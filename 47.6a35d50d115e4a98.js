"use strict";(self.webpackChunkaetherAI_home_challenge=self.webpackChunkaetherAI_home_challenge||[]).push([[47],{6047:(_v,Za,O)=>{O.r(Za),O.d(Za,{TodoListModule:()=>Iv});var Ha=O(6895),Wa=O(2038),k=O(4650),Xa=O(8746),ke=O(4004),Ya=O(8505),Ud=O(4986),Bd=O(9751),Rr=O(8996),Ja=O(9646),Re=O(5813),Hs=O(8675),qd=O(4482),Gd=O(5403);function Ws(){return(0,qd.e)((n,e)=>{let t,r=!1;n.subscribe((0,Gd.x)(e,s=>{const i=t;t=s,r&&e.next([i,s]),r=!0}))})}var E,Xs=O(5026),Kd=O(1884),eu=O(9300),Mr=O(2011),jd=(O(1451),O(3942)),p=O(5861),Fr=O(9681),tu=O(4859),pt=O(1877),L=O(2090),$d=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},Ge={},Ys=Ys||{},A=$d||self;function Lr(){}function Js(n){var e=typeof n;return"array"==(e="object"!=e?e:n?Array.isArray(n)?"array":e:"null")||"object"==e&&"number"==typeof n.length}function bn(n){var e=typeof n;return"object"==e&&null!=n||"function"==e}var ei="closure_uid_"+(1e9*Math.random()>>>0),Qd=0;function Zd(n,e,t){return n.call.apply(n.bind,arguments)}function Hd(n,e,t){if(!n)throw Error();if(2<arguments.length){var r=Array.prototype.slice.call(arguments,2);return function(){var s=Array.prototype.slice.call(arguments);return Array.prototype.unshift.apply(s,r),n.apply(e,s)}}return function(){return n.apply(e,arguments)}}function le(n,e,t){return(le=Function.prototype.bind&&-1!=Function.prototype.bind.toString().indexOf("native code")?Zd:Hd).apply(null,arguments)}function Or(n,e){var t=Array.prototype.slice.call(arguments,1);return function(){var r=t.slice();return r.push.apply(r,arguments),n.apply(this,r)}}function he(n,e){function t(){}t.prototype=e.prototype,n.Z=e.prototype,n.prototype=new t,n.prototype.constructor=n,n.Vb=function(r,s,i){for(var o=Array(arguments.length-2),a=2;a<arguments.length;a++)o[a-2]=arguments[a];return e.prototype[s].apply(r,o)}}function Xe(){this.s=this.s,this.o=this.o}var Xd={};Xe.prototype.s=!1,Xe.prototype.na=function(){if(!this.s&&(this.s=!0,this.M(),0)){var n=function zd(n){return Object.prototype.hasOwnProperty.call(n,ei)&&n[ei]||(n[ei]=++Qd)}(this);delete Xd[n]}},Xe.prototype.M=function(){if(this.o)for(;this.o.length;)this.o.shift()()};const nu=Array.prototype.indexOf?function(n,e){return Array.prototype.indexOf.call(n,e,void 0)}:function(n,e){if("string"==typeof n)return"string"!=typeof e||1!=e.length?-1:n.indexOf(e,0);for(let t=0;t<n.length;t++)if(t in n&&n[t]===e)return t;return-1},ru=Array.prototype.forEach?function(n,e,t){Array.prototype.forEach.call(n,e,t)}:function(n,e,t){const r=n.length,s="string"==typeof n?n.split(""):n;for(let i=0;i<r;i++)i in s&&e.call(t,s[i],i,n)};function su(n){return Array.prototype.concat.apply([],arguments)}function ti(n){const e=n.length;if(0<e){const t=Array(e);for(let r=0;r<e;r++)t[r]=n[r];return t}return[]}function Vr(n){return/^[\s\xa0]*$/.test(n)}var Ie,iu=String.prototype.trim?function(n){return n.trim()}:function(n){return/^[\s\xa0]*([\s\S]*?)[\s\xa0]*$/.exec(n)[1]};function we(n,e){return-1!=n.indexOf(e)}function ni(n,e){return n<e?-1:n>e?1:0}e:{var ou=A.navigator;if(ou){var au=ou.userAgent;if(au){Ie=au;break e}}Ie=""}function ri(n,e,t){for(const r in n)e.call(t,n[r],r,n)}function uu(n){const e={};for(const t in n)e[t]=n[t];return e}var cu="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function lu(n,e){let t,r;for(let s=1;s<arguments.length;s++){for(t in r=arguments[s],r)n[t]=r[t];for(let i=0;i<cu.length;i++)t=cu[i],Object.prototype.hasOwnProperty.call(r,t)&&(n[t]=r[t])}}function si(n){return si[" "](n),n}si[" "]=Lr;var Pr,n,ef=we(Ie,"Opera"),Qt=we(Ie,"Trident")||we(Ie,"MSIE"),hu=we(Ie,"Edge"),ii=hu||Qt,du=we(Ie,"Gecko")&&!(we(Ie.toLowerCase(),"webkit")&&!we(Ie,"Edge"))&&!(we(Ie,"Trident")||we(Ie,"MSIE"))&&!we(Ie,"Edge"),tf=we(Ie.toLowerCase(),"webkit")&&!we(Ie,"Edge");function fu(){var n=A.document;return n?n.documentMode:void 0}e:{var oi="",ai=(n=Ie,du?/rv:([^\);]+)(\)|;)/.exec(n):hu?/Edge\/([\d\.]+)/.exec(n):Qt?/\b(?:MSIE|rv)[: ]([^\);]+)(\)|;)/.exec(n):tf?/WebKit\/(\S+)/.exec(n):ef?/(?:Version)[ \/]?(\S+)/.exec(n):void 0);if(ai&&(oi=ai?ai[1]:""),Qt){var ui=fu();if(null!=ui&&ui>parseFloat(oi)){Pr=String(ui);break e}}Pr=oi}var nf={};var sf=A.document&&Qt&&(fu()||parseInt(Pr,10))||void 0,of=function(){if(!A.addEventListener||!Object.defineProperty)return!1;var n=!1,e=Object.defineProperty({},"passive",{get:function(){n=!0}});try{A.addEventListener("test",Lr,e),A.removeEventListener("test",Lr,e)}catch{}return n}();function pe(n,e){this.type=n,this.g=this.target=e,this.defaultPrevented=!1}function Dn(n,e){if(pe.call(this,n?n.type:""),this.relatedTarget=this.g=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.state=null,this.pointerId=0,this.pointerType="",this.i=null,n){var t=this.type=n.type,r=n.changedTouches&&n.changedTouches.length?n.changedTouches[0]:null;if(this.target=n.target||n.srcElement,this.g=e,e=n.relatedTarget){if(du){e:{try{si(e.nodeName);var s=!0;break e}catch{}s=!1}s||(e=null)}}else"mouseover"==t?e=n.fromElement:"mouseout"==t&&(e=n.toElement);this.relatedTarget=e,r?(this.clientX=void 0!==r.clientX?r.clientX:r.pageX,this.clientY=void 0!==r.clientY?r.clientY:r.pageY,this.screenX=r.screenX||0,this.screenY=r.screenY||0):(this.clientX=void 0!==n.clientX?n.clientX:n.pageX,this.clientY=void 0!==n.clientY?n.clientY:n.pageY,this.screenX=n.screenX||0,this.screenY=n.screenY||0),this.button=n.button,this.key=n.key||"",this.ctrlKey=n.ctrlKey,this.altKey=n.altKey,this.shiftKey=n.shiftKey,this.metaKey=n.metaKey,this.pointerId=n.pointerId||0,this.pointerType="string"==typeof n.pointerType?n.pointerType:af[n.pointerType]||"",this.state=n.state,this.i=n,n.defaultPrevented&&Dn.Z.h.call(this)}}pe.prototype.h=function(){this.defaultPrevented=!0},he(Dn,pe);var af={2:"touch",3:"pen",4:"mouse"};Dn.prototype.h=function(){Dn.Z.h.call(this);var n=this.i;n.preventDefault?n.preventDefault():n.returnValue=!1};var An="closure_listenable_"+(1e6*Math.random()|0),uf=0;function cf(n,e,t,r,s){this.listener=n,this.proxy=null,this.src=e,this.type=t,this.capture=!!r,this.ia=s,this.key=++uf,this.ca=this.fa=!1}function Ur(n){n.ca=!0,n.listener=null,n.proxy=null,n.src=null,n.ia=null}function Br(n){this.src=n,this.g={},this.h=0}function li(n,e){var t=e.type;if(t in n.g){var i,r=n.g[t],s=nu(r,e);(i=0<=s)&&Array.prototype.splice.call(r,s,1),i&&(Ur(e),0==n.g[t].length&&(delete n.g[t],n.h--))}}function hi(n,e,t,r){for(var s=0;s<n.length;++s){var i=n[s];if(!i.ca&&i.listener==e&&i.capture==!!t&&i.ia==r)return s}return-1}Br.prototype.add=function(n,e,t,r,s){var i=n.toString();(n=this.g[i])||(n=this.g[i]=[],this.h++);var o=hi(n,e,r,s);return-1<o?(e=n[o],t||(e.fa=!1)):((e=new cf(e,this.src,i,!!r,s)).fa=t,n.push(e)),e};var di="closure_lm_"+(1e6*Math.random()|0),fi={};function gu(n,e,t,r,s){if(r&&r.once)return yu(n,e,t,r,s);if(Array.isArray(e)){for(var i=0;i<e.length;i++)gu(n,e[i],t,r,s);return null}return t=yi(t),n&&n[An]?n.N(e,t,bn(r)?!!r.capture:!!r,s):pu(n,e,t,!1,r,s)}function pu(n,e,t,r,s,i){if(!e)throw Error("Invalid event type");var o=bn(s)?!!s.capture:!!s,a=gi(n);if(a||(n[di]=a=new Br(n)),(t=a.add(e,t,r,o,i)).proxy)return t;if(r=function lf(){var e=hf;return function n(t){return e.call(n.src,n.listener,t)}}(),t.proxy=r,r.src=n,r.listener=t,n.addEventListener)of||(s=o),void 0===s&&(s=!1),n.addEventListener(e.toString(),r,s);else if(n.attachEvent)n.attachEvent(wu(e.toString()),r);else{if(!n.addListener||!n.removeListener)throw Error("addEventListener and attachEvent are unavailable.");n.addListener(r)}return t}function yu(n,e,t,r,s){if(Array.isArray(e)){for(var i=0;i<e.length;i++)yu(n,e[i],t,r,s);return null}return t=yi(t),n&&n[An]?n.O(e,t,bn(r)?!!r.capture:!!r,s):pu(n,e,t,!0,r,s)}function vu(n,e,t,r,s){if(Array.isArray(e))for(var i=0;i<e.length;i++)vu(n,e[i],t,r,s);else r=bn(r)?!!r.capture:!!r,t=yi(t),n&&n[An]?(n=n.i,(e=String(e).toString())in n.g&&-1<(t=hi(i=n.g[e],t,r,s))&&(Ur(i[t]),Array.prototype.splice.call(i,t,1),0==i.length&&(delete n.g[e],n.h--))):n&&(n=gi(n))&&(e=n.g[e.toString()],n=-1,e&&(n=hi(e,t,r,s)),(t=-1<n?e[n]:null)&&mi(t))}function mi(n){if("number"!=typeof n&&n&&!n.ca){var e=n.src;if(e&&e[An])li(e.i,n);else{var t=n.type,r=n.proxy;e.removeEventListener?e.removeEventListener(t,r,n.capture):e.detachEvent?e.detachEvent(wu(t),r):e.addListener&&e.removeListener&&e.removeListener(r),(t=gi(e))?(li(t,n),0==t.h&&(t.src=null,e[di]=null)):Ur(n)}}}function wu(n){return n in fi?fi[n]:fi[n]="on"+n}function hf(n,e){if(n.ca)n=!0;else{e=new Dn(e,this);var t=n.listener,r=n.ia||n.src;n.fa&&mi(n),n=t.call(r,e)}return n}function gi(n){return(n=n[di])instanceof Br?n:null}var pi="__closure_events_fn_"+(1e9*Math.random()>>>0);function yi(n){return"function"==typeof n?n:(n[pi]||(n[pi]=function(e){return n.handleEvent(e)}),n[pi])}function se(){Xe.call(this),this.i=new Br(this),this.P=this,this.I=null}function de(n,e){var t,r=n.I;if(r)for(t=[];r;r=r.I)t.push(r);if(n=n.P,r=e.type||e,"string"==typeof e)e=new pe(e,n);else if(e instanceof pe)e.target=e.target||n;else{var s=e;lu(e=new pe(r,n),s)}if(s=!0,t)for(var i=t.length-1;0<=i;i--){var o=e.g=t[i];s=qr(o,r,!0,e)&&s}if(s=qr(o=e.g=n,r,!0,e)&&s,s=qr(o,r,!1,e)&&s,t)for(i=0;i<t.length;i++)s=qr(o=e.g=t[i],r,!1,e)&&s}function qr(n,e,t,r){if(!(e=n.i.g[String(e)]))return!0;e=e.concat();for(var s=!0,i=0;i<e.length;++i){var o=e[i];if(o&&!o.ca&&o.capture==t){var a=o.listener,u=o.ia||o.src;o.fa&&li(n.i,o),s=!1!==a.call(u,r)&&s}}return s&&!r.defaultPrevented}he(se,Xe),se.prototype[An]=!0,se.prototype.removeEventListener=function(n,e,t,r){vu(this,n,e,t,r)},se.prototype.M=function(){if(se.Z.M.call(this),this.i){var e,n=this.i;for(e in n.g){for(var t=n.g[e],r=0;r<t.length;r++)Ur(t[r]);delete n.g[e],n.h--}}this.I=null},se.prototype.N=function(n,e,t,r){return this.i.add(String(n),e,!1,t,r)},se.prototype.O=function(n,e,t,r){return this.i.add(String(n),e,!0,t,r)};var vi=A.JSON.stringify;function df(){var n=_u;let e=null;return n.g&&(e=n.g,n.g=n.g.next,n.g||(n.h=null),e.next=null),e}var Ii,Iu=new class{constructor(n,e){this.i=n,this.j=e,this.h=0,this.g=null}get(){let n;return 0<this.h?(this.h--,n=this.g,this.g=n.next,n.next=null):n=this.i(),n}}(()=>new mf,n=>n.reset());class mf{constructor(){this.next=this.g=this.h=null}set(e,t){this.h=e,this.g=t,this.next=null}reset(){this.next=this.g=this.h=null}}function gf(n){A.setTimeout(()=>{throw n},0)}function wi(n,e){Ii||function pf(){var n=A.Promise.resolve(void 0);Ii=function(){n.then(yf)}}(),_i||(Ii(),_i=!0),_u.add(n,e)}var _i=!1,_u=new class ff{constructor(){this.h=this.g=null}add(e,t){const r=Iu.get();r.set(e,t),this.h?this.h.next=r:this.g=r,this.h=r}};function yf(){for(var n;n=df();){try{n.h.call(n.g)}catch(t){gf(t)}var e=Iu;e.j(n),100>e.h&&(e.h++,n.next=e.g,e.g=n)}_i=!1}function Gr(n,e){se.call(this),this.h=n||1,this.g=e||A,this.j=le(this.kb,this),this.l=Date.now()}function xi(n){n.da=!1,n.S&&(n.g.clearTimeout(n.S),n.S=null)}function Ei(n,e,t){if("function"==typeof n)t&&(n=le(n,t));else{if(!n||"function"!=typeof n.handleEvent)throw Error("Invalid listener argument");n=le(n.handleEvent,n)}return 2147483647<Number(e)?-1:A.setTimeout(n,e||0)}function xu(n){n.g=Ei(()=>{n.g=null,n.i&&(n.i=!1,xu(n))},n.j);const e=n.h;n.h=null,n.m.apply(null,e)}he(Gr,se),(E=Gr.prototype).da=!1,E.S=null,E.kb=function(){if(this.da){var n=Date.now()-this.l;0<n&&n<.8*this.h?this.S=this.g.setTimeout(this.j,this.h-n):(this.S&&(this.g.clearTimeout(this.S),this.S=null),de(this,"tick"),this.da&&(xi(this),this.start()))}},E.start=function(){this.da=!0,this.S||(this.S=this.g.setTimeout(this.j,this.h),this.l=Date.now())},E.M=function(){Gr.Z.M.call(this),xi(this),delete this.g};class vf extends Xe{constructor(e,t){super(),this.m=e,this.j=t,this.h=null,this.i=!1,this.g=null}l(e){this.h=arguments,this.g?this.i=!0:xu(this)}M(){super.M(),this.g&&(A.clearTimeout(this.g),this.g=null,this.i=!1,this.h=null)}}function Cn(n){Xe.call(this),this.h=n,this.g={}}he(Cn,Xe);var Eu=[];function Tu(n,e,t,r){Array.isArray(t)||(t&&(Eu[0]=t.toString()),t=Eu);for(var s=0;s<t.length;s++){var i=gu(e,t[s],r||n.handleEvent,!1,n.h||n);if(!i)break;n.g[i.key]=i}}function Su(n){ri(n.g,function(e,t){this.g.hasOwnProperty(t)&&mi(e)},n),n.g={}}function Kr(){this.g=!0}function Zt(n,e,t,r){n.info(function(){return"XMLHTTP TEXT ("+e+"): "+function xf(n,e){if(!n.g)return e;if(!e)return null;try{var t=JSON.parse(e);if(t)for(n=0;n<t.length;n++)if(Array.isArray(t[n])){var r=t[n];if(!(2>r.length)){var s=r[1];if(Array.isArray(s)&&!(1>s.length)){var i=s[0];if("noop"!=i&&"stop"!=i&&"close"!=i)for(var o=1;o<s.length;o++)s[o]=""}}}return vi(t)}catch{return e}}(n,t)+(r?" "+r:"")})}Cn.prototype.M=function(){Cn.Z.M.call(this),Su(this)},Cn.prototype.handleEvent=function(){throw Error("EventHandler.handleEvent not implemented")},Kr.prototype.Aa=function(){this.g=!1},Kr.prototype.info=function(){};var yt={},bu=null;function jr(){return bu=bu||new se}function Du(n){pe.call(this,yt.Ma,n)}function Nn(n){const e=jr();de(e,new Du(e,n))}function Au(n,e){pe.call(this,yt.STAT_EVENT,n),this.stat=e}function _e(n){const e=jr();de(e,new Au(e,n))}function Cu(n,e){pe.call(this,yt.Na,n),this.size=e}function kn(n,e){if("function"!=typeof n)throw Error("Fn must not be null and must be a function");return A.setTimeout(function(){n()},e)}yt.Ma="serverreachability",he(Du,pe),yt.STAT_EVENT="statevent",he(Au,pe),yt.Na="timingevent",he(Cu,pe);var $r={NO_ERROR:0,lb:1,yb:2,xb:3,sb:4,wb:5,zb:6,Ja:7,TIMEOUT:8,Cb:9},Nu={qb:"complete",Mb:"success",Ka:"error",Ja:"abort",Eb:"ready",Fb:"readystatechange",TIMEOUT:"timeout",Ab:"incrementaldata",Db:"progress",tb:"downloadprogress",Ub:"uploadprogress"};function Ti(){}function Ru(){}Ti.prototype.h=null;var Di,Rn={OPEN:"a",pb:"b",Ka:"c",Bb:"d"};function Si(){pe.call(this,"d")}function bi(){pe.call(this,"c")}function zr(){}function Mn(n,e,t,r){this.l=n,this.j=e,this.m=t,this.X=r||1,this.V=new Cn(this),this.P=Ef,this.W=new Gr(n=ii?125:void 0),this.H=null,this.i=!1,this.s=this.A=this.v=this.K=this.F=this.Y=this.B=null,this.D=[],this.g=null,this.C=0,this.o=this.u=null,this.N=-1,this.I=!1,this.O=0,this.L=null,this.aa=this.J=this.$=this.U=!1,this.h=new Mu}function Mu(){this.i=null,this.g="",this.h=!1}he(Si,pe),he(bi,pe),he(zr,Ti),zr.prototype.g=function(){return new XMLHttpRequest},zr.prototype.i=function(){return{}},Di=new zr;var Ef=45e3,Ai={},Qr={};function Ci(n,e,t){n.K=1,n.v=Yr(Ke(e)),n.s=t,n.U=!0,Fu(n,null)}function Fu(n,e){n.F=Date.now(),Fn(n),n.A=Ke(n.v);var t=n.A,r=n.X;Array.isArray(r)||(r=[String(r)]),Ku(t.h,"t",r),n.C=0,t=n.l.H,n.h=new Mu,n.g=dc(n.l,t?e:null,!n.s),0<n.O&&(n.L=new vf(le(n.Ia,n,n.g),n.O)),Tu(n.V,n.g,"readystatechange",n.gb),e=n.H?uu(n.H):{},n.s?(n.u||(n.u="POST"),e["Content-Type"]="application/x-www-form-urlencoded",n.g.ea(n.A,n.u,n.s,e)):(n.u="GET",n.g.ea(n.A,n.u,null,e)),Nn(1),function wf(n,e,t,r,s,i){n.info(function(){if(n.g)if(i)for(var o="",a=i.split("&"),u=0;u<a.length;u++){var c=a[u].split("=");if(1<c.length){var l=c[0];c=c[1];var h=l.split("_");o=2<=h.length&&"type"==h[1]?o+(l+"=")+c+"&":o+(l+"=redacted&")}}else o=null;else o=i;return"XMLHTTP REQ ("+r+") [attempt "+s+"]: "+e+"\n"+t+"\n"+o})}(n.j,n.u,n.A,n.m,n.X,n.s)}function Lu(n){return!!n.g&&"GET"==n.u&&2!=n.K&&n.l.Ba}function Ou(n,e,t){let s,r=!0;for(;!n.I&&n.C<t.length;){if(s=Tf(n,t),s==Qr){4==e&&(n.o=4,_e(14),r=!1),Zt(n.j,n.m,null,"[Incomplete Response]");break}if(s==Ai){n.o=4,_e(15),Zt(n.j,n.m,t,"[Invalid Chunk]"),r=!1;break}Zt(n.j,n.m,s,null),Ni(n,s)}Lu(n)&&s!=Qr&&s!=Ai&&(n.h.g="",n.C=0),4!=e||0!=t.length||n.h.h||(n.o=1,_e(16),r=!1),n.i=n.i&&r,r?0<t.length&&!n.aa&&(n.aa=!0,(e=n.l).g==n&&e.$&&!e.L&&(e.h.info("Great, no buffering proxy detected. Bytes received: "+t.length),qi(e),e.L=!0,_e(11))):(Zt(n.j,n.m,t,"[Invalid Chunked Response]"),vt(n),Ln(n))}function Tf(n,e){var t=n.C,r=e.indexOf("\n",t);return-1==r?Qr:(t=Number(e.substring(t,r)),isNaN(t)?Ai:(r+=1)+t>e.length?Qr:(e=e.substr(r,t),n.C=r+t,e))}function Fn(n){n.Y=Date.now()+n.P,Vu(n,n.P)}function Vu(n,e){if(null!=n.B)throw Error("WatchDog timer not null");n.B=kn(le(n.eb,n),e)}function Zr(n){n.B&&(A.clearTimeout(n.B),n.B=null)}function Ln(n){0==n.l.G||n.I||uc(n.l,n)}function vt(n){Zr(n);var e=n.L;e&&"function"==typeof e.na&&e.na(),n.L=null,xi(n.W),Su(n.V),n.g&&(e=n.g,n.g=null,e.abort(),e.na())}function Ni(n,e){try{var t=n.l;if(0!=t.G&&(t.g==n||Mi(t.i,n)))if(t.I=n.N,!n.J&&Mi(t.i,n)&&3==t.G){try{var r=t.Ca.g.parse(e)}catch{r=null}if(Array.isArray(r)&&3==r.length){var s=r;if(0==s[0]){e:if(!t.u){if(t.g){if(!(t.g.F+3e3<n.F))break e;ss(t),ns(t)}Bi(t),_e(18)}}else t.ta=s[1],0<t.ta-t.U&&37500>s[2]&&t.N&&0==t.A&&!t.v&&(t.v=kn(le(t.ab,t),6e3));if(1>=zu(t.i)&&t.ka){try{t.ka()}catch{}t.ka=void 0}}else _t(t,11)}else if((n.J||t.g==n)&&ss(t),!Vr(e))for(s=t.Ca.g.parse(e),e=0;e<s.length;e++){let c=s[e];if(t.U=c[0],c=c[1],2==t.G)if("c"==c[0]){t.J=c[1],t.la=c[2];const l=c[3];null!=l&&(t.ma=l,t.h.info("VER="+t.ma));const h=c[4];null!=h&&(t.za=h,t.h.info("SVER="+t.za));const d=c[5];null!=d&&"number"==typeof d&&0<d&&(t.K=r=1.5*d,t.h.info("backChannelRequestTimeoutMs_="+r)),r=t;const g=n.g;if(g){const y=g.g?g.g.getResponseHeader("X-Client-Wire-Protocol"):null;if(y){var i=r.i;!i.g&&(we(y,"spdy")||we(y,"quic")||we(y,"h2"))&&(i.j=i.l,i.g=new Set,i.h&&(Fi(i,i.h),i.h=null))}if(r.D){const x=g.g?g.g.getResponseHeader("X-HTTP-Session-Id"):null;x&&(r.sa=x,j(r.F,r.D,x))}}t.G=3,t.j&&t.j.xa(),t.$&&(t.O=Date.now()-n.F,t.h.info("Handshake RTT: "+t.O+"ms"));var o=n;if((r=t).oa=hc(r,r.H?r.la:null,r.W),o.J){Qu(r.i,o);var a=o,u=r.K;u&&a.setTimeout(u),a.B&&(Zr(a),Fn(a)),r.g=o}else oc(r);0<t.l.length&&rs(t)}else"stop"!=c[0]&&"close"!=c[0]||_t(t,7);else 3==t.G&&("stop"==c[0]||"close"==c[0]?"stop"==c[0]?_t(t,7):Pi(t):"noop"!=c[0]&&t.j&&t.j.wa(c),t.A=0)}Nn(4)}catch{}}function ki(n,e){if(n.forEach&&"function"==typeof n.forEach)n.forEach(e,void 0);else if(Js(n)||"string"==typeof n)ru(n,e,void 0);else{if(n.T&&"function"==typeof n.T)var t=n.T();else if(n.R&&"function"==typeof n.R)t=void 0;else if(Js(n)||"string"==typeof n){t=[];for(var r=n.length,s=0;s<r;s++)t.push(s)}else for(s in t=[],r=0,n)t[r++]=s;r=function Sf(n){if(n.R&&"function"==typeof n.R)return n.R();if("string"==typeof n)return n.split("");if(Js(n)){for(var e=[],t=n.length,r=0;r<t;r++)e.push(n[r]);return e}for(r in e=[],t=0,n)e[t++]=n[r];return e}(n),s=r.length;for(var i=0;i<s;i++)e.call(void 0,r[i],t&&t[i],n)}}function Ht(n,e){this.h={},this.g=[],this.i=0;var t=arguments.length;if(1<t){if(t%2)throw Error("Uneven number of arguments");for(var r=0;r<t;r+=2)this.set(arguments[r],arguments[r+1])}else if(n)if(n instanceof Ht)for(t=n.T(),r=0;r<t.length;r++)this.set(t[r],n.get(t[r]));else for(r in n)this.set(r,n[r])}function Ri(n){if(n.i!=n.g.length){for(var e=0,t=0;e<n.g.length;){var r=n.g[e];wt(n.h,r)&&(n.g[t++]=r),e++}n.g.length=t}if(n.i!=n.g.length){var s={};for(t=e=0;e<n.g.length;)wt(s,r=n.g[e])||(n.g[t++]=r,s[r]=1),e++;n.g.length=t}}function wt(n,e){return Object.prototype.hasOwnProperty.call(n,e)}(E=Mn.prototype).setTimeout=function(n){this.P=n},E.gb=function(n){n=n.target;const e=this.L;e&&3==je(n)?e.l():this.Ia(n)},E.Ia=function(n){try{if(n==this.g)e:{const l=je(this.g);var e=this.g.Da();const h=this.g.ba();if(!(3>l)&&(3!=l||ii||this.g&&(this.h.h||this.g.ga()||tc(this.g)))){this.I||4!=l||7==e||Nn(8==e||0>=h?3:2),Zr(this);var t=this.g.ba();this.N=t;t:if(Lu(this)){var r=tc(this.g);n="";var s=r.length,i=4==je(this.g);if(!this.h.i){if(typeof TextDecoder>"u"){vt(this),Ln(this);var o="";break t}this.h.i=new A.TextDecoder}for(e=0;e<s;e++)this.h.h=!0,n+=this.h.i.decode(r[e],{stream:i&&e==s-1});r.splice(0,s),this.h.g+=n,this.C=0,o=this.h.g}else o=this.g.ga();if(this.i=200==t,function If(n,e,t,r,s,i,o){n.info(function(){return"XMLHTTP RESP ("+r+") [ attempt "+s+"]: "+e+"\n"+t+"\n"+i+" "+o})}(this.j,this.u,this.A,this.m,this.X,l,t),this.i){if(this.$&&!this.J){t:{if(this.g){var a,u=this.g;if((a=u.g?u.g.getResponseHeader("X-HTTP-Initial-Response"):null)&&!Vr(a)){var c=a;break t}}c=null}if(!(t=c)){this.i=!1,this.o=3,_e(12),vt(this),Ln(this);break e}Zt(this.j,this.m,t,"Initial handshake response via X-HTTP-Initial-Response"),this.J=!0,Ni(this,t)}this.U?(Ou(this,l,o),ii&&this.i&&3==l&&(Tu(this.V,this.W,"tick",this.fb),this.W.start())):(Zt(this.j,this.m,o,null),Ni(this,o)),4==l&&vt(this),this.i&&!this.I&&(4==l?uc(this.l,this):(this.i=!1,Fn(this)))}else 400==t&&0<o.indexOf("Unknown SID")?(this.o=3,_e(12)):(this.o=0,_e(13)),vt(this),Ln(this)}}}catch{}},E.fb=function(){if(this.g){var n=je(this.g),e=this.g.ga();this.C<e.length&&(Zr(this),Ou(this,n,e),this.i&&4!=n&&Fn(this))}},E.cancel=function(){this.I=!0,vt(this)},E.eb=function(){this.B=null;const n=Date.now();0<=n-this.Y?(function _f(n,e){n.info(function(){return"TIMEOUT: "+e})}(this.j,this.A),2!=this.K&&(Nn(3),_e(17)),vt(this),this.o=2,Ln(this)):Vu(this,this.Y-n)},(E=Ht.prototype).R=function(){Ri(this);for(var n=[],e=0;e<this.g.length;e++)n.push(this.h[this.g[e]]);return n},E.T=function(){return Ri(this),this.g.concat()},E.get=function(n,e){return wt(this.h,n)?this.h[n]:e},E.set=function(n,e){wt(this.h,n)||(this.i++,this.g.push(n)),this.h[n]=e},E.forEach=function(n,e){for(var t=this.T(),r=0;r<t.length;r++){var s=t[r],i=this.get(s);n.call(e,i,s,this)}};var Pu=/^(?:([^:/?#.]+):)?(?:\/\/(?:([^\\/?#]*)@)?([^\\/?#]*?)(?::([0-9]+))?(?=[\\/?#]|$))?([^?#]+)?(?:\?([^#]*))?(?:#([\s\S]*))?$/;function It(n,e){if(this.i=this.s=this.j="",this.m=null,this.o=this.l="",this.g=!1,n instanceof It){this.g=void 0!==e?e:n.g,Hr(this,n.j),this.s=n.s,Wr(this,n.i),Xr(this,n.m),this.l=n.l,e=n.h;var t=new Pn;t.i=e.i,e.g&&(t.g=new Ht(e.g),t.h=e.h),Uu(this,t),this.o=n.o}else n&&(t=String(n).match(Pu))?(this.g=!!e,Hr(this,t[1]||"",!0),this.s=On(t[2]||""),Wr(this,t[3]||"",!0),Xr(this,t[4]),this.l=On(t[5]||"",!0),Uu(this,t[6]||"",!0),this.o=On(t[7]||"")):(this.g=!!e,this.h=new Pn(null,this.g))}function Ke(n){return new It(n)}function Hr(n,e,t){n.j=t?On(e,!0):e,n.j&&(n.j=n.j.replace(/:$/,""))}function Wr(n,e,t){n.i=t?On(e,!0):e}function Xr(n,e){if(e){if(e=Number(e),isNaN(e)||0>e)throw Error("Bad port number "+e);n.m=e}else n.m=null}function Uu(n,e,t){e instanceof Pn?(n.h=e,function Ff(n,e){e&&!n.j&&(Ye(n),n.i=null,n.g.forEach(function(t,r){var s=r.toLowerCase();r!=s&&(qu(this,r),Ku(this,s,t))},n)),n.j=e}(n.h,n.g)):(t||(e=Vn(e,Rf)),n.h=new Pn(e,n.g))}function j(n,e,t){n.h.set(e,t)}function Yr(n){return j(n,"zx",Math.floor(2147483648*Math.random()).toString(36)+Math.abs(Math.floor(2147483648*Math.random())^Date.now()).toString(36)),n}function On(n,e){return n?e?decodeURI(n.replace(/%25/g,"%2525")):decodeURIComponent(n):""}function Vn(n,e,t){return"string"==typeof n?(n=encodeURI(n).replace(e,Cf),t&&(n=n.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),n):null}function Cf(n){return"%"+((n=n.charCodeAt(0))>>4&15).toString(16)+(15&n).toString(16)}It.prototype.toString=function(){var n=[],e=this.j;e&&n.push(Vn(e,Bu,!0),":");var t=this.i;return(t||"file"==e)&&(n.push("//"),(e=this.s)&&n.push(Vn(e,Bu,!0),"@"),n.push(encodeURIComponent(String(t)).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),null!=(t=this.m)&&n.push(":",String(t))),(t=this.l)&&(this.i&&"/"!=t.charAt(0)&&n.push("/"),n.push(Vn(t,"/"==t.charAt(0)?kf:Nf,!0))),(t=this.h.toString())&&n.push("?",t),(t=this.o)&&n.push("#",Vn(t,Mf)),n.join("")};var Bu=/[#\/\?@]/g,Nf=/[#\?:]/g,kf=/[#\?]/g,Rf=/[#\?@]/g,Mf=/#/g;function Pn(n,e){this.h=this.g=null,this.i=n||null,this.j=!!e}function Ye(n){n.g||(n.g=new Ht,n.h=0,n.i&&function bf(n,e){if(n){n=n.split("&");for(var t=0;t<n.length;t++){var r=n[t].indexOf("="),s=null;if(0<=r){var i=n[t].substring(0,r);s=n[t].substring(r+1)}else i=n[t];e(i,s?decodeURIComponent(s.replace(/\+/g," ")):"")}}}(n.i,function(e,t){n.add(decodeURIComponent(e.replace(/\+/g," ")),t)}))}function qu(n,e){Ye(n),e=Wt(n,e),wt(n.g.h,e)&&(n.i=null,n.h-=n.g.get(e).length,wt((n=n.g).h,e)&&(delete n.h[e],n.i--,n.g.length>2*n.i&&Ri(n)))}function Gu(n,e){return Ye(n),e=Wt(n,e),wt(n.g.h,e)}function Ku(n,e,t){qu(n,e),0<t.length&&(n.i=null,n.g.set(Wt(n,e),ti(t)),n.h+=t.length)}function Wt(n,e){return e=String(e),n.j&&(e=e.toLowerCase()),e}function ju(n){this.l=n||Of,n=A.PerformanceNavigationTiming?0<(n=A.performance.getEntriesByType("navigation")).length&&("hq"==n[0].nextHopProtocol||"h2"==n[0].nextHopProtocol):!!(A.g&&A.g.Ea&&A.g.Ea()&&A.g.Ea().Zb),this.j=n?this.l:1,this.g=null,1<this.j&&(this.g=new Set),this.h=null,this.i=[]}(E=Pn.prototype).add=function(n,e){Ye(this),this.i=null,n=Wt(this,n);var t=this.g.get(n);return t||this.g.set(n,t=[]),t.push(e),this.h+=1,this},E.forEach=function(n,e){Ye(this),this.g.forEach(function(t,r){ru(t,function(s){n.call(e,s,r,this)},this)},this)},E.T=function(){Ye(this);for(var n=this.g.R(),e=this.g.T(),t=[],r=0;r<e.length;r++)for(var s=n[r],i=0;i<s.length;i++)t.push(e[r]);return t},E.R=function(n){Ye(this);var e=[];if("string"==typeof n)Gu(this,n)&&(e=su(e,this.g.get(Wt(this,n))));else{n=this.g.R();for(var t=0;t<n.length;t++)e=su(e,n[t])}return e},E.set=function(n,e){return Ye(this),this.i=null,Gu(this,n=Wt(this,n))&&(this.h-=this.g.get(n).length),this.g.set(n,[e]),this.h+=1,this},E.get=function(n,e){return n&&0<(n=this.R(n)).length?String(n[0]):e},E.toString=function(){if(this.i)return this.i;if(!this.g)return"";for(var n=[],e=this.g.T(),t=0;t<e.length;t++){var r=e[t],s=encodeURIComponent(String(r));r=this.R(r);for(var i=0;i<r.length;i++){var o=s;""!==r[i]&&(o+="="+encodeURIComponent(String(r[i]))),n.push(o)}}return this.i=n.join("&")};var Of=10;function $u(n){return!!n.h||!!n.g&&n.g.size>=n.j}function zu(n){return n.h?1:n.g?n.g.size:0}function Mi(n,e){return n.h?n.h==e:!!n.g&&n.g.has(e)}function Fi(n,e){n.g?n.g.add(e):n.h=e}function Qu(n,e){n.h&&n.h==e?n.h=null:n.g&&n.g.has(e)&&n.g.delete(e)}function Zu(n){if(null!=n.h)return n.i.concat(n.h.D);if(null!=n.g&&0!==n.g.size){let e=n.i;for(const t of n.g.values())e=e.concat(t.D);return e}return ti(n.i)}function Li(){}function Vf(){this.g=new Li}function Pf(n,e,t){const r=t||"";try{ki(n,function(s,i){let o=s;bn(s)&&(o=vi(s)),e.push(r+i+"="+encodeURIComponent(o))})}catch(s){throw e.push(r+"type="+encodeURIComponent("_badmap")),s}}function Jr(n,e,t,r,s){try{e.onload=null,e.onerror=null,e.onabort=null,e.ontimeout=null,s(r)}catch{}}function Un(n){this.l=n.$b||null,this.j=n.ib||!1}function es(n,e){se.call(this),this.D=n,this.u=e,this.m=void 0,this.readyState=Oi,this.status=0,this.responseType=this.responseText=this.response=this.statusText="",this.onreadystatechange=null,this.v=new Headers,this.h=null,this.C="GET",this.B="",this.g=!1,this.A=this.j=this.l=null}ju.prototype.cancel=function(){if(this.i=Zu(this),this.h)this.h.cancel(),this.h=null;else if(this.g&&0!==this.g.size){for(const n of this.g.values())n.cancel();this.g.clear()}},Li.prototype.stringify=function(n){return A.JSON.stringify(n,void 0)},Li.prototype.parse=function(n){return A.JSON.parse(n,void 0)},he(Un,Ti),Un.prototype.g=function(){return new es(this.l,this.j)},Un.prototype.i=function(n){return function(){return n}}({}),he(es,se);var Oi=0;function Hu(n){n.j.read().then(n.Sa.bind(n)).catch(n.ha.bind(n))}function Bn(n){n.readyState=4,n.l=null,n.j=null,n.A=null,qn(n)}function qn(n){n.onreadystatechange&&n.onreadystatechange.call(n)}(E=es.prototype).open=function(n,e){if(this.readyState!=Oi)throw this.abort(),Error("Error reopening a connection");this.C=n,this.B=e,this.readyState=1,qn(this)},E.send=function(n){if(1!=this.readyState)throw this.abort(),Error("need to call open() first. ");this.g=!0;const e={headers:this.v,method:this.C,credentials:this.m,cache:void 0};n&&(e.body=n),(this.D||A).fetch(new Request(this.B,e)).then(this.Va.bind(this),this.ha.bind(this))},E.abort=function(){this.response=this.responseText="",this.v=new Headers,this.status=0,this.j&&this.j.cancel("Request was aborted."),1<=this.readyState&&this.g&&4!=this.readyState&&(this.g=!1,Bn(this)),this.readyState=Oi},E.Va=function(n){if(this.g&&(this.l=n,this.h||(this.status=this.l.status,this.statusText=this.l.statusText,this.h=n.headers,this.readyState=2,qn(this)),this.g&&(this.readyState=3,qn(this),this.g)))if("arraybuffer"===this.responseType)n.arrayBuffer().then(this.Ta.bind(this),this.ha.bind(this));else if(typeof A.ReadableStream<"u"&&"body"in n){if(this.j=n.body.getReader(),this.u){if(this.responseType)throw Error('responseType must be empty for "streamBinaryChunks" mode responses.');this.response=[]}else this.response=this.responseText="",this.A=new TextDecoder;Hu(this)}else n.text().then(this.Ua.bind(this),this.ha.bind(this))},E.Sa=function(n){if(this.g){if(this.u&&n.value)this.response.push(n.value);else if(!this.u){var e=n.value?n.value:new Uint8Array(0);(e=this.A.decode(e,{stream:!n.done}))&&(this.response=this.responseText+=e)}n.done?Bn(this):qn(this),3==this.readyState&&Hu(this)}},E.Ua=function(n){this.g&&(this.response=this.responseText=n,Bn(this))},E.Ta=function(n){this.g&&(this.response=n,Bn(this))},E.ha=function(){this.g&&Bn(this)},E.setRequestHeader=function(n,e){this.v.append(n,e)},E.getResponseHeader=function(n){return this.h&&this.h.get(n.toLowerCase())||""},E.getAllResponseHeaders=function(){if(!this.h)return"";const n=[],e=this.h.entries();for(var t=e.next();!t.done;)n.push((t=t.value)[0]+": "+t[1]),t=e.next();return n.join("\r\n")},Object.defineProperty(es.prototype,"withCredentials",{get:function(){return"include"===this.m},set:function(n){this.m=n?"include":"same-origin"}});var Bf=A.JSON.parse;function Y(n){se.call(this),this.headers=new Ht,this.u=n||null,this.h=!1,this.C=this.g=null,this.H="",this.m=0,this.j="",this.l=this.F=this.v=this.D=!1,this.B=0,this.A=null,this.J=Wu,this.K=this.L=!1}he(Y,se);var Wu="",qf=/^https?$/i,Gf=["POST","PUT"];function jf(n){return"content-type"==n.toLowerCase()}function Xu(n,e){n.h=!1,n.g&&(n.l=!0,n.g.abort(),n.l=!1),n.j=e,n.m=5,Yu(n),ts(n)}function Yu(n){n.D||(n.D=!0,de(n,"complete"),de(n,"error"))}function Ju(n){if(n.h&&typeof Ys<"u"&&(!n.C[1]||4!=je(n)||2!=n.ba()))if(n.v&&4==je(n))Ei(n.Fa,0,n);else if(de(n,"readystatechange"),4==je(n)){n.h=!1;try{const a=n.ba();e:switch(a){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var e=!0;break e;default:e=!1}var t;if(!(t=e)){var r;if(r=0===a){var s=String(n.H).match(Pu)[1]||null;if(!s&&A.self&&A.self.location){var i=A.self.location.protocol;s=i.substr(0,i.length-1)}r=!qf.test(s?s.toLowerCase():"")}t=r}if(t)de(n,"complete"),de(n,"success");else{n.m=6;try{var o=2<je(n)?n.g.statusText:""}catch{o=""}n.j=o+" ["+n.ba()+"]",Yu(n)}}finally{ts(n)}}}function ts(n,e){if(n.g){ec(n);const t=n.g,r=n.C[0]?Lr:null;n.g=null,n.C=null,e||de(n,"ready");try{t.onreadystatechange=r}catch{}}}function ec(n){n.g&&n.K&&(n.g.ontimeout=null),n.A&&(A.clearTimeout(n.A),n.A=null)}function je(n){return n.g?n.g.readyState:0}function tc(n){try{if(!n.g)return null;if("response"in n.g)return n.g.response;switch(n.J){case Wu:case"text":return n.g.responseText;case"arraybuffer":if("mozResponseArrayBuffer"in n.g)return n.g.mozResponseArrayBuffer}return null}catch{return null}}function Vi(n,e,t){e:{for(r in t){var r=!1;break e}r=!0}r||(t=function $f(n){let e="";return ri(n,function(t,r){e+=r,e+=":",e+=t,e+="\r\n"}),e}(t),"string"==typeof n?null!=t&&encodeURIComponent(String(t)):j(n,e,t))}function Gn(n,e,t){return t&&t.internalChannelParams&&t.internalChannelParams[n]||e}function nc(n){this.za=0,this.l=[],this.h=new Kr,this.la=this.oa=this.F=this.W=this.g=this.sa=this.D=this.aa=this.o=this.P=this.s=null,this.Za=this.V=0,this.Xa=Gn("failFast",!1,n),this.N=this.v=this.u=this.m=this.j=null,this.X=!0,this.I=this.ta=this.U=-1,this.Y=this.A=this.C=0,this.Pa=Gn("baseRetryDelayMs",5e3,n),this.$a=Gn("retryDelaySeedMs",1e4,n),this.Ya=Gn("forwardChannelMaxRetries",2,n),this.ra=Gn("forwardChannelRequestTimeoutMs",2e4,n),this.qa=n&&n.xmlHttpFactory||void 0,this.Ba=n&&n.Yb||!1,this.K=void 0,this.H=n&&n.supportsCrossDomainXhr||!1,this.J="",this.i=new ju(n&&n.concurrentRequestLimit),this.Ca=new Vf,this.ja=n&&n.fastHandshake||!1,this.Ra=n&&n.Wb||!1,n&&n.Aa&&this.h.Aa(),n&&n.forceLongPolling&&(this.X=!1),this.$=!this.ja&&this.X&&n&&n.detectBufferingProxy||!1,this.ka=void 0,this.O=0,this.L=!1,this.B=null,this.Wa=!n||!1!==n.Xb}function Pi(n){if(rc(n),3==n.G){var e=n.V++,t=Ke(n.F);j(t,"SID",n.J),j(t,"RID",e),j(t,"TYPE","terminate"),Kn(n,t),(e=new Mn(n,n.h,e,void 0)).K=2,e.v=Yr(Ke(t)),t=!1,A.navigator&&A.navigator.sendBeacon&&(t=A.navigator.sendBeacon(e.v.toString(),"")),!t&&A.Image&&((new Image).src=e.v,t=!0),t||(e.g=dc(e.l,null),e.g.ea(e.v)),e.F=Date.now(),Fn(e)}lc(n)}function ns(n){n.g&&(qi(n),n.g.cancel(),n.g=null)}function rc(n){ns(n),n.u&&(A.clearTimeout(n.u),n.u=null),ss(n),n.i.cancel(),n.m&&("number"==typeof n.m&&A.clearTimeout(n.m),n.m=null)}function Ui(n,e){n.l.push(new class{constructor(n,e){this.h=n,this.g=e}}(n.Za++,e)),3==n.G&&rs(n)}function rs(n){$u(n.i)||n.m||(n.m=!0,wi(n.Ha,n),n.C=0)}function sc(n,e){var t;t=e?e.m:n.V++;const r=Ke(n.F);j(r,"SID",n.J),j(r,"RID",t),j(r,"AID",n.U),Kn(n,r),n.o&&n.s&&Vi(r,n.o,n.s),t=new Mn(n,n.h,t,n.C+1),null===n.o&&(t.H=n.s),e&&(n.l=e.D.concat(n.l)),e=ic(n,t,1e3),t.setTimeout(Math.round(.5*n.ra)+Math.round(.5*n.ra*Math.random())),Fi(n.i,t),Ci(t,r,e)}function Kn(n,e){n.j&&ki({},function(t,r){j(e,r,t)})}function ic(n,e,t){t=Math.min(n.l.length,t);var r=n.j?le(n.j.Oa,n.j,n):null;e:{var s=n.l;let i=-1;for(;;){const o=["count="+t];-1==i?0<t?(i=s[0].h,o.push("ofs="+i)):i=0:o.push("ofs="+i);let a=!0;for(let u=0;u<t;u++){let c=s[u].h;const l=s[u].g;if(c-=i,0>c)i=Math.max(0,s[u].h-100),a=!1;else try{Pf(l,o,"req"+c+"_")}catch{r&&r(l)}}if(a){r=o.join("&");break e}}}return n=n.l.splice(0,t),e.D=n,r}function oc(n){n.g||n.u||(n.Y=1,wi(n.Ga,n),n.A=0)}function Bi(n){return!(n.g||n.u||3<=n.A||(n.Y++,n.u=kn(le(n.Ga,n),cc(n,n.A)),n.A++,0))}function qi(n){null!=n.B&&(A.clearTimeout(n.B),n.B=null)}function ac(n){n.g=new Mn(n,n.h,"rpc",n.Y),null===n.o&&(n.g.H=n.s),n.g.O=0;var e=Ke(n.oa);j(e,"RID","rpc"),j(e,"SID",n.J),j(e,"CI",n.N?"0":"1"),j(e,"AID",n.U),Kn(n,e),j(e,"TYPE","xmlhttp"),n.o&&n.s&&Vi(e,n.o,n.s),n.K&&n.g.setTimeout(n.K);var t=n.g;n=n.la,t.K=1,t.v=Yr(Ke(e)),t.s=null,t.U=!0,Fu(t,n)}function ss(n){null!=n.v&&(A.clearTimeout(n.v),n.v=null)}function uc(n,e){var t=null;if(n.g==e){ss(n),qi(n),n.g=null;var r=2}else{if(!Mi(n.i,e))return;t=e.D,Qu(n.i,e),r=1}if(n.I=e.N,0!=n.G)if(e.i)if(1==r){t=e.s?e.s.length:0,e=Date.now()-e.F;var s=n.C;de(r=jr(),new Cu(r,t,e,s)),rs(n)}else oc(n);else if(3==(s=e.o)||0==s&&0<n.I||!(1==r&&function zf(n,e){return!(zu(n.i)>=n.i.j-(n.m?1:0)||(n.m?(n.l=e.D.concat(n.l),0):1==n.G||2==n.G||n.C>=(n.Xa?0:n.Ya)||(n.m=kn(le(n.Ha,n,e),cc(n,n.C)),n.C++,0)))}(n,e)||2==r&&Bi(n)))switch(t&&0<t.length&&(e=n.i,e.i=e.i.concat(t)),s){case 1:_t(n,5);break;case 4:_t(n,10);break;case 3:_t(n,6);break;default:_t(n,2)}}function cc(n,e){let t=n.Pa+Math.floor(Math.random()*n.$a);return n.j||(t*=2),t*e}function _t(n,e){if(n.h.info("Error code "+e),2==e){var t=null;n.j&&(t=null);var r=le(n.jb,n);t||(t=new It("//www.google.com/images/cleardot.gif"),A.location&&"http"==A.location.protocol||Hr(t,"https"),Yr(t)),function Uf(n,e){const t=new Kr;if(A.Image){const r=new Image;r.onload=Or(Jr,t,r,"TestLoadImage: loaded",!0,e),r.onerror=Or(Jr,t,r,"TestLoadImage: error",!1,e),r.onabort=Or(Jr,t,r,"TestLoadImage: abort",!1,e),r.ontimeout=Or(Jr,t,r,"TestLoadImage: timeout",!1,e),A.setTimeout(function(){r.ontimeout&&r.ontimeout()},1e4),r.src=n}else e(!1)}(t.toString(),r)}else _e(2);n.G=0,n.j&&n.j.va(e),lc(n),rc(n)}function lc(n){n.G=0,n.I=-1,n.j&&((0!=Zu(n.i).length||0!=n.l.length)&&(n.i.i.length=0,ti(n.l),n.l.length=0),n.j.ua())}function hc(n,e,t){let r=function Df(n){return n instanceof It?Ke(n):new It(n,void 0)}(t);if(""!=r.i)e&&Wr(r,e+"."+r.i),Xr(r,r.m);else{const s=A.location;r=function Af(n,e,t,r){var s=new It(null,void 0);return n&&Hr(s,n),e&&Wr(s,e),t&&Xr(s,t),r&&(s.l=r),s}(s.protocol,e?e+"."+s.hostname:s.hostname,+s.port,t)}return n.aa&&ri(n.aa,function(s,i){j(r,i,s)}),t=n.sa,(e=n.D)&&t&&j(r,e,t),j(r,"VER",n.ma),Kn(n,r),r}function dc(n,e,t){if(e&&!n.H)throw Error("Can't create secondary domain capable XhrIo object.");return(e=new Y(t&&n.Ba&&!n.qa?new Un({ib:!0}):n.qa)).L=n.H,e}function fc(){}function is(){if(Qt&&!(10<=Number(sf)))throw Error("Environmental error: no available transport.")}function Ae(n,e){se.call(this),this.g=new nc(e),this.l=n,this.h=e&&e.messageUrlParams||null,n=e&&e.messageHeaders||null,e&&e.clientProtocolHeaderRequired&&(n?n["X-Client-Protocol"]="webchannel":n={"X-Client-Protocol":"webchannel"}),this.g.s=n,n=e&&e.initMessageHeaders||null,e&&e.messageContentType&&(n?n["X-WebChannel-Content-Type"]=e.messageContentType:n={"X-WebChannel-Content-Type":e.messageContentType}),e&&e.ya&&(n?n["X-WebChannel-Client-Profile"]=e.ya:n={"X-WebChannel-Client-Profile":e.ya}),this.g.P=n,(n=e&&e.httpHeadersOverwriteParam)&&!Vr(n)&&(this.g.o=n),this.A=e&&e.supportsCrossDomainXhr||!1,this.v=e&&e.sendRawJson||!1,(e=e&&e.httpSessionIdParam)&&!Vr(e)&&(this.g.D=e,null!==(n=this.h)&&e in n&&e in(n=this.h)&&delete n[e]),this.j=new Xt(this)}function mc(n){Si.call(this);var e=n.__sm__;if(e){e:{for(const t in e){n=t;break e}n=void 0}(this.i=n)&&(n=this.i,e=null!==e&&n in e?e[n]:void 0),this.data=e}else this.data=n}function gc(){bi.call(this),this.status=1}function Xt(n){this.g=n}(E=Y.prototype).ea=function(n,e,t,r){if(this.g)throw Error("[goog.net.XhrIo] Object is active with another request="+this.H+"; newUri="+n);e=e?e.toUpperCase():"GET",this.H=n,this.j="",this.m=0,this.D=!1,this.h=!0,this.g=this.u?this.u.g():Di.g(),this.C=function ku(n){return n.h||(n.h=n.i())}(this.u?this.u:Di),this.g.onreadystatechange=le(this.Fa,this);try{this.F=!0,this.g.open(e,String(n),!0),this.F=!1}catch(i){return void Xu(this,i)}n=t||"";const s=new Ht(this.headers);r&&ki(r,function(i,o){s.set(o,i)}),r=function Yd(n){e:{var e=jf;const t=n.length,r="string"==typeof n?n.split(""):n;for(let s=0;s<t;s++)if(s in r&&e.call(void 0,r[s],s,n)){e=s;break e}e=-1}return 0>e?null:"string"==typeof n?n.charAt(e):n[e]}(s.T()),t=A.FormData&&n instanceof A.FormData,!(0<=nu(Gf,e))||r||t||s.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8"),s.forEach(function(i,o){this.g.setRequestHeader(o,i)},this),this.J&&(this.g.responseType=this.J),"withCredentials"in this.g&&this.g.withCredentials!==this.L&&(this.g.withCredentials=this.L);try{ec(this),0<this.B&&((this.K=function Kf(n){return Qt&&function rf(){return function Jd(n){var e=nf;return Object.prototype.hasOwnProperty.call(e,9)?e[9]:e[9]=n(9)}(function(){let n=0;const e=iu(String(Pr)).split("."),t=iu("9").split("."),r=Math.max(e.length,t.length);for(let o=0;0==n&&o<r;o++){var s=e[o]||"",i=t[o]||"";do{if(s=/(\d*)(\D*)(.*)/.exec(s)||["","","",""],i=/(\d*)(\D*)(.*)/.exec(i)||["","","",""],0==s[0].length&&0==i[0].length)break;n=ni(0==s[1].length?0:parseInt(s[1],10),0==i[1].length?0:parseInt(i[1],10))||ni(0==s[2].length,0==i[2].length)||ni(s[2],i[2]),s=s[3],i=i[3]}while(0==n)}return 0<=n})}()&&"number"==typeof n.timeout&&void 0!==n.ontimeout}(this.g))?(this.g.timeout=this.B,this.g.ontimeout=le(this.pa,this)):this.A=Ei(this.pa,this.B,this)),this.v=!0,this.g.send(n),this.v=!1}catch(i){Xu(this,i)}},E.pa=function(){typeof Ys<"u"&&this.g&&(this.j="Timed out after "+this.B+"ms, aborting",this.m=8,de(this,"timeout"),this.abort(8))},E.abort=function(n){this.g&&this.h&&(this.h=!1,this.l=!0,this.g.abort(),this.l=!1,this.m=n||7,de(this,"complete"),de(this,"abort"),ts(this))},E.M=function(){this.g&&(this.h&&(this.h=!1,this.l=!0,this.g.abort(),this.l=!1),ts(this,!0)),Y.Z.M.call(this)},E.Fa=function(){this.s||(this.F||this.v||this.l?Ju(this):this.cb())},E.cb=function(){Ju(this)},E.ba=function(){try{return 2<je(this)?this.g.status:-1}catch{return-1}},E.ga=function(){try{return this.g?this.g.responseText:""}catch{return""}},E.Qa=function(n){if(this.g){var e=this.g.responseText;return n&&0==e.indexOf(n)&&(e=e.substring(n.length)),Bf(e)}},E.Da=function(){return this.m},E.La=function(){return"string"==typeof this.j?this.j:String(this.j)},(E=nc.prototype).ma=8,E.G=1,E.hb=function(n){try{this.h.info("Origin Trials invoked: "+n)}catch{}},E.Ha=function(n){if(this.m)if(this.m=null,1==this.G){if(!n){this.V=Math.floor(1e5*Math.random()),n=this.V++;const s=new Mn(this,this.h,n,void 0);let i=this.s;if(this.P&&(i?(i=uu(i),lu(i,this.P)):i=this.P),null===this.o&&(s.H=i),this.ja)e:{for(var e=0,t=0;t<this.l.length;t++){var r=this.l[t];if(void 0===(r="__data__"in r.g&&"string"==typeof(r=r.g.__data__)?r.length:void 0))break;if(4096<(e+=r)){e=t;break e}if(4096===e||t===this.l.length-1){e=t+1;break e}}e=1e3}else e=1e3;e=ic(this,s,e),j(t=Ke(this.F),"RID",n),j(t,"CVER",22),this.D&&j(t,"X-HTTP-Session-Id",this.D),Kn(this,t),this.o&&i&&Vi(t,this.o,i),Fi(this.i,s),this.Ra&&j(t,"TYPE","init"),this.ja?(j(t,"$req",e),j(t,"SID","null"),s.$=!0,Ci(s,t,null)):Ci(s,t,e),this.G=2}}else 3==this.G&&(n?sc(this,n):0==this.l.length||$u(this.i)||sc(this))},E.Ga=function(){if(this.u=null,ac(this),this.$&&!(this.L||null==this.g||0>=this.O)){var n=2*this.O;this.h.info("BP detection timer enabled: "+n),this.B=kn(le(this.bb,this),n)}},E.bb=function(){this.B&&(this.B=null,this.h.info("BP detection timeout reached."),this.h.info("Buffering proxy detected and switch to long-polling!"),this.N=!1,this.L=!0,_e(10),ns(this),ac(this))},E.ab=function(){null!=this.v&&(this.v=null,ns(this),Bi(this),_e(19))},E.jb=function(n){n?(this.h.info("Successfully pinged google.com"),_e(2)):(this.h.info("Failed to ping google.com"),_e(1))},(E=fc.prototype).xa=function(){},E.wa=function(){},E.va=function(){},E.ua=function(){},E.Oa=function(){},is.prototype.g=function(n,e){return new Ae(n,e)},he(Ae,se),Ae.prototype.m=function(){this.g.j=this.j,this.A&&(this.g.H=!0);var n=this.g,e=this.l,t=this.h||void 0;n.Wa&&(n.h.info("Origin Trials enabled."),wi(le(n.hb,n,e))),_e(0),n.W=e,n.aa=t||{},n.N=n.X,n.F=hc(n,null,n.W),rs(n)},Ae.prototype.close=function(){Pi(this.g)},Ae.prototype.u=function(n){if("string"==typeof n){var e={};e.__data__=n,Ui(this.g,e)}else this.v?((e={}).__data__=vi(n),Ui(this.g,e)):Ui(this.g,n)},Ae.prototype.M=function(){this.g.j=null,delete this.j,Pi(this.g),delete this.g,Ae.Z.M.call(this)},he(mc,Si),he(gc,bi),he(Xt,fc),Xt.prototype.xa=function(){de(this.g,"a")},Xt.prototype.wa=function(n){de(this.g,new mc(n))},Xt.prototype.va=function(n){de(this.g,new gc(n))},Xt.prototype.ua=function(){de(this.g,"b")},is.prototype.createWebChannel=is.prototype.g,Ae.prototype.send=Ae.prototype.u,Ae.prototype.open=Ae.prototype.m,Ae.prototype.close=Ae.prototype.close,$r.NO_ERROR=0,$r.TIMEOUT=8,$r.HTTP_ERROR=6,Nu.COMPLETE="complete",Ru.EventType=Rn,Rn.OPEN="a",Rn.CLOSE="b",Rn.ERROR="c",Rn.MESSAGE="d",se.prototype.listen=se.prototype.N,Y.prototype.listenOnce=Y.prototype.O,Y.prototype.getLastError=Y.prototype.La,Y.prototype.getLastErrorCode=Y.prototype.Da,Y.prototype.getStatus=Y.prototype.ba,Y.prototype.getResponseJson=Y.prototype.Qa,Y.prototype.getResponseText=Y.prototype.ga,Y.prototype.send=Y.prototype.ea;var Qf=Ge.createWebChannelTransport=function(){return new is},Zf=Ge.getStatEventTarget=function(){return jr()},Gi=Ge.ErrorCode=$r,Hf=Ge.EventType=Nu,Wf=Ge.Event=yt,pc=Ge.Stat={rb:0,ub:1,vb:2,Ob:3,Tb:4,Qb:5,Rb:6,Pb:7,Nb:8,Sb:9,PROXY:10,NOPROXY:11,Lb:12,Hb:13,Ib:14,Gb:15,Jb:16,Kb:17,nb:18,mb:19,ob:20},Xf=Ge.FetchXmlHttpFactory=Un,os=Ge.WebChannel=Ru,Yf=Ge.XhrIo=Y;const yc="@firebase/firestore";class ie{constructor(e){this.uid=e}isAuthenticated(){return null!=this.uid}toKey(){return this.isAuthenticated()?"uid:"+this.uid:"anonymous-user"}isEqual(e){return e.uid===this.uid}}ie.UNAUTHENTICATED=new ie(null),ie.GOOGLE_CREDENTIALS=new ie("google-credentials-uid"),ie.FIRST_PARTY=new ie("first-party-uid"),ie.MOCK_USER=new ie("mock-user");let Yt="9.9.1";const Je=new pt.Yd("@firebase/firestore");function Ki(){return Je.logLevel}function w(n,...e){if(Je.logLevel<=pt.in.DEBUG){const t=e.map(ji);Je.debug(`Firestore (${Yt}): ${n}`,...t)}}function J(n,...e){if(Je.logLevel<=pt.in.ERROR){const t=e.map(ji);Je.error(`Firestore (${Yt}): ${n}`,...t)}}function jn(n,...e){if(Je.logLevel<=pt.in.WARN){const t=e.map(ji);Je.warn(`Firestore (${Yt}): ${n}`,...t)}}function ji(n){if("string"==typeof n)return n;try{return JSON.stringify(n)}catch{return n}}function T(n="Unexpected state"){const e=`FIRESTORE (${Yt}) INTERNAL ASSERTION FAILED: `+n;throw J(e),new Error(e)}function D(n,e){n||T()}function _(n,e){return n}const m={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"};class v extends L.ZR{constructor(e,t){super(e,t),this.code=e,this.message=t,this.toString=()=>`${this.name}: [code=${this.code}]: ${this.message}`}}class oe{constructor(){this.promise=new Promise((e,t)=>{this.resolve=e,this.reject=t})}}class vc{constructor(e,t){this.user=t,this.type="OAuth",this.headers=new Map,this.headers.set("Authorization",`Bearer ${e}`)}}class tm{getToken(){return Promise.resolve(null)}invalidateToken(){}start(e,t){e.enqueueRetryable(()=>t(ie.UNAUTHENTICATED))}shutdown(){}}class nm{constructor(e){this.token=e,this.changeListener=null}getToken(){return Promise.resolve(this.token)}invalidateToken(){}start(e,t){this.changeListener=t,e.enqueueRetryable(()=>t(this.token.user))}shutdown(){this.changeListener=null}}class rm{constructor(e){this.t=e,this.currentUser=ie.UNAUTHENTICATED,this.i=0,this.forceRefresh=!1,this.auth=null}start(e,t){var r=this;let s=this.i;const i=c=>this.i!==s?(s=this.i,t(c)):Promise.resolve();let o=new oe;this.o=()=>{this.i++,this.currentUser=this.u(),o.resolve(),o=new oe,e.enqueueRetryable(()=>i(this.currentUser))};const a=()=>{const c=o;e.enqueueRetryable((0,p.Z)(function*(){yield c.promise,yield i(r.currentUser)}))},u=c=>{w("FirebaseAuthCredentialsProvider","Auth detected"),this.auth=c,this.auth.addAuthTokenListener(this.o),a()};this.t.onInit(c=>u(c)),setTimeout(()=>{if(!this.auth){const c=this.t.getImmediate({optional:!0});c?u(c):(w("FirebaseAuthCredentialsProvider","Auth not yet detected"),o.resolve(),o=new oe)}},0),a()}getToken(){const e=this.i,t=this.forceRefresh;return this.forceRefresh=!1,this.auth?this.auth.getToken(t).then(r=>this.i!==e?(w("FirebaseAuthCredentialsProvider","getToken aborted due to token change."),this.getToken()):r?(D("string"==typeof r.accessToken),new vc(r.accessToken,this.currentUser)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.auth&&this.auth.removeAuthTokenListener(this.o)}u(){const e=this.auth&&this.auth.getUid();return D(null===e||"string"==typeof e),new ie(e)}}class sm{constructor(e,t,r){this.type="FirstParty",this.user=ie.FIRST_PARTY,this.headers=new Map,this.headers.set("X-Goog-AuthUser",t);const s=e.auth.getAuthHeaderValueForFirstParty([]);s&&this.headers.set("Authorization",s),r&&this.headers.set("X-Goog-Iam-Authorization-Token",r)}}class im{constructor(e,t,r){this.h=e,this.l=t,this.m=r}getToken(){return Promise.resolve(new sm(this.h,this.l,this.m))}start(e,t){e.enqueueRetryable(()=>t(ie.FIRST_PARTY))}shutdown(){}invalidateToken(){}}class wc{constructor(e){this.value=e,this.type="AppCheck",this.headers=new Map,e&&e.length>0&&this.headers.set("x-firebase-appcheck",this.value)}}class om{constructor(e){this.g=e,this.forceRefresh=!1,this.appCheck=null,this.p=null}start(e,t){const r=i=>{null!=i.error&&w("FirebaseAppCheckTokenProvider",`Error getting App Check token; using placeholder token instead. Error: ${i.error.message}`);const o=i.token!==this.p;return this.p=i.token,w("FirebaseAppCheckTokenProvider",`Received ${o?"new":"existing"} token.`),o?t(i.token):Promise.resolve()};this.o=i=>{e.enqueueRetryable(()=>r(i))};const s=i=>{w("FirebaseAppCheckTokenProvider","AppCheck detected"),this.appCheck=i,this.appCheck.addTokenListener(this.o)};this.g.onInit(i=>s(i)),setTimeout(()=>{if(!this.appCheck){const i=this.g.getImmediate({optional:!0});i?s(i):w("FirebaseAppCheckTokenProvider","AppCheck not yet detected")}},0)}getToken(){const e=this.forceRefresh;return this.forceRefresh=!1,this.appCheck?this.appCheck.getToken(e).then(t=>t?(D("string"==typeof t.token),this.p=t.token,new wc(t.token)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.appCheck&&this.appCheck.removeTokenListener(this.o)}}function am(n){const e=typeof self<"u"&&(self.crypto||self.msCrypto),t=new Uint8Array(n);if(e&&"function"==typeof e.getRandomValues)e.getRandomValues(t);else for(let r=0;r<n;r++)t[r]=Math.floor(256*Math.random());return t}class Ic{static I(){const e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",t=Math.floor(256/e.length)*e.length;let r="";for(;r.length<20;){const s=am(40);for(let i=0;i<s.length;++i)r.length<20&&s[i]<t&&(r+=e.charAt(s[i]%e.length))}return r}}function C(n,e){return n<e?-1:n>e?1:0}function Jt(n,e,t){return n.length===e.length&&n.every((r,s)=>t(r,e[s]))}function _c(n){return n+"\0"}class ${constructor(e,t){if(this.seconds=e,this.nanoseconds=t,t<0)throw new v(m.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(t>=1e9)throw new v(m.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(e<-62135596800)throw new v(m.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e);if(e>=253402300800)throw new v(m.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e)}static now(){return $.fromMillis(Date.now())}static fromDate(e){return $.fromMillis(e.getTime())}static fromMillis(e){const t=Math.floor(e/1e3),r=Math.floor(1e6*(e-1e3*t));return new $(t,r)}toDate(){return new Date(this.toMillis())}toMillis(){return 1e3*this.seconds+this.nanoseconds/1e6}_compareTo(e){return this.seconds===e.seconds?C(this.nanoseconds,e.nanoseconds):C(this.seconds,e.seconds)}isEqual(e){return e.seconds===this.seconds&&e.nanoseconds===this.nanoseconds}toString(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"}toJSON(){return{seconds:this.seconds,nanoseconds:this.nanoseconds}}valueOf(){return String(this.seconds- -62135596800).padStart(12,"0")+"."+String(this.nanoseconds).padStart(9,"0")}}class b{constructor(e){this.timestamp=e}static fromTimestamp(e){return new b(e)}static min(){return new b(new $(0,0))}static max(){return new b(new $(253402300799,999999999))}compareTo(e){return this.timestamp._compareTo(e.timestamp)}isEqual(e){return this.timestamp.isEqual(e.timestamp)}toMicroseconds(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3}toString(){return"SnapshotVersion("+this.timestamp.toString()+")"}toTimestamp(){return this.timestamp}}class $n{constructor(e,t,r){void 0===t?t=0:t>e.length&&T(),void 0===r?r=e.length-t:r>e.length-t&&T(),this.segments=e,this.offset=t,this.len=r}get length(){return this.len}isEqual(e){return 0===$n.comparator(this,e)}child(e){const t=this.segments.slice(this.offset,this.limit());return e instanceof $n?e.forEach(r=>{t.push(r)}):t.push(e),this.construct(t)}limit(){return this.offset+this.length}popFirst(e){return this.construct(this.segments,this.offset+(e=void 0===e?1:e),this.length-e)}popLast(){return this.construct(this.segments,this.offset,this.length-1)}firstSegment(){return this.segments[this.offset]}lastSegment(){return this.get(this.length-1)}get(e){return this.segments[this.offset+e]}isEmpty(){return 0===this.length}isPrefixOf(e){if(e.length<this.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}isImmediateParentOf(e){if(this.length+1!==e.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}forEach(e){for(let t=this.offset,r=this.limit();t<r;t++)e(this.segments[t])}toArray(){return this.segments.slice(this.offset,this.limit())}static comparator(e,t){const r=Math.min(e.length,t.length);for(let s=0;s<r;s++){const i=e.get(s),o=t.get(s);if(i<o)return-1;if(i>o)return 1}return e.length<t.length?-1:e.length>t.length?1:0}}class M extends $n{construct(e,t,r){return new M(e,t,r)}canonicalString(){return this.toArray().join("/")}toString(){return this.canonicalString()}static fromString(...e){const t=[];for(const r of e){if(r.indexOf("//")>=0)throw new v(m.INVALID_ARGUMENT,`Invalid segment (${r}). Paths must not contain // in them.`);t.push(...r.split("/").filter(s=>s.length>0))}return new M(t)}static emptyPath(){return new M([])}}const um=/^[_a-zA-Z][_a-zA-Z0-9]*$/;class X extends $n{construct(e,t,r){return new X(e,t,r)}static isValidIdentifier(e){return um.test(e)}canonicalString(){return this.toArray().map(e=>(e=e.replace(/\\/g,"\\\\").replace(/`/g,"\\`"),X.isValidIdentifier(e)||(e="`"+e+"`"),e)).join(".")}toString(){return this.canonicalString()}isKeyField(){return 1===this.length&&"__name__"===this.get(0)}static keyField(){return new X(["__name__"])}static fromServerFormat(e){const t=[];let r="",s=0;const i=()=>{if(0===r.length)throw new v(m.INVALID_ARGUMENT,`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`);t.push(r),r=""};let o=!1;for(;s<e.length;){const a=e[s];if("\\"===a){if(s+1===e.length)throw new v(m.INVALID_ARGUMENT,"Path has trailing escape character: "+e);const u=e[s+1];if("\\"!==u&&"."!==u&&"`"!==u)throw new v(m.INVALID_ARGUMENT,"Path has invalid escape sequence: "+e);r+=u,s+=2}else"`"===a?(o=!o,s++):"."!==a||o?(r+=a,s++):(i(),s++)}if(i(),o)throw new v(m.INVALID_ARGUMENT,"Unterminated ` in path: "+e);return new X(t)}static emptyPath(){return new X([])}}class I{constructor(e){this.path=e}static fromPath(e){return new I(M.fromString(e))}static fromName(e){return new I(M.fromString(e).popFirst(5))}static empty(){return new I(M.emptyPath())}get collectionGroup(){return this.path.popLast().lastSegment()}hasCollectionId(e){return this.path.length>=2&&this.path.get(this.path.length-2)===e}getCollectionGroup(){return this.path.get(this.path.length-2)}getCollectionPath(){return this.path.popLast()}isEqual(e){return null!==e&&0===M.comparator(this.path,e.path)}toString(){return this.path.toString()}static comparator(e,t){return M.comparator(e.path,t.path)}static isDocumentKey(e){return e.length%2==0}static fromSegments(e){return new I(new M(e.slice()))}}class as{constructor(e,t,r,s){this.indexId=e,this.collectionGroup=t,this.fields=r,this.indexState=s}}function $i(n){return n.fields.find(e=>2===e.kind)}function xt(n){return n.fields.filter(e=>2!==e.kind)}as.UNKNOWN_ID=-1;class us{constructor(e,t){this.fieldPath=e,this.kind=t}}class zn{constructor(e,t){this.sequenceNumber=e,this.offset=t}static empty(){return new zn(0,Ce.min())}}function xc(n,e){const t=n.toTimestamp().seconds,r=n.toTimestamp().nanoseconds+1,s=b.fromTimestamp(1e9===r?new $(t+1,0):new $(t,r));return new Ce(s,I.empty(),e)}function Ec(n){return new Ce(n.readTime,n.key,-1)}class Ce{constructor(e,t,r){this.readTime=e,this.documentKey=t,this.largestBatchId=r}static min(){return new Ce(b.min(),I.empty(),-1)}static max(){return new Ce(b.max(),I.empty(),-1)}}function zi(n,e){let t=n.readTime.compareTo(e.readTime);return 0!==t?t:(t=I.comparator(n.documentKey,e.documentKey),0!==t?t:C(n.largestBatchId,e.largestBatchId))}const Tc="The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab.";class Sc{constructor(){this.onCommittedListeners=[]}addOnCommittedListener(e){this.onCommittedListeners.push(e)}raiseOnCommittedEvent(){this.onCommittedListeners.forEach(e=>e())}}function et(n){return Qi.apply(this,arguments)}function Qi(){return Qi=(0,p.Z)(function*(n){if(n.code!==m.FAILED_PRECONDITION||n.message!==Tc)throw n;w("LocalStore","Unexpectedly lost primary lease")}),Qi.apply(this,arguments)}class f{constructor(e){this.nextCallback=null,this.catchCallback=null,this.result=void 0,this.error=void 0,this.isDone=!1,this.callbackAttached=!1,e(t=>{this.isDone=!0,this.result=t,this.nextCallback&&this.nextCallback(t)},t=>{this.isDone=!0,this.error=t,this.catchCallback&&this.catchCallback(t)})}catch(e){return this.next(void 0,e)}next(e,t){return this.callbackAttached&&T(),this.callbackAttached=!0,this.isDone?this.error?this.wrapFailure(t,this.error):this.wrapSuccess(e,this.result):new f((r,s)=>{this.nextCallback=i=>{this.wrapSuccess(e,i).next(r,s)},this.catchCallback=i=>{this.wrapFailure(t,i).next(r,s)}})}toPromise(){return new Promise((e,t)=>{this.next(e,t)})}wrapUserFunction(e){try{const t=e();return t instanceof f?t:f.resolve(t)}catch(t){return f.reject(t)}}wrapSuccess(e,t){return e?this.wrapUserFunction(()=>e(t)):f.resolve(t)}wrapFailure(e,t){return e?this.wrapUserFunction(()=>e(t)):f.reject(t)}static resolve(e){return new f((t,r)=>{t(e)})}static reject(e){return new f((t,r)=>{r(e)})}static waitFor(e){return new f((t,r)=>{let s=0,i=0,o=!1;e.forEach(a=>{++s,a.next(()=>{++i,o&&i===s&&t()},u=>r(u))}),o=!0,i===s&&t()})}static or(e){let t=f.resolve(!1);for(const r of e)t=t.next(s=>s?f.resolve(s):r());return t}static forEach(e,t){const r=[];return e.forEach((s,i)=>{r.push(t.call(this,s,i))}),this.waitFor(r)}static mapArray(e,t){return new f((r,s)=>{const i=e.length,o=new Array(i);let a=0;for(let u=0;u<i;u++){const c=u;t(e[c]).next(l=>{o[c]=l,++a,a===i&&r(o)},l=>s(l))}})}static doWhile(e,t){return new f((r,s)=>{const i=()=>{!0===e()?t().next(()=>{i()},s):r()};i()})}}class cs{constructor(e,t){this.action=e,this.transaction=t,this.aborted=!1,this.T=new oe,this.transaction.oncomplete=()=>{this.T.resolve()},this.transaction.onabort=()=>{t.error?this.T.reject(new Qn(e,t.error)):this.T.resolve()},this.transaction.onerror=r=>{const s=Zi(r.target.error);this.T.reject(new Qn(e,s))}}static open(e,t,r,s){try{return new cs(t,e.transaction(s,r))}catch(i){throw new Qn(t,i)}}get A(){return this.T.promise}abort(e){e&&this.T.reject(e),this.aborted||(w("SimpleDb","Aborting transaction:",e?e.message:"Client-initiated abort"),this.aborted=!0,this.transaction.abort())}R(){const e=this.transaction;this.aborted||"function"!=typeof e.commit||e.commit()}store(e){const t=this.transaction.objectStore(e);return new lm(t)}}class Le{constructor(e,t,r){this.name=e,this.version=t,this.P=r,12.2===Le.v((0,L.z$)())&&J("Firestore persistence suffers from a bug in iOS 12.2 Safari that may cause your app to stop working. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.")}static delete(e){return w("SimpleDb","Removing database:",e),Et(window.indexedDB.deleteDatabase(e)).toPromise()}static V(){if(!(0,L.hl)())return!1;if(Le.S())return!0;const e=(0,L.z$)(),t=Le.v(e),r=0<t&&t<10,s=Le.D(e),i=0<s&&s<4.5;return!(e.indexOf("MSIE ")>0||e.indexOf("Trident/")>0||e.indexOf("Edge/")>0||r||i)}static S(){var e;return typeof process<"u"&&"YES"===(null===(e=process.env)||void 0===e?void 0:e.C)}static N(e,t){return e.store(t)}static v(e){const t=e.match(/i(?:phone|pad|pod) os ([\d_]+)/i),r=t?t[1].split("_").slice(0,2).join("."):"-1";return Number(r)}static D(e){const t=e.match(/Android ([\d.]+)/i),r=t?t[1].split(".").slice(0,2).join("."):"-1";return Number(r)}k(e){var t=this;return(0,p.Z)(function*(){return t.db||(w("SimpleDb","Opening database:",t.name),t.db=yield new Promise((r,s)=>{const i=indexedDB.open(t.name,t.version);i.onsuccess=o=>{r(o.target.result)},i.onblocked=()=>{s(new Qn(e,"Cannot upgrade IndexedDB schema while another tab is open. Close all tabs that access Firestore and reload this page to proceed."))},i.onerror=o=>{const a=o.target.error;s("VersionError"===a.name?new v(m.FAILED_PRECONDITION,"A newer version of the Firestore SDK was previously used and so the persisted data is not compatible with the version of the SDK you are now using. The SDK will operate with persistence disabled. If you need persistence, please re-upgrade to a newer version of the SDK or else clear the persisted IndexedDB data for your app to start fresh."):"InvalidStateError"===a.name?new v(m.FAILED_PRECONDITION,"Unable to open an IndexedDB connection. This could be due to running in a private browsing session on a browser whose private browsing sessions do not support IndexedDB: "+a):new Qn(e,a))},i.onupgradeneeded=o=>{w("SimpleDb",'Database "'+t.name+'" requires upgrade from version:',o.oldVersion),t.P.O(o.target.result,i.transaction,o.oldVersion,t.version).next(()=>{w("SimpleDb","Database upgrade to version "+t.version+" complete")})}})),t.M&&(t.db.onversionchange=r=>t.M(r)),t.db})()}F(e){this.M=e,this.db&&(this.db.onversionchange=t=>e(t))}runTransaction(e,t,r,s){var i=this;return(0,p.Z)(function*(){const o="readonly"===t;let a=0;for(;;){++a;try{i.db=yield i.k(e);const u=cs.open(i.db,e,o?"readonly":"readwrite",r),c=s(u).next(l=>(u.R(),l)).catch(l=>(u.abort(l),f.reject(l))).toPromise();return c.catch(()=>{}),yield u.A,c}catch(u){const c=u,l="FirebaseError"!==c.name&&a<3;if(w("SimpleDb","Transaction failed with error:",c.message,"Retrying:",l),i.close(),!l)return Promise.reject(c)}}})()}close(){this.db&&this.db.close(),this.db=void 0}}class cm{constructor(e){this.$=e,this.B=!1,this.L=null}get isDone(){return this.B}get U(){return this.L}set cursor(e){this.$=e}done(){this.B=!0}q(e){this.L=e}delete(){return Et(this.$.delete())}}class Qn extends v{constructor(e,t){super(m.UNAVAILABLE,`IndexedDB transaction '${e}' failed: ${t}`),this.name="IndexedDbTransactionError"}}function tt(n){return"IndexedDbTransactionError"===n.name}class lm{constructor(e){this.store=e}put(e,t){let r;return void 0!==t?(w("SimpleDb","PUT",this.store.name,e,t),r=this.store.put(t,e)):(w("SimpleDb","PUT",this.store.name,"<auto-key>",e),r=this.store.put(e)),Et(r)}add(e){return w("SimpleDb","ADD",this.store.name,e,e),Et(this.store.add(e))}get(e){return Et(this.store.get(e)).next(t=>(void 0===t&&(t=null),w("SimpleDb","GET",this.store.name,e,t),t))}delete(e){return w("SimpleDb","DELETE",this.store.name,e),Et(this.store.delete(e))}count(){return w("SimpleDb","COUNT",this.store.name),Et(this.store.count())}K(e,t){const r=this.options(e,t);if(r.index||"function"!=typeof this.store.getAll){const s=this.cursor(r),i=[];return this.G(s,(o,a)=>{i.push(a)}).next(()=>i)}{const s=this.store.getAll(r.range);return new f((i,o)=>{s.onerror=a=>{o(a.target.error)},s.onsuccess=a=>{i(a.target.result)}})}}j(e,t){const r=this.store.getAll(e,null===t?void 0:t);return new f((s,i)=>{r.onerror=o=>{i(o.target.error)},r.onsuccess=o=>{s(o.target.result)}})}W(e,t){w("SimpleDb","DELETE ALL",this.store.name);const r=this.options(e,t);r.H=!1;const s=this.cursor(r);return this.G(s,(i,o,a)=>a.delete())}J(e,t){let r;t?r=e:(r={},t=e);const s=this.cursor(r);return this.G(s,t)}Y(e){const t=this.cursor({});return new f((r,s)=>{t.onerror=i=>{const o=Zi(i.target.error);s(o)},t.onsuccess=i=>{const o=i.target.result;o?e(o.primaryKey,o.value).next(a=>{a?o.continue():r()}):r()}})}G(e,t){const r=[];return new f((s,i)=>{e.onerror=o=>{i(o.target.error)},e.onsuccess=o=>{const a=o.target.result;if(!a)return void s();const u=new cm(a),c=t(a.primaryKey,a.value,u);if(c instanceof f){const l=c.catch(h=>(u.done(),f.reject(h)));r.push(l)}u.isDone?s():null===u.U?a.continue():a.continue(u.U)}}).next(()=>f.waitFor(r))}options(e,t){let r;return void 0!==e&&("string"==typeof e?r=e:t=e),{index:r,range:t}}cursor(e){let t="next";if(e.reverse&&(t="prev"),e.index){const r=this.store.index(e.index);return e.H?r.openKeyCursor(e.range,t):r.openCursor(e.range,t)}return this.store.openCursor(e.range,t)}}function Et(n){return new f((e,t)=>{n.onsuccess=r=>{e(r.target.result)},n.onerror=r=>{const s=Zi(r.target.error);t(s)}})}let bc=!1;function Zi(n){const e=Le.v((0,L.z$)());if(e>=12.2&&e<13){const t="An internal error was encountered in the Indexed Database server";if(n.message.indexOf(t)>=0){const r=new v("internal",`IOS_INDEXEDDB_BUG1: IndexedDb has thrown '${t}'. This is likely due to an unavoidable bug in iOS. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.`);return bc||(bc=!0,setTimeout(()=>{throw r},0)),r}}return n}class hm{constructor(e,t){this.asyncQueue=e,this.X=t,this.task=null}start(){}stop(){this.task&&(this.task.cancel(),this.task=null)}get started(){return null!==this.task}Z(e){var t=this;w("IndexBackiller",`Scheduled in ${e}ms`),this.task=this.asyncQueue.enqueueAfterDelay("index_backfill",e,(0,p.Z)(function*(){t.task=null;try{w("IndexBackiller",`Documents written: ${yield t.X.tt()}`)}catch(r){tt(r)?w("IndexBackiller","Ignoring IndexedDB error during index backfill: ",r):yield et(r)}yield t.Z(1)}))}}class dm{constructor(e,t){this.localStore=e,this.persistence=t}tt(e=50){var t=this;return(0,p.Z)(function*(){return t.persistence.runTransaction("Backfill Indexes","readwrite-primary",r=>t.et(r,e))})()}et(e,t){const r=new Set;let s=t,i=!0;return f.doWhile(()=>!0===i&&s>0,()=>this.localStore.indexManager.getNextCollectionGroupToUpdate(e).next(o=>{if(null!==o&&!r.has(o))return w("IndexBackiller",`Processing collection: ${o}`),this.nt(e,o,s).next(a=>{s-=a,r.add(o)});i=!1})).next(()=>t-s)}nt(e,t,r){return this.localStore.indexManager.getMinOffsetFromCollectionGroup(e,t).next(s=>this.localStore.localDocuments.getNextDocuments(e,t,s,r).next(i=>{const o=i.changes;return this.localStore.indexManager.updateIndexEntries(e,o).next(()=>this.st(s,i)).next(a=>(w("IndexBackiller",`Updating offset: ${a}`),this.localStore.indexManager.updateCollectionGroup(e,t,a))).next(()=>o.size)}))}st(e,t){let r=e;return t.changes.forEach((s,i)=>{const o=Ec(i);zi(o,r)>0&&(r=o)}),new Ce(r.readTime,r.documentKey,Math.max(t.batchId,e.largestBatchId))}}class Se{constructor(e,t){this.previousValue=e,t&&(t.sequenceNumberHandler=r=>this.it(r),this.rt=r=>t.writeSequenceNumber(r))}it(e){return this.previousValue=Math.max(e,this.previousValue),this.previousValue}next(){const e=++this.previousValue;return this.rt&&this.rt(e),e}}function Dc(n){let e=0;for(const t in n)Object.prototype.hasOwnProperty.call(n,t)&&e++;return e}function Tt(n,e){for(const t in n)Object.prototype.hasOwnProperty.call(n,t)&&e(t,n[t])}function Ac(n){for(const e in n)if(Object.prototype.hasOwnProperty.call(n,e))return!1;return!0}Se.ot=-1;class H{constructor(e,t){this.comparator=e,this.root=t||fe.EMPTY}insert(e,t){return new H(this.comparator,this.root.insert(e,t,this.comparator).copy(null,null,fe.BLACK,null,null))}remove(e){return new H(this.comparator,this.root.remove(e,this.comparator).copy(null,null,fe.BLACK,null,null))}get(e){let t=this.root;for(;!t.isEmpty();){const r=this.comparator(e,t.key);if(0===r)return t.value;r<0?t=t.left:r>0&&(t=t.right)}return null}indexOf(e){let t=0,r=this.root;for(;!r.isEmpty();){const s=this.comparator(e,r.key);if(0===s)return t+r.left.size;s<0?r=r.left:(t+=r.left.size+1,r=r.right)}return-1}isEmpty(){return this.root.isEmpty()}get size(){return this.root.size}minKey(){return this.root.minKey()}maxKey(){return this.root.maxKey()}inorderTraversal(e){return this.root.inorderTraversal(e)}forEach(e){this.inorderTraversal((t,r)=>(e(t,r),!1))}toString(){const e=[];return this.inorderTraversal((t,r)=>(e.push(`${t}:${r}`),!1)),`{${e.join(", ")}}`}reverseTraversal(e){return this.root.reverseTraversal(e)}getIterator(){return new ls(this.root,null,this.comparator,!1)}getIteratorFrom(e){return new ls(this.root,e,this.comparator,!1)}getReverseIterator(){return new ls(this.root,null,this.comparator,!0)}getReverseIteratorFrom(e){return new ls(this.root,e,this.comparator,!0)}}class ls{constructor(e,t,r,s){this.isReverse=s,this.nodeStack=[];let i=1;for(;!e.isEmpty();)if(i=t?r(e.key,t):1,t&&s&&(i*=-1),i<0)e=this.isReverse?e.left:e.right;else{if(0===i){this.nodeStack.push(e);break}this.nodeStack.push(e),e=this.isReverse?e.right:e.left}}getNext(){let e=this.nodeStack.pop();const t={key:e.key,value:e.value};if(this.isReverse)for(e=e.left;!e.isEmpty();)this.nodeStack.push(e),e=e.right;else for(e=e.right;!e.isEmpty();)this.nodeStack.push(e),e=e.left;return t}hasNext(){return this.nodeStack.length>0}peek(){if(0===this.nodeStack.length)return null;const e=this.nodeStack[this.nodeStack.length-1];return{key:e.key,value:e.value}}}class fe{constructor(e,t,r,s,i){this.key=e,this.value=t,this.color=r??fe.RED,this.left=s??fe.EMPTY,this.right=i??fe.EMPTY,this.size=this.left.size+1+this.right.size}copy(e,t,r,s,i){return new fe(e??this.key,t??this.value,r??this.color,s??this.left,i??this.right)}isEmpty(){return!1}inorderTraversal(e){return this.left.inorderTraversal(e)||e(this.key,this.value)||this.right.inorderTraversal(e)}reverseTraversal(e){return this.right.reverseTraversal(e)||e(this.key,this.value)||this.left.reverseTraversal(e)}min(){return this.left.isEmpty()?this:this.left.min()}minKey(){return this.min().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(e,t,r){let s=this;const i=r(e,s.key);return s=i<0?s.copy(null,null,null,s.left.insert(e,t,r),null):0===i?s.copy(null,t,null,null,null):s.copy(null,null,null,null,s.right.insert(e,t,r)),s.fixUp()}removeMin(){if(this.left.isEmpty())return fe.EMPTY;let e=this;return e.left.isRed()||e.left.left.isRed()||(e=e.moveRedLeft()),e=e.copy(null,null,null,e.left.removeMin(),null),e.fixUp()}remove(e,t){let r,s=this;if(t(e,s.key)<0)s.left.isEmpty()||s.left.isRed()||s.left.left.isRed()||(s=s.moveRedLeft()),s=s.copy(null,null,null,s.left.remove(e,t),null);else{if(s.left.isRed()&&(s=s.rotateRight()),s.right.isEmpty()||s.right.isRed()||s.right.left.isRed()||(s=s.moveRedRight()),0===t(e,s.key)){if(s.right.isEmpty())return fe.EMPTY;r=s.right.min(),s=s.copy(r.key,r.value,null,null,s.right.removeMin())}s=s.copy(null,null,null,null,s.right.remove(e,t))}return s.fixUp()}isRed(){return this.color}fixUp(){let e=this;return e.right.isRed()&&!e.left.isRed()&&(e=e.rotateLeft()),e.left.isRed()&&e.left.left.isRed()&&(e=e.rotateRight()),e.left.isRed()&&e.right.isRed()&&(e=e.colorFlip()),e}moveRedLeft(){let e=this.colorFlip();return e.right.left.isRed()&&(e=e.copy(null,null,null,null,e.right.rotateRight()),e=e.rotateLeft(),e=e.colorFlip()),e}moveRedRight(){let e=this.colorFlip();return e.left.left.isRed()&&(e=e.rotateRight(),e=e.colorFlip()),e}rotateLeft(){const e=this.copy(null,null,fe.RED,null,this.right.left);return this.right.copy(null,null,this.color,e,null)}rotateRight(){const e=this.copy(null,null,fe.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,e)}colorFlip(){const e=this.left.copy(null,null,!this.left.color,null,null),t=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,e,t)}checkMaxDepth(){const e=this.check();return Math.pow(2,e)<=this.size+1}check(){if(this.isRed()&&this.left.isRed()||this.right.isRed())throw T();const e=this.left.check();if(e!==this.right.check())throw T();return e+(this.isRed()?0:1)}}fe.EMPTY=null,fe.RED=!0,fe.BLACK=!1,fe.EMPTY=new class{constructor(){this.size=0}get key(){throw T()}get value(){throw T()}get color(){throw T()}get left(){throw T()}get right(){throw T()}copy(n,e,t,r,s){return this}insert(n,e,t){return new fe(n,e)}remove(n,e){return this}isEmpty(){return!0}inorderTraversal(n){return!1}reverseTraversal(n){return!1}minKey(){return null}maxKey(){return null}isRed(){return!1}checkMaxDepth(){return!0}check(){return 0}};class P{constructor(e){this.comparator=e,this.data=new H(this.comparator)}has(e){return null!==this.data.get(e)}first(){return this.data.minKey()}last(){return this.data.maxKey()}get size(){return this.data.size}indexOf(e){return this.data.indexOf(e)}forEach(e){this.data.inorderTraversal((t,r)=>(e(t),!1))}forEachInRange(e,t){const r=this.data.getIteratorFrom(e[0]);for(;r.hasNext();){const s=r.getNext();if(this.comparator(s.key,e[1])>=0)return;t(s.key)}}forEachWhile(e,t){let r;for(r=void 0!==t?this.data.getIteratorFrom(t):this.data.getIterator();r.hasNext();)if(!e(r.getNext().key))return}firstAfterOrEqual(e){const t=this.data.getIteratorFrom(e);return t.hasNext()?t.getNext().key:null}getIterator(){return new Cc(this.data.getIterator())}getIteratorFrom(e){return new Cc(this.data.getIteratorFrom(e))}add(e){return this.copy(this.data.remove(e).insert(e,!0))}delete(e){return this.has(e)?this.copy(this.data.remove(e)):this}isEmpty(){return this.data.isEmpty()}unionWith(e){let t=this;return t.size<e.size&&(t=e,e=this),e.forEach(r=>{t=t.add(r)}),t}isEqual(e){if(!(e instanceof P)||this.size!==e.size)return!1;const t=this.data.getIterator(),r=e.data.getIterator();for(;t.hasNext();){const s=t.getNext().key,i=r.getNext().key;if(0!==this.comparator(s,i))return!1}return!0}toArray(){const e=[];return this.forEach(t=>{e.push(t)}),e}toString(){const e=[];return this.forEach(t=>e.push(t)),"SortedSet("+e.toString()+")"}copy(e){const t=new P(this.comparator);return t.data=e,t}}class Cc{constructor(e){this.iter=e}getNext(){return this.iter.getNext().key}hasNext(){return this.iter.hasNext()}}function en(n){return n.hasNext()?n.getNext():void 0}class Ne{constructor(e){this.fields=e,e.sort(X.comparator)}static empty(){return new Ne([])}unionWith(e){let t=new P(X.comparator);for(const r of this.fields)t=t.add(r);for(const r of e)t=t.add(r);return new Ne(t.toArray())}covers(e){for(const t of this.fields)if(t.isPrefixOf(e))return!0;return!1}isEqual(e){return Jt(this.fields,e.fields,(t,r)=>t.isEqual(r))}}class re{constructor(e){this.binaryString=e}static fromBase64String(e){const t=atob(e);return new re(t)}static fromUint8Array(e){const t=function(r){let s="";for(let i=0;i<r.length;++i)s+=String.fromCharCode(r[i]);return s}(e);return new re(t)}[Symbol.iterator](){let e=0;return{next:()=>e<this.binaryString.length?{value:this.binaryString.charCodeAt(e++),done:!1}:{value:void 0,done:!0}}}toBase64(){return btoa(this.binaryString)}toUint8Array(){return function(e){const t=new Uint8Array(e.length);for(let r=0;r<e.length;r++)t[r]=e.charCodeAt(r);return t}(this.binaryString)}approximateByteSize(){return 2*this.binaryString.length}compareTo(e){return C(this.binaryString,e.binaryString)}isEqual(e){return this.binaryString===e.binaryString}}re.EMPTY_BYTE_STRING=new re("");const mm=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function nt(n){if(D(!!n),"string"==typeof n){let e=0;const t=mm.exec(n);if(D(!!t),t[1]){let s=t[1];s=(s+"000000000").substr(0,9),e=Number(s)}const r=new Date(n);return{seconds:Math.floor(r.getTime()/1e3),nanos:e}}return{seconds:W(n.seconds),nanos:W(n.nanos)}}function W(n){return"number"==typeof n?n:"string"==typeof n?Number(n):0}function St(n){return"string"==typeof n?re.fromBase64String(n):re.fromUint8Array(n)}function Hi(n){var e,t;return"server_timestamp"===(null===(t=((null===(e=n?.mapValue)||void 0===e?void 0:e.fields)||{}).__type__)||void 0===t?void 0:t.stringValue)}function Nc(n){const e=n.mapValue.fields.__previous_value__;return Hi(e)?Nc(e):e}function Zn(n){const e=nt(n.mapValue.fields.__local_write_time__.timestampValue);return new $(e.seconds,e.nanos)}class gm{constructor(e,t,r,s,i,o,a,u){this.databaseId=e,this.appId=t,this.persistenceKey=r,this.host=s,this.ssl=i,this.forceLongPolling=o,this.autoDetectLongPolling=a,this.useFetchStreams=u}}class $e{constructor(e,t){this.projectId=e,this.database=t||"(default)"}static empty(){return new $e("","")}get isDefaultDatabase(){return"(default)"===this.database}isEqual(e){return e instanceof $e&&e.projectId===this.projectId&&e.database===this.database}}function Hn(n){return null==n}function Wn(n){return 0===n&&1/n==-1/0}function kc(n){return"number"==typeof n&&Number.isInteger(n)&&!Wn(n)&&n<=Number.MAX_SAFE_INTEGER&&n>=Number.MIN_SAFE_INTEGER}const rt={mapValue:{fields:{__type__:{stringValue:"__max__"}}}},hs={nullValue:"NULL_VALUE"};function bt(n){return"nullValue"in n?0:"booleanValue"in n?1:"integerValue"in n||"doubleValue"in n?2:"timestampValue"in n?3:"stringValue"in n?5:"bytesValue"in n?6:"referenceValue"in n?7:"geoPointValue"in n?8:"arrayValue"in n?9:"mapValue"in n?Hi(n)?4:Lc(n)?9007199254740991:10:T()}function Oe(n,e){if(n===e)return!0;const t=bt(n);if(t!==bt(e))return!1;switch(t){case 0:case 9007199254740991:return!0;case 1:return n.booleanValue===e.booleanValue;case 4:return Zn(n).isEqual(Zn(e));case 3:return function(r,s){if("string"==typeof r.timestampValue&&"string"==typeof s.timestampValue&&r.timestampValue.length===s.timestampValue.length)return r.timestampValue===s.timestampValue;const i=nt(r.timestampValue),o=nt(s.timestampValue);return i.seconds===o.seconds&&i.nanos===o.nanos}(n,e);case 5:return n.stringValue===e.stringValue;case 6:return s=e,St(n.bytesValue).isEqual(St(s.bytesValue));case 7:return n.referenceValue===e.referenceValue;case 8:return function(r,s){return W(r.geoPointValue.latitude)===W(s.geoPointValue.latitude)&&W(r.geoPointValue.longitude)===W(s.geoPointValue.longitude)}(n,e);case 2:return function(r,s){if("integerValue"in r&&"integerValue"in s)return W(r.integerValue)===W(s.integerValue);if("doubleValue"in r&&"doubleValue"in s){const i=W(r.doubleValue),o=W(s.doubleValue);return i===o?Wn(i)===Wn(o):isNaN(i)&&isNaN(o)}return!1}(n,e);case 9:return Jt(n.arrayValue.values||[],e.arrayValue.values||[],Oe);case 10:return function(r,s){const i=r.mapValue.fields||{},o=s.mapValue.fields||{};if(Dc(i)!==Dc(o))return!1;for(const a in i)if(i.hasOwnProperty(a)&&(void 0===o[a]||!Oe(i[a],o[a])))return!1;return!0}(n,e);default:return T()}var s}function Xn(n,e){return void 0!==(n.values||[]).find(t=>Oe(t,e))}function st(n,e){if(n===e)return 0;const t=bt(n),r=bt(e);if(t!==r)return C(t,r);switch(t){case 0:case 9007199254740991:return 0;case 1:return C(n.booleanValue,e.booleanValue);case 2:return function(s,i){const o=W(s.integerValue||s.doubleValue),a=W(i.integerValue||i.doubleValue);return o<a?-1:o>a?1:o===a?0:isNaN(o)?isNaN(a)?0:-1:1}(n,e);case 3:return Rc(n.timestampValue,e.timestampValue);case 4:return Rc(Zn(n),Zn(e));case 5:return C(n.stringValue,e.stringValue);case 6:return function(s,i){const o=St(s),a=St(i);return o.compareTo(a)}(n.bytesValue,e.bytesValue);case 7:return function(s,i){const o=s.split("/"),a=i.split("/");for(let u=0;u<o.length&&u<a.length;u++){const c=C(o[u],a[u]);if(0!==c)return c}return C(o.length,a.length)}(n.referenceValue,e.referenceValue);case 8:return function(s,i){const o=C(W(s.latitude),W(i.latitude));return 0!==o?o:C(W(s.longitude),W(i.longitude))}(n.geoPointValue,e.geoPointValue);case 9:return function(s,i){const o=s.values||[],a=i.values||[];for(let u=0;u<o.length&&u<a.length;++u){const c=st(o[u],a[u]);if(c)return c}return C(o.length,a.length)}(n.arrayValue,e.arrayValue);case 10:return function(s,i){if(s===rt.mapValue&&i===rt.mapValue)return 0;if(s===rt.mapValue)return 1;if(i===rt.mapValue)return-1;const o=s.fields||{},a=Object.keys(o),u=i.fields||{},c=Object.keys(u);a.sort(),c.sort();for(let l=0;l<a.length&&l<c.length;++l){const h=C(a[l],c[l]);if(0!==h)return h;const d=st(o[a[l]],u[c[l]]);if(0!==d)return d}return C(a.length,c.length)}(n.mapValue,e.mapValue);default:throw T()}}function Rc(n,e){if("string"==typeof n&&"string"==typeof e&&n.length===e.length)return C(n,e);const t=nt(n),r=nt(e),s=C(t.seconds,r.seconds);return 0!==s?s:C(t.nanos,r.nanos)}function tn(n){return Wi(n)}function Wi(n){return"nullValue"in n?"null":"booleanValue"in n?""+n.booleanValue:"integerValue"in n?""+n.integerValue:"doubleValue"in n?""+n.doubleValue:"timestampValue"in n?function(r){const s=nt(r);return`time(${s.seconds},${s.nanos})`}(n.timestampValue):"stringValue"in n?n.stringValue:"bytesValue"in n?St(n.bytesValue).toBase64():"referenceValue"in n?I.fromName(n.referenceValue).toString():"geoPointValue"in n?`geo(${(e=n.geoPointValue).latitude},${e.longitude})`:"arrayValue"in n?function(r){let s="[",i=!0;for(const o of r.values||[])i?i=!1:s+=",",s+=Wi(o);return s+"]"}(n.arrayValue):"mapValue"in n?function(r){const s=Object.keys(r.fields||{}).sort();let i="{",o=!0;for(const a of s)o?o=!1:i+=",",i+=`${a}:${Wi(r.fields[a])}`;return i+"}"}(n.mapValue):T();var e}function Dt(n,e){return{referenceValue:`projects/${n.projectId}/databases/${n.database}/documents/${e.path.canonicalString()}`}}function Xi(n){return!!n&&"integerValue"in n}function Yn(n){return!!n&&"arrayValue"in n}function Mc(n){return!!n&&"nullValue"in n}function Fc(n){return!!n&&"doubleValue"in n&&isNaN(Number(n.doubleValue))}function ds(n){return!!n&&"mapValue"in n}function Jn(n){if(n.geoPointValue)return{geoPointValue:Object.assign({},n.geoPointValue)};if(n.timestampValue&&"object"==typeof n.timestampValue)return{timestampValue:Object.assign({},n.timestampValue)};if(n.mapValue){const e={mapValue:{fields:{}}};return Tt(n.mapValue.fields,(t,r)=>e.mapValue.fields[t]=Jn(r)),e}if(n.arrayValue){const e={arrayValue:{values:[]}};for(let t=0;t<(n.arrayValue.values||[]).length;++t)e.arrayValue.values[t]=Jn(n.arrayValue.values[t]);return e}return Object.assign({},n)}function Lc(n){return"__max__"===(((n.mapValue||{}).fields||{}).__type__||{}).stringValue}function pm(n){return"nullValue"in n?hs:"booleanValue"in n?{booleanValue:!1}:"integerValue"in n||"doubleValue"in n?{doubleValue:NaN}:"timestampValue"in n?{timestampValue:{seconds:Number.MIN_SAFE_INTEGER}}:"stringValue"in n?{stringValue:""}:"bytesValue"in n?{bytesValue:""}:"referenceValue"in n?Dt($e.empty(),I.empty()):"geoPointValue"in n?{geoPointValue:{latitude:-90,longitude:-180}}:"arrayValue"in n?{arrayValue:{}}:"mapValue"in n?{mapValue:{}}:T()}function ym(n){return"nullValue"in n?{booleanValue:!1}:"booleanValue"in n?{doubleValue:NaN}:"integerValue"in n||"doubleValue"in n?{timestampValue:{seconds:Number.MIN_SAFE_INTEGER}}:"timestampValue"in n?{stringValue:""}:"stringValue"in n?{bytesValue:""}:"bytesValue"in n?Dt($e.empty(),I.empty()):"referenceValue"in n?{geoPointValue:{latitude:-90,longitude:-180}}:"geoPointValue"in n?{arrayValue:{}}:"arrayValue"in n?{mapValue:{}}:"mapValue"in n?rt:T()}function Oc(n,e){const t=st(n.value,e.value);return 0!==t?t:n.inclusive&&!e.inclusive?-1:!n.inclusive&&e.inclusive?1:0}function Vc(n,e){const t=st(n.value,e.value);return 0!==t?t:n.inclusive&&!e.inclusive?1:!n.inclusive&&e.inclusive?-1:0}class me{constructor(e){this.value=e}static empty(){return new me({mapValue:{}})}field(e){if(e.isEmpty())return this.value;{let t=this.value;for(let r=0;r<e.length-1;++r)if(t=(t.mapValue.fields||{})[e.get(r)],!ds(t))return null;return t=(t.mapValue.fields||{})[e.lastSegment()],t||null}}set(e,t){this.getFieldsMap(e.popLast())[e.lastSegment()]=Jn(t)}setAll(e){let t=X.emptyPath(),r={},s=[];e.forEach((o,a)=>{if(!t.isImmediateParentOf(a)){const u=this.getFieldsMap(t);this.applyChanges(u,r,s),r={},s=[],t=a.popLast()}o?r[a.lastSegment()]=Jn(o):s.push(a.lastSegment())});const i=this.getFieldsMap(t);this.applyChanges(i,r,s)}delete(e){const t=this.field(e.popLast());ds(t)&&t.mapValue.fields&&delete t.mapValue.fields[e.lastSegment()]}isEqual(e){return Oe(this.value,e.value)}getFieldsMap(e){let t=this.value;t.mapValue.fields||(t.mapValue={fields:{}});for(let r=0;r<e.length;++r){let s=t.mapValue.fields[e.get(r)];ds(s)&&s.mapValue.fields||(s={mapValue:{fields:{}}},t.mapValue.fields[e.get(r)]=s),t=s}return t.mapValue.fields}applyChanges(e,t,r){Tt(t,(s,i)=>e[s]=i);for(const s of r)delete e[s]}clone(){return new me(Jn(this.value))}}function Pc(n){const e=[];return Tt(n.fields,(t,r)=>{const s=new X([t]);if(ds(r)){const i=Pc(r.mapValue).fields;if(0===i.length)e.push(s);else for(const o of i)e.push(s.child(o))}else e.push(s)}),new Ne(e)}class B{constructor(e,t,r,s,i,o){this.key=e,this.documentType=t,this.version=r,this.readTime=s,this.data=i,this.documentState=o}static newInvalidDocument(e){return new B(e,0,b.min(),b.min(),me.empty(),0)}static newFoundDocument(e,t,r){return new B(e,1,t,b.min(),r,0)}static newNoDocument(e,t){return new B(e,2,t,b.min(),me.empty(),0)}static newUnknownDocument(e,t){return new B(e,3,t,b.min(),me.empty(),2)}convertToFoundDocument(e,t){return this.version=e,this.documentType=1,this.data=t,this.documentState=0,this}convertToNoDocument(e){return this.version=e,this.documentType=2,this.data=me.empty(),this.documentState=0,this}convertToUnknownDocument(e){return this.version=e,this.documentType=3,this.data=me.empty(),this.documentState=2,this}setHasCommittedMutations(){return this.documentState=2,this}setHasLocalMutations(){return this.documentState=1,this.version=b.min(),this}setReadTime(e){return this.readTime=e,this}get hasLocalMutations(){return 1===this.documentState}get hasCommittedMutations(){return 2===this.documentState}get hasPendingWrites(){return this.hasLocalMutations||this.hasCommittedMutations}isValidDocument(){return 0!==this.documentType}isFoundDocument(){return 1===this.documentType}isNoDocument(){return 2===this.documentType}isUnknownDocument(){return 3===this.documentType}isEqual(e){return e instanceof B&&this.key.isEqual(e.key)&&this.version.isEqual(e.version)&&this.documentType===e.documentType&&this.documentState===e.documentState&&this.data.isEqual(e.data)}mutableCopy(){return new B(this.key,this.documentType,this.version,this.readTime,this.data.clone(),this.documentState)}toString(){return`Document(${this.key}, ${this.version}, ${JSON.stringify(this.data.value)}, {documentType: ${this.documentType}}), {documentState: ${this.documentState}})`}}class vm{constructor(e,t=null,r=[],s=[],i=null,o=null,a=null){this.path=e,this.collectionGroup=t,this.orderBy=r,this.filters=s,this.limit=i,this.startAt=o,this.endAt=a,this.ut=null}}function Uc(n,e=null,t=[],r=[],s=null,i=null,o=null){return new vm(n,e,t,r,s,i,o)}function At(n){const e=_(n);if(null===e.ut){let t=e.path.canonicalString();null!==e.collectionGroup&&(t+="|cg:"+e.collectionGroup),t+="|f:",t+=e.filters.map(r=>{return(s=r).field.canonicalString()+s.op.toString()+tn(s.value);var s}).join(","),t+="|ob:",t+=e.orderBy.map(r=>{return(s=r).field.canonicalString()+s.dir;var s}).join(","),Hn(e.limit)||(t+="|l:",t+=e.limit),e.startAt&&(t+="|lb:",t+=e.startAt.inclusive?"b:":"a:",t+=e.startAt.position.map(r=>tn(r)).join(",")),e.endAt&&(t+="|ub:",t+=e.endAt.inclusive?"a:":"b:",t+=e.endAt.position.map(r=>tn(r)).join(",")),e.ut=t}return e.ut}function er(n,e){if(n.limit!==e.limit||n.orderBy.length!==e.orderBy.length)return!1;for(let s=0;s<n.orderBy.length;s++)if(!Dm(n.orderBy[s],e.orderBy[s]))return!1;if(n.filters.length!==e.filters.length)return!1;for(let s=0;s<n.filters.length;s++)if((t=n.filters[s]).op!==(r=e.filters[s]).op||!t.field.isEqual(r.field)||!Oe(t.value,r.value))return!1;var t,r;return n.collectionGroup===e.collectionGroup&&!!n.path.isEqual(e.path)&&!!jc(n.startAt,e.startAt)&&jc(n.endAt,e.endAt)}function fs(n){return I.isDocumentKey(n.path)&&null===n.collectionGroup&&0===n.filters.length}function ms(n,e){return n.filters.filter(t=>t instanceof ge&&t.field.isEqual(e))}function Bc(n,e,t){let r=hs,s=!0;for(const i of ms(n,e)){let o=hs,a=!0;switch(i.op){case"<":case"<=":o=pm(i.value);break;case"==":case"in":case">=":o=i.value;break;case">":o=i.value,a=!1;break;case"!=":case"not-in":o=hs}Oc({value:r,inclusive:s},{value:o,inclusive:a})<0&&(r=o,s=a)}if(null!==t)for(let i=0;i<n.orderBy.length;++i)if(n.orderBy[i].field.isEqual(e)){const o=t.position[i];Oc({value:r,inclusive:s},{value:o,inclusive:t.inclusive})<0&&(r=o,s=t.inclusive);break}return{value:r,inclusive:s}}function qc(n,e,t){let r=rt,s=!0;for(const i of ms(n,e)){let o=rt,a=!0;switch(i.op){case">=":case">":o=ym(i.value),a=!1;break;case"==":case"in":case"<=":o=i.value;break;case"<":o=i.value,a=!1;break;case"!=":case"not-in":o=rt}Vc({value:r,inclusive:s},{value:o,inclusive:a})>0&&(r=o,s=a)}if(null!==t)for(let i=0;i<n.orderBy.length;++i)if(n.orderBy[i].field.isEqual(e)){const o=t.position[i];Vc({value:r,inclusive:s},{value:o,inclusive:t.inclusive})>0&&(r=o,s=t.inclusive);break}return{value:r,inclusive:s}}class ge extends class{}{constructor(e,t,r){super(),this.field=e,this.op=t,this.value=r}static create(e,t,r){return e.isKeyField()?"in"===t||"not-in"===t?this.ct(e,t,r):new Im(e,t,r):"array-contains"===t?new Em(e,r):"in"===t?new Tm(e,r):"not-in"===t?new Sm(e,r):"array-contains-any"===t?new bm(e,r):new ge(e,t,r)}static ct(e,t,r){return"in"===t?new _m(e,r):new xm(e,r)}matches(e){const t=e.data.field(this.field);return"!="===this.op?null!==t&&this.at(st(t,this.value)):null!==t&&bt(this.value)===bt(t)&&this.at(st(t,this.value))}at(e){switch(this.op){case"<":return e<0;case"<=":return e<=0;case"==":return 0===e;case"!=":return 0!==e;case">":return e>0;case">=":return e>=0;default:return T()}}ht(){return["<","<=",">",">=","!=","not-in"].indexOf(this.op)>=0}}class Im extends ge{constructor(e,t,r){super(e,t,r),this.key=I.fromName(r.referenceValue)}matches(e){const t=I.comparator(e.key,this.key);return this.at(t)}}class _m extends ge{constructor(e,t){super(e,"in",t),this.keys=Gc(0,t)}matches(e){return this.keys.some(t=>t.isEqual(e.key))}}class xm extends ge{constructor(e,t){super(e,"not-in",t),this.keys=Gc(0,t)}matches(e){return!this.keys.some(t=>t.isEqual(e.key))}}function Gc(n,e){var t;return((null===(t=e.arrayValue)||void 0===t?void 0:t.values)||[]).map(r=>I.fromName(r.referenceValue))}class Em extends ge{constructor(e,t){super(e,"array-contains",t)}matches(e){const t=e.data.field(this.field);return Yn(t)&&Xn(t.arrayValue,this.value)}}class Tm extends ge{constructor(e,t){super(e,"in",t)}matches(e){const t=e.data.field(this.field);return null!==t&&Xn(this.value.arrayValue,t)}}class Sm extends ge{constructor(e,t){super(e,"not-in",t)}matches(e){if(Xn(this.value.arrayValue,{nullValue:"NULL_VALUE"}))return!1;const t=e.data.field(this.field);return null!==t&&!Xn(this.value.arrayValue,t)}}class bm extends ge{constructor(e,t){super(e,"array-contains-any",t)}matches(e){const t=e.data.field(this.field);return!(!Yn(t)||!t.arrayValue.values)&&t.arrayValue.values.some(r=>Xn(this.value.arrayValue,r))}}class it{constructor(e,t){this.position=e,this.inclusive=t}}class nn{constructor(e,t="asc"){this.field=e,this.dir=t}}function Dm(n,e){return n.dir===e.dir&&n.field.isEqual(e.field)}function Kc(n,e,t){let r=0;for(let s=0;s<n.position.length;s++){const i=e[s],o=n.position[s];if(r=i.field.isKeyField()?I.comparator(I.fromName(o.referenceValue),t.key):st(o,t.data.field(i.field)),"desc"===i.dir&&(r*=-1),0!==r)break}return r}function jc(n,e){if(null===n)return null===e;if(null===e||n.inclusive!==e.inclusive||n.position.length!==e.position.length)return!1;for(let t=0;t<n.position.length;t++)if(!Oe(n.position[t],e.position[t]))return!1;return!0}class ze{constructor(e,t=null,r=[],s=[],i=null,o="F",a=null,u=null){this.path=e,this.collectionGroup=t,this.explicitOrderBy=r,this.filters=s,this.limit=i,this.limitType=o,this.startAt=a,this.endAt=u,this.lt=null,this.ft=null}}function $c(n,e,t,r,s,i,o,a){return new ze(n,e,t,r,s,i,o,a)}function rn(n){return new ze(n)}function Yi(n){return n.explicitOrderBy.length>0?n.explicitOrderBy[0].field:null}function Ji(n){for(const e of n.filters)if(e.ht())return e.field;return null}function eo(n){return null!==n.collectionGroup}function sn(n){const e=_(n);if(null===e.lt){e.lt=[];const t=Ji(e),r=Yi(e);if(null!==t&&null===r)t.isKeyField()||e.lt.push(new nn(t)),e.lt.push(new nn(X.keyField(),"asc"));else{let s=!1;for(const i of e.explicitOrderBy)e.lt.push(i),i.field.isKeyField()&&(s=!0);if(!s){const i=e.explicitOrderBy.length>0?e.explicitOrderBy[e.explicitOrderBy.length-1].dir:"asc";e.lt.push(new nn(X.keyField(),i))}}}return e.lt}function Me(n){const e=_(n);if(!e.ft)if("F"===e.limitType)e.ft=Uc(e.path,e.collectionGroup,sn(e),e.filters,e.limit,e.startAt,e.endAt);else{const t=[];for(const i of sn(e))t.push(new nn(i.field,"desc"===i.dir?"asc":"desc"));const r=e.endAt?new it(e.endAt.position,e.endAt.inclusive):null,s=e.startAt?new it(e.startAt.position,e.startAt.inclusive):null;e.ft=Uc(e.path,e.collectionGroup,t,e.filters,e.limit,r,s)}return e.ft}function zc(n,e,t){return new ze(n.path,n.collectionGroup,n.explicitOrderBy.slice(),n.filters.slice(),e,t,n.startAt,n.endAt)}function tr(n,e){return er(Me(n),Me(e))&&n.limitType===e.limitType}function Qc(n){return`${At(Me(n))}|lt:${n.limitType}`}function to(n){return`Query(target=${function wm(n){let e=n.path.canonicalString();return null!==n.collectionGroup&&(e+=" collectionGroup="+n.collectionGroup),n.filters.length>0&&(e+=`, filters: [${n.filters.map(t=>{return`${(r=t).field.canonicalString()} ${r.op} ${tn(r.value)}`;var r}).join(", ")}]`),Hn(n.limit)||(e+=", limit: "+n.limit),n.orderBy.length>0&&(e+=`, orderBy: [${n.orderBy.map(t=>{return`${(r=t).field.canonicalString()} (${r.dir})`;var r}).join(", ")}]`),n.startAt&&(e+=", startAt: ",e+=n.startAt.inclusive?"b:":"a:",e+=n.startAt.position.map(t=>tn(t)).join(",")),n.endAt&&(e+=", endAt: ",e+=n.endAt.inclusive?"a:":"b:",e+=n.endAt.position.map(t=>tn(t)).join(",")),`Target(${e})`}(Me(n))}; limitType=${n.limitType})`}function no(n,e){return e.isFoundDocument()&&function(t,r){const s=r.key.path;return null!==t.collectionGroup?r.key.hasCollectionId(t.collectionGroup)&&t.path.isPrefixOf(s):I.isDocumentKey(t.path)?t.path.isEqual(s):t.path.isImmediateParentOf(s)}(n,e)&&function(t,r){for(const s of t.explicitOrderBy)if(!s.field.isKeyField()&&null===r.data.field(s.field))return!1;return!0}(n,e)&&function(t,r){for(const s of t.filters)if(!s.matches(r))return!1;return!0}(n,e)&&(r=e,!((t=n).startAt&&!function(s,i,o){const a=Kc(s,i,o);return s.inclusive?a<=0:a<0}(t.startAt,sn(t),r)||t.endAt&&!function(s,i,o){const a=Kc(s,i,o);return s.inclusive?a>=0:a>0}(t.endAt,sn(t),r)));var t,r}function Zc(n){return n.collectionGroup||(n.path.length%2==1?n.path.lastSegment():n.path.get(n.path.length-2))}function Hc(n){return(e,t)=>{let r=!1;for(const s of sn(n)){const i=Cm(s,e,t);if(0!==i)return i;r=r||s.field.isKeyField()}return 0}}function Cm(n,e,t){const r=n.field.isKeyField()?I.comparator(e.key,t.key):function(s,i,o){const a=i.data.field(s),u=o.data.field(s);return null!==a&&null!==u?st(a,u):T()}(n.field,e,t);switch(n.dir){case"asc":return r;case"desc":return-1*r;default:return T()}}function Wc(n,e){if(n.dt){if(isNaN(e))return{doubleValue:"NaN"};if(e===1/0)return{doubleValue:"Infinity"};if(e===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:Wn(e)?"-0":e}}function Xc(n){return{integerValue:""+n}}function Yc(n,e){return kc(e)?Xc(e):Wc(n,e)}class gs{constructor(){this._=void 0}}function Nm(n,e,t){return n instanceof on?function(r,s){const i={fields:{__type__:{stringValue:"server_timestamp"},__local_write_time__:{timestampValue:{seconds:r.seconds,nanos:r.nanoseconds}}}};return s&&(i.fields.__previous_value__=s),{mapValue:i}}(t,e):n instanceof Ct?el(n,e):n instanceof Nt?tl(n,e):function(r,s){const i=Jc(r,s),o=nl(i)+nl(r._t);return Xi(i)&&Xi(r._t)?Xc(o):Wc(r.wt,o)}(n,e)}function km(n,e,t){return n instanceof Ct?el(n,e):n instanceof Nt?tl(n,e):t}function Jc(n,e){return n instanceof an?Xi(t=e)||(r=t)&&"doubleValue"in r?e:{integerValue:0}:null;var r,t}class on extends gs{}class Ct extends gs{constructor(e){super(),this.elements=e}}function el(n,e){const t=rl(e);for(const r of n.elements)t.some(s=>Oe(s,r))||t.push(r);return{arrayValue:{values:t}}}class Nt extends gs{constructor(e){super(),this.elements=e}}function tl(n,e){let t=rl(e);for(const r of n.elements)t=t.filter(s=>!Oe(s,r));return{arrayValue:{values:t}}}class an extends gs{constructor(e,t){super(),this.wt=e,this._t=t}}function nl(n){return W(n.integerValue||n.doubleValue)}function rl(n){return Yn(n)&&n.arrayValue.values?n.arrayValue.values.slice():[]}class nr{constructor(e,t){this.field=e,this.transform=t}}class Mm{constructor(e,t){this.version=e,this.transformResults=t}}class Q{constructor(e,t){this.updateTime=e,this.exists=t}static none(){return new Q}static exists(e){return new Q(void 0,e)}static updateTime(e){return new Q(e)}get isNone(){return void 0===this.updateTime&&void 0===this.exists}isEqual(e){return this.exists===e.exists&&(this.updateTime?!!e.updateTime&&this.updateTime.isEqual(e.updateTime):!e.updateTime)}}function ps(n,e){return void 0!==n.updateTime?e.isFoundDocument()&&e.version.isEqual(n.updateTime):void 0===n.exists||n.exists===e.isFoundDocument()}class ys{}function sl(n,e){if(!n.hasLocalMutations||e&&0===e.fields.length)return null;if(null===e)return n.isNoDocument()?new cn(n.key,Q.none()):new un(n.key,n.data,Q.none());{const t=n.data,r=me.empty();let s=new P(X.comparator);for(let i of e.fields)if(!s.has(i)){let o=t.field(i);null===o&&i.length>1&&(i=i.popLast(),o=t.field(i)),null===o?r.delete(i):r.set(i,o),s=s.add(i)}return new Qe(n.key,r,new Ne(s.toArray()),Q.none())}}function Fm(n,e,t){n instanceof un?function(r,s,i){const o=r.value.clone(),a=al(r.fieldTransforms,s,i.transformResults);o.setAll(a),s.convertToFoundDocument(i.version,o).setHasCommittedMutations()}(n,e,t):n instanceof Qe?function(r,s,i){if(!ps(r.precondition,s))return void s.convertToUnknownDocument(i.version);const o=al(r.fieldTransforms,s,i.transformResults),a=s.data;a.setAll(ol(r)),a.setAll(o),s.convertToFoundDocument(i.version,a).setHasCommittedMutations()}(n,e,t):e.convertToNoDocument(t.version).setHasCommittedMutations()}function rr(n,e,t,r){return n instanceof un?function(s,i,o,a){if(!ps(s.precondition,i))return o;const u=s.value.clone(),c=ul(s.fieldTransforms,a,i);return u.setAll(c),i.convertToFoundDocument(i.version,u).setHasLocalMutations(),null}(n,e,t,r):n instanceof Qe?function(s,i,o,a){if(!ps(s.precondition,i))return o;const u=ul(s.fieldTransforms,a,i),c=i.data;return c.setAll(ol(s)),c.setAll(u),i.convertToFoundDocument(i.version,c).setHasLocalMutations(),null===o?null:o.unionWith(s.fieldMask.fields).unionWith(s.fieldTransforms.map(l=>l.field))}(n,e,t,r):(o=t,ps(n.precondition,i=e)?(i.convertToNoDocument(i.version).setHasLocalMutations(),null):o);var i,o}function Lm(n,e){let t=null;for(const r of n.fieldTransforms){const s=e.data.field(r.field),i=Jc(r.transform,s||null);null!=i&&(null===t&&(t=me.empty()),t.set(r.field,i))}return t||null}function il(n,e){return n.type===e.type&&!!n.key.isEqual(e.key)&&!!n.precondition.isEqual(e.precondition)&&(r=e.fieldTransforms,!!(void 0===(t=n.fieldTransforms)&&void 0===r||t&&r&&Jt(t,r,(s,i)=>function Rm(n,e){return n.field.isEqual(e.field)&&(r=e.transform,(t=n.transform)instanceof Ct&&r instanceof Ct||t instanceof Nt&&r instanceof Nt?Jt(t.elements,r.elements,Oe):t instanceof an&&r instanceof an?Oe(t._t,r._t):t instanceof on&&r instanceof on);var t,r}(s,i))))&&(0===n.type?n.value.isEqual(e.value):1!==n.type||n.data.isEqual(e.data)&&n.fieldMask.isEqual(e.fieldMask));var t,r}class un extends ys{constructor(e,t,r,s=[]){super(),this.key=e,this.value=t,this.precondition=r,this.fieldTransforms=s,this.type=0}getFieldMask(){return null}}class Qe extends ys{constructor(e,t,r,s,i=[]){super(),this.key=e,this.data=t,this.fieldMask=r,this.precondition=s,this.fieldTransforms=i,this.type=1}getFieldMask(){return this.fieldMask}}function ol(n){const e=new Map;return n.fieldMask.fields.forEach(t=>{if(!t.isEmpty()){const r=n.data.field(t);e.set(t,r)}}),e}function al(n,e,t){const r=new Map;D(n.length===t.length);for(let s=0;s<t.length;s++){const i=n[s],o=i.transform,a=e.data.field(i.field);r.set(i.field,km(o,a,t[s]))}return r}function ul(n,e,t){const r=new Map;for(const s of n){const i=s.transform,o=t.data.field(s.field);r.set(s.field,Nm(i,o,e))}return r}class cn extends ys{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=2,this.fieldTransforms=[]}getFieldMask(){return null}}class ro extends ys{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=3,this.fieldTransforms=[]}getFieldMask(){return null}}class Om{constructor(e){this.count=e}}var ee,F;function cl(n){switch(n){default:return T();case m.CANCELLED:case m.UNKNOWN:case m.DEADLINE_EXCEEDED:case m.RESOURCE_EXHAUSTED:case m.INTERNAL:case m.UNAVAILABLE:case m.UNAUTHENTICATED:return!1;case m.INVALID_ARGUMENT:case m.NOT_FOUND:case m.ALREADY_EXISTS:case m.PERMISSION_DENIED:case m.FAILED_PRECONDITION:case m.ABORTED:case m.OUT_OF_RANGE:case m.UNIMPLEMENTED:case m.DATA_LOSS:return!0}}function ll(n){if(void 0===n)return J("GRPC error has no .code"),m.UNKNOWN;switch(n){case ee.OK:return m.OK;case ee.CANCELLED:return m.CANCELLED;case ee.UNKNOWN:return m.UNKNOWN;case ee.DEADLINE_EXCEEDED:return m.DEADLINE_EXCEEDED;case ee.RESOURCE_EXHAUSTED:return m.RESOURCE_EXHAUSTED;case ee.INTERNAL:return m.INTERNAL;case ee.UNAVAILABLE:return m.UNAVAILABLE;case ee.UNAUTHENTICATED:return m.UNAUTHENTICATED;case ee.INVALID_ARGUMENT:return m.INVALID_ARGUMENT;case ee.NOT_FOUND:return m.NOT_FOUND;case ee.ALREADY_EXISTS:return m.ALREADY_EXISTS;case ee.PERMISSION_DENIED:return m.PERMISSION_DENIED;case ee.FAILED_PRECONDITION:return m.FAILED_PRECONDITION;case ee.ABORTED:return m.ABORTED;case ee.OUT_OF_RANGE:return m.OUT_OF_RANGE;case ee.UNIMPLEMENTED:return m.UNIMPLEMENTED;case ee.DATA_LOSS:return m.DATA_LOSS;default:return T()}}(F=ee||(ee={}))[F.OK=0]="OK",F[F.CANCELLED=1]="CANCELLED",F[F.UNKNOWN=2]="UNKNOWN",F[F.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",F[F.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",F[F.NOT_FOUND=5]="NOT_FOUND",F[F.ALREADY_EXISTS=6]="ALREADY_EXISTS",F[F.PERMISSION_DENIED=7]="PERMISSION_DENIED",F[F.UNAUTHENTICATED=16]="UNAUTHENTICATED",F[F.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",F[F.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",F[F.ABORTED=10]="ABORTED",F[F.OUT_OF_RANGE=11]="OUT_OF_RANGE",F[F.UNIMPLEMENTED=12]="UNIMPLEMENTED",F[F.INTERNAL=13]="INTERNAL",F[F.UNAVAILABLE=14]="UNAVAILABLE",F[F.DATA_LOSS=15]="DATA_LOSS";class ot{constructor(e,t){this.mapKeyFn=e,this.equalsFn=t,this.inner={},this.innerSize=0}get(e){const t=this.mapKeyFn(e),r=this.inner[t];if(void 0!==r)for(const[s,i]of r)if(this.equalsFn(s,e))return i}has(e){return void 0!==this.get(e)}set(e,t){const r=this.mapKeyFn(e),s=this.inner[r];if(void 0===s)return this.inner[r]=[[e,t]],void this.innerSize++;for(let i=0;i<s.length;i++)if(this.equalsFn(s[i][0],e))return void(s[i]=[e,t]);s.push([e,t]),this.innerSize++}delete(e){const t=this.mapKeyFn(e),r=this.inner[t];if(void 0===r)return!1;for(let s=0;s<r.length;s++)if(this.equalsFn(r[s][0],e))return 1===r.length?delete this.inner[t]:r.splice(s,1),this.innerSize--,!0;return!1}forEach(e){Tt(this.inner,(t,r)=>{for(const[s,i]of r)e(s,i)})}isEmpty(){return Ac(this.inner)}size(){return this.innerSize}}const Vm=new H(I.comparator);function be(){return Vm}const hl=new H(I.comparator);function sr(...n){let e=hl;for(const t of n)e=e.insert(t.key,t);return e}function dl(n){let e=hl;return n.forEach((t,r)=>e=e.insert(t,r.overlayedDocument)),e}function Ve(){return ir()}function fl(){return ir()}function ir(){return new ot(n=>n.toString(),(n,e)=>n.isEqual(e))}const Pm=new H(I.comparator),Um=new P(I.comparator);function N(...n){let e=Um;for(const t of n)e=e.add(t);return e}const Bm=new P(C);function vs(){return Bm}class or{constructor(e,t,r,s,i){this.snapshotVersion=e,this.targetChanges=t,this.targetMismatches=r,this.documentUpdates=s,this.resolvedLimboDocuments=i}static createSynthesizedRemoteEventForCurrentChange(e,t){const r=new Map;return r.set(e,ar.createSynthesizedTargetChangeForCurrentChange(e,t)),new or(b.min(),r,vs(),be(),N())}}class ar{constructor(e,t,r,s,i){this.resumeToken=e,this.current=t,this.addedDocuments=r,this.modifiedDocuments=s,this.removedDocuments=i}static createSynthesizedTargetChangeForCurrentChange(e,t){return new ar(re.EMPTY_BYTE_STRING,t,N(),N(),N())}}class ws{constructor(e,t,r,s){this.gt=e,this.removedTargetIds=t,this.key=r,this.yt=s}}class ml{constructor(e,t){this.targetId=e,this.It=t}}class gl{constructor(e,t,r=re.EMPTY_BYTE_STRING,s=null){this.state=e,this.targetIds=t,this.resumeToken=r,this.cause=s}}class pl{constructor(){this.Tt=0,this.Et=vl(),this.At=re.EMPTY_BYTE_STRING,this.Rt=!1,this.bt=!0}get current(){return this.Rt}get resumeToken(){return this.At}get Pt(){return 0!==this.Tt}get vt(){return this.bt}Vt(e){e.approximateByteSize()>0&&(this.bt=!0,this.At=e)}St(){let e=N(),t=N(),r=N();return this.Et.forEach((s,i)=>{switch(i){case 0:e=e.add(s);break;case 2:t=t.add(s);break;case 1:r=r.add(s);break;default:T()}}),new ar(this.At,this.Rt,e,t,r)}Dt(){this.bt=!1,this.Et=vl()}Ct(e,t){this.bt=!0,this.Et=this.Et.insert(e,t)}xt(e){this.bt=!0,this.Et=this.Et.remove(e)}Nt(){this.Tt+=1}kt(){this.Tt-=1}Ot(){this.bt=!0,this.Rt=!0}}class qm{constructor(e){this.Mt=e,this.Ft=new Map,this.$t=be(),this.Bt=yl(),this.Lt=new P(C)}Ut(e){for(const t of e.gt)e.yt&&e.yt.isFoundDocument()?this.qt(t,e.yt):this.Kt(t,e.key,e.yt);for(const t of e.removedTargetIds)this.Kt(t,e.key,e.yt)}Gt(e){this.forEachTarget(e,t=>{const r=this.Qt(t);switch(e.state){case 0:this.jt(t)&&r.Vt(e.resumeToken);break;case 1:r.kt(),r.Pt||r.Dt(),r.Vt(e.resumeToken);break;case 2:r.kt(),r.Pt||this.removeTarget(t);break;case 3:this.jt(t)&&(r.Ot(),r.Vt(e.resumeToken));break;case 4:this.jt(t)&&(this.Wt(t),r.Vt(e.resumeToken));break;default:T()}})}forEachTarget(e,t){e.targetIds.length>0?e.targetIds.forEach(t):this.Ft.forEach((r,s)=>{this.jt(s)&&t(s)})}zt(e){const t=e.targetId,r=e.It.count,s=this.Ht(t);if(s){const i=s.target;if(fs(i))if(0===r){const o=new I(i.path);this.Kt(t,o,B.newNoDocument(o,b.min()))}else D(1===r);else this.Jt(t)!==r&&(this.Wt(t),this.Lt=this.Lt.add(t))}}Yt(e){const t=new Map;this.Ft.forEach((i,o)=>{const a=this.Ht(o);if(a){if(i.current&&fs(a.target)){const u=new I(a.target.path);null!==this.$t.get(u)||this.Xt(o,u)||this.Kt(o,u,B.newNoDocument(u,e))}i.vt&&(t.set(o,i.St()),i.Dt())}});let r=N();this.Bt.forEach((i,o)=>{let a=!0;o.forEachWhile(u=>{const c=this.Ht(u);return!c||2===c.purpose||(a=!1,!1)}),a&&(r=r.add(i))}),this.$t.forEach((i,o)=>o.setReadTime(e));const s=new or(e,t,this.Lt,this.$t,r);return this.$t=be(),this.Bt=yl(),this.Lt=new P(C),s}qt(e,t){if(!this.jt(e))return;const r=this.Xt(e,t.key)?2:0;this.Qt(e).Ct(t.key,r),this.$t=this.$t.insert(t.key,t),this.Bt=this.Bt.insert(t.key,this.Zt(t.key).add(e))}Kt(e,t,r){if(!this.jt(e))return;const s=this.Qt(e);this.Xt(e,t)?s.Ct(t,1):s.xt(t),this.Bt=this.Bt.insert(t,this.Zt(t).delete(e)),r&&(this.$t=this.$t.insert(t,r))}removeTarget(e){this.Ft.delete(e)}Jt(e){const t=this.Qt(e).St();return this.Mt.getRemoteKeysForTarget(e).size+t.addedDocuments.size-t.removedDocuments.size}Nt(e){this.Qt(e).Nt()}Qt(e){let t=this.Ft.get(e);return t||(t=new pl,this.Ft.set(e,t)),t}Zt(e){let t=this.Bt.get(e);return t||(t=new P(C),this.Bt=this.Bt.insert(e,t)),t}jt(e){const t=null!==this.Ht(e);return t||w("WatchChangeAggregator","Detected inactive target",e),t}Ht(e){const t=this.Ft.get(e);return t&&t.Pt?null:this.Mt.te(e)}Wt(e){this.Ft.set(e,new pl),this.Mt.getRemoteKeysForTarget(e).forEach(t=>{this.Kt(e,t,null)})}Xt(e,t){return this.Mt.getRemoteKeysForTarget(e).has(t)}}function yl(){return new H(I.comparator)}function vl(){return new H(I.comparator)}const Gm={asc:"ASCENDING",desc:"DESCENDING"},Km={"<":"LESS_THAN","<=":"LESS_THAN_OR_EQUAL",">":"GREATER_THAN",">=":"GREATER_THAN_OR_EQUAL","==":"EQUAL","!=":"NOT_EQUAL","array-contains":"ARRAY_CONTAINS",in:"IN","not-in":"NOT_IN","array-contains-any":"ARRAY_CONTAINS_ANY"};class jm{constructor(e,t){this.databaseId=e,this.dt=t}}function ur(n,e){return n.dt?`${new Date(1e3*e.seconds).toISOString().replace(/\.\d*/,"").replace("Z","")}.${("000000000"+e.nanoseconds).slice(-9)}Z`:{seconds:""+e.seconds,nanos:e.nanoseconds}}function wl(n,e){return n.dt?e.toBase64():e.toUint8Array()}function $m(n,e){return ur(n,e.toTimestamp())}function ae(n){return D(!!n),b.fromTimestamp(function(e){const t=nt(e);return new $(t.seconds,t.nanos)}(n))}function so(n,e){return(t=n,new M(["projects",t.projectId,"databases",t.database])).child("documents").child(e).canonicalString();var t}function Il(n){const e=M.fromString(n);return D(Cl(e)),e}function cr(n,e){return so(n.databaseId,e.path)}function Pe(n,e){const t=Il(e);if(t.get(1)!==n.databaseId.projectId)throw new v(m.INVALID_ARGUMENT,"Tried to deserialize key from different project: "+t.get(1)+" vs "+n.databaseId.projectId);if(t.get(3)!==n.databaseId.database)throw new v(m.INVALID_ARGUMENT,"Tried to deserialize key from different database: "+t.get(3)+" vs "+n.databaseId.database);return new I(xl(t))}function io(n,e){return so(n.databaseId,e)}function _l(n){const e=Il(n);return 4===e.length?M.emptyPath():xl(e)}function lr(n){return new M(["projects",n.databaseId.projectId,"databases",n.databaseId.database]).canonicalString()}function xl(n){return D(n.length>4&&"documents"===n.get(4)),n.popFirst(5)}function El(n,e,t){return{name:cr(n,e),fields:t.value.mapValue.fields}}function Tl(n,e,t){const r=Pe(n,e.name),s=ae(e.updateTime),i=new me({mapValue:{fields:e.fields}}),o=B.newFoundDocument(r,s,i);return t&&o.setHasCommittedMutations(),t?o.setHasCommittedMutations():o}function hr(n,e){let t;if(e instanceof un)t={update:El(n,e.key,e.value)};else if(e instanceof cn)t={delete:cr(n,e.key)};else if(e instanceof Qe)t={update:El(n,e.key,e.data),updateMask:eg(e.fieldMask)};else{if(!(e instanceof ro))return T();t={verify:cr(n,e.key)}}return e.fieldTransforms.length>0&&(t.updateTransforms=e.fieldTransforms.map(r=>function(s,i){const o=i.transform;if(o instanceof on)return{fieldPath:i.field.canonicalString(),setToServerValue:"REQUEST_TIME"};if(o instanceof Ct)return{fieldPath:i.field.canonicalString(),appendMissingElements:{values:o.elements}};if(o instanceof Nt)return{fieldPath:i.field.canonicalString(),removeAllFromArray:{values:o.elements}};if(o instanceof an)return{fieldPath:i.field.canonicalString(),increment:o._t};throw T()}(0,r))),e.precondition.isNone||(t.currentDocument=void 0!==(s=e.precondition).updateTime?{updateTime:$m(n,s.updateTime)}:void 0!==s.exists?{exists:s.exists}:T()),t;var s}function oo(n,e){const t=e.currentDocument?void 0!==(s=e.currentDocument).updateTime?Q.updateTime(ae(s.updateTime)):void 0!==s.exists?Q.exists(s.exists):Q.none():Q.none(),r=e.updateTransforms?e.updateTransforms.map(s=>function(i,o){let a=null;"setToServerValue"in o?(D("REQUEST_TIME"===o.setToServerValue),a=new on):"appendMissingElements"in o?a=new Ct(o.appendMissingElements.values||[]):"removeAllFromArray"in o?a=new Nt(o.removeAllFromArray.values||[]):"increment"in o?a=new an(i,o.increment):T();const u=X.fromServerFormat(o.fieldPath);return new nr(u,a)}(n,s)):[];var s;if(e.update){const s=Pe(n,e.update.name),i=new me({mapValue:{fields:e.update.fields}});if(e.updateMask){const o=new Ne((e.updateMask.fieldPaths||[]).map(c=>X.fromServerFormat(c)));return new Qe(s,i,o,t,r)}return new un(s,i,t,r)}if(e.delete){const s=Pe(n,e.delete);return new cn(s,t)}if(e.verify){const s=Pe(n,e.verify);return new ro(s,t)}return T()}function Sl(n,e){return{documents:[io(n,e.path)]}}function bl(n,e){const t={structuredQuery:{}},r=e.path;null!==e.collectionGroup?(t.parent=io(n,r),t.structuredQuery.from=[{collectionId:e.collectionGroup,allDescendants:!0}]):(t.parent=io(n,r.popLast()),t.structuredQuery.from=[{collectionId:r.lastSegment()}]);const s=function(u){if(0===u.length)return;const c=u.map(l=>function(h){if("=="===h.op){if(Fc(h.value))return{unaryFilter:{field:ln(h.field),op:"IS_NAN"}};if(Mc(h.value))return{unaryFilter:{field:ln(h.field),op:"IS_NULL"}}}else if("!="===h.op){if(Fc(h.value))return{unaryFilter:{field:ln(h.field),op:"IS_NOT_NAN"}};if(Mc(h.value))return{unaryFilter:{field:ln(h.field),op:"IS_NOT_NULL"}}}return{fieldFilter:{field:ln(h.field),op:Xm(h.op),value:h.value}}}(l));return 1===c.length?c[0]:{compositeFilter:{op:"AND",filters:c}}}(e.filters);s&&(t.structuredQuery.where=s);const i=function(u){if(0!==u.length)return u.map(c=>{return{field:ln((l=c).field),direction:Wm(l.dir)};var l})}(e.orderBy);i&&(t.structuredQuery.orderBy=i);const o=(c=e.limit,n.dt||Hn(c)?c:{value:c});var c,a,u;return null!==o&&(t.structuredQuery.limit=o),e.startAt&&(t.structuredQuery.startAt={before:(a=e.startAt).inclusive,values:a.position}),e.endAt&&(t.structuredQuery.endAt={before:!(u=e.endAt).inclusive,values:u.position}),t}function Dl(n){let e=_l(n.parent);const t=n.structuredQuery,r=t.from?t.from.length:0;let s=null;if(r>0){D(1===r);const l=t.from[0];l.allDescendants?s=l.collectionId:e=e.child(l.collectionId)}let i=[];t.where&&(i=Al(t.where));let o=[];t.orderBy&&(o=t.orderBy.map(l=>{return new nn(hn((h=l).field),function(d){switch(d){case"ASCENDING":return"asc";case"DESCENDING":return"desc";default:return}}(h.direction));var h}));let a=null;t.limit&&(a=function(l){let h;return h="object"==typeof l?l.value:l,Hn(h)?null:h}(t.limit));let u=null;var l;t.startAt&&(u=new it((l=t.startAt).values||[],!!l.before));let c=null;return t.endAt&&(c=function(l){return new it(l.values||[],!l.before)}(t.endAt)),$c(e,s,o,i,a,"F",u,c)}function Al(n){return n?void 0!==n.unaryFilter?[Jm(n)]:void 0!==n.fieldFilter?[Ym(n)]:void 0!==n.compositeFilter?n.compositeFilter.filters.map(e=>Al(e)).reduce((e,t)=>e.concat(t)):T():[]}function Wm(n){return Gm[n]}function Xm(n){return Km[n]}function ln(n){return{fieldPath:n.canonicalString()}}function hn(n){return X.fromServerFormat(n.fieldPath)}function Ym(n){return ge.create(hn(n.fieldFilter.field),function(e){switch(e){case"EQUAL":return"==";case"NOT_EQUAL":return"!=";case"GREATER_THAN":return">";case"GREATER_THAN_OR_EQUAL":return">=";case"LESS_THAN":return"<";case"LESS_THAN_OR_EQUAL":return"<=";case"ARRAY_CONTAINS":return"array-contains";case"IN":return"in";case"NOT_IN":return"not-in";case"ARRAY_CONTAINS_ANY":return"array-contains-any";default:return T()}}(n.fieldFilter.op),n.fieldFilter.value)}function Jm(n){switch(n.unaryFilter.op){case"IS_NAN":const e=hn(n.unaryFilter.field);return ge.create(e,"==",{doubleValue:NaN});case"IS_NULL":const t=hn(n.unaryFilter.field);return ge.create(t,"==",{nullValue:"NULL_VALUE"});case"IS_NOT_NAN":const r=hn(n.unaryFilter.field);return ge.create(r,"!=",{doubleValue:NaN});case"IS_NOT_NULL":const s=hn(n.unaryFilter.field);return ge.create(s,"!=",{nullValue:"NULL_VALUE"});default:return T()}}function eg(n){const e=[];return n.fields.forEach(t=>e.push(t.canonicalString())),{fieldPaths:e}}function Cl(n){return n.length>=4&&"projects"===n.get(0)&&"databases"===n.get(2)}function xe(n){let e="";for(let t=0;t<n.length;t++)e.length>0&&(e=Nl(e)),e=tg(n.get(t),e);return Nl(e)}function tg(n,e){let t=e;const r=n.length;for(let s=0;s<r;s++){const i=n.charAt(s);switch(i){case"\0":t+="\x01\x10";break;case"\x01":t+="\x01\x11";break;default:t+=i}}return t}function Nl(n){return n+"\x01\x01"}function Ue(n){const e=n.length;if(D(e>=2),2===e)return D("\x01"===n.charAt(0)&&"\x01"===n.charAt(1)),M.emptyPath();const t=e-2,r=[];let s="";for(let i=0;i<e;){const o=n.indexOf("\x01",i);switch((o<0||o>t)&&T(),n.charAt(o+1)){case"\x01":const a=n.substring(i,o);let u;0===s.length?u=a:(s+=a,u=s,s=""),r.push(u);break;case"\x10":s+=n.substring(i,o),s+="\0";break;case"\x11":s+=n.substring(i,o+1);break;default:T()}i=o+2}return new M(r)}const kl=["userId","batchId"];function Is(n,e){return[n,xe(e)]}function Rl(n,e,t){return[n,xe(e),t]}const ng={},rg=["prefixPath","collectionGroup","readTime","documentId"],sg=["prefixPath","collectionGroup","documentId"],ig=["collectionGroup","readTime","prefixPath","documentId"],og=["canonicalId","targetId"],ag=["targetId","path"],ug=["path","targetId"],cg=["collectionId","parent"],lg=["indexId","uid"],hg=["uid","sequenceNumber"],dg=["indexId","uid","arrayValue","directionalValue","orderedDocumentKey","documentKey"],fg=["indexId","uid","orderedDocumentKey"],mg=["userId","collectionPath","documentId"],gg=["userId","collectionPath","largestBatchId"],pg=["userId","collectionGroup","largestBatchId"],Ml=["mutationQueues","mutations","documentMutations","remoteDocuments","targets","owner","targetGlobal","targetDocuments","clientMetadata","remoteDocumentGlobal","collectionParents","bundles","namedQueries"],yg=[...Ml,"documentOverlays"],Fl=["mutationQueues","mutations","documentMutations","remoteDocumentsV14","targets","owner","targetGlobal","targetDocuments","clientMetadata","remoteDocumentGlobal","collectionParents","bundles","namedQueries","documentOverlays"],Ll=Fl,vg=[...Ll,"indexConfiguration","indexState","indexEntries"];class ao extends Sc{constructor(e,t){super(),this.ee=e,this.currentSequenceNumber=t}}function ue(n,e){const t=_(n);return Le.N(t.ee,e)}class uo{constructor(e,t,r,s){this.batchId=e,this.localWriteTime=t,this.baseMutations=r,this.mutations=s}applyToRemoteDocument(e,t){const r=t.mutationResults;for(let s=0;s<this.mutations.length;s++){const i=this.mutations[s];i.key.isEqual(e.key)&&Fm(i,e,r[s])}}applyToLocalView(e,t){for(const r of this.baseMutations)r.key.isEqual(e.key)&&(t=rr(r,e,t,this.localWriteTime));for(const r of this.mutations)r.key.isEqual(e.key)&&(t=rr(r,e,t,this.localWriteTime));return t}applyToLocalDocumentSet(e,t){const r=fl();return this.mutations.forEach(s=>{const i=e.get(s.key),o=i.overlayedDocument;let a=this.applyToLocalView(o,i.mutatedFields);a=t.has(s.key)?null:a;const u=sl(o,a);null!==u&&r.set(s.key,u),o.isValidDocument()||o.convertToNoDocument(b.min())}),r}keys(){return this.mutations.reduce((e,t)=>e.add(t.key),N())}isEqual(e){return this.batchId===e.batchId&&Jt(this.mutations,e.mutations,(t,r)=>il(t,r))&&Jt(this.baseMutations,e.baseMutations,(t,r)=>il(t,r))}}class co{constructor(e,t,r,s){this.batch=e,this.commitVersion=t,this.mutationResults=r,this.docVersions=s}static from(e,t,r){D(e.mutations.length===r.length);let s=Pm;const i=e.mutations;for(let o=0;o<i.length;o++)s=s.insert(i[o].key,r[o].version);return new co(e,t,r,s)}}class lo{constructor(e,t){this.largestBatchId=e,this.mutation=t}getKey(){return this.mutation.key}isEqual(e){return null!==e&&this.mutation===e.mutation}toString(){return`Overlay{\n      largestBatchId: ${this.largestBatchId},\n      mutation: ${this.mutation.toString()}\n    }`}}class at{constructor(e,t,r,s,i=b.min(),o=b.min(),a=re.EMPTY_BYTE_STRING){this.target=e,this.targetId=t,this.purpose=r,this.sequenceNumber=s,this.snapshotVersion=i,this.lastLimboFreeSnapshotVersion=o,this.resumeToken=a}withSequenceNumber(e){return new at(this.target,this.targetId,this.purpose,e,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken)}withResumeToken(e,t){return new at(this.target,this.targetId,this.purpose,this.sequenceNumber,t,this.lastLimboFreeSnapshotVersion,e)}withLastLimboFreeSnapshotVersion(e){return new at(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,e,this.resumeToken)}}class Ol{constructor(e){this.ne=e}}function Vl(n,e){const t=e.key,r={prefixPath:t.getCollectionPath().popLast().toArray(),collectionGroup:t.collectionGroup,documentId:t.path.lastSegment(),readTime:_s(e.readTime),hasCommittedMutations:e.hasCommittedMutations};if(e.isFoundDocument())r.document={name:cr(s=n.ne,(i=e).key),fields:i.data.value.mapValue.fields,updateTime:ur(s,i.version.toTimestamp())};else if(e.isNoDocument())r.noDocument={path:t.path.toArray(),readTime:kt(e.version)};else{if(!e.isUnknownDocument())return T();r.unknownDocument={path:t.path.toArray(),version:kt(e.version)}}var s,i;return r}function _s(n){const e=n.toTimestamp();return[e.seconds,e.nanoseconds]}function kt(n){const e=n.toTimestamp();return{seconds:e.seconds,nanoseconds:e.nanoseconds}}function Rt(n){const e=new $(n.seconds,n.nanoseconds);return b.fromTimestamp(e)}function Mt(n,e){const t=(e.baseMutations||[]).map(i=>oo(n.ne,i));for(let i=0;i<e.mutations.length-1;++i){const o=e.mutations[i];i+1<e.mutations.length&&void 0!==e.mutations[i+1].transform&&(o.updateTransforms=e.mutations[i+1].transform.fieldTransforms,e.mutations.splice(i+1,1),++i)}const r=e.mutations.map(i=>oo(n.ne,i)),s=$.fromMillis(e.localWriteTimeMs);return new uo(e.batchId,s,t,r)}function dr(n){const e=Rt(n.readTime),t=void 0!==n.lastLimboFreeSnapshotVersion?Rt(n.lastLimboFreeSnapshotVersion):b.min();let r;var s;return void 0!==n.query.documents?(D(1===(s=n.query).documents.length),r=Me(rn(_l(s.documents[0])))):r=Me(Dl(n.query)),new at(r,n.targetId,0,n.lastListenSequenceNumber,e,t,re.fromBase64String(n.resumeToken))}function Pl(n,e){const t=kt(e.snapshotVersion),r=kt(e.lastLimboFreeSnapshotVersion);let s;s=fs(e.target)?Sl(n.ne,e.target):bl(n.ne,e.target);const i=e.resumeToken.toBase64();return{targetId:e.targetId,canonicalId:At(e.target),readTime:t,resumeToken:i,lastListenSequenceNumber:e.sequenceNumber,lastLimboFreeSnapshotVersion:r,query:s}}function ho(n){const e=Dl({parent:n.parent,structuredQuery:n.structuredQuery});return"LAST"===n.limitType?zc(e,e.limit,"L"):e}function fo(n,e){return new lo(e.largestBatchId,oo(n.ne,e.overlayMutation))}function Ul(n,e){const t=e.path.lastSegment();return[n,xe(e.path.popLast()),t]}function Bl(n,e,t,r){return{indexId:n,uid:e.uid||"",sequenceNumber:t,readTime:kt(r.readTime),documentKey:xe(r.documentKey.path),largestBatchId:r.largestBatchId}}class Ig{getBundleMetadata(e,t){return ql(e).get(t).next(r=>{if(r)return{id:(s=r).bundleId,createTime:Rt(s.createTime),version:s.version};var s})}saveBundleMetadata(e,t){return ql(e).put({bundleId:(r=t).id,createTime:kt(ae(r.createTime)),version:r.version});var r}getNamedQuery(e,t){return Gl(e).get(t).next(r=>{if(r)return{name:(s=r).name,query:ho(s.bundledQuery),readTime:Rt(s.readTime)};var s})}saveNamedQuery(e,t){return Gl(e).put({name:(r=t).name,readTime:kt(ae(r.readTime)),bundledQuery:r.bundledQuery});var r}}function ql(n){return ue(n,"bundles")}function Gl(n){return ue(n,"namedQueries")}class xs{constructor(e,t){this.wt=e,this.userId=t}static se(e,t){return new xs(e,t.uid||"")}getOverlay(e,t){return fr(e).get(Ul(this.userId,t)).next(r=>r?fo(this.wt,r):null)}getOverlays(e,t){const r=Ve();return f.forEach(t,s=>this.getOverlay(e,s).next(i=>{null!==i&&r.set(s,i)})).next(()=>r)}saveOverlays(e,t,r){const s=[];return r.forEach((i,o)=>{const a=new lo(t,o);s.push(this.ie(e,a))}),f.waitFor(s)}removeOverlaysForBatchId(e,t,r){const s=new Set;t.forEach(o=>s.add(xe(o.getCollectionPath())));const i=[];return s.forEach(o=>{const a=IDBKeyRange.bound([this.userId,o,r],[this.userId,o,r+1],!1,!0);i.push(fr(e).W("collectionPathOverlayIndex",a))}),f.waitFor(i)}getOverlaysForCollection(e,t,r){const s=Ve(),i=xe(t),o=IDBKeyRange.bound([this.userId,i,r],[this.userId,i,Number.POSITIVE_INFINITY],!0);return fr(e).K("collectionPathOverlayIndex",o).next(a=>{for(const u of a){const c=fo(this.wt,u);s.set(c.getKey(),c)}return s})}getOverlaysForCollectionGroup(e,t,r,s){const i=Ve();let o;const a=IDBKeyRange.bound([this.userId,t,r],[this.userId,t,Number.POSITIVE_INFINITY],!0);return fr(e).J({index:"collectionGroupOverlayIndex",range:a},(u,c,l)=>{const h=fo(this.wt,c);i.size()<s||h.largestBatchId===o?(i.set(h.getKey(),h),o=h.largestBatchId):l.done()}).next(()=>i)}ie(e,t){return fr(e).put(function(r,s,i){const[o,a,u]=Ul(s,i.mutation.key);return{userId:s,collectionPath:a,documentId:u,collectionGroup:i.mutation.key.getCollectionGroup(),largestBatchId:i.largestBatchId,overlayMutation:hr(r.ne,i.mutation)}}(this.wt,this.userId,t))}}function fr(n){return ue(n,"documentOverlays")}class Ft{constructor(){}re(e,t){this.oe(e,t),t.ue()}oe(e,t){if("nullValue"in e)this.ce(t,5);else if("booleanValue"in e)this.ce(t,10),t.ae(e.booleanValue?1:0);else if("integerValue"in e)this.ce(t,15),t.ae(W(e.integerValue));else if("doubleValue"in e){const r=W(e.doubleValue);isNaN(r)?this.ce(t,13):(this.ce(t,15),Wn(r)?t.ae(0):t.ae(r))}else if("timestampValue"in e){const r=e.timestampValue;this.ce(t,20),"string"==typeof r?t.he(r):(t.he(`${r.seconds||""}`),t.ae(r.nanos||0))}else if("stringValue"in e)this.le(e.stringValue,t),this.fe(t);else if("bytesValue"in e)this.ce(t,30),t.de(St(e.bytesValue)),this.fe(t);else if("referenceValue"in e)this._e(e.referenceValue,t);else if("geoPointValue"in e){const r=e.geoPointValue;this.ce(t,45),t.ae(r.latitude||0),t.ae(r.longitude||0)}else"mapValue"in e?Lc(e)?this.ce(t,Number.MAX_SAFE_INTEGER):(this.we(e.mapValue,t),this.fe(t)):"arrayValue"in e?(this.me(e.arrayValue,t),this.fe(t)):T()}le(e,t){this.ce(t,25),this.ge(e,t)}ge(e,t){t.he(e)}we(e,t){const r=e.fields||{};this.ce(t,55);for(const s of Object.keys(r))this.le(s,t),this.oe(r[s],t)}me(e,t){const r=e.values||[];this.ce(t,50);for(const s of r)this.oe(s,t)}_e(e,t){this.ce(t,37),I.fromName(e).path.forEach(r=>{this.ce(t,60),this.ge(r,t)})}ce(e,t){e.ae(t)}fe(e){e.ae(2)}}function _g(n){if(0===n)return 8;let e=0;return n>>4==0&&(e+=4,n<<=4),n>>6==0&&(e+=2,n<<=2),n>>7==0&&(e+=1),e}function Kl(n){const e=64-function(t){let r=0;for(let s=0;s<8;++s){const i=_g(255&t[s]);if(r+=i,8!==i)break}return r}(n);return Math.ceil(e/8)}Ft.ye=new Ft;class xg{constructor(){this.buffer=new Uint8Array(1024),this.position=0}pe(e){const t=e[Symbol.iterator]();let r=t.next();for(;!r.done;)this.Ie(r.value),r=t.next();this.Te()}Ee(e){const t=e[Symbol.iterator]();let r=t.next();for(;!r.done;)this.Ae(r.value),r=t.next();this.Re()}be(e){for(const t of e){const r=t.charCodeAt(0);if(r<128)this.Ie(r);else if(r<2048)this.Ie(960|r>>>6),this.Ie(128|63&r);else if(t<"\ud800"||"\udbff"<t)this.Ie(480|r>>>12),this.Ie(128|63&r>>>6),this.Ie(128|63&r);else{const s=t.codePointAt(0);this.Ie(240|s>>>18),this.Ie(128|63&s>>>12),this.Ie(128|63&s>>>6),this.Ie(128|63&s)}}this.Te()}Pe(e){for(const t of e){const r=t.charCodeAt(0);if(r<128)this.Ae(r);else if(r<2048)this.Ae(960|r>>>6),this.Ae(128|63&r);else if(t<"\ud800"||"\udbff"<t)this.Ae(480|r>>>12),this.Ae(128|63&r>>>6),this.Ae(128|63&r);else{const s=t.codePointAt(0);this.Ae(240|s>>>18),this.Ae(128|63&s>>>12),this.Ae(128|63&s>>>6),this.Ae(128|63&s)}}this.Re()}ve(e){const t=this.Ve(e),r=Kl(t);this.Se(1+r),this.buffer[this.position++]=255&r;for(let s=t.length-r;s<t.length;++s)this.buffer[this.position++]=255&t[s]}De(e){const t=this.Ve(e),r=Kl(t);this.Se(1+r),this.buffer[this.position++]=~(255&r);for(let s=t.length-r;s<t.length;++s)this.buffer[this.position++]=~(255&t[s])}Ce(){this.xe(255),this.xe(255)}Ne(){this.ke(255),this.ke(255)}reset(){this.position=0}seed(e){this.Se(e.length),this.buffer.set(e,this.position),this.position+=e.length}Oe(){return this.buffer.slice(0,this.position)}Ve(e){const t=function(s){const i=new DataView(new ArrayBuffer(8));return i.setFloat64(0,s,!1),new Uint8Array(i.buffer)}(e),r=0!=(128&t[0]);t[0]^=r?255:128;for(let s=1;s<t.length;++s)t[s]^=r?255:0;return t}Ie(e){const t=255&e;0===t?(this.xe(0),this.xe(255)):255===t?(this.xe(255),this.xe(0)):this.xe(t)}Ae(e){const t=255&e;0===t?(this.ke(0),this.ke(255)):255===t?(this.ke(255),this.ke(0)):this.ke(e)}Te(){this.xe(0),this.xe(1)}Re(){this.ke(0),this.ke(1)}xe(e){this.Se(1),this.buffer[this.position++]=e}ke(e){this.Se(1),this.buffer[this.position++]=~e}Se(e){const t=e+this.position;if(t<=this.buffer.length)return;let r=2*this.buffer.length;r<t&&(r=t);const s=new Uint8Array(r);s.set(this.buffer),this.buffer=s}}class Eg{constructor(e){this.Me=e}de(e){this.Me.pe(e)}he(e){this.Me.be(e)}ae(e){this.Me.ve(e)}ue(){this.Me.Ce()}}class Tg{constructor(e){this.Me=e}de(e){this.Me.Ee(e)}he(e){this.Me.Pe(e)}ae(e){this.Me.De(e)}ue(){this.Me.Ne()}}class mr{constructor(){this.Me=new xg,this.Fe=new Eg(this.Me),this.$e=new Tg(this.Me)}seed(e){this.Me.seed(e)}Be(e){return 0===e?this.Fe:this.$e}Oe(){return this.Me.Oe()}reset(){this.Me.reset()}}class Lt{constructor(e,t,r,s){this.indexId=e,this.documentKey=t,this.arrayValue=r,this.directionalValue=s}Le(){const e=this.directionalValue.length,t=0===e||255===this.directionalValue[e-1]?e+1:e,r=new Uint8Array(t);return r.set(this.directionalValue,0),t!==e?r.set([0],this.directionalValue.length):++r[r.length-1],new Lt(this.indexId,this.documentKey,this.arrayValue,r)}}function Ot(n,e){let t=n.indexId-e.indexId;return 0!==t?t:(t=jl(n.arrayValue,e.arrayValue),0!==t?t:(t=jl(n.directionalValue,e.directionalValue),0!==t?t:I.comparator(n.documentKey,e.documentKey)))}function jl(n,e){for(let t=0;t<n.length&&t<e.length;++t){const r=n[t]-e[t];if(0!==r)return r}return n.length-e.length}class Sg{constructor(e){this.collectionId=null!=e.collectionGroup?e.collectionGroup:e.path.lastSegment(),this.Ue=e.orderBy,this.qe=[];for(const t of e.filters){const r=t;r.ht()?this.Ke=r:this.qe.push(r)}}Ge(e){const t=$i(e);if(void 0!==t&&!this.Qe(t))return!1;const r=xt(e);let s=0,i=0;for(;s<r.length&&this.Qe(r[s]);++s);if(s===r.length)return!0;if(void 0!==this.Ke){const o=r[s];if(!this.je(this.Ke,o)||!this.We(this.Ue[i++],o))return!1;++s}for(;s<r.length;++s){const o=r[s];if(i>=this.Ue.length||!this.We(this.Ue[i++],o))return!1}return!0}Qe(e){for(const t of this.qe)if(this.je(t,e))return!0;return!1}je(e,t){return!(void 0===e||!e.field.isEqual(t.fieldPath))&&2===t.kind==("array-contains"===e.op||"array-contains-any"===e.op)}We(e,t){return!!e.field.isEqual(t.fieldPath)&&(0===t.kind&&"asc"===e.dir||1===t.kind&&"desc"===e.dir)}}class bg{constructor(){this.ze=new mo}addToCollectionParentIndex(e,t){return this.ze.add(t),f.resolve()}getCollectionParents(e,t){return f.resolve(this.ze.getEntries(t))}addFieldIndex(e,t){return f.resolve()}deleteFieldIndex(e,t){return f.resolve()}getDocumentsMatchingTarget(e,t){return f.resolve(null)}getIndexType(e,t){return f.resolve(0)}getFieldIndexes(e,t){return f.resolve([])}getNextCollectionGroupToUpdate(e){return f.resolve(null)}getMinOffset(e,t){return f.resolve(Ce.min())}getMinOffsetFromCollectionGroup(e,t){return f.resolve(Ce.min())}updateCollectionGroup(e,t,r){return f.resolve()}updateIndexEntries(e,t){return f.resolve()}}class mo{constructor(){this.index={}}add(e){const t=e.lastSegment(),r=e.popLast(),s=this.index[t]||new P(M.comparator),i=!s.has(r);return this.index[t]=s.add(r),i}has(e){const t=e.lastSegment(),r=e.popLast(),s=this.index[t];return s&&s.has(r)}getEntries(e){return(this.index[e]||new P(M.comparator)).toArray()}}const Es=new Uint8Array(0);class Dg{constructor(e,t){this.user=e,this.databaseId=t,this.He=new mo,this.Je=new ot(r=>At(r),(r,s)=>er(r,s)),this.uid=e.uid||""}addToCollectionParentIndex(e,t){if(!this.He.has(t)){const r=t.lastSegment(),s=t.popLast();e.addOnCommittedListener(()=>{this.He.add(t)});const i={collectionId:r,parent:xe(s)};return $l(e).put(i)}return f.resolve()}getCollectionParents(e,t){const r=[],s=IDBKeyRange.bound([t,""],[_c(t),""],!1,!0);return $l(e).K(s).next(i=>{for(const o of i){if(o.collectionId!==t)break;r.push(Ue(o.parent))}return r})}addFieldIndex(e,t){const r=Ts(e),s={indexId:(o=t).indexId,collectionGroup:o.collectionGroup,fields:o.fields.map(a=>[a.fieldPath.canonicalString(),a.kind])};var o;delete s.indexId;const i=r.add(s);if(t.indexState){const o=pr(e);return i.next(a=>{o.put(Bl(a,this.user,t.indexState.sequenceNumber,t.indexState.offset))})}return i.next()}deleteFieldIndex(e,t){const r=Ts(e),s=pr(e),i=gr(e);return r.delete(t.indexId).next(()=>s.delete(IDBKeyRange.bound([t.indexId],[t.indexId+1],!1,!0))).next(()=>i.delete(IDBKeyRange.bound([t.indexId],[t.indexId+1],!1,!0)))}getDocumentsMatchingTarget(e,t){const r=gr(e);let s=!0;const i=new Map;return f.forEach(this.Ye(t),o=>this.Xe(e,o).next(a=>{s&&(s=!!a),i.set(o,a)})).next(()=>{if(s){let o=N();const a=[];return f.forEach(i,(u,c)=>{var l;w("IndexedDbIndexManager",`Using index ${l=u,`id=${l.indexId}|cg=${l.collectionGroup}|f=${l.fields.map(U=>`${U.fieldPath}:${U.kind}`).join(",")}`} to execute ${At(t)}`);const h=function(U,ne){const K=$i(ne);if(void 0===K)return null;for(const Z of ms(U,K.fieldPath))switch(Z.op){case"array-contains-any":return Z.value.arrayValue.values||[];case"array-contains":return[Z.value]}return null}(c,u),d=function(U,ne){const K=new Map;for(const Z of xt(ne))for(const ve of ms(U,Z.fieldPath))switch(ve.op){case"==":case"in":K.set(Z.fieldPath.canonicalString(),ve.value);break;case"not-in":case"!=":return K.set(Z.fieldPath.canonicalString(),ve.value),Array.from(K.values())}return null}(c,u),g=function(U,ne){const K=[];let Z=!0;for(const ve of xt(ne)){const kr=0===ve.kind?Bc(U,ve.fieldPath,U.startAt):qc(U,ve.fieldPath,U.startAt);K.push(kr.value),Z&&(Z=kr.inclusive)}return new it(K,Z)}(c,u),y=function(U,ne){const K=[];let Z=!0;for(const ve of xt(ne)){const kr=0===ve.kind?qc(U,ve.fieldPath,U.endAt):Bc(U,ve.fieldPath,U.endAt);K.push(kr.value),Z&&(Z=kr.inclusive)}return new it(K,Z)}(c,u),x=this.Ze(u,c,g),S=this.Ze(u,c,y),V=this.tn(u,c,d),G=this.en(u.indexId,h,x,g.inclusive,S,y.inclusive,V);return f.forEach(G,U=>r.j(U,t.limit).next(ne=>{ne.forEach(K=>{const Z=I.fromSegments(K.documentKey);o.has(Z)||(o=o.add(Z),a.push(Z))})}))}).next(()=>a)}return f.resolve(null)})}Ye(e){let t=this.Je.get(e);return t||(t=[e],this.Je.set(e,t),t)}en(e,t,r,s,i,o,a){const u=(null!=t?t.length:1)*Math.max(r.length,i.length),c=u/(null!=t?t.length:1),l=[];for(let h=0;h<u;++h){const d=t?this.nn(t[h/c]):Es,g=this.sn(e,d,r[h%c],s),y=this.rn(e,d,i[h%c],o),x=a.map(S=>this.sn(e,d,S,!0));l.push(...this.createRange(g,y,x))}return l}sn(e,t,r,s){const i=new Lt(e,I.empty(),t,r);return s?i:i.Le()}rn(e,t,r,s){const i=new Lt(e,I.empty(),t,r);return s?i.Le():i}Xe(e,t){const r=new Sg(t),s=null!=t.collectionGroup?t.collectionGroup:t.path.lastSegment();return this.getFieldIndexes(e,s).next(i=>{let o=null;for(const a of i)r.Ge(a)&&(!o||a.fields.length>o.fields.length)&&(o=a);return o})}getIndexType(e,t){let r=2;return f.forEach(this.Ye(t),s=>this.Xe(e,s).next(i=>{i?0!==r&&i.fields.length<function(o){let a=new P(X.comparator),u=!1;for(const c of o.filters){const l=c;l.field.isKeyField()||("array-contains"===l.op||"array-contains-any"===l.op?u=!0:a=a.add(l.field))}for(const c of o.orderBy)c.field.isKeyField()||(a=a.add(c.field));return a.size+(u?1:0)}(s)&&(r=1):r=0})).next(()=>r)}on(e,t){const r=new mr;for(const s of xt(e)){const i=t.data.field(s.fieldPath);if(null==i)return null;const o=r.Be(s.kind);Ft.ye.re(i,o)}return r.Oe()}nn(e){const t=new mr;return Ft.ye.re(e,t.Be(0)),t.Oe()}un(e,t){const r=new mr;return Ft.ye.re(Dt(this.databaseId,t),r.Be(function(s){const i=xt(s);return 0===i.length?0:i[i.length-1].kind}(e))),r.Oe()}tn(e,t,r){if(null===r)return[];let s=[];s.push(new mr);let i=0;for(const o of xt(e)){const a=r[i++];for(const u of s)if(this.cn(t,o.fieldPath)&&Yn(a))s=this.an(s,o,a);else{const c=u.Be(o.kind);Ft.ye.re(a,c)}}return this.hn(s)}Ze(e,t,r){return this.tn(e,t,r.position)}hn(e){const t=[];for(let r=0;r<e.length;++r)t[r]=e[r].Oe();return t}an(e,t,r){const s=[...e],i=[];for(const o of r.arrayValue.values||[])for(const a of s){const u=new mr;u.seed(a.Oe()),Ft.ye.re(o,u.Be(t.kind)),i.push(u)}return i}cn(e,t){return!!e.filters.find(r=>r instanceof ge&&r.field.isEqual(t)&&("in"===r.op||"not-in"===r.op))}getFieldIndexes(e,t){const r=Ts(e),s=pr(e);return(t?r.K("collectionGroupIndex",IDBKeyRange.bound(t,t)):r.K()).next(i=>{const o=[];return f.forEach(i,a=>s.get([a.indexId,this.uid]).next(u=>{o.push(function(c,l){const h=l?new zn(l.sequenceNumber,new Ce(Rt(l.readTime),new I(Ue(l.documentKey)),l.largestBatchId)):zn.empty(),d=c.fields.map(([g,y])=>new us(X.fromServerFormat(g),y));return new as(c.indexId,c.collectionGroup,d,h)}(a,u))})).next(()=>o)})}getNextCollectionGroupToUpdate(e){return this.getFieldIndexes(e).next(t=>0===t.length?null:(t.sort((r,s)=>{const i=r.indexState.sequenceNumber-s.indexState.sequenceNumber;return 0!==i?i:C(r.collectionGroup,s.collectionGroup)}),t[0].collectionGroup))}updateCollectionGroup(e,t,r){const s=Ts(e),i=pr(e);return this.ln(e).next(o=>s.K("collectionGroupIndex",IDBKeyRange.bound(t,t)).next(a=>f.forEach(a,u=>i.put(Bl(u.indexId,this.user,o,r)))))}updateIndexEntries(e,t){const r=new Map;return f.forEach(t,(s,i)=>{const o=r.get(s.collectionGroup);return(o?f.resolve(o):this.getFieldIndexes(e,s.collectionGroup)).next(a=>(r.set(s.collectionGroup,a),f.forEach(a,u=>this.fn(e,s,u).next(c=>{const l=this.dn(i,u);return c.isEqual(l)?f.resolve():this._n(e,i,u,c,l)}))))})}wn(e,t,r,s){return gr(e).put({indexId:s.indexId,uid:this.uid,arrayValue:s.arrayValue,directionalValue:s.directionalValue,orderedDocumentKey:this.un(r,t.key),documentKey:t.key.path.toArray()})}mn(e,t,r,s){return gr(e).delete([s.indexId,this.uid,s.arrayValue,s.directionalValue,this.un(r,t.key),t.key.path.toArray()])}fn(e,t,r){const s=gr(e);let i=new P(Ot);return s.J({index:"documentKeyIndex",range:IDBKeyRange.only([r.indexId,this.uid,this.un(r,t)])},(o,a)=>{i=i.add(new Lt(r.indexId,t,a.arrayValue,a.directionalValue))}).next(()=>i)}dn(e,t){let r=new P(Ot);const s=this.on(t,e);if(null==s)return r;const i=$i(t);if(null!=i){const o=e.data.field(i.fieldPath);if(Yn(o))for(const a of o.arrayValue.values||[])r=r.add(new Lt(t.indexId,e.key,this.nn(a),s))}else r=r.add(new Lt(t.indexId,e.key,Es,s));return r}_n(e,t,r,s,i){w("IndexedDbIndexManager","Updating index entries for document '%s'",t.key);const o=[];return function(a,u,c,l,h){const d=a.getIterator(),g=u.getIterator();let y=en(d),x=en(g);for(;y||x;){let S=!1,V=!1;if(y&&x){const G=c(y,x);G<0?V=!0:G>0&&(S=!0)}else null!=y?V=!0:S=!0;S?(l(x),x=en(g)):V?(h(y),y=en(d)):(y=en(d),x=en(g))}}(s,i,Ot,a=>{o.push(this.wn(e,t,r,a))},a=>{o.push(this.mn(e,t,r,a))}),f.waitFor(o)}ln(e){let t=1;return pr(e).J({index:"sequenceNumberIndex",reverse:!0,range:IDBKeyRange.upperBound([this.uid,Number.MAX_SAFE_INTEGER])},(r,s,i)=>{i.done(),t=s.sequenceNumber+1}).next(()=>t)}createRange(e,t,r){r=r.sort((o,a)=>Ot(o,a)).filter((o,a,u)=>!a||0!==Ot(o,u[a-1]));const s=[];s.push(e);for(const o of r){const a=Ot(o,e),u=Ot(o,t);if(0===a)s[0]=e.Le();else if(a>0&&u<0)s.push(o),s.push(o.Le());else if(u>0)break}s.push(t);const i=[];for(let o=0;o<s.length;o+=2)i.push(IDBKeyRange.bound([s[o].indexId,this.uid,s[o].arrayValue,s[o].directionalValue,Es,[]],[s[o+1].indexId,this.uid,s[o+1].arrayValue,s[o+1].directionalValue,Es,[]]));return i}getMinOffsetFromCollectionGroup(e,t){return this.getFieldIndexes(e,t).next(zl)}getMinOffset(e,t){return f.mapArray(this.Ye(t),r=>this.Xe(e,r).next(s=>s||T())).next(zl)}}function $l(n){return ue(n,"collectionParents")}function gr(n){return ue(n,"indexEntries")}function Ts(n){return ue(n,"indexConfiguration")}function pr(n){return ue(n,"indexState")}function zl(n){D(0!==n.length);let e=n[0].indexState.offset,t=e.largestBatchId;for(let r=1;r<n.length;r++){const s=n[r].indexState.offset;zi(s,e)<0&&(e=s),t<s.largestBatchId&&(t=s.largestBatchId)}return new Ce(e.readTime,e.documentKey,t)}const Ql={didRun:!1,sequenceNumbersCollected:0,targetsRemoved:0,documentsRemoved:0};class De{constructor(e,t,r){this.cacheSizeCollectionThreshold=e,this.percentileToCollect=t,this.maximumSequenceNumbersToCollect=r}static withCacheSize(e){return new De(e,De.DEFAULT_COLLECTION_PERCENTILE,De.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT)}}function Zl(n,e,t){const r=n.store("mutations"),s=n.store("documentMutations"),i=[],o=IDBKeyRange.only(t.batchId);let a=0;const u=r.J({range:o},(l,h,d)=>(a++,d.delete()));i.push(u.next(()=>{D(1===a)}));const c=[];for(const l of t.mutations){const h=Rl(e,l.key.path,t.batchId);i.push(s.delete(h)),c.push(l.key)}return f.waitFor(i).next(()=>c)}function Ss(n){if(!n)return 0;let e;if(n.document)e=n.document;else if(n.unknownDocument)e=n.unknownDocument;else{if(!n.noDocument)throw T();e=n.noDocument}return JSON.stringify(e).length}De.DEFAULT_COLLECTION_PERCENTILE=10,De.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT=1e3,De.DEFAULT=new De(41943040,De.DEFAULT_COLLECTION_PERCENTILE,De.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT),De.DISABLED=new De(-1,0,0);class bs{constructor(e,t,r,s){this.userId=e,this.wt=t,this.indexManager=r,this.referenceDelegate=s,this.gn={}}static se(e,t,r,s){D(""!==e.uid);const i=e.isAuthenticated()?e.uid:"";return new bs(i,t,r,s)}checkEmpty(e){let t=!0;const r=IDBKeyRange.bound([this.userId,Number.NEGATIVE_INFINITY],[this.userId,Number.POSITIVE_INFINITY]);return ut(e).J({index:"userMutationsIndex",range:r},(s,i,o)=>{t=!1,o.done()}).next(()=>t)}addMutationBatch(e,t,r,s){const i=dn(e),o=ut(e);return o.add({}).next(a=>{D("number"==typeof a);const u=new uo(a,t,r,s),c=function(d,g,y){const x=y.baseMutations.map(V=>hr(d.ne,V)),S=y.mutations.map(V=>hr(d.ne,V));return{userId:g,batchId:y.batchId,localWriteTimeMs:y.localWriteTime.toMillis(),baseMutations:x,mutations:S}}(this.wt,this.userId,u),l=[];let h=new P((d,g)=>C(d.canonicalString(),g.canonicalString()));for(const d of s){const g=Rl(this.userId,d.key.path,a);h=h.add(d.key.path.popLast()),l.push(o.put(c)),l.push(i.put(g,ng))}return h.forEach(d=>{l.push(this.indexManager.addToCollectionParentIndex(e,d))}),e.addOnCommittedListener(()=>{this.gn[a]=u.keys()}),f.waitFor(l).next(()=>u)})}lookupMutationBatch(e,t){return ut(e).get(t).next(r=>r?(D(r.userId===this.userId),Mt(this.wt,r)):null)}yn(e,t){return this.gn[t]?f.resolve(this.gn[t]):this.lookupMutationBatch(e,t).next(r=>{if(r){const s=r.keys();return this.gn[t]=s,s}return null})}getNextMutationBatchAfterBatchId(e,t){const r=t+1,s=IDBKeyRange.lowerBound([this.userId,r]);let i=null;return ut(e).J({index:"userMutationsIndex",range:s},(o,a,u)=>{a.userId===this.userId&&(D(a.batchId>=r),i=Mt(this.wt,a)),u.done()}).next(()=>i)}getHighestUnacknowledgedBatchId(e){const t=IDBKeyRange.upperBound([this.userId,Number.POSITIVE_INFINITY]);let r=-1;return ut(e).J({index:"userMutationsIndex",range:t,reverse:!0},(s,i,o)=>{r=i.batchId,o.done()}).next(()=>r)}getAllMutationBatches(e){const t=IDBKeyRange.bound([this.userId,-1],[this.userId,Number.POSITIVE_INFINITY]);return ut(e).K("userMutationsIndex",t).next(r=>r.map(s=>Mt(this.wt,s)))}getAllMutationBatchesAffectingDocumentKey(e,t){const r=Is(this.userId,t.path),s=IDBKeyRange.lowerBound(r),i=[];return dn(e).J({range:s},(o,a,u)=>{const[c,l,h]=o,d=Ue(l);if(c===this.userId&&t.path.isEqual(d))return ut(e).get(h).next(g=>{if(!g)throw T();D(g.userId===this.userId),i.push(Mt(this.wt,g))});u.done()}).next(()=>i)}getAllMutationBatchesAffectingDocumentKeys(e,t){let r=new P(C);const s=[];return t.forEach(i=>{const o=Is(this.userId,i.path),a=IDBKeyRange.lowerBound(o),u=dn(e).J({range:a},(c,l,h)=>{const[d,g,y]=c,x=Ue(g);d===this.userId&&i.path.isEqual(x)?r=r.add(y):h.done()});s.push(u)}),f.waitFor(s).next(()=>this.pn(e,r))}getAllMutationBatchesAffectingQuery(e,t){const r=t.path,s=r.length+1,i=Is(this.userId,r),o=IDBKeyRange.lowerBound(i);let a=new P(C);return dn(e).J({range:o},(u,c,l)=>{const[h,d,g]=u,y=Ue(d);h===this.userId&&r.isPrefixOf(y)?y.length===s&&(a=a.add(g)):l.done()}).next(()=>this.pn(e,a))}pn(e,t){const r=[],s=[];return t.forEach(i=>{s.push(ut(e).get(i).next(o=>{if(null===o)throw T();D(o.userId===this.userId),r.push(Mt(this.wt,o))}))}),f.waitFor(s).next(()=>r)}removeMutationBatch(e,t){return Zl(e.ee,this.userId,t).next(r=>(e.addOnCommittedListener(()=>{this.In(t.batchId)}),f.forEach(r,s=>this.referenceDelegate.markPotentiallyOrphaned(e,s))))}In(e){delete this.gn[e]}performConsistencyCheck(e){return this.checkEmpty(e).next(t=>{if(!t)return f.resolve();const r=IDBKeyRange.lowerBound([this.userId]),s=[];return dn(e).J({range:r},(i,o,a)=>{if(i[0]===this.userId){const u=Ue(i[1]);s.push(u)}else a.done()}).next(()=>{D(0===s.length)})})}containsKey(e,t){return Hl(e,this.userId,t)}Tn(e){return Wl(e).get(this.userId).next(t=>t||{userId:this.userId,lastAcknowledgedBatchId:-1,lastStreamToken:""})}}function Hl(n,e,t){const r=Is(e,t.path),s=r[1],i=IDBKeyRange.lowerBound(r);let o=!1;return dn(n).J({range:i,H:!0},(a,u,c)=>{const[l,h,d]=a;l===e&&h===s&&(o=!0),c.done()}).next(()=>o)}function ut(n){return ue(n,"mutations")}function dn(n){return ue(n,"documentMutations")}function Wl(n){return ue(n,"mutationQueues")}class Vt{constructor(e){this.En=e}next(){return this.En+=2,this.En}static An(){return new Vt(0)}static Rn(){return new Vt(-1)}}class Ag{constructor(e,t){this.referenceDelegate=e,this.wt=t}allocateTargetId(e){return this.bn(e).next(t=>{const r=new Vt(t.highestTargetId);return t.highestTargetId=r.next(),this.Pn(e,t).next(()=>t.highestTargetId)})}getLastRemoteSnapshotVersion(e){return this.bn(e).next(t=>b.fromTimestamp(new $(t.lastRemoteSnapshotVersion.seconds,t.lastRemoteSnapshotVersion.nanoseconds)))}getHighestSequenceNumber(e){return this.bn(e).next(t=>t.highestListenSequenceNumber)}setTargetsMetadata(e,t,r){return this.bn(e).next(s=>(s.highestListenSequenceNumber=t,r&&(s.lastRemoteSnapshotVersion=r.toTimestamp()),t>s.highestListenSequenceNumber&&(s.highestListenSequenceNumber=t),this.Pn(e,s)))}addTargetData(e,t){return this.vn(e,t).next(()=>this.bn(e).next(r=>(r.targetCount+=1,this.Vn(t,r),this.Pn(e,r))))}updateTargetData(e,t){return this.vn(e,t)}removeTargetData(e,t){return this.removeMatchingKeysForTargetId(e,t.targetId).next(()=>fn(e).delete(t.targetId)).next(()=>this.bn(e)).next(r=>(D(r.targetCount>0),r.targetCount-=1,this.Pn(e,r)))}removeTargets(e,t,r){let s=0;const i=[];return fn(e).J((o,a)=>{const u=dr(a);u.sequenceNumber<=t&&null===r.get(u.targetId)&&(s++,i.push(this.removeTargetData(e,u)))}).next(()=>f.waitFor(i)).next(()=>s)}forEachTarget(e,t){return fn(e).J((r,s)=>{const i=dr(s);t(i)})}bn(e){return Xl(e).get("targetGlobalKey").next(t=>(D(null!==t),t))}Pn(e,t){return Xl(e).put("targetGlobalKey",t)}vn(e,t){return fn(e).put(Pl(this.wt,t))}Vn(e,t){let r=!1;return e.targetId>t.highestTargetId&&(t.highestTargetId=e.targetId,r=!0),e.sequenceNumber>t.highestListenSequenceNumber&&(t.highestListenSequenceNumber=e.sequenceNumber,r=!0),r}getTargetCount(e){return this.bn(e).next(t=>t.targetCount)}getTargetData(e,t){const r=At(t),s=IDBKeyRange.bound([r,Number.NEGATIVE_INFINITY],[r,Number.POSITIVE_INFINITY]);let i=null;return fn(e).J({range:s,index:"queryTargetsIndex"},(o,a,u)=>{const c=dr(a);er(t,c.target)&&(i=c,u.done())}).next(()=>i)}addMatchingKeys(e,t,r){const s=[],i=ct(e);return t.forEach(o=>{const a=xe(o.path);s.push(i.put({targetId:r,path:a})),s.push(this.referenceDelegate.addReference(e,r,o))}),f.waitFor(s)}removeMatchingKeys(e,t,r){const s=ct(e);return f.forEach(t,i=>{const o=xe(i.path);return f.waitFor([s.delete([r,o]),this.referenceDelegate.removeReference(e,r,i)])})}removeMatchingKeysForTargetId(e,t){const r=ct(e),s=IDBKeyRange.bound([t],[t+1],!1,!0);return r.delete(s)}getMatchingKeysForTargetId(e,t){const r=IDBKeyRange.bound([t],[t+1],!1,!0),s=ct(e);let i=N();return s.J({range:r,H:!0},(o,a,u)=>{const c=Ue(o[1]),l=new I(c);i=i.add(l)}).next(()=>i)}containsKey(e,t){const r=xe(t.path),s=IDBKeyRange.bound([r],[_c(r)],!1,!0);let i=0;return ct(e).J({index:"documentTargetsIndex",H:!0,range:s},([o,a],u,c)=>{0!==o&&(i++,c.done())}).next(()=>i>0)}te(e,t){return fn(e).get(t).next(r=>r?dr(r):null)}}function fn(n){return ue(n,"targets")}function Xl(n){return ue(n,"targetGlobal")}function ct(n){return ue(n,"targetDocuments")}function Yl([n,e],[t,r]){const s=C(n,t);return 0===s?C(e,r):s}class Cg{constructor(e){this.Sn=e,this.buffer=new P(Yl),this.Dn=0}Cn(){return++this.Dn}xn(e){const t=[e,this.Cn()];if(this.buffer.size<this.Sn)this.buffer=this.buffer.add(t);else{const r=this.buffer.last();Yl(t,r)<0&&(this.buffer=this.buffer.delete(r).add(t))}}get maxValue(){return this.buffer.last()[0]}}class Ng{constructor(e,t,r){this.garbageCollector=e,this.asyncQueue=t,this.localStore=r,this.Nn=null}start(){-1!==this.garbageCollector.params.cacheSizeCollectionThreshold&&this.kn(6e4)}stop(){this.Nn&&(this.Nn.cancel(),this.Nn=null)}get started(){return null!==this.Nn}kn(e){var t=this;w("LruGarbageCollector",`Garbage collection scheduled in ${e}ms`),this.Nn=this.asyncQueue.enqueueAfterDelay("lru_garbage_collection",e,(0,p.Z)(function*(){t.Nn=null;try{yield t.localStore.collectGarbage(t.garbageCollector)}catch(r){tt(r)?w("LruGarbageCollector","Ignoring IndexedDB error during garbage collection: ",r):yield et(r)}yield t.kn(3e5)}))}}class kg{constructor(e,t){this.On=e,this.params=t}calculateTargetCount(e,t){return this.On.Mn(e).next(r=>Math.floor(t/100*r))}nthSequenceNumber(e,t){if(0===t)return f.resolve(Se.ot);const r=new Cg(t);return this.On.forEachTarget(e,s=>r.xn(s.sequenceNumber)).next(()=>this.On.Fn(e,s=>r.xn(s))).next(()=>r.maxValue)}removeTargets(e,t,r){return this.On.removeTargets(e,t,r)}removeOrphanedDocuments(e,t){return this.On.removeOrphanedDocuments(e,t)}collect(e,t){return-1===this.params.cacheSizeCollectionThreshold?(w("LruGarbageCollector","Garbage collection skipped; disabled"),f.resolve(Ql)):this.getCacheSize(e).next(r=>r<this.params.cacheSizeCollectionThreshold?(w("LruGarbageCollector",`Garbage collection skipped; Cache size ${r} is lower than threshold ${this.params.cacheSizeCollectionThreshold}`),Ql):this.$n(e,t))}getCacheSize(e){return this.On.getCacheSize(e)}$n(e,t){let r,s,i,o,a,u,c;const l=Date.now();return this.calculateTargetCount(e,this.params.percentileToCollect).next(h=>(h>this.params.maximumSequenceNumbersToCollect?(w("LruGarbageCollector",`Capping sequence numbers to collect down to the maximum of ${this.params.maximumSequenceNumbersToCollect} from ${h}`),s=this.params.maximumSequenceNumbersToCollect):s=h,o=Date.now(),this.nthSequenceNumber(e,s))).next(h=>(r=h,a=Date.now(),this.removeTargets(e,r,t))).next(h=>(i=h,u=Date.now(),this.removeOrphanedDocuments(e,r))).next(h=>(c=Date.now(),Ki()<=pt.in.DEBUG&&w("LruGarbageCollector",`LRU Garbage Collection\n\tCounted targets in ${o-l}ms\n\tDetermined least recently used ${s} in `+(a-o)+`ms\n\tRemoved ${i} targets in `+(u-a)+`ms\n\tRemoved ${h} documents in `+(c-u)+`ms\nTotal Duration: ${c-l}ms`),f.resolve({didRun:!0,sequenceNumbersCollected:s,targetsRemoved:i,documentsRemoved:h})))}}class Rg{constructor(e,t){this.db=e,this.garbageCollector=new kg(this,t)}Mn(e){const t=this.Bn(e);return this.db.getTargetCache().getTargetCount(e).next(r=>t.next(s=>r+s))}Bn(e){let t=0;return this.Fn(e,r=>{t++}).next(()=>t)}forEachTarget(e,t){return this.db.getTargetCache().forEachTarget(e,t)}Fn(e,t){return this.Ln(e,(r,s)=>t(s))}addReference(e,t,r){return Ds(e,r)}removeReference(e,t,r){return Ds(e,r)}removeTargets(e,t,r){return this.db.getTargetCache().removeTargets(e,t,r)}markPotentiallyOrphaned(e,t){return Ds(e,t)}Un(e,t){return function(r,s){let i=!1;return Wl(r).Y(o=>Hl(r,o,s).next(a=>(a&&(i=!0),f.resolve(!a)))).next(()=>i)}(e,t)}removeOrphanedDocuments(e,t){const r=this.db.getRemoteDocumentCache().newChangeBuffer(),s=[];let i=0;return this.Ln(e,(o,a)=>{if(a<=t){const u=this.Un(e,o).next(c=>{if(!c)return i++,r.getEntry(e,o).next(()=>(r.removeEntry(o,b.min()),ct(e).delete([0,xe(o.path)])))});s.push(u)}}).next(()=>f.waitFor(s)).next(()=>r.apply(e)).next(()=>i)}removeTarget(e,t){const r=t.withSequenceNumber(e.currentSequenceNumber);return this.db.getTargetCache().updateTargetData(e,r)}updateLimboDocument(e,t){return Ds(e,t)}Ln(e,t){const r=ct(e);let s,i=Se.ot;return r.J({index:"documentTargetsIndex"},([o,a],{path:u,sequenceNumber:c})=>{0===o?(i!==Se.ot&&t(new I(Ue(s)),i),i=c,s=u):i=Se.ot}).next(()=>{i!==Se.ot&&t(new I(Ue(s)),i)})}getCacheSize(e){return this.db.getRemoteDocumentCache().getSize(e)}}function Ds(n,e){return ct(n).put((r=n.currentSequenceNumber,{targetId:0,path:xe(e.path),sequenceNumber:r}));var r}class Jl{constructor(){this.changes=new ot(e=>e.toString(),(e,t)=>e.isEqual(t)),this.changesApplied=!1}addEntry(e){this.assertNotApplied(),this.changes.set(e.key,e)}removeEntry(e,t){this.assertNotApplied(),this.changes.set(e,B.newInvalidDocument(e).setReadTime(t))}getEntry(e,t){this.assertNotApplied();const r=this.changes.get(t);return void 0!==r?f.resolve(r):this.getFromCache(e,t)}getEntries(e,t){return this.getAllFromCache(e,t)}apply(e){return this.assertNotApplied(),this.changesApplied=!0,this.applyChanges(e)}assertNotApplied(){}}class Mg{constructor(e){this.wt=e}setIndexManager(e){this.indexManager=e}addEntry(e,t,r){return Pt(e).put(r)}removeEntry(e,t,r){return Pt(e).delete(function(s,i){const o=s.path.toArray();return[o.slice(0,o.length-2),o[o.length-2],_s(i),o[o.length-1]]}(t,r))}updateMetadata(e,t){return this.getMetadata(e).next(r=>(r.byteSize+=t,this.qn(e,r)))}getEntry(e,t){let r=B.newInvalidDocument(t);return Pt(e).J({index:"documentKeyIndex",range:IDBKeyRange.only(yr(t))},(s,i)=>{r=this.Kn(t,i)}).next(()=>r)}Gn(e,t){let r={size:0,document:B.newInvalidDocument(t)};return Pt(e).J({index:"documentKeyIndex",range:IDBKeyRange.only(yr(t))},(s,i)=>{r={document:this.Kn(t,i),size:Ss(i)}}).next(()=>r)}getEntries(e,t){let r=be();return this.Qn(e,t,(s,i)=>{const o=this.Kn(s,i);r=r.insert(s,o)}).next(()=>r)}jn(e,t){let r=be(),s=new H(I.comparator);return this.Qn(e,t,(i,o)=>{const a=this.Kn(i,o);r=r.insert(i,a),s=s.insert(i,Ss(o))}).next(()=>({documents:r,Wn:s}))}Qn(e,t,r){if(t.isEmpty())return f.resolve();let s=new P(rh);t.forEach(u=>s=s.add(u));const i=IDBKeyRange.bound(yr(s.first()),yr(s.last())),o=s.getIterator();let a=o.getNext();return Pt(e).J({index:"documentKeyIndex",range:i},(u,c,l)=>{const h=I.fromSegments([...c.prefixPath,c.collectionGroup,c.documentId]);for(;a&&rh(a,h)<0;)r(a,null),a=o.getNext();a&&a.isEqual(h)&&(r(a,c),a=o.hasNext()?o.getNext():null),a?l.q(yr(a)):l.done()}).next(()=>{for(;a;)r(a,null),a=o.hasNext()?o.getNext():null})}getAllFromCollection(e,t,r){const s=[t.popLast().toArray(),t.lastSegment(),_s(r.readTime),r.documentKey.path.isEmpty()?"":r.documentKey.path.lastSegment()],i=[t.popLast().toArray(),t.lastSegment(),[Number.MAX_SAFE_INTEGER,Number.MAX_SAFE_INTEGER],""];return Pt(e).K(IDBKeyRange.bound(s,i,!0)).next(o=>{let a=be();for(const u of o){const c=this.Kn(I.fromSegments(u.prefixPath.concat(u.collectionGroup,u.documentId)),u);a=a.insert(c.key,c)}return a})}getAllFromCollectionGroup(e,t,r,s){let i=be();const o=nh(t,r),a=nh(t,Ce.max());return Pt(e).J({index:"collectionGroupIndex",range:IDBKeyRange.bound(o,a,!0)},(u,c,l)=>{const h=this.Kn(I.fromSegments(c.prefixPath.concat(c.collectionGroup,c.documentId)),c);i=i.insert(h.key,h),i.size===s&&l.done()}).next(()=>i)}newChangeBuffer(e){return new Fg(this,!!e&&e.trackRemovals)}getSize(e){return this.getMetadata(e).next(t=>t.byteSize)}getMetadata(e){return th(e).get("remoteDocumentGlobalKey").next(t=>(D(!!t),t))}qn(e,t){return th(e).put("remoteDocumentGlobalKey",t)}Kn(e,t){if(t){const r=function wg(n,e){let t;if(e.document)t=Tl(n.ne,e.document,!!e.hasCommittedMutations);else if(e.noDocument){const r=I.fromSegments(e.noDocument.path),s=Rt(e.noDocument.readTime);t=B.newNoDocument(r,s),e.hasCommittedMutations&&t.setHasCommittedMutations()}else{if(!e.unknownDocument)return T();{const r=I.fromSegments(e.unknownDocument.path),s=Rt(e.unknownDocument.version);t=B.newUnknownDocument(r,s)}}return e.readTime&&t.setReadTime(function(r){const s=new $(r[0],r[1]);return b.fromTimestamp(s)}(e.readTime)),t}(this.wt,t);if(!r.isNoDocument()||!r.version.isEqual(b.min()))return r}return B.newInvalidDocument(e)}}function eh(n){return new Mg(n)}class Fg extends Jl{constructor(e,t){super(),this.zn=e,this.trackRemovals=t,this.Hn=new ot(r=>r.toString(),(r,s)=>r.isEqual(s))}applyChanges(e){const t=[];let r=0,s=new P((i,o)=>C(i.canonicalString(),o.canonicalString()));return this.changes.forEach((i,o)=>{const a=this.Hn.get(i);if(t.push(this.zn.removeEntry(e,i,a.readTime)),o.isValidDocument()){const u=Vl(this.zn.wt,o);s=s.add(i.path.popLast()),r+=Ss(u)-a.size,t.push(this.zn.addEntry(e,i,u))}else if(r-=a.size,this.trackRemovals){const u=Vl(this.zn.wt,o.convertToNoDocument(b.min()));t.push(this.zn.addEntry(e,i,u))}}),s.forEach(i=>{t.push(this.zn.indexManager.addToCollectionParentIndex(e,i))}),t.push(this.zn.updateMetadata(e,r)),f.waitFor(t)}getFromCache(e,t){return this.zn.Gn(e,t).next(r=>(this.Hn.set(t,{size:r.size,readTime:r.document.readTime}),r.document))}getAllFromCache(e,t){return this.zn.jn(e,t).next(({documents:r,Wn:s})=>(s.forEach((i,o)=>{this.Hn.set(i,{size:o,readTime:r.get(i).readTime})}),r))}}function th(n){return ue(n,"remoteDocumentGlobal")}function Pt(n){return ue(n,"remoteDocumentsV14")}function yr(n){const e=n.path.toArray();return[e.slice(0,e.length-2),e[e.length-2],e[e.length-1]]}function nh(n,e){const t=e.documentKey.path.toArray();return[n,_s(e.readTime),t.slice(0,t.length-2),t.length>0?t[t.length-1]:""]}function rh(n,e){const t=n.path.toArray(),r=e.path.toArray();let s=0;for(let i=0;i<t.length-2&&i<r.length-2;++i)if(s=C(t[i],r[i]),s)return s;return s=C(t.length,r.length),s||(s=C(t[t.length-2],r[r.length-2]),s||C(t[t.length-1],r[r.length-1]))}class Lg{constructor(e,t){this.overlayedDocument=e,this.mutatedFields=t}}class sh{constructor(e,t,r,s){this.remoteDocumentCache=e,this.mutationQueue=t,this.documentOverlayCache=r,this.indexManager=s}getDocument(e,t){let r=null;return this.documentOverlayCache.getOverlay(e,t).next(s=>(r=s,this.getBaseDocument(e,t,r))).next(s=>(null!==r&&rr(r.mutation,s,Ne.empty(),$.now()),s))}getDocuments(e,t){return this.remoteDocumentCache.getEntries(e,t).next(r=>this.getLocalViewOfDocuments(e,r,N()).next(()=>r))}getLocalViewOfDocuments(e,t,r=N()){const s=Ve();return this.populateOverlays(e,s,t).next(()=>this.computeViews(e,t,s,r).next(i=>{let o=sr();return i.forEach((a,u)=>{o=o.insert(a,u.overlayedDocument)}),o}))}getOverlayedDocuments(e,t){const r=Ve();return this.populateOverlays(e,r,t).next(()=>this.computeViews(e,t,r,N()))}populateOverlays(e,t,r){const s=[];return r.forEach(i=>{t.has(i)||s.push(i)}),this.documentOverlayCache.getOverlays(e,s).next(i=>{i.forEach((o,a)=>{t.set(o,a)})})}computeViews(e,t,r,s){let i=be();const o=ir(),a=ir();return t.forEach((u,c)=>{const l=r.get(c.key);s.has(c.key)&&(void 0===l||l.mutation instanceof Qe)?i=i.insert(c.key,c):void 0!==l&&(o.set(c.key,l.mutation.getFieldMask()),rr(l.mutation,c,l.mutation.getFieldMask(),$.now()))}),this.recalculateAndSaveOverlays(e,i).next(u=>(u.forEach((c,l)=>o.set(c,l)),t.forEach((c,l)=>{var h;return a.set(c,new Lg(l,null!==(h=o.get(c))&&void 0!==h?h:null))}),a))}recalculateAndSaveOverlays(e,t){const r=ir();let s=new H((o,a)=>o-a),i=N();return this.mutationQueue.getAllMutationBatchesAffectingDocumentKeys(e,t).next(o=>{for(const a of o)a.keys().forEach(u=>{const c=t.get(u);if(null===c)return;let l=r.get(u)||Ne.empty();l=a.applyToLocalView(c,l),r.set(u,l);const h=(s.get(a.batchId)||N()).add(u);s=s.insert(a.batchId,h)})}).next(()=>{const o=[],a=s.getReverseIterator();for(;a.hasNext();){const u=a.getNext(),c=u.key,l=u.value,h=fl();l.forEach(d=>{if(!i.has(d)){const g=sl(t.get(d),r.get(d));null!==g&&h.set(d,g),i=i.add(d)}}),o.push(this.documentOverlayCache.saveOverlays(e,c,h))}return f.waitFor(o)}).next(()=>r)}recalculateAndSaveOverlaysForDocumentKeys(e,t){return this.remoteDocumentCache.getEntries(e,t).next(r=>this.recalculateAndSaveOverlays(e,r))}getDocumentsMatchingQuery(e,t,r){return I.isDocumentKey((s=t).path)&&null===s.collectionGroup&&0===s.filters.length?this.getDocumentsMatchingDocumentQuery(e,t.path):eo(t)?this.getDocumentsMatchingCollectionGroupQuery(e,t,r):this.getDocumentsMatchingCollectionQuery(e,t,r);var s}getNextDocuments(e,t,r,s){return this.remoteDocumentCache.getAllFromCollectionGroup(e,t,r,s).next(i=>{const o=s-i.size>0?this.documentOverlayCache.getOverlaysForCollectionGroup(e,t,r.largestBatchId,s-i.size):f.resolve(Ve());let a=-1,u=i;return o.next(c=>f.forEach(c,(l,h)=>(a<h.largestBatchId&&(a=h.largestBatchId),i.get(l)?f.resolve():this.getBaseDocument(e,l,h).next(d=>{u=u.insert(l,d)}))).next(()=>this.populateOverlays(e,c,i)).next(()=>this.computeViews(e,u,c,N())).next(l=>({batchId:a,changes:dl(l)})))})}getDocumentsMatchingDocumentQuery(e,t){return this.getDocument(e,new I(t)).next(r=>{let s=sr();return r.isFoundDocument()&&(s=s.insert(r.key,r)),s})}getDocumentsMatchingCollectionGroupQuery(e,t,r){const s=t.collectionGroup;let i=sr();return this.indexManager.getCollectionParents(e,s).next(o=>f.forEach(o,a=>{const u=(c=t,l=a.child(s),new ze(l,null,c.explicitOrderBy.slice(),c.filters.slice(),c.limit,c.limitType,c.startAt,c.endAt));var c,l;return this.getDocumentsMatchingCollectionQuery(e,u,r).next(c=>{c.forEach((l,h)=>{i=i.insert(l,h)})})}).next(()=>i))}getDocumentsMatchingCollectionQuery(e,t,r){let s;return this.remoteDocumentCache.getAllFromCollection(e,t.path,r).next(i=>(s=i,this.documentOverlayCache.getOverlaysForCollection(e,t.path,r.largestBatchId))).next(i=>{i.forEach((a,u)=>{const c=u.getKey();null===s.get(c)&&(s=s.insert(c,B.newInvalidDocument(c)))});let o=sr();return s.forEach((a,u)=>{const c=i.get(a);void 0!==c&&rr(c.mutation,u,Ne.empty(),$.now()),no(t,u)&&(o=o.insert(a,u))}),o})}getBaseDocument(e,t,r){return null===r||1===r.mutation.type?this.remoteDocumentCache.getEntry(e,t):f.resolve(B.newInvalidDocument(t))}}class Og{constructor(e){this.wt=e,this.Jn=new Map,this.Yn=new Map}getBundleMetadata(e,t){return f.resolve(this.Jn.get(t))}saveBundleMetadata(e,t){var r;return this.Jn.set(t.id,{id:(r=t).id,version:r.version,createTime:ae(r.createTime)}),f.resolve()}getNamedQuery(e,t){return f.resolve(this.Yn.get(t))}saveNamedQuery(e,t){return this.Yn.set(t.name,{name:(r=t).name,query:ho(r.bundledQuery),readTime:ae(r.readTime)}),f.resolve();var r}}class Vg{constructor(){this.overlays=new H(I.comparator),this.Xn=new Map}getOverlay(e,t){return f.resolve(this.overlays.get(t))}getOverlays(e,t){const r=Ve();return f.forEach(t,s=>this.getOverlay(e,s).next(i=>{null!==i&&r.set(s,i)})).next(()=>r)}saveOverlays(e,t,r){return r.forEach((s,i)=>{this.ie(e,t,i)}),f.resolve()}removeOverlaysForBatchId(e,t,r){const s=this.Xn.get(r);return void 0!==s&&(s.forEach(i=>this.overlays=this.overlays.remove(i)),this.Xn.delete(r)),f.resolve()}getOverlaysForCollection(e,t,r){const s=Ve(),i=t.length+1,o=new I(t.child("")),a=this.overlays.getIteratorFrom(o);for(;a.hasNext();){const u=a.getNext().value,c=u.getKey();if(!t.isPrefixOf(c.path))break;c.path.length===i&&u.largestBatchId>r&&s.set(u.getKey(),u)}return f.resolve(s)}getOverlaysForCollectionGroup(e,t,r,s){let i=new H((c,l)=>c-l);const o=this.overlays.getIterator();for(;o.hasNext();){const c=o.getNext().value;if(c.getKey().getCollectionGroup()===t&&c.largestBatchId>r){let l=i.get(c.largestBatchId);null===l&&(l=Ve(),i=i.insert(c.largestBatchId,l)),l.set(c.getKey(),c)}}const a=Ve(),u=i.getIterator();for(;u.hasNext()&&(u.getNext().value.forEach((c,l)=>a.set(c,l)),!(a.size()>=s)););return f.resolve(a)}ie(e,t,r){const s=this.overlays.get(r.key);if(null!==s){const o=this.Xn.get(s.largestBatchId).delete(r.key);this.Xn.set(s.largestBatchId,o)}this.overlays=this.overlays.insert(r.key,new lo(t,r));let i=this.Xn.get(t);void 0===i&&(i=N(),this.Xn.set(t,i)),this.Xn.set(t,i.add(r.key))}}class go{constructor(){this.Zn=new P(ce.ts),this.es=new P(ce.ns)}isEmpty(){return this.Zn.isEmpty()}addReference(e,t){const r=new ce(e,t);this.Zn=this.Zn.add(r),this.es=this.es.add(r)}ss(e,t){e.forEach(r=>this.addReference(r,t))}removeReference(e,t){this.rs(new ce(e,t))}os(e,t){e.forEach(r=>this.removeReference(r,t))}us(e){const t=new I(new M([])),r=new ce(t,e),s=new ce(t,e+1),i=[];return this.es.forEachInRange([r,s],o=>{this.rs(o),i.push(o.key)}),i}cs(){this.Zn.forEach(e=>this.rs(e))}rs(e){this.Zn=this.Zn.delete(e),this.es=this.es.delete(e)}hs(e){const t=new I(new M([])),r=new ce(t,e),s=new ce(t,e+1);let i=N();return this.es.forEachInRange([r,s],o=>{i=i.add(o.key)}),i}containsKey(e){const t=new ce(e,0),r=this.Zn.firstAfterOrEqual(t);return null!==r&&e.isEqual(r.key)}}class ce{constructor(e,t){this.key=e,this.ls=t}static ts(e,t){return I.comparator(e.key,t.key)||C(e.ls,t.ls)}static ns(e,t){return C(e.ls,t.ls)||I.comparator(e.key,t.key)}}class Pg{constructor(e,t){this.indexManager=e,this.referenceDelegate=t,this.mutationQueue=[],this.fs=1,this.ds=new P(ce.ts)}checkEmpty(e){return f.resolve(0===this.mutationQueue.length)}addMutationBatch(e,t,r,s){const i=this.fs;this.fs++;const o=new uo(i,t,r,s);this.mutationQueue.push(o);for(const a of s)this.ds=this.ds.add(new ce(a.key,i)),this.indexManager.addToCollectionParentIndex(e,a.key.path.popLast());return f.resolve(o)}lookupMutationBatch(e,t){return f.resolve(this._s(t))}getNextMutationBatchAfterBatchId(e,t){const s=this.ws(t+1),i=s<0?0:s;return f.resolve(this.mutationQueue.length>i?this.mutationQueue[i]:null)}getHighestUnacknowledgedBatchId(){return f.resolve(0===this.mutationQueue.length?-1:this.fs-1)}getAllMutationBatches(e){return f.resolve(this.mutationQueue.slice())}getAllMutationBatchesAffectingDocumentKey(e,t){const r=new ce(t,0),s=new ce(t,Number.POSITIVE_INFINITY),i=[];return this.ds.forEachInRange([r,s],o=>{const a=this._s(o.ls);i.push(a)}),f.resolve(i)}getAllMutationBatchesAffectingDocumentKeys(e,t){let r=new P(C);return t.forEach(s=>{const i=new ce(s,0),o=new ce(s,Number.POSITIVE_INFINITY);this.ds.forEachInRange([i,o],a=>{r=r.add(a.ls)})}),f.resolve(this.gs(r))}getAllMutationBatchesAffectingQuery(e,t){const r=t.path,s=r.length+1;let i=r;I.isDocumentKey(i)||(i=i.child(""));const o=new ce(new I(i),0);let a=new P(C);return this.ds.forEachWhile(u=>{const c=u.key.path;return!!r.isPrefixOf(c)&&(c.length===s&&(a=a.add(u.ls)),!0)},o),f.resolve(this.gs(a))}gs(e){const t=[];return e.forEach(r=>{const s=this._s(r);null!==s&&t.push(s)}),t}removeMutationBatch(e,t){D(0===this.ys(t.batchId,"removed")),this.mutationQueue.shift();let r=this.ds;return f.forEach(t.mutations,s=>{const i=new ce(s.key,t.batchId);return r=r.delete(i),this.referenceDelegate.markPotentiallyOrphaned(e,s.key)}).next(()=>{this.ds=r})}In(e){}containsKey(e,t){const r=new ce(t,0),s=this.ds.firstAfterOrEqual(r);return f.resolve(t.isEqual(s&&s.key))}performConsistencyCheck(e){return f.resolve()}ys(e,t){return this.ws(e)}ws(e){return 0===this.mutationQueue.length?0:e-this.mutationQueue[0].batchId}_s(e){const t=this.ws(e);return t<0||t>=this.mutationQueue.length?null:this.mutationQueue[t]}}class Ug{constructor(e){this.ps=e,this.docs=new H(I.comparator),this.size=0}setIndexManager(e){this.indexManager=e}addEntry(e,t){const r=t.key,s=this.docs.get(r),i=s?s.size:0,o=this.ps(t);return this.docs=this.docs.insert(r,{document:t.mutableCopy(),size:o}),this.size+=o-i,this.indexManager.addToCollectionParentIndex(e,r.path.popLast())}removeEntry(e){const t=this.docs.get(e);t&&(this.docs=this.docs.remove(e),this.size-=t.size)}getEntry(e,t){const r=this.docs.get(t);return f.resolve(r?r.document.mutableCopy():B.newInvalidDocument(t))}getEntries(e,t){let r=be();return t.forEach(s=>{const i=this.docs.get(s);r=r.insert(s,i?i.document.mutableCopy():B.newInvalidDocument(s))}),f.resolve(r)}getAllFromCollection(e,t,r){let s=be();const i=new I(t.child("")),o=this.docs.getIteratorFrom(i);for(;o.hasNext();){const{key:a,value:{document:u}}=o.getNext();if(!t.isPrefixOf(a.path))break;a.path.length>t.length+1||zi(Ec(u),r)<=0||(s=s.insert(u.key,u.mutableCopy()))}return f.resolve(s)}getAllFromCollectionGroup(e,t,r,s){T()}Is(e,t){return f.forEach(this.docs,r=>t(r))}newChangeBuffer(e){return new Bg(this)}getSize(e){return f.resolve(this.size)}}class Bg extends Jl{constructor(e){super(),this.zn=e}applyChanges(e){const t=[];return this.changes.forEach((r,s)=>{s.isValidDocument()?t.push(this.zn.addEntry(e,s)):this.zn.removeEntry(r)}),f.waitFor(t)}getFromCache(e,t){return this.zn.getEntry(e,t)}getAllFromCache(e,t){return this.zn.getEntries(e,t)}}class qg{constructor(e){this.persistence=e,this.Ts=new ot(t=>At(t),er),this.lastRemoteSnapshotVersion=b.min(),this.highestTargetId=0,this.Es=0,this.As=new go,this.targetCount=0,this.Rs=Vt.An()}forEachTarget(e,t){return this.Ts.forEach((r,s)=>t(s)),f.resolve()}getLastRemoteSnapshotVersion(e){return f.resolve(this.lastRemoteSnapshotVersion)}getHighestSequenceNumber(e){return f.resolve(this.Es)}allocateTargetId(e){return this.highestTargetId=this.Rs.next(),f.resolve(this.highestTargetId)}setTargetsMetadata(e,t,r){return r&&(this.lastRemoteSnapshotVersion=r),t>this.Es&&(this.Es=t),f.resolve()}vn(e){this.Ts.set(e.target,e);const t=e.targetId;t>this.highestTargetId&&(this.Rs=new Vt(t),this.highestTargetId=t),e.sequenceNumber>this.Es&&(this.Es=e.sequenceNumber)}addTargetData(e,t){return this.vn(t),this.targetCount+=1,f.resolve()}updateTargetData(e,t){return this.vn(t),f.resolve()}removeTargetData(e,t){return this.Ts.delete(t.target),this.As.us(t.targetId),this.targetCount-=1,f.resolve()}removeTargets(e,t,r){let s=0;const i=[];return this.Ts.forEach((o,a)=>{a.sequenceNumber<=t&&null===r.get(a.targetId)&&(this.Ts.delete(o),i.push(this.removeMatchingKeysForTargetId(e,a.targetId)),s++)}),f.waitFor(i).next(()=>s)}getTargetCount(e){return f.resolve(this.targetCount)}getTargetData(e,t){const r=this.Ts.get(t)||null;return f.resolve(r)}addMatchingKeys(e,t,r){return this.As.ss(t,r),f.resolve()}removeMatchingKeys(e,t,r){this.As.os(t,r);const s=this.persistence.referenceDelegate,i=[];return s&&t.forEach(o=>{i.push(s.markPotentiallyOrphaned(e,o))}),f.waitFor(i)}removeMatchingKeysForTargetId(e,t){return this.As.us(t),f.resolve()}getMatchingKeysForTargetId(e,t){const r=this.As.hs(t);return f.resolve(r)}containsKey(e,t){return f.resolve(this.As.containsKey(t))}}class ih{constructor(e,t){this.bs={},this.overlays={},this.Ps=new Se(0),this.vs=!1,this.vs=!0,this.referenceDelegate=e(this),this.Vs=new qg(this),this.indexManager=new bg,this.remoteDocumentCache=new Ug(r=>this.referenceDelegate.Ss(r)),this.wt=new Ol(t),this.Ds=new Og(this.wt)}start(){return Promise.resolve()}shutdown(){return this.vs=!1,Promise.resolve()}get started(){return this.vs}setDatabaseDeletedListener(){}setNetworkEnabled(){}getIndexManager(e){return this.indexManager}getDocumentOverlayCache(e){let t=this.overlays[e.toKey()];return t||(t=new Vg,this.overlays[e.toKey()]=t),t}getMutationQueue(e,t){let r=this.bs[e.toKey()];return r||(r=new Pg(t,this.referenceDelegate),this.bs[e.toKey()]=r),r}getTargetCache(){return this.Vs}getRemoteDocumentCache(){return this.remoteDocumentCache}getBundleCache(){return this.Ds}runTransaction(e,t,r){w("MemoryPersistence","Starting transaction:",e);const s=new Gg(this.Ps.next());return this.referenceDelegate.Cs(),r(s).next(i=>this.referenceDelegate.xs(s).next(()=>i)).toPromise().then(i=>(s.raiseOnCommittedEvent(),i))}Ns(e,t){return f.or(Object.values(this.bs).map(r=>()=>r.containsKey(e,t)))}}class Gg extends Sc{constructor(e){super(),this.currentSequenceNumber=e}}class As{constructor(e){this.persistence=e,this.ks=new go,this.Os=null}static Ms(e){return new As(e)}get Fs(){if(this.Os)return this.Os;throw T()}addReference(e,t,r){return this.ks.addReference(r,t),this.Fs.delete(r.toString()),f.resolve()}removeReference(e,t,r){return this.ks.removeReference(r,t),this.Fs.add(r.toString()),f.resolve()}markPotentiallyOrphaned(e,t){return this.Fs.add(t.toString()),f.resolve()}removeTarget(e,t){this.ks.us(t.targetId).forEach(s=>this.Fs.add(s.toString()));const r=this.persistence.getTargetCache();return r.getMatchingKeysForTargetId(e,t.targetId).next(s=>{s.forEach(i=>this.Fs.add(i.toString()))}).next(()=>r.removeTargetData(e,t))}Cs(){this.Os=new Set}xs(e){const t=this.persistence.getRemoteDocumentCache().newChangeBuffer();return f.forEach(this.Fs,r=>{const s=I.fromPath(r);return this.$s(e,s).next(i=>{i||t.removeEntry(s,b.min())})}).next(()=>(this.Os=null,t.apply(e)))}updateLimboDocument(e,t){return this.$s(e,t).next(r=>{r?this.Fs.delete(t.toString()):this.Fs.add(t.toString())})}Ss(e){return 0}$s(e,t){return f.or([()=>f.resolve(this.ks.containsKey(t)),()=>this.persistence.getTargetCache().containsKey(e,t),()=>this.persistence.Ns(e,t)])}}class Kg{constructor(e){this.wt=e}O(e,t,r,s){const i=new cs("createOrUpgrade",t);var a;r<1&&s>=1&&(e.createObjectStore("owner"),(a=e).createObjectStore("mutationQueues",{keyPath:"userId"}),a.createObjectStore("mutations",{keyPath:"batchId",autoIncrement:!0}).createIndex("userMutationsIndex",kl,{unique:!0}),a.createObjectStore("documentMutations"),oh(e),function(a){a.createObjectStore("remoteDocuments")}(e));let o=f.resolve();return r<3&&s>=3&&(0!==r&&(function(a){a.deleteObjectStore("targetDocuments"),a.deleteObjectStore("targets"),a.deleteObjectStore("targetGlobal")}(e),oh(e)),o=o.next(()=>function(a){const u=a.store("targetGlobal"),c={highestTargetId:0,highestListenSequenceNumber:0,lastRemoteSnapshotVersion:b.min().toTimestamp(),targetCount:0};return u.put("targetGlobalKey",c)}(i))),r<4&&s>=4&&(0!==r&&(o=o.next(()=>function(a,u){return u.store("mutations").K().next(c=>{a.deleteObjectStore("mutations"),a.createObjectStore("mutations",{keyPath:"batchId",autoIncrement:!0}).createIndex("userMutationsIndex",kl,{unique:!0});const l=u.store("mutations"),h=c.map(d=>l.put(d));return f.waitFor(h)})}(e,i))),o=o.next(()=>{!function(a){a.createObjectStore("clientMetadata",{keyPath:"clientId"})}(e)})),r<5&&s>=5&&(o=o.next(()=>this.Bs(i))),r<6&&s>=6&&(o=o.next(()=>(function(a){a.createObjectStore("remoteDocumentGlobal")}(e),this.Ls(i)))),r<7&&s>=7&&(o=o.next(()=>this.Us(i))),r<8&&s>=8&&(o=o.next(()=>this.qs(e,i))),r<9&&s>=9&&(o=o.next(()=>{!function(a){a.objectStoreNames.contains("remoteDocumentChanges")&&a.deleteObjectStore("remoteDocumentChanges")}(e)})),r<10&&s>=10&&(o=o.next(()=>this.Ks(i))),r<11&&s>=11&&(o=o.next(()=>{(function(a){a.createObjectStore("bundles",{keyPath:"bundleId"})})(e),function(a){a.createObjectStore("namedQueries",{keyPath:"name"})}(e)})),r<12&&s>=12&&(o=o.next(()=>{!function(a){const u=a.createObjectStore("documentOverlays",{keyPath:mg});u.createIndex("collectionPathOverlayIndex",gg,{unique:!1}),u.createIndex("collectionGroupOverlayIndex",pg,{unique:!1})}(e)})),r<13&&s>=13&&(o=o.next(()=>function(a){const u=a.createObjectStore("remoteDocumentsV14",{keyPath:rg});u.createIndex("documentKeyIndex",sg),u.createIndex("collectionGroupIndex",ig)}(e)).next(()=>this.Gs(e,i)).next(()=>e.deleteObjectStore("remoteDocuments"))),r<14&&s>=14&&(o=o.next(()=>this.Qs(e,i))),r<15&&s>=15&&(o=o.next(()=>function(a){a.createObjectStore("indexConfiguration",{keyPath:"indexId",autoIncrement:!0}).createIndex("collectionGroupIndex","collectionGroup",{unique:!1}),a.createObjectStore("indexState",{keyPath:lg}).createIndex("sequenceNumberIndex",hg,{unique:!1}),a.createObjectStore("indexEntries",{keyPath:dg}).createIndex("documentKeyIndex",fg,{unique:!1})}(e))),o}Ls(e){let t=0;return e.store("remoteDocuments").J((r,s)=>{t+=Ss(s)}).next(()=>{const r={byteSize:t};return e.store("remoteDocumentGlobal").put("remoteDocumentGlobalKey",r)})}Bs(e){const t=e.store("mutationQueues"),r=e.store("mutations");return t.K().next(s=>f.forEach(s,i=>{const o=IDBKeyRange.bound([i.userId,-1],[i.userId,i.lastAcknowledgedBatchId]);return r.K("userMutationsIndex",o).next(a=>f.forEach(a,u=>{D(u.userId===i.userId);const c=Mt(this.wt,u);return Zl(e,i.userId,c).next(()=>{})}))}))}Us(e){const t=e.store("targetDocuments"),r=e.store("remoteDocuments");return e.store("targetGlobal").get("targetGlobalKey").next(s=>{const i=[];return r.J((o,a)=>{const u=new M(o),c=[0,xe(u)];i.push(t.get(c).next(l=>l?f.resolve():t.put({targetId:0,path:xe(u),sequenceNumber:s.highestListenSequenceNumber})))}).next(()=>f.waitFor(i))})}qs(e,t){e.createObjectStore("collectionParents",{keyPath:cg});const r=t.store("collectionParents"),s=new mo,i=o=>{if(s.add(o)){const a=o.lastSegment(),u=o.popLast();return r.put({collectionId:a,parent:xe(u)})}};return t.store("remoteDocuments").J({H:!0},(o,a)=>{const u=new M(o);return i(u.popLast())}).next(()=>t.store("documentMutations").J({H:!0},([o,a,u],c)=>{const l=Ue(a);return i(l.popLast())}))}Ks(e){const t=e.store("targets");return t.J((r,s)=>{const i=dr(s),o=Pl(this.wt,i);return t.put(o)})}Gs(e,t){const r=t.store("remoteDocuments"),s=[];return r.J((i,o)=>{const a=t.store("remoteDocumentsV14"),u=(c=o,c.document?new I(M.fromString(c.document.name).popFirst(5)):c.noDocument?I.fromSegments(c.noDocument.path):c.unknownDocument?I.fromSegments(c.unknownDocument.path):T()).path.toArray();var c;const l={prefixPath:u.slice(0,u.length-2),collectionGroup:u[u.length-2],documentId:u[u.length-1],readTime:o.readTime||[0,0],unknownDocument:o.unknownDocument,noDocument:o.noDocument,document:o.document,hasCommittedMutations:!!o.hasCommittedMutations};s.push(a.put(l))}).next(()=>f.waitFor(s))}Qs(e,t){const r=t.store("mutations"),s=eh(this.wt),i=new ih(As.Ms,this.wt.ne);return r.K().next(o=>{const a=new Map;return o.forEach(u=>{var c;let l=null!==(c=a.get(u.userId))&&void 0!==c?c:N();Mt(this.wt,u).keys().forEach(h=>l=l.add(h)),a.set(u.userId,l)}),f.forEach(a,(u,c)=>{const l=new ie(c),h=xs.se(this.wt,l),d=i.getIndexManager(l),g=bs.se(l,this.wt,d,i.referenceDelegate);return new sh(s,g,h,d).recalculateAndSaveOverlaysForDocumentKeys(new ao(t,Se.ot),u).next()})})}}function oh(n){n.createObjectStore("targetDocuments",{keyPath:ag}).createIndex("documentTargetsIndex",ug,{unique:!0}),n.createObjectStore("targets",{keyPath:"targetId"}).createIndex("queryTargetsIndex",og,{unique:!0}),n.createObjectStore("targetGlobal")}const po="Failed to obtain exclusive access to the persistence layer. To allow shared access, multi-tab synchronization has to be enabled in all tabs. If you are using `experimentalForceOwningTab:true`, make sure that only one tab has persistence enabled at any given time.";class yo{constructor(e,t,r,s,i,o,a,u,c,l,h=14){if(this.allowTabSynchronization=e,this.persistenceKey=t,this.clientId=r,this.js=i,this.window=o,this.document=a,this.Ws=c,this.zs=l,this.Hs=h,this.Ps=null,this.vs=!1,this.isPrimary=!1,this.networkEnabled=!0,this.Js=null,this.inForeground=!1,this.Ys=null,this.Xs=null,this.Zs=Number.NEGATIVE_INFINITY,this.ti=d=>Promise.resolve(),!yo.V())throw new v(m.UNIMPLEMENTED,"This platform is either missing IndexedDB or is known to have an incomplete implementation. Offline persistence has been disabled.");this.referenceDelegate=new Rg(this,s),this.ei=t+"main",this.wt=new Ol(u),this.ni=new Le(this.ei,this.Hs,new Kg(this.wt)),this.Vs=new Ag(this.referenceDelegate,this.wt),this.remoteDocumentCache=eh(this.wt),this.Ds=new Ig,this.window&&this.window.localStorage?this.si=this.window.localStorage:(this.si=null,!1===l&&J("IndexedDbPersistence","LocalStorage is unavailable. As a result, persistence may not work reliably. In particular enablePersistence() could fail immediately after refreshing the page."))}start(){return this.ii().then(()=>{if(!this.isPrimary&&!this.allowTabSynchronization)throw new v(m.FAILED_PRECONDITION,po);return this.ri(),this.oi(),this.ui(),this.runTransaction("getHighestListenSequenceNumber","readonly",e=>this.Vs.getHighestSequenceNumber(e))}).then(e=>{this.Ps=new Se(e,this.Ws)}).then(()=>{this.vs=!0}).catch(e=>(this.ni&&this.ni.close(),Promise.reject(e)))}ci(e){var t=this;return this.ti=function(){var r=(0,p.Z)(function*(s){if(t.started)return e(s)});return function(s){return r.apply(this,arguments)}}(),e(this.isPrimary)}setDatabaseDeletedListener(e){this.ni.F(function(){var t=(0,p.Z)(function*(r){null===r.newVersion&&(yield e())});return function(r){return t.apply(this,arguments)}}())}setNetworkEnabled(e){var t=this;this.networkEnabled!==e&&(this.networkEnabled=e,this.js.enqueueAndForget((0,p.Z)(function*(){t.started&&(yield t.ii())})))}ii(){return this.runTransaction("updateClientMetadataAndTryBecomePrimary","readwrite",e=>Cs(e).put({clientId:this.clientId,updateTimeMs:Date.now(),networkEnabled:this.networkEnabled,inForeground:this.inForeground}).next(()=>{if(this.isPrimary)return this.ai(e).next(t=>{t||(this.isPrimary=!1,this.js.enqueueRetryable(()=>this.ti(!1)))})}).next(()=>this.hi(e)).next(t=>this.isPrimary&&!t?this.li(e).next(()=>!1):!!t&&this.fi(e).next(()=>!0))).catch(e=>{if(tt(e))return w("IndexedDbPersistence","Failed to extend owner lease: ",e),this.isPrimary;if(!this.allowTabSynchronization)throw e;return w("IndexedDbPersistence","Releasing owner lease after error during lease refresh",e),!1}).then(e=>{this.isPrimary!==e&&this.js.enqueueRetryable(()=>this.ti(e)),this.isPrimary=e})}ai(e){return vr(e).get("owner").next(t=>f.resolve(this.di(t)))}_i(e){return Cs(e).delete(this.clientId)}wi(){var e=this;return(0,p.Z)(function*(){if(e.isPrimary&&!e.mi(e.Zs,18e5)){e.Zs=Date.now();const t=yield e.runTransaction("maybeGarbageCollectMultiClientState","readwrite-primary",r=>{const s=ue(r,"clientMetadata");return s.K().next(i=>{const o=e.gi(i,18e5),a=i.filter(u=>-1===o.indexOf(u));return f.forEach(a,u=>s.delete(u.clientId)).next(()=>a)})}).catch(()=>[]);if(e.si)for(const r of t)e.si.removeItem(e.yi(r.clientId))}})()}ui(){this.Xs=this.js.enqueueAfterDelay("client_metadata_refresh",4e3,()=>this.ii().then(()=>this.wi()).then(()=>this.ui()))}di(e){return!!e&&e.ownerId===this.clientId}hi(e){return this.zs?f.resolve(!0):vr(e).get("owner").next(t=>{if(null!==t&&this.mi(t.leaseTimestampMs,5e3)&&!this.pi(t.ownerId)){if(this.di(t)&&this.networkEnabled)return!0;if(!this.di(t)){if(!t.allowTabSynchronization)throw new v(m.FAILED_PRECONDITION,po);return!1}}return!(!this.networkEnabled||!this.inForeground)||Cs(e).K().next(r=>void 0===this.gi(r,5e3).find(s=>{if(this.clientId!==s.clientId){const o=!this.inForeground&&s.inForeground,a=this.networkEnabled===s.networkEnabled;if(!this.networkEnabled&&s.networkEnabled||o&&a)return!0}return!1}))}).next(t=>(this.isPrimary!==t&&w("IndexedDbPersistence",`Client ${t?"is":"is not"} eligible for a primary lease.`),t))}shutdown(){var e=this;return(0,p.Z)(function*(){e.vs=!1,e.Ii(),e.Xs&&(e.Xs.cancel(),e.Xs=null),e.Ti(),e.Ei(),yield e.ni.runTransaction("shutdown","readwrite",["owner","clientMetadata"],t=>{const r=new ao(t,Se.ot);return e.li(r).next(()=>e._i(r))}),e.ni.close(),e.Ai()})()}gi(e,t){return e.filter(r=>this.mi(r.updateTimeMs,t)&&!this.pi(r.clientId))}Ri(){return this.runTransaction("getActiveClients","readonly",e=>Cs(e).K().next(t=>this.gi(t,18e5).map(r=>r.clientId)))}get started(){return this.vs}getMutationQueue(e,t){return bs.se(e,this.wt,t,this.referenceDelegate)}getTargetCache(){return this.Vs}getRemoteDocumentCache(){return this.remoteDocumentCache}getIndexManager(e){return new Dg(e,this.wt.ne.databaseId)}getDocumentOverlayCache(e){return xs.se(this.wt,e)}getBundleCache(){return this.Ds}runTransaction(e,t,r){w("IndexedDbPersistence","Starting transaction:",e);const s="readonly"===t?"readonly":"readwrite",i=15===(o=this.Hs)?vg:14===o?Ll:13===o?Fl:12===o?yg:11===o?Ml:void T();var o;let a;return this.ni.runTransaction(e,s,i,u=>(a=new ao(u,this.Ps?this.Ps.next():Se.ot),"readwrite-primary"===t?this.ai(a).next(c=>!!c||this.hi(a)).next(c=>{if(!c)throw J(`Failed to obtain primary lease for action '${e}'.`),this.isPrimary=!1,this.js.enqueueRetryable(()=>this.ti(!1)),new v(m.FAILED_PRECONDITION,Tc);return r(a)}).next(c=>this.fi(a).next(()=>c)):this.bi(a).next(()=>r(a)))).then(u=>(a.raiseOnCommittedEvent(),u))}bi(e){return vr(e).get("owner").next(t=>{if(null!==t&&this.mi(t.leaseTimestampMs,5e3)&&!this.pi(t.ownerId)&&!this.di(t)&&!(this.zs||this.allowTabSynchronization&&t.allowTabSynchronization))throw new v(m.FAILED_PRECONDITION,po)})}fi(e){const t={ownerId:this.clientId,allowTabSynchronization:this.allowTabSynchronization,leaseTimestampMs:Date.now()};return vr(e).put("owner",t)}static V(){return Le.V()}li(e){const t=vr(e);return t.get("owner").next(r=>this.di(r)?(w("IndexedDbPersistence","Releasing primary lease."),t.delete("owner")):f.resolve())}mi(e,t){const r=Date.now();return!(e<r-t||e>r&&(J(`Detected an update time that is in the future: ${e} > ${r}`),1))}ri(){null!==this.document&&"function"==typeof this.document.addEventListener&&(this.Ys=()=>{this.js.enqueueAndForget(()=>(this.inForeground="visible"===this.document.visibilityState,this.ii()))},this.document.addEventListener("visibilitychange",this.Ys),this.inForeground="visible"===this.document.visibilityState)}Ti(){this.Ys&&(this.document.removeEventListener("visibilitychange",this.Ys),this.Ys=null)}oi(){var e;"function"==typeof(null===(e=this.window)||void 0===e?void 0:e.addEventListener)&&(this.Js=()=>{this.Ii(),(0,L.G6)()&&navigator.appVersion.match(/Version\/1[45]/)&&this.js.enterRestrictedMode(!0),this.js.enqueueAndForget(()=>this.shutdown())},this.window.addEventListener("pagehide",this.Js))}Ei(){this.Js&&(this.window.removeEventListener("pagehide",this.Js),this.Js=null)}pi(e){var t;try{const r=null!==(null===(t=this.si)||void 0===t?void 0:t.getItem(this.yi(e)));return w("IndexedDbPersistence",`Client '${e}' ${r?"is":"is not"} zombied in LocalStorage`),r}catch(r){return J("IndexedDbPersistence","Failed to get zombied client id.",r),!1}}Ii(){if(this.si)try{this.si.setItem(this.yi(this.clientId),String(Date.now()))}catch(e){J("Failed to set zombie client id.",e)}}Ai(){if(this.si)try{this.si.removeItem(this.yi(this.clientId))}catch{}}yi(e){return`firestore_zombie_${this.persistenceKey}_${e}`}}function vr(n){return ue(n,"owner")}function Cs(n){return ue(n,"clientMetadata")}function vo(n,e){let t=n.projectId;return n.isDefaultDatabase||(t+="."+n.database),"firestore/"+e+"/"+t+"/"}class wo{constructor(e,t,r,s){this.targetId=e,this.fromCache=t,this.Pi=r,this.vi=s}static Vi(e,t){let r=N(),s=N();for(const i of t.docChanges)switch(i.type){case 0:r=r.add(i.doc.key);break;case 1:s=s.add(i.doc.key)}return new wo(e,t.fromCache,r,s)}}class ah{constructor(){this.Si=!1}initialize(e,t){this.Di=e,this.indexManager=t,this.Si=!0}getDocumentsMatchingQuery(e,t,r,s){return this.Ci(e,t).next(i=>i||this.xi(e,t,s,r)).next(i=>i||this.Ni(e,t))}Ci(e,t){return f.resolve(null)}xi(e,t,r,s){return function Am(n){return 0===n.filters.length&&null===n.limit&&null==n.startAt&&null==n.endAt&&(0===n.explicitOrderBy.length||1===n.explicitOrderBy.length&&n.explicitOrderBy[0].field.isKeyField())}(t)||s.isEqual(b.min())?this.Ni(e,t):this.Di.getDocuments(e,r).next(i=>{const o=this.ki(t,i);return this.Oi(t,o,r,s)?this.Ni(e,t):(Ki()<=pt.in.DEBUG&&w("QueryEngine","Re-using previous result from %s to execute query: %s",s.toString(),to(t)),this.Mi(e,o,t,xc(s,-1)))})}ki(e,t){let r=new P(Hc(e));return t.forEach((s,i)=>{no(e,i)&&(r=r.add(i))}),r}Oi(e,t,r,s){if(null===e.limit)return!1;if(r.size!==t.size)return!0;const i="F"===e.limitType?t.last():t.first();return!!i&&(i.hasPendingWrites||i.version.compareTo(s)>0)}Ni(e,t){return Ki()<=pt.in.DEBUG&&w("QueryEngine","Using full collection scan to execute query:",to(t)),this.Di.getDocumentsMatchingQuery(e,t,Ce.min())}Mi(e,t,r,s){return this.Di.getDocumentsMatchingQuery(e,r,s).next(i=>(t.forEach(o=>{i=i.insert(o.key,o)}),i))}}class jg{constructor(e,t,r,s){this.persistence=e,this.Fi=t,this.wt=s,this.$i=new H(C),this.Bi=new ot(i=>At(i),er),this.Li=new Map,this.Ui=e.getRemoteDocumentCache(),this.Vs=e.getTargetCache(),this.Ds=e.getBundleCache(),this.qi(r)}qi(e){this.documentOverlayCache=this.persistence.getDocumentOverlayCache(e),this.indexManager=this.persistence.getIndexManager(e),this.mutationQueue=this.persistence.getMutationQueue(e,this.indexManager),this.localDocuments=new sh(this.Ui,this.mutationQueue,this.documentOverlayCache,this.indexManager),this.Ui.setIndexManager(this.indexManager),this.Fi.initialize(this.localDocuments,this.indexManager)}collectGarbage(e){return this.persistence.runTransaction("Collect garbage","readwrite-primary",t=>e.collect(t,this.$i))}}function uh(n,e,t,r){return new jg(n,e,t,r)}function ch(n,e){return Io.apply(this,arguments)}function Io(){return Io=(0,p.Z)(function*(n,e){const t=_(n);return yield t.persistence.runTransaction("Handle user change","readonly",r=>{let s;return t.mutationQueue.getAllMutationBatches(r).next(i=>(s=i,t.qi(e),t.mutationQueue.getAllMutationBatches(r))).next(i=>{const o=[],a=[];let u=N();for(const c of s){o.push(c.batchId);for(const l of c.mutations)u=u.add(l.key)}for(const c of i){a.push(c.batchId);for(const l of c.mutations)u=u.add(l.key)}return t.localDocuments.getDocuments(r,u).next(c=>({Ki:c,removedBatchIds:o,addedBatchIds:a}))})})}),Io.apply(this,arguments)}function $g(n,e){const t=_(n);return t.persistence.runTransaction("Acknowledge batch","readwrite-primary",r=>{const s=e.batch.keys(),i=t.Ui.newChangeBuffer({trackRemovals:!0});return function(o,a,u,c){const l=u.batch,h=l.keys();let d=f.resolve();return h.forEach(g=>{d=d.next(()=>c.getEntry(a,g)).next(y=>{const x=u.docVersions.get(g);D(null!==x),y.version.compareTo(x)<0&&(l.applyToRemoteDocument(y,u),y.isValidDocument()&&(y.setReadTime(u.commitVersion),c.addEntry(y)))})}),d.next(()=>o.mutationQueue.removeMutationBatch(a,l))}(t,r,e,i).next(()=>i.apply(r)).next(()=>t.mutationQueue.performConsistencyCheck(r)).next(()=>t.documentOverlayCache.removeOverlaysForBatchId(r,s,e.batch.batchId)).next(()=>t.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(r,function(o){let a=N();for(let u=0;u<o.mutationResults.length;++u)o.mutationResults[u].transformResults.length>0&&(a=a.add(o.batch.mutations[u].key));return a}(e))).next(()=>t.localDocuments.getDocuments(r,s))})}function lh(n){const e=_(n);return e.persistence.runTransaction("Get last remote snapshot version","readonly",t=>e.Vs.getLastRemoteSnapshotVersion(t))}function zg(n,e){const t=_(n),r=e.snapshotVersion;let s=t.$i;return t.persistence.runTransaction("Apply remote event","readwrite-primary",i=>{const o=t.Ui.newChangeBuffer({trackRemovals:!0});s=t.$i;const a=[];e.targetChanges.forEach((l,h)=>{const d=s.get(h);if(!d)return;a.push(t.Vs.removeMatchingKeys(i,l.removedDocuments,h).next(()=>t.Vs.addMatchingKeys(i,l.addedDocuments,h)));let g=d.withSequenceNumber(i.currentSequenceNumber);var y,x,S;e.targetMismatches.has(h)?g=g.withResumeToken(re.EMPTY_BYTE_STRING,b.min()).withLastLimboFreeSnapshotVersion(b.min()):l.resumeToken.approximateByteSize()>0&&(g=g.withResumeToken(l.resumeToken,r)),s=s.insert(h,g),x=g,S=l,(0===(y=d).resumeToken.approximateByteSize()||x.snapshotVersion.toMicroseconds()-y.snapshotVersion.toMicroseconds()>=3e8||S.addedDocuments.size+S.modifiedDocuments.size+S.removedDocuments.size>0)&&a.push(t.Vs.updateTargetData(i,g))});let u=be(),c=N();if(e.documentUpdates.forEach(l=>{e.resolvedLimboDocuments.has(l)&&a.push(t.persistence.referenceDelegate.updateLimboDocument(i,l))}),a.push(hh(i,o,e.documentUpdates).next(l=>{u=l.Gi,c=l.Qi})),!r.isEqual(b.min())){const l=t.Vs.getLastRemoteSnapshotVersion(i).next(h=>t.Vs.setTargetsMetadata(i,i.currentSequenceNumber,r));a.push(l)}return f.waitFor(a).next(()=>o.apply(i)).next(()=>t.localDocuments.getLocalViewOfDocuments(i,u,c)).next(()=>u)}).then(i=>(t.$i=s,i))}function hh(n,e,t){let r=N(),s=N();return t.forEach(i=>r=r.add(i)),e.getEntries(n,r).next(i=>{let o=be();return t.forEach((a,u)=>{const c=i.get(a);u.isFoundDocument()!==c.isFoundDocument()&&(s=s.add(a)),u.isNoDocument()&&u.version.isEqual(b.min())?(e.removeEntry(a,u.readTime),o=o.insert(a,u)):!c.isValidDocument()||u.version.compareTo(c.version)>0||0===u.version.compareTo(c.version)&&c.hasPendingWrites?(e.addEntry(u),o=o.insert(a,u)):w("LocalStore","Ignoring outdated watch update for ",a,". Current version:",c.version," Watch version:",u.version)}),{Gi:o,Qi:s}})}function Qg(n,e){const t=_(n);return t.persistence.runTransaction("Get next mutation batch","readonly",r=>(void 0===e&&(e=-1),t.mutationQueue.getNextMutationBatchAfterBatchId(r,e)))}function mn(n,e){const t=_(n);return t.persistence.runTransaction("Allocate target","readwrite",r=>{let s;return t.Vs.getTargetData(r,e).next(i=>i?(s=i,f.resolve(s)):t.Vs.allocateTargetId(r).next(o=>(s=new at(e,o,0,r.currentSequenceNumber),t.Vs.addTargetData(r,s).next(()=>s))))}).then(r=>{const s=t.$i.get(r.targetId);return(null===s||r.snapshotVersion.compareTo(s.snapshotVersion)>0)&&(t.$i=t.$i.insert(r.targetId,r),t.Bi.set(e,r.targetId)),r})}function gn(n,e,t){return _o.apply(this,arguments)}function _o(){return _o=(0,p.Z)(function*(n,e,t){const r=_(n),s=r.$i.get(e),i=t?"readwrite":"readwrite-primary";try{t||(yield r.persistence.runTransaction("Release target",i,o=>r.persistence.referenceDelegate.removeTarget(o,s)))}catch(o){if(!tt(o))throw o;w("LocalStore",`Failed to update sequence numbers for target ${e}: ${o}`)}r.$i=r.$i.remove(e),r.Bi.delete(s.target)}),_o.apply(this,arguments)}function Ns(n,e,t){const r=_(n);let s=b.min(),i=N();return r.persistence.runTransaction("Execute query","readonly",o=>function(a,u,c){const l=_(a),h=l.Bi.get(c);return void 0!==h?f.resolve(l.$i.get(h)):l.Vs.getTargetData(u,c)}(r,o,Me(e)).next(a=>{if(a)return s=a.lastLimboFreeSnapshotVersion,r.Vs.getMatchingKeysForTargetId(o,a.targetId).next(u=>{i=u})}).next(()=>r.Fi.getDocumentsMatchingQuery(o,e,t?s:b.min(),t?i:N())).next(a=>(mh(r,Zc(e),a),{documents:a,ji:i})))}function dh(n,e){const t=_(n),r=_(t.Vs),s=t.$i.get(e);return s?Promise.resolve(s.target):t.persistence.runTransaction("Get target data","readonly",i=>r.te(i,e).next(o=>o?o.target:null))}function fh(n,e){const t=_(n),r=t.Li.get(e)||b.min();return t.persistence.runTransaction("Get new document changes","readonly",s=>t.Ui.getAllFromCollectionGroup(s,e,xc(r,-1),Number.MAX_SAFE_INTEGER)).then(s=>(mh(t,e,s),s))}function mh(n,e,t){let r=b.min();t.forEach((s,i)=>{i.readTime.compareTo(r)>0&&(r=i.readTime)}),n.Li.set(e,r)}function xo(){return xo=(0,p.Z)(function*(n,e,t,r){const s=_(n);let i=N(),o=be();for(const c of t){const l=e.Wi(c.metadata.name);c.document&&(i=i.add(l));const h=e.zi(c);h.setReadTime(e.Hi(c.metadata.readTime)),o=o.insert(l,h)}const a=s.Ui.newChangeBuffer({trackRemovals:!0}),u=yield mn(s,(c=r,Me(rn(M.fromString(`__bundle__/docs/${c}`)))));var c;return s.persistence.runTransaction("Apply bundle documents","readwrite",c=>hh(c,a,o).next(l=>(a.apply(c),l)).next(l=>s.Vs.removeMatchingKeysForTargetId(c,u.targetId).next(()=>s.Vs.addMatchingKeys(c,i,u.targetId)).next(()=>s.localDocuments.getLocalViewOfDocuments(c,l.Gi,l.Qi)).next(()=>l.Gi)))}),xo.apply(this,arguments)}function Hg(n,e){return Eo.apply(this,arguments)}function Eo(){return Eo=(0,p.Z)(function*(n,e,t=N()){const r=yield mn(n,Me(ho(e.bundledQuery))),s=_(n);return s.persistence.runTransaction("Save named query","readwrite",i=>{const o=ae(e.readTime);if(r.snapshotVersion.compareTo(o)>=0)return s.Ds.saveNamedQuery(i,e);const a=r.withResumeToken(re.EMPTY_BYTE_STRING,o);return s.$i=s.$i.insert(a.targetId,a),s.Vs.updateTargetData(i,a).next(()=>s.Vs.removeMatchingKeysForTargetId(i,r.targetId)).next(()=>s.Vs.addMatchingKeys(i,t,r.targetId)).next(()=>s.Ds.saveNamedQuery(i,e))})}),Eo.apply(this,arguments)}function gh(n,e){return`firestore_clients_${n}_${e}`}function ph(n,e,t){let r=`firestore_mutations_${n}_${t}`;return e.isAuthenticated()&&(r+=`_${e.uid}`),r}function To(n,e){return`firestore_targets_${n}_${e}`}class ks{constructor(e,t,r,s){this.user=e,this.batchId=t,this.state=r,this.error=s}static Ji(e,t,r){const s=JSON.parse(r);let i,o="object"==typeof s&&-1!==["pending","acknowledged","rejected"].indexOf(s.state)&&(void 0===s.error||"object"==typeof s.error);return o&&s.error&&(o="string"==typeof s.error.message&&"string"==typeof s.error.code,o&&(i=new v(s.error.code,s.error.message))),o?new ks(e,t,s.state,i):(J("SharedClientState",`Failed to parse mutation state for ID '${t}': ${r}`),null)}Yi(){const e={state:this.state,updateTimeMs:Date.now()};return this.error&&(e.error={code:this.error.code,message:this.error.message}),JSON.stringify(e)}}class wr{constructor(e,t,r){this.targetId=e,this.state=t,this.error=r}static Ji(e,t){const r=JSON.parse(t);let s,i="object"==typeof r&&-1!==["not-current","current","rejected"].indexOf(r.state)&&(void 0===r.error||"object"==typeof r.error);return i&&r.error&&(i="string"==typeof r.error.message&&"string"==typeof r.error.code,i&&(s=new v(r.error.code,r.error.message))),i?new wr(e,r.state,s):(J("SharedClientState",`Failed to parse target state for ID '${e}': ${t}`),null)}Yi(){const e={state:this.state,updateTimeMs:Date.now()};return this.error&&(e.error={code:this.error.code,message:this.error.message}),JSON.stringify(e)}}class Rs{constructor(e,t){this.clientId=e,this.activeTargetIds=t}static Ji(e,t){const r=JSON.parse(t);let s="object"==typeof r&&r.activeTargetIds instanceof Array,i=vs();for(let o=0;s&&o<r.activeTargetIds.length;++o)s=kc(r.activeTargetIds[o]),i=i.add(r.activeTargetIds[o]);return s?new Rs(e,i):(J("SharedClientState",`Failed to parse client data for instance '${e}': ${t}`),null)}}class So{constructor(e,t){this.clientId=e,this.onlineState=t}static Ji(e){const t=JSON.parse(e);return"object"==typeof t&&-1!==["Unknown","Online","Offline"].indexOf(t.onlineState)&&"string"==typeof t.clientId?new So(t.clientId,t.onlineState):(J("SharedClientState",`Failed to parse online state: ${e}`),null)}}class bo{constructor(){this.activeTargetIds=vs()}Xi(e){this.activeTargetIds=this.activeTargetIds.add(e)}Zi(e){this.activeTargetIds=this.activeTargetIds.delete(e)}Yi(){const e={activeTargetIds:this.activeTargetIds.toArray(),updateTimeMs:Date.now()};return JSON.stringify(e)}}class Do{constructor(e,t,r,s,i){this.window=e,this.js=t,this.persistenceKey=r,this.tr=s,this.syncEngine=null,this.onlineStateHandler=null,this.sequenceNumberHandler=null,this.er=this.nr.bind(this),this.sr=new H(C),this.started=!1,this.ir=[];const o=r.replace(/[.*+?^${}()|[\]\\]/g,"\\$&");this.storage=this.window.localStorage,this.currentUser=i,this.rr=gh(this.persistenceKey,this.tr),this.ur=`firestore_sequence_number_${this.persistenceKey}`,this.sr=this.sr.insert(this.tr,new bo),this.cr=new RegExp(`^firestore_clients_${o}_([^_]*)$`),this.ar=new RegExp(`^firestore_mutations_${o}_(\\d+)(?:_(.*))?$`),this.hr=new RegExp(`^firestore_targets_${o}_(\\d+)$`),this.lr=`firestore_online_state_${this.persistenceKey}`,this.dr=function(a){return`firestore_bundle_loaded_v2_${a}`}(this.persistenceKey),this.window.addEventListener("storage",this.er)}static V(e){return!(!e||!e.localStorage)}start(){var e=this;return(0,p.Z)(function*(){const t=yield e.syncEngine.Ri();for(const s of t){if(s===e.tr)continue;const i=e.getItem(gh(e.persistenceKey,s));if(i){const o=Rs.Ji(s,i);o&&(e.sr=e.sr.insert(o.clientId,o))}}e._r();const r=e.storage.getItem(e.lr);if(r){const s=e.wr(r);s&&e.mr(s)}for(const s of e.ir)e.nr(s);e.ir=[],e.window.addEventListener("pagehide",()=>e.shutdown()),e.started=!0})()}writeSequenceNumber(e){this.setItem(this.ur,JSON.stringify(e))}getAllActiveQueryTargets(){return this.gr(this.sr)}isActiveQueryTarget(e){let t=!1;return this.sr.forEach((r,s)=>{s.activeTargetIds.has(e)&&(t=!0)}),t}addPendingMutation(e){this.yr(e,"pending")}updateMutationState(e,t,r){this.yr(e,t,r),this.pr(e)}addLocalQueryTarget(e){let t="not-current";if(this.isActiveQueryTarget(e)){const r=this.storage.getItem(To(this.persistenceKey,e));if(r){const s=wr.Ji(e,r);s&&(t=s.state)}}return this.Ir.Xi(e),this._r(),t}removeLocalQueryTarget(e){this.Ir.Zi(e),this._r()}isLocalQueryTarget(e){return this.Ir.activeTargetIds.has(e)}clearQueryState(e){this.removeItem(To(this.persistenceKey,e))}updateQueryState(e,t,r){this.Tr(e,t,r)}handleUserChange(e,t,r){t.forEach(s=>{this.pr(s)}),this.currentUser=e,r.forEach(s=>{this.addPendingMutation(s)})}setOnlineState(e){this.Er(e)}notifyBundleLoaded(e){this.Ar(e)}shutdown(){this.started&&(this.window.removeEventListener("storage",this.er),this.removeItem(this.rr),this.started=!1)}getItem(e){const t=this.storage.getItem(e);return w("SharedClientState","READ",e,t),t}setItem(e,t){w("SharedClientState","SET",e,t),this.storage.setItem(e,t)}removeItem(e){w("SharedClientState","REMOVE",e),this.storage.removeItem(e)}nr(e){var t=this;const r=e;if(r.storageArea===this.storage){if(w("SharedClientState","EVENT",r.key,r.newValue),r.key===this.rr)return void J("Received WebStorage notification for local change. Another client might have garbage-collected our state");this.js.enqueueRetryable((0,p.Z)(function*(){if(t.started){if(null!==r.key)if(t.cr.test(r.key)){if(null==r.newValue){const s=t.Rr(r.key);return t.br(s,null)}{const s=t.Pr(r.key,r.newValue);if(s)return t.br(s.clientId,s)}}else if(t.ar.test(r.key)){if(null!==r.newValue){const s=t.vr(r.key,r.newValue);if(s)return t.Vr(s)}}else if(t.hr.test(r.key)){if(null!==r.newValue){const s=t.Sr(r.key,r.newValue);if(s)return t.Dr(s)}}else if(r.key===t.lr){if(null!==r.newValue){const s=t.wr(r.newValue);if(s)return t.mr(s)}}else if(r.key===t.ur){const s=function(i){let o=Se.ot;if(null!=i)try{const a=JSON.parse(i);D("number"==typeof a),o=a}catch(a){J("SharedClientState","Failed to read sequence number from WebStorage",a)}return o}(r.newValue);s!==Se.ot&&t.sequenceNumberHandler(s)}else if(r.key===t.dr){const s=t.Cr(r.newValue);yield Promise.all(s.map(i=>t.syncEngine.Nr(i)))}}else t.ir.push(r)}))}}get Ir(){return this.sr.get(this.tr)}_r(){this.setItem(this.rr,this.Ir.Yi())}yr(e,t,r){const s=new ks(this.currentUser,e,t,r),i=ph(this.persistenceKey,this.currentUser,e);this.setItem(i,s.Yi())}pr(e){const t=ph(this.persistenceKey,this.currentUser,e);this.removeItem(t)}Er(e){this.storage.setItem(this.lr,JSON.stringify({clientId:this.tr,onlineState:e}))}Tr(e,t,r){const s=To(this.persistenceKey,e),i=new wr(e,t,r);this.setItem(s,i.Yi())}Ar(e){const t=JSON.stringify(Array.from(e));this.setItem(this.dr,t)}Rr(e){const t=this.cr.exec(e);return t?t[1]:null}Pr(e,t){const r=this.Rr(e);return Rs.Ji(r,t)}vr(e,t){const r=this.ar.exec(e),s=Number(r[1]);return ks.Ji(new ie(void 0!==r[2]?r[2]:null),s,t)}Sr(e,t){const r=this.hr.exec(e),s=Number(r[1]);return wr.Ji(s,t)}wr(e){return So.Ji(e)}Cr(e){return JSON.parse(e)}Vr(e){var t=this;return(0,p.Z)(function*(){if(e.user.uid===t.currentUser.uid)return t.syncEngine.kr(e.batchId,e.state,e.error);w("SharedClientState",`Ignoring mutation for non-active user ${e.user.uid}`)})()}Dr(e){return this.syncEngine.Or(e.targetId,e.state,e.error)}br(e,t){const r=t?this.sr.insert(e,t):this.sr.remove(e),s=this.gr(this.sr),i=this.gr(r),o=[],a=[];return i.forEach(u=>{s.has(u)||o.push(u)}),s.forEach(u=>{i.has(u)||a.push(u)}),this.syncEngine.Mr(o,a).then(()=>{this.sr=r})}mr(e){this.sr.get(e.clientId)&&this.onlineStateHandler(e.onlineState)}gr(e){let t=vs();return e.forEach((r,s)=>{t=t.unionWith(s.activeTargetIds)}),t}}class yh{constructor(){this.Fr=new bo,this.$r={},this.onlineStateHandler=null,this.sequenceNumberHandler=null}addPendingMutation(e){}updateMutationState(e,t,r){}addLocalQueryTarget(e){return this.Fr.Xi(e),this.$r[e]||"not-current"}updateQueryState(e,t,r){this.$r[e]=t}removeLocalQueryTarget(e){this.Fr.Zi(e)}isLocalQueryTarget(e){return this.Fr.activeTargetIds.has(e)}clearQueryState(e){delete this.$r[e]}getAllActiveQueryTargets(){return this.Fr.activeTargetIds}isActiveQueryTarget(e){return this.Fr.activeTargetIds.has(e)}start(){return this.Fr=new bo,Promise.resolve()}handleUserChange(e,t,r){}setOnlineState(e){}shutdown(){}writeSequenceNumber(e){}notifyBundleLoaded(e){}}class Wg{Br(e){}shutdown(){}}class vh{constructor(){this.Lr=()=>this.Ur(),this.qr=()=>this.Kr(),this.Gr=[],this.Qr()}Br(e){this.Gr.push(e)}shutdown(){window.removeEventListener("online",this.Lr),window.removeEventListener("offline",this.qr)}Qr(){window.addEventListener("online",this.Lr),window.addEventListener("offline",this.qr)}Ur(){w("ConnectivityMonitor","Network connectivity changed: AVAILABLE");for(const e of this.Gr)e(0)}Kr(){w("ConnectivityMonitor","Network connectivity changed: UNAVAILABLE");for(const e of this.Gr)e(1)}static V(){return typeof window<"u"&&void 0!==window.addEventListener&&void 0!==window.removeEventListener}}const Xg={BatchGetDocuments:"batchGet",Commit:"commit",RunQuery:"runQuery"};class Yg{constructor(e){this.jr=e.jr,this.Wr=e.Wr}zr(e){this.Hr=e}Jr(e){this.Yr=e}onMessage(e){this.Xr=e}close(){this.Wr()}send(e){this.jr(e)}Zr(){this.Hr()}eo(e){this.Yr(e)}no(e){this.Xr(e)}}class Jg extends class{constructor(e){this.databaseInfo=e,this.databaseId=e.databaseId,this.so=(e.ssl?"https":"http")+"://"+e.host,this.io="projects/"+this.databaseId.projectId+"/databases/"+this.databaseId.database+"/documents"}ro(e,t,r,s,i){const o=this.oo(e,t);w("RestConnection","Sending: ",o,r);const a={};return this.uo(a,s,i),this.co(e,o,a,r).then(u=>(w("RestConnection","Received: ",u),u),u=>{throw jn("RestConnection",`${e} failed with error: `,u,"url: ",o,"request:",r),u})}ao(e,t,r,s,i,o){return this.ro(e,t,r,s,i)}uo(e,t,r){e["X-Goog-Api-Client"]="gl-js/ fire/"+Yt,e["Content-Type"]="text/plain",this.databaseInfo.appId&&(e["X-Firebase-GMPID"]=this.databaseInfo.appId),t&&t.headers.forEach((s,i)=>e[i]=s),r&&r.headers.forEach((s,i)=>e[i]=s)}oo(e,t){return`${this.so}/v1/${t}:${Xg[e]}`}}{constructor(e){super(e),this.forceLongPolling=e.forceLongPolling,this.autoDetectLongPolling=e.autoDetectLongPolling,this.useFetchStreams=e.useFetchStreams}co(e,t,r,s){return new Promise((i,o)=>{const a=new Yf;a.listenOnce(Hf.COMPLETE,()=>{try{switch(a.getLastErrorCode()){case Gi.NO_ERROR:const c=a.getResponseJson();w("Connection","XHR received:",JSON.stringify(c)),i(c);break;case Gi.TIMEOUT:w("Connection",'RPC "'+e+'" timed out'),o(new v(m.DEADLINE_EXCEEDED,"Request time out"));break;case Gi.HTTP_ERROR:const l=a.getStatus();if(w("Connection",'RPC "'+e+'" failed with status:',l,"response text:",a.getResponseText()),l>0){const h=a.getResponseJson().error;if(h&&h.status&&h.message){const d=function(g){const y=g.toLowerCase().replace(/_/g,"-");return Object.values(m).indexOf(y)>=0?y:m.UNKNOWN}(h.status);o(new v(d,h.message))}else o(new v(m.UNKNOWN,"Server responded with status "+a.getStatus()))}else o(new v(m.UNAVAILABLE,"Connection failed."));break;default:T()}}finally{w("Connection",'RPC "'+e+'" completed.')}});const u=JSON.stringify(s);a.send(t,"POST",u,r,15)})}ho(e,t,r){const s=[this.so,"/","google.firestore.v1.Firestore","/",e,"/channel"],i=Qf(),o=Zf(),a={httpSessionIdParam:"gsessionid",initMessageHeaders:{},messageUrlParams:{database:`projects/${this.databaseId.projectId}/databases/${this.databaseId.database}`},sendRawJson:!0,supportsCrossDomainXhr:!0,internalChannelParams:{forwardChannelRequestTimeoutMs:6e5},forceLongPolling:this.forceLongPolling,detectBufferingProxy:this.autoDetectLongPolling};this.useFetchStreams&&(a.xmlHttpFactory=new Xf({})),this.uo(a.initMessageHeaders,t,r),(0,L.uI)()||(0,L.b$)()||(0,L.d)()||(0,L.w1)()||(0,L.Mn)()||(0,L.ru)()||(a.httpHeadersOverwriteParam="$httpHeaders");const u=s.join("");w("Connection","Creating WebChannel: "+u,a);const c=i.createWebChannel(u,a);let l=!1,h=!1;const d=new Yg({jr:y=>{h?w("Connection","Not sending because WebChannel is closed:",y):(l||(w("Connection","Opening WebChannel transport."),c.open(),l=!0),w("Connection","WebChannel sending:",y),c.send(y))},Wr:()=>c.close()}),g=(y,x,S)=>{y.listen(x,V=>{try{S(V)}catch(G){setTimeout(()=>{throw G},0)}})};return g(c,os.EventType.OPEN,()=>{h||w("Connection","WebChannel transport opened.")}),g(c,os.EventType.CLOSE,()=>{h||(h=!0,w("Connection","WebChannel transport closed"),d.eo())}),g(c,os.EventType.ERROR,y=>{h||(h=!0,jn("Connection","WebChannel transport errored:",y),d.eo(new v(m.UNAVAILABLE,"The operation could not be completed")))}),g(c,os.EventType.MESSAGE,y=>{var x;if(!h){const S=y.data[0];D(!!S);const V=S,G=V.error||(null===(x=V[0])||void 0===x?void 0:x.error);if(G){w("Connection","WebChannel received error:",G);const U=G.status;let ne=function(Z){const ve=ee[Z];if(void 0!==ve)return ll(ve)}(U),K=G.message;void 0===ne&&(ne=m.INTERNAL,K="Unknown error status: "+U+" with message "+G.message),h=!0,d.eo(new v(ne,K)),c.close()}else w("Connection","WebChannel received:",S),d.no(S)}}),g(o,Wf.STAT_EVENT,y=>{y.stat===pc.PROXY?w("Connection","Detected buffering proxy"):y.stat===pc.NOPROXY&&w("Connection","Detected no buffering proxy")}),setTimeout(()=>{d.Zr()},0),d}}function wh(){return typeof window<"u"?window:null}function Ms(){return typeof document<"u"?document:null}function Ir(n){return new jm(n,!0)}class Ao{constructor(e,t,r=1e3,s=1.5,i=6e4){this.js=e,this.timerId=t,this.lo=r,this.fo=s,this._o=i,this.wo=0,this.mo=null,this.yo=Date.now(),this.reset()}reset(){this.wo=0}po(){this.wo=this._o}Io(e){this.cancel();const t=Math.floor(this.wo+this.To()),r=Math.max(0,Date.now()-this.yo),s=Math.max(0,t-r);s>0&&w("ExponentialBackoff",`Backing off for ${s} ms (base delay: ${this.wo} ms, delay with jitter: ${t} ms, last attempt: ${r} ms ago)`),this.mo=this.js.enqueueAfterDelay(this.timerId,s,()=>(this.yo=Date.now(),e())),this.wo*=this.fo,this.wo<this.lo&&(this.wo=this.lo),this.wo>this._o&&(this.wo=this._o)}Eo(){null!==this.mo&&(this.mo.skipDelay(),this.mo=null)}cancel(){null!==this.mo&&(this.mo.cancel(),this.mo=null)}To(){return(Math.random()-.5)*this.wo}}class Ih{constructor(e,t,r,s,i,o,a,u){this.js=e,this.Ao=r,this.Ro=s,this.bo=i,this.authCredentialsProvider=o,this.appCheckCredentialsProvider=a,this.listener=u,this.state=0,this.Po=0,this.vo=null,this.Vo=null,this.stream=null,this.So=new Ao(e,t)}Do(){return 1===this.state||5===this.state||this.Co()}Co(){return 2===this.state||3===this.state}start(){4!==this.state?this.auth():this.xo()}stop(){var e=this;return(0,p.Z)(function*(){e.Do()&&(yield e.close(0))})()}No(){this.state=0,this.So.reset()}ko(){this.Co()&&null===this.vo&&(this.vo=this.js.enqueueAfterDelay(this.Ao,6e4,()=>this.Oo()))}Mo(e){this.Fo(),this.stream.send(e)}Oo(){var e=this;return(0,p.Z)(function*(){if(e.Co())return e.close(0)})()}Fo(){this.vo&&(this.vo.cancel(),this.vo=null)}$o(){this.Vo&&(this.Vo.cancel(),this.Vo=null)}close(e,t){var r=this;return(0,p.Z)(function*(){r.Fo(),r.$o(),r.So.cancel(),r.Po++,4!==e?r.So.reset():t&&t.code===m.RESOURCE_EXHAUSTED?(J(t.toString()),J("Using maximum backoff delay to prevent overloading the backend."),r.So.po()):t&&t.code===m.UNAUTHENTICATED&&3!==r.state&&(r.authCredentialsProvider.invalidateToken(),r.appCheckCredentialsProvider.invalidateToken()),null!==r.stream&&(r.Bo(),r.stream.close(),r.stream=null),r.state=e,yield r.listener.Jr(t)})()}Bo(){}auth(){this.state=1;const e=this.Lo(this.Po),t=this.Po;Promise.all([this.authCredentialsProvider.getToken(),this.appCheckCredentialsProvider.getToken()]).then(([r,s])=>{this.Po===t&&this.Uo(r,s)},r=>{e(()=>{const s=new v(m.UNKNOWN,"Fetching auth token failed: "+r.message);return this.qo(s)})})}Uo(e,t){const r=this.Lo(this.Po);this.stream=this.Ko(e,t),this.stream.zr(()=>{r(()=>(this.state=2,this.Vo=this.js.enqueueAfterDelay(this.Ro,1e4,()=>(this.Co()&&(this.state=3),Promise.resolve())),this.listener.zr()))}),this.stream.Jr(s=>{r(()=>this.qo(s))}),this.stream.onMessage(s=>{r(()=>this.onMessage(s))})}xo(){var e=this;this.state=5,this.So.Io((0,p.Z)(function*(){e.state=0,e.start()}))}qo(e){return w("PersistentStream",`close with error: ${e}`),this.stream=null,this.close(4,e)}Lo(e){return t=>{this.js.enqueueAndForget(()=>this.Po===e?t():(w("PersistentStream","stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve()))}}}class ep extends Ih{constructor(e,t,r,s,i,o){super(e,"listen_stream_connection_backoff","listen_stream_idle","health_check_timeout",t,r,s,o),this.wt=i}Ko(e,t){return this.bo.ho("Listen",e,t)}onMessage(e){this.So.reset();const t=function Qm(n,e){let t;if("targetChange"in e){const r="NO_CHANGE"===(u=e.targetChange.targetChangeType||"NO_CHANGE")?0:"ADD"===u?1:"REMOVE"===u?2:"CURRENT"===u?3:"RESET"===u?4:T(),s=e.targetChange.targetIds||[],i=function(u,c){return u.dt?(D(void 0===c||"string"==typeof c),re.fromBase64String(c||"")):(D(void 0===c||c instanceof Uint8Array),re.fromUint8Array(c||new Uint8Array))}(n,e.targetChange.resumeToken),o=e.targetChange.cause,a=o&&function(u){const c=void 0===u.code?m.UNKNOWN:ll(u.code);return new v(c,u.message||"")}(o);t=new gl(r,s,i,a||null)}else if("documentChange"in e){const r=e.documentChange,s=Pe(n,r.document.name),i=ae(r.document.updateTime),o=new me({mapValue:{fields:r.document.fields}}),a=B.newFoundDocument(s,i,o);t=new ws(r.targetIds||[],r.removedTargetIds||[],a.key,a)}else if("documentDelete"in e){const r=e.documentDelete,s=Pe(n,r.document),i=r.readTime?ae(r.readTime):b.min(),o=B.newNoDocument(s,i);t=new ws([],r.removedTargetIds||[],o.key,o)}else if("documentRemove"in e){const r=e.documentRemove,s=Pe(n,r.document);t=new ws([],r.removedTargetIds||[],s,null)}else{if(!("filter"in e))return T();{const r=e.filter,i=new Om(r.count||0);t=new ml(r.targetId,i)}}var u;return t}(this.wt,e),r=function(s){if(!("targetChange"in s))return b.min();const i=s.targetChange;return i.targetIds&&i.targetIds.length?b.min():i.readTime?ae(i.readTime):b.min()}(e);return this.listener.Go(t,r)}Qo(e){const t={};t.database=lr(this.wt),t.addTarget=function(s,i){let o;const a=i.target;return o=fs(a)?{documents:Sl(s,a)}:{query:bl(s,a)},o.targetId=i.targetId,i.resumeToken.approximateByteSize()>0?o.resumeToken=wl(s,i.resumeToken):i.snapshotVersion.compareTo(b.min())>0&&(o.readTime=ur(s,i.snapshotVersion.toTimestamp())),o}(this.wt,e);const r=function Hm(n,e){const t=function(r,s){switch(s){case 0:return null;case 1:return"existence-filter-mismatch";case 2:return"limbo-document";default:return T()}}(0,e.purpose);return null==t?null:{"goog-listen-tags":t}}(0,e);r&&(t.labels=r),this.Mo(t)}jo(e){const t={};t.database=lr(this.wt),t.removeTarget=e,this.Mo(t)}}class tp extends Ih{constructor(e,t,r,s,i,o){super(e,"write_stream_connection_backoff","write_stream_idle","health_check_timeout",t,r,s,o),this.wt=i,this.Wo=!1}get zo(){return this.Wo}start(){this.Wo=!1,this.lastStreamToken=void 0,super.start()}Bo(){this.Wo&&this.Ho([])}Ko(e,t){return this.bo.ho("Write",e,t)}onMessage(e){if(D(!!e.streamToken),this.lastStreamToken=e.streamToken,this.Wo){this.So.reset();const t=function Zm(n,e){return n&&n.length>0?(D(void 0!==e),n.map(t=>function(r,s){let i=ae(r.updateTime?r.updateTime:s);return i.isEqual(b.min())&&(i=ae(s)),new Mm(i,r.transformResults||[])}(t,e))):[]}(e.writeResults,e.commitTime),r=ae(e.commitTime);return this.listener.Jo(r,t)}return D(!e.writeResults||0===e.writeResults.length),this.Wo=!0,this.listener.Yo()}Xo(){const e={};e.database=lr(this.wt),this.Mo(e)}Ho(e){const t={streamToken:this.lastStreamToken,writes:e.map(r=>hr(this.wt,r))};this.Mo(t)}}class np extends class{}{constructor(e,t,r,s){super(),this.authCredentials=e,this.appCheckCredentials=t,this.bo=r,this.wt=s,this.Zo=!1}tu(){if(this.Zo)throw new v(m.FAILED_PRECONDITION,"The client has already been terminated.")}ro(e,t,r){return this.tu(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([s,i])=>this.bo.ro(e,t,r,s,i)).catch(s=>{throw"FirebaseError"===s.name?(s.code===m.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),s):new v(m.UNKNOWN,s.toString())})}ao(e,t,r,s){return this.tu(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([i,o])=>this.bo.ao(e,t,r,i,o,s)).catch(i=>{throw"FirebaseError"===i.name?(i.code===m.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),i):new v(m.UNKNOWN,i.toString())})}terminate(){this.Zo=!0}}class rp{constructor(e,t){this.asyncQueue=e,this.onlineStateHandler=t,this.state="Unknown",this.eu=0,this.nu=null,this.su=!0}iu(){0===this.eu&&(this.ru("Unknown"),this.nu=this.asyncQueue.enqueueAfterDelay("online_state_timeout",1e4,()=>(this.nu=null,this.ou("Backend didn't respond within 10 seconds."),this.ru("Offline"),Promise.resolve())))}uu(e){"Online"===this.state?this.ru("Unknown"):(this.eu++,this.eu>=1&&(this.cu(),this.ou(`Connection failed 1 times. Most recent error: ${e.toString()}`),this.ru("Offline")))}set(e){this.cu(),this.eu=0,"Online"===e&&(this.su=!1),this.ru(e)}ru(e){e!==this.state&&(this.state=e,this.onlineStateHandler(e))}ou(e){const t=`Could not reach Cloud Firestore backend. ${e}\nThis typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.`;this.su?(J(t),this.su=!1):w("OnlineStateTracker",t)}cu(){null!==this.nu&&(this.nu.cancel(),this.nu=null)}}class sp{constructor(e,t,r,s,i){var o=this;this.localStore=e,this.datastore=t,this.asyncQueue=r,this.remoteSyncer={},this.au=[],this.hu=new Map,this.lu=new Set,this.fu=[],this.du=i,this.du.Br(a=>{r.enqueueAndForget((0,p.Z)(function*(){var u;lt(o)&&(w("RemoteStore","Restarting streams for network reachability change."),yield(u=(0,p.Z)(function*(c){const l=_(c);l.lu.add(4),yield pn(l),l._u.set("Unknown"),l.lu.delete(4),yield _r(l)}),function(c){return u.apply(this,arguments)})(o))}))}),this._u=new rp(r,s)}}function _r(n){return Co.apply(this,arguments)}function Co(){return Co=(0,p.Z)(function*(n){if(lt(n))for(const e of n.fu)yield e(!0)}),Co.apply(this,arguments)}function pn(n){return No.apply(this,arguments)}function No(){return No=(0,p.Z)(function*(n){for(const e of n.fu)yield e(!1)}),No.apply(this,arguments)}function Fs(n,e){const t=_(n);t.hu.has(e.targetId)||(t.hu.set(e.targetId,e),Mo(t)?Ro(t):vn(t).Co()&&ko(t,e))}function xr(n,e){const t=_(n),r=vn(t);t.hu.delete(e),r.Co()&&_h(t,e),0===t.hu.size&&(r.Co()?r.ko():lt(t)&&t._u.set("Unknown"))}function ko(n,e){n.wu.Nt(e.targetId),vn(n).Qo(e)}function _h(n,e){n.wu.Nt(e),vn(n).jo(e)}function Ro(n){n.wu=new qm({getRemoteKeysForTarget:e=>n.remoteSyncer.getRemoteKeysForTarget(e),te:e=>n.hu.get(e)||null}),vn(n).start(),n._u.iu()}function Mo(n){return lt(n)&&!vn(n).Do()&&n.hu.size>0}function lt(n){return 0===_(n).lu.size}function xh(n){n.wu=void 0}function ip(n){return Fo.apply(this,arguments)}function Fo(){return Fo=(0,p.Z)(function*(n){n.hu.forEach((e,t)=>{ko(n,e)})}),Fo.apply(this,arguments)}function op(n,e){return Lo.apply(this,arguments)}function Lo(){return Lo=(0,p.Z)(function*(n,e){xh(n),Mo(n)?(n._u.uu(e),Ro(n)):n._u.set("Unknown")}),Lo.apply(this,arguments)}function ap(n,e,t){return Oo.apply(this,arguments)}function Oo(){return Oo=(0,p.Z)(function*(n,e,t){if(n._u.set("Online"),e instanceof gl&&2===e.state&&e.cause)try{yield(r=(0,p.Z)(function*(s,i){const o=i.cause;for(const a of i.targetIds)s.hu.has(a)&&(yield s.remoteSyncer.rejectListen(a,o),s.hu.delete(a),s.wu.removeTarget(a))}),function(s,i){return r.apply(this,arguments)})(n,e)}catch(r){w("RemoteStore","Failed to remove targets %s: %s ",e.targetIds.join(","),r),yield Ls(n,r)}else if(e instanceof ws?n.wu.Ut(e):e instanceof ml?n.wu.zt(e):n.wu.Gt(e),!t.isEqual(b.min()))try{const r=yield lh(n.localStore);t.compareTo(r)>=0&&(yield function(s,i){const o=s.wu.Yt(i);return o.targetChanges.forEach((a,u)=>{if(a.resumeToken.approximateByteSize()>0){const c=s.hu.get(u);c&&s.hu.set(u,c.withResumeToken(a.resumeToken,i))}}),o.targetMismatches.forEach(a=>{const u=s.hu.get(a);if(!u)return;s.hu.set(a,u.withResumeToken(re.EMPTY_BYTE_STRING,u.snapshotVersion)),_h(s,a);const c=new at(u.target,a,1,u.sequenceNumber);ko(s,c)}),s.remoteSyncer.applyRemoteEvent(o)}(n,t))}catch(r){w("RemoteStore","Failed to raise snapshot:",r),yield Ls(n,r)}var r}),Oo.apply(this,arguments)}function Ls(n,e,t){return Vo.apply(this,arguments)}function Vo(){return Vo=(0,p.Z)(function*(n,e,t){if(!tt(e))throw e;n.lu.add(1),yield pn(n),n._u.set("Offline"),t||(t=()=>lh(n.localStore)),n.asyncQueue.enqueueRetryable((0,p.Z)(function*(){w("RemoteStore","Retrying IndexedDB access"),yield t(),n.lu.delete(1),yield _r(n)}))}),Vo.apply(this,arguments)}function Eh(n,e){return e().catch(t=>Ls(n,t,e))}function yn(n){return Po.apply(this,arguments)}function Po(){return Po=(0,p.Z)(function*(n){const e=_(n),t=ht(e);let r=e.au.length>0?e.au[e.au.length-1].batchId:-1;for(;up(e);)try{const s=yield Qg(e.localStore,r);if(null===s){0===e.au.length&&t.ko();break}r=s.batchId,cp(e,s)}catch(s){yield Ls(e,s)}Th(e)&&Sh(e)}),Po.apply(this,arguments)}function up(n){return lt(n)&&n.au.length<10}function cp(n,e){n.au.push(e);const t=ht(n);t.Co()&&t.zo&&t.Ho(e.mutations)}function Th(n){return lt(n)&&!ht(n).Do()&&n.au.length>0}function Sh(n){ht(n).start()}function lp(n){return Uo.apply(this,arguments)}function Uo(){return Uo=(0,p.Z)(function*(n){ht(n).Xo()}),Uo.apply(this,arguments)}function hp(n){return Bo.apply(this,arguments)}function Bo(){return Bo=(0,p.Z)(function*(n){const e=ht(n);for(const t of n.au)e.Ho(t.mutations)}),Bo.apply(this,arguments)}function dp(n,e,t){return qo.apply(this,arguments)}function qo(){return qo=(0,p.Z)(function*(n,e,t){const r=n.au.shift(),s=co.from(r,e,t);yield Eh(n,()=>n.remoteSyncer.applySuccessfulWrite(s)),yield yn(n)}),qo.apply(this,arguments)}function fp(n,e){return Go.apply(this,arguments)}function Go(){return Go=(0,p.Z)(function*(n,e){var t;e&&ht(n).zo&&(yield(t=(0,p.Z)(function*(r,s){if(cl(i=s.code)&&i!==m.ABORTED){const o=r.au.shift();ht(r).No(),yield Eh(r,()=>r.remoteSyncer.rejectFailedWrite(o.batchId,s)),yield yn(r)}var i}),function(r,s){return t.apply(this,arguments)})(n,e)),Th(n)&&Sh(n)}),Go.apply(this,arguments)}function bh(n,e){return Ko.apply(this,arguments)}function Ko(){return Ko=(0,p.Z)(function*(n,e){const t=_(n);t.asyncQueue.verifyOperationInProgress(),w("RemoteStore","RemoteStore received new credentials");const r=lt(t);t.lu.add(3),yield pn(t),r&&t._u.set("Unknown"),yield t.remoteSyncer.handleCredentialChange(e),t.lu.delete(3),yield _r(t)}),Ko.apply(this,arguments)}function jo(n,e){return $o.apply(this,arguments)}function $o(){return $o=(0,p.Z)(function*(n,e){const t=_(n);e?(t.lu.delete(2),yield _r(t)):e||(t.lu.add(2),yield pn(t),t._u.set("Unknown"))}),$o.apply(this,arguments)}function vn(n){return n.mu||(n.mu=function(e,t,r){const s=_(e);return s.tu(),new ep(t,s.bo,s.authCredentials,s.appCheckCredentials,s.wt,r)}(n.datastore,n.asyncQueue,{zr:ip.bind(null,n),Jr:op.bind(null,n),Go:ap.bind(null,n)}),n.fu.push(function(){var e=(0,p.Z)(function*(t){t?(n.mu.No(),Mo(n)?Ro(n):n._u.set("Unknown")):(yield n.mu.stop(),xh(n))});return function(t){return e.apply(this,arguments)}}())),n.mu}function ht(n){return n.gu||(n.gu=function(e,t,r){const s=_(e);return s.tu(),new tp(t,s.bo,s.authCredentials,s.appCheckCredentials,s.wt,r)}(n.datastore,n.asyncQueue,{zr:lp.bind(null,n),Jr:fp.bind(null,n),Yo:hp.bind(null,n),Jo:dp.bind(null,n)}),n.fu.push(function(){var e=(0,p.Z)(function*(t){t?(n.gu.No(),yield yn(n)):(yield n.gu.stop(),n.au.length>0&&(w("RemoteStore",`Stopping write stream with ${n.au.length} pending writes`),n.au=[]))});return function(t){return e.apply(this,arguments)}}())),n.gu}class zo{constructor(e,t,r,s,i){this.asyncQueue=e,this.timerId=t,this.targetTimeMs=r,this.op=s,this.removalCallback=i,this.deferred=new oe,this.then=this.deferred.promise.then.bind(this.deferred.promise),this.deferred.promise.catch(o=>{})}static createAndSchedule(e,t,r,s,i){const o=Date.now()+r,a=new zo(e,t,o,s,i);return a.start(r),a}start(e){this.timerHandle=setTimeout(()=>this.handleDelayElapsed(),e)}skipDelay(){return this.handleDelayElapsed()}cancel(e){null!==this.timerHandle&&(this.clearTimeout(),this.deferred.reject(new v(m.CANCELLED,"Operation cancelled"+(e?": "+e:""))))}handleDelayElapsed(){this.asyncQueue.enqueueAndForget(()=>null!==this.timerHandle?(this.clearTimeout(),this.op().then(e=>this.deferred.resolve(e))):Promise.resolve())}clearTimeout(){null!==this.timerHandle&&(this.removalCallback(this),clearTimeout(this.timerHandle),this.timerHandle=null)}}function wn(n,e){if(J("AsyncQueue",`${e}: ${n}`),tt(n))return new v(m.UNAVAILABLE,`${e}: ${n}`);throw n}class In{constructor(e){this.comparator=e?(t,r)=>e(t,r)||I.comparator(t.key,r.key):(t,r)=>I.comparator(t.key,r.key),this.keyedMap=sr(),this.sortedSet=new H(this.comparator)}static emptySet(e){return new In(e.comparator)}has(e){return null!=this.keyedMap.get(e)}get(e){return this.keyedMap.get(e)}first(){return this.sortedSet.minKey()}last(){return this.sortedSet.maxKey()}isEmpty(){return this.sortedSet.isEmpty()}indexOf(e){const t=this.keyedMap.get(e);return t?this.sortedSet.indexOf(t):-1}get size(){return this.sortedSet.size}forEach(e){this.sortedSet.inorderTraversal((t,r)=>(e(t),!1))}add(e){const t=this.delete(e.key);return t.copy(t.keyedMap.insert(e.key,e),t.sortedSet.insert(e,null))}delete(e){const t=this.get(e);return t?this.copy(this.keyedMap.remove(e),this.sortedSet.remove(t)):this}isEqual(e){if(!(e instanceof In)||this.size!==e.size)return!1;const t=this.sortedSet.getIterator(),r=e.sortedSet.getIterator();for(;t.hasNext();){const s=t.getNext().key,i=r.getNext().key;if(!s.isEqual(i))return!1}return!0}toString(){const e=[];return this.forEach(t=>{e.push(t.toString())}),0===e.length?"DocumentSet ()":"DocumentSet (\n  "+e.join("  \n")+"\n)"}copy(e,t){const r=new In;return r.comparator=this.comparator,r.keyedMap=e,r.sortedSet=t,r}}class Dh{constructor(){this.yu=new H(I.comparator)}track(e){const t=e.doc.key,r=this.yu.get(t);r?0!==e.type&&3===r.type?this.yu=this.yu.insert(t,e):3===e.type&&1!==r.type?this.yu=this.yu.insert(t,{type:r.type,doc:e.doc}):2===e.type&&2===r.type?this.yu=this.yu.insert(t,{type:2,doc:e.doc}):2===e.type&&0===r.type?this.yu=this.yu.insert(t,{type:0,doc:e.doc}):1===e.type&&0===r.type?this.yu=this.yu.remove(t):1===e.type&&2===r.type?this.yu=this.yu.insert(t,{type:1,doc:r.doc}):0===e.type&&1===r.type?this.yu=this.yu.insert(t,{type:2,doc:e.doc}):T():this.yu=this.yu.insert(t,e)}pu(){const e=[];return this.yu.inorderTraversal((t,r)=>{e.push(r)}),e}}class _n{constructor(e,t,r,s,i,o,a,u){this.query=e,this.docs=t,this.oldDocs=r,this.docChanges=s,this.mutatedKeys=i,this.fromCache=o,this.syncStateChanged=a,this.excludesMetadataChanges=u}static fromInitialDocuments(e,t,r,s){const i=[];return t.forEach(o=>{i.push({type:0,doc:o})}),new _n(e,t,In.emptySet(t),i,r,s,!0,!1)}get hasPendingWrites(){return!this.mutatedKeys.isEmpty()}isEqual(e){if(!(this.fromCache===e.fromCache&&this.syncStateChanged===e.syncStateChanged&&this.mutatedKeys.isEqual(e.mutatedKeys)&&tr(this.query,e.query)&&this.docs.isEqual(e.docs)&&this.oldDocs.isEqual(e.oldDocs)))return!1;const t=this.docChanges,r=e.docChanges;if(t.length!==r.length)return!1;for(let s=0;s<t.length;s++)if(t[s].type!==r[s].type||!t[s].doc.isEqual(r[s].doc))return!1;return!0}}class mp{constructor(){this.Iu=void 0,this.listeners=[]}}class gp{constructor(){this.queries=new ot(e=>Qc(e),tr),this.onlineState="Unknown",this.Tu=new Set}}function Qo(n,e){return Zo.apply(this,arguments)}function Zo(){return Zo=(0,p.Z)(function*(n,e){const t=_(n),r=e.query;let s=!1,i=t.queries.get(r);if(i||(s=!0,i=new mp),s)try{i.Iu=yield t.onListen(r)}catch(o){const a=wn(o,`Initialization of query '${to(e.query)}' failed`);return void e.onError(a)}t.queries.set(r,i),i.listeners.push(e),e.Eu(t.onlineState),i.Iu&&e.Au(i.Iu)&&Xo(t)}),Zo.apply(this,arguments)}function Ho(n,e){return Wo.apply(this,arguments)}function Wo(){return Wo=(0,p.Z)(function*(n,e){const t=_(n),r=e.query;let s=!1;const i=t.queries.get(r);if(i){const o=i.listeners.indexOf(e);o>=0&&(i.listeners.splice(o,1),s=0===i.listeners.length)}if(s)return t.queries.delete(r),t.onUnlisten(r)}),Wo.apply(this,arguments)}function pp(n,e){const t=_(n);let r=!1;for(const s of e){const o=t.queries.get(s.query);if(o){for(const a of o.listeners)a.Au(s)&&(r=!0);o.Iu=s}}r&&Xo(t)}function yp(n,e,t){const r=_(n),s=r.queries.get(e);if(s)for(const i of s.listeners)i.onError(t);r.queries.delete(e)}function Xo(n){n.Tu.forEach(e=>{e.next()})}class Yo{constructor(e,t,r){this.query=e,this.Ru=t,this.bu=!1,this.Pu=null,this.onlineState="Unknown",this.options=r||{}}Au(e){if(!this.options.includeMetadataChanges){const r=[];for(const s of e.docChanges)3!==s.type&&r.push(s);e=new _n(e.query,e.docs,e.oldDocs,r,e.mutatedKeys,e.fromCache,e.syncStateChanged,!0)}let t=!1;return this.bu?this.vu(e)&&(this.Ru.next(e),t=!0):this.Vu(e,this.onlineState)&&(this.Su(e),t=!0),this.Pu=e,t}onError(e){this.Ru.error(e)}Eu(e){this.onlineState=e;let t=!1;return this.Pu&&!this.bu&&this.Vu(this.Pu,e)&&(this.Su(this.Pu),t=!0),t}Vu(e,t){return!e.fromCache||!(this.options.Du&&"Offline"!==t||e.docs.isEmpty()&&"Offline"!==t)}vu(e){return e.docChanges.length>0||!!(e.syncStateChanged||this.Pu&&this.Pu.hasPendingWrites!==e.hasPendingWrites)&&!0===this.options.includeMetadataChanges}Su(e){e=_n.fromInitialDocuments(e.query,e.docs,e.mutatedKeys,e.fromCache),this.bu=!0,this.Ru.next(e)}}class vp{constructor(e,t){this.payload=e,this.byteLength=t}Cu(){return"metadata"in this.payload}}class Ah{constructor(e){this.wt=e}Wi(e){return Pe(this.wt,e)}zi(e){return e.metadata.exists?Tl(this.wt,e.document,!1):B.newNoDocument(this.Wi(e.metadata.name),this.Hi(e.metadata.readTime))}Hi(e){return ae(e)}}class wp{constructor(e,t,r){this.xu=e,this.localStore=t,this.wt=r,this.queries=[],this.documents=[],this.collectionGroups=new Set,this.progress=Ch(e)}Nu(e){this.progress.bytesLoaded+=e.byteLength;let t=this.progress.documentsLoaded;if(e.payload.namedQuery)this.queries.push(e.payload.namedQuery);else if(e.payload.documentMetadata){this.documents.push({metadata:e.payload.documentMetadata}),e.payload.documentMetadata.exists||++t;const r=M.fromString(e.payload.documentMetadata.name);this.collectionGroups.add(r.get(r.length-2))}else e.payload.document&&(this.documents[this.documents.length-1].document=e.payload.document,++t);return t!==this.progress.documentsLoaded?(this.progress.documentsLoaded=t,Object.assign({},this.progress)):null}ku(e){const t=new Map,r=new Ah(this.wt);for(const s of e)if(s.metadata.queries){const i=r.Wi(s.metadata.name);for(const o of s.metadata.queries){const a=(t.get(o)||N()).add(i);t.set(o,a)}}return t}complete(){var e=this;return(0,p.Z)(function*(){const t=yield function Zg(n,e,t,r){return xo.apply(this,arguments)}(e.localStore,new Ah(e.wt),e.documents,e.xu.id),r=e.ku(e.documents);for(const s of e.queries)yield Hg(e.localStore,s,r.get(s.name));return e.progress.taskState="Success",{progress:e.progress,Ou:e.collectionGroups,Mu:t}})()}}function Ch(n){return{taskState:"Running",documentsLoaded:0,bytesLoaded:0,totalDocuments:n.totalDocuments,totalBytes:n.totalBytes}}class Nh{constructor(e){this.key=e}}class kh{constructor(e){this.key=e}}class Rh{constructor(e,t){this.query=e,this.Fu=t,this.$u=null,this.current=!1,this.Bu=N(),this.mutatedKeys=N(),this.Lu=Hc(e),this.Uu=new In(this.Lu)}get qu(){return this.Fu}Ku(e,t){const r=t?t.Gu:new Dh,s=t?t.Uu:this.Uu;let i=t?t.mutatedKeys:this.mutatedKeys,o=s,a=!1;const u="F"===this.query.limitType&&s.size===this.query.limit?s.last():null,c="L"===this.query.limitType&&s.size===this.query.limit?s.first():null;if(e.inorderTraversal((l,h)=>{const d=s.get(l),g=no(this.query,h)?h:null,y=!!d&&this.mutatedKeys.has(d.key),x=!!g&&(g.hasLocalMutations||this.mutatedKeys.has(g.key)&&g.hasCommittedMutations);let S=!1;d&&g?d.data.isEqual(g.data)?y!==x&&(r.track({type:3,doc:g}),S=!0):this.Qu(d,g)||(r.track({type:2,doc:g}),S=!0,(u&&this.Lu(g,u)>0||c&&this.Lu(g,c)<0)&&(a=!0)):!d&&g?(r.track({type:0,doc:g}),S=!0):d&&!g&&(r.track({type:1,doc:d}),S=!0,(u||c)&&(a=!0)),S&&(g?(o=o.add(g),i=x?i.add(l):i.delete(l)):(o=o.delete(l),i=i.delete(l)))}),null!==this.query.limit)for(;o.size>this.query.limit;){const l="F"===this.query.limitType?o.last():o.first();o=o.delete(l.key),i=i.delete(l.key),r.track({type:1,doc:l})}return{Uu:o,Gu:r,Oi:a,mutatedKeys:i}}Qu(e,t){return e.hasLocalMutations&&t.hasCommittedMutations&&!t.hasLocalMutations}applyChanges(e,t,r){const s=this.Uu;this.Uu=e.Uu,this.mutatedKeys=e.mutatedKeys;const i=e.Gu.pu();i.sort((c,l)=>function(h,d){const g=y=>{switch(y){case 0:return 1;case 2:case 3:return 2;case 1:return 0;default:return T()}};return g(h)-g(d)}(c.type,l.type)||this.Lu(c.doc,l.doc)),this.ju(r);const o=t?this.Wu():[],a=0===this.Bu.size&&this.current?1:0,u=a!==this.$u;return this.$u=a,0!==i.length||u?{snapshot:new _n(this.query,e.Uu,s,i,e.mutatedKeys,0===a,u,!1),zu:o}:{zu:o}}Eu(e){return this.current&&"Offline"===e?(this.current=!1,this.applyChanges({Uu:this.Uu,Gu:new Dh,mutatedKeys:this.mutatedKeys,Oi:!1},!1)):{zu:[]}}Hu(e){return!this.Fu.has(e)&&!!this.Uu.has(e)&&!this.Uu.get(e).hasLocalMutations}ju(e){e&&(e.addedDocuments.forEach(t=>this.Fu=this.Fu.add(t)),e.modifiedDocuments.forEach(t=>{}),e.removedDocuments.forEach(t=>this.Fu=this.Fu.delete(t)),this.current=e.current)}Wu(){if(!this.current)return[];const e=this.Bu;this.Bu=N(),this.Uu.forEach(r=>{this.Hu(r.key)&&(this.Bu=this.Bu.add(r.key))});const t=[];return e.forEach(r=>{this.Bu.has(r)||t.push(new kh(r))}),this.Bu.forEach(r=>{e.has(r)||t.push(new Nh(r))}),t}Ju(e){this.Fu=e.ji,this.Bu=N();const t=this.Ku(e.documents);return this.applyChanges(t,!0)}Yu(){return _n.fromInitialDocuments(this.query,this.Uu,this.mutatedKeys,0===this.$u)}}class Ip{constructor(e,t,r){this.query=e,this.targetId=t,this.view=r}}class _p{constructor(e){this.key=e,this.Xu=!1}}class xp{constructor(e,t,r,s,i,o){this.localStore=e,this.remoteStore=t,this.eventManager=r,this.sharedClientState=s,this.currentUser=i,this.maxConcurrentLimboResolutions=o,this.Zu={},this.tc=new ot(a=>Qc(a),tr),this.ec=new Map,this.nc=new Set,this.sc=new H(I.comparator),this.ic=new Map,this.rc=new go,this.oc={},this.uc=new Map,this.cc=Vt.Rn(),this.onlineState="Unknown",this.ac=void 0}get isPrimaryClient(){return!0===this.ac}}function Ep(n,e){return Jo.apply(this,arguments)}function Jo(){return Jo=(0,p.Z)(function*(n,e){const t=xa(n);let r,s;const i=t.tc.get(e);if(i)r=i.targetId,t.sharedClientState.addLocalQueryTarget(r),s=i.view.Yu();else{const o=yield mn(t.localStore,Me(e));t.isPrimaryClient&&Fs(t.remoteStore,o);const a=t.sharedClientState.addLocalQueryTarget(o.targetId);r=o.targetId,s=yield ea(t,e,r,"current"===a)}return s}),Jo.apply(this,arguments)}function ea(n,e,t,r){return ta.apply(this,arguments)}function ta(){return ta=(0,p.Z)(function*(n,e,t,r){n.hc=(l,h,d)=>{return(g=(0,p.Z)(function*(y,x,S,V){let G=x.view.Ku(S);G.Oi&&(G=yield Ns(y.localStore,x.query,!1).then(({documents:K})=>x.view.Ku(K,G)));const U=V&&V.targetChanges.get(x.targetId),ne=x.view.applyChanges(G,y.isPrimaryClient,U);return ha(y,x.targetId,ne.zu),ne.snapshot}),function(y,x,S,V){return g.apply(this,arguments)})(n,l,h,d);var g};const s=yield Ns(n.localStore,e,!0),i=new Rh(e,s.ji),o=i.Ku(s.documents),a=ar.createSynthesizedTargetChangeForCurrentChange(t,r&&"Offline"!==n.onlineState),u=i.applyChanges(o,n.isPrimaryClient,a);ha(n,t,u.zu);const c=new Ip(e,t,i);return n.tc.set(e,c),n.ec.has(t)?n.ec.get(t).push(e):n.ec.set(t,[e]),u.snapshot}),ta.apply(this,arguments)}function Tp(n,e){return na.apply(this,arguments)}function na(){return na=(0,p.Z)(function*(n,e){const t=_(n),r=t.tc.get(e),s=t.ec.get(r.targetId);if(s.length>1)return t.ec.set(r.targetId,s.filter(i=>!tr(i,e))),void t.tc.delete(e);t.isPrimaryClient?(t.sharedClientState.removeLocalQueryTarget(r.targetId),t.sharedClientState.isActiveQueryTarget(r.targetId)||(yield gn(t.localStore,r.targetId,!1).then(()=>{t.sharedClientState.clearQueryState(r.targetId),xr(t.remoteStore,r.targetId),xn(t,r.targetId)}).catch(et))):(xn(t,r.targetId),yield gn(t.localStore,r.targetId,!0))}),na.apply(this,arguments)}function ra(){return ra=(0,p.Z)(function*(n,e,t){const r=Ea(n);try{const s=yield function(i,o){const a=_(i),u=$.now(),c=o.reduce((d,g)=>d.add(g.key),N());let l,h;return a.persistence.runTransaction("Locally write mutations","readwrite",d=>{let g=be(),y=N();return a.Ui.getEntries(d,c).next(x=>{g=x,g.forEach((S,V)=>{V.isValidDocument()||(y=y.add(S))})}).next(()=>a.localDocuments.getOverlayedDocuments(d,g)).next(x=>{l=x;const S=[];for(const V of o){const G=Lm(V,l.get(V.key).overlayedDocument);null!=G&&S.push(new Qe(V.key,G,Pc(G.value.mapValue),Q.exists(!0)))}return a.mutationQueue.addMutationBatch(d,u,S,o)}).next(x=>{h=x;const S=x.applyToLocalDocumentSet(l,y);return a.documentOverlayCache.saveOverlays(d,x.batchId,S)})}).then(()=>({batchId:h.batchId,changes:dl(l)}))}(r.localStore,e);r.sharedClientState.addPendingMutation(s.batchId),function(i,o,a){let u=i.oc[i.currentUser.toKey()];u||(u=new H(C)),u=u.insert(o,a),i.oc[i.currentUser.toKey()]=u}(r,s.batchId,t),yield Ze(r,s.changes),yield yn(r.remoteStore)}catch(s){const i=wn(s,"Failed to persist write");t.reject(i)}}),ra.apply(this,arguments)}function Mh(n,e){return sa.apply(this,arguments)}function sa(){return sa=(0,p.Z)(function*(n,e){const t=_(n);try{const r=yield zg(t.localStore,e);e.targetChanges.forEach((s,i)=>{const o=t.ic.get(i);o&&(D(s.addedDocuments.size+s.modifiedDocuments.size+s.removedDocuments.size<=1),s.addedDocuments.size>0?o.Xu=!0:s.modifiedDocuments.size>0?D(o.Xu):s.removedDocuments.size>0&&(D(o.Xu),o.Xu=!1))}),yield Ze(t,r,e)}catch(r){yield et(r)}}),sa.apply(this,arguments)}function Fh(n,e,t){const r=_(n);if(r.isPrimaryClient&&0===t||!r.isPrimaryClient&&1===t){const s=[];r.tc.forEach((i,o)=>{const a=o.view.Eu(e);a.snapshot&&s.push(a.snapshot)}),function(i,o){const a=_(i);a.onlineState=o;let u=!1;a.queries.forEach((c,l)=>{for(const h of l.listeners)h.Eu(o)&&(u=!0)}),u&&Xo(a)}(r.eventManager,e),s.length&&r.Zu.Go(s),r.onlineState=e,r.isPrimaryClient&&r.sharedClientState.setOnlineState(e)}}function bp(n,e,t){return ia.apply(this,arguments)}function ia(){return ia=(0,p.Z)(function*(n,e,t){const r=_(n);r.sharedClientState.updateQueryState(e,"rejected",t);const s=r.ic.get(e),i=s&&s.key;if(i){let o=new H(I.comparator);o=o.insert(i,B.newNoDocument(i,b.min()));const a=N().add(i),u=new or(b.min(),new Map,new P(C),o,a);yield Mh(r,u),r.sc=r.sc.remove(i),r.ic.delete(e),da(r)}else yield gn(r.localStore,e,!1).then(()=>xn(r,e,t)).catch(et)}),ia.apply(this,arguments)}function Dp(n,e){return oa.apply(this,arguments)}function oa(){return oa=(0,p.Z)(function*(n,e){const t=_(n),r=e.batch.batchId;try{const s=yield $g(t.localStore,e);la(t,r,null),ca(t,r),t.sharedClientState.updateMutationState(r,"acknowledged"),yield Ze(t,s)}catch(s){yield et(s)}}),oa.apply(this,arguments)}function Ap(n,e,t){return aa.apply(this,arguments)}function aa(){return aa=(0,p.Z)(function*(n,e,t){const r=_(n);try{const s=yield function(i,o){const a=_(i);return a.persistence.runTransaction("Reject batch","readwrite-primary",u=>{let c;return a.mutationQueue.lookupMutationBatch(u,o).next(l=>(D(null!==l),c=l.keys(),a.mutationQueue.removeMutationBatch(u,l))).next(()=>a.mutationQueue.performConsistencyCheck(u)).next(()=>a.documentOverlayCache.removeOverlaysForBatchId(u,c,o)).next(()=>a.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(u,c)).next(()=>a.localDocuments.getDocuments(u,c))})}(r.localStore,e);la(r,e,t),ca(r,e),r.sharedClientState.updateMutationState(e,"rejected",t),yield Ze(r,s)}catch(s){yield et(s)}}),aa.apply(this,arguments)}function ua(){return ua=(0,p.Z)(function*(n,e){const t=_(n);lt(t.remoteStore)||w("SyncEngine","The network is disabled. The task returned by 'awaitPendingWrites()' will not complete until the network is enabled.");try{const r=yield function(i){const o=_(i);return o.persistence.runTransaction("Get highest unacknowledged batch id","readonly",a=>o.mutationQueue.getHighestUnacknowledgedBatchId(a))}(t.localStore);if(-1===r)return void e.resolve();const s=t.uc.get(r)||[];s.push(e),t.uc.set(r,s)}catch(r){const s=wn(r,"Initialization of waitForPendingWrites() operation failed");e.reject(s)}}),ua.apply(this,arguments)}function ca(n,e){(n.uc.get(e)||[]).forEach(t=>{t.resolve()}),n.uc.delete(e)}function la(n,e,t){const r=_(n);let s=r.oc[r.currentUser.toKey()];if(s){const i=s.get(e);i&&(t?i.reject(t):i.resolve(),s=s.remove(e)),r.oc[r.currentUser.toKey()]=s}}function xn(n,e,t=null){n.sharedClientState.removeLocalQueryTarget(e);for(const r of n.ec.get(e))n.tc.delete(r),t&&n.Zu.lc(r,t);n.ec.delete(e),n.isPrimaryClient&&n.rc.us(e).forEach(r=>{n.rc.containsKey(r)||Lh(n,r)})}function Lh(n,e){n.nc.delete(e.path.canonicalString());const t=n.sc.get(e);null!==t&&(xr(n.remoteStore,t),n.sc=n.sc.remove(e),n.ic.delete(t),da(n))}function ha(n,e,t){for(const r of t)r instanceof Nh?(n.rc.addReference(r.key,e),Np(n,r)):r instanceof kh?(w("SyncEngine","Document no longer in limbo: "+r.key),n.rc.removeReference(r.key,e),n.rc.containsKey(r.key)||Lh(n,r.key)):T()}function Np(n,e){const t=e.key,r=t.path.canonicalString();n.sc.get(t)||n.nc.has(r)||(w("SyncEngine","New document in limbo: "+t),n.nc.add(r),da(n))}function da(n){for(;n.nc.size>0&&n.sc.size<n.maxConcurrentLimboResolutions;){const e=n.nc.values().next().value;n.nc.delete(e);const t=new I(M.fromString(e)),r=n.cc.next();n.ic.set(r,new _p(t)),n.sc=n.sc.insert(t,r),Fs(n.remoteStore,new at(Me(rn(t.path)),r,2,Se.ot))}}function Ze(n,e,t){return fa.apply(this,arguments)}function fa(){return fa=(0,p.Z)(function*(n,e,t){const r=_(n),s=[],i=[],o=[];var a;r.tc.isEmpty()||(r.tc.forEach((a,u)=>{o.push(r.hc(u,e,t).then(c=>{if(c){r.isPrimaryClient&&r.sharedClientState.updateQueryState(u.targetId,c.fromCache?"not-current":"current"),s.push(c);const l=wo.Vi(u.targetId,c);i.push(l)}}))}),yield Promise.all(o),r.Zu.Go(s),yield(a=(0,p.Z)(function*(u,c){const l=_(u);try{yield l.persistence.runTransaction("notifyLocalViewChanges","readwrite",h=>f.forEach(c,d=>f.forEach(d.Pi,g=>l.persistence.referenceDelegate.addReference(h,d.targetId,g)).next(()=>f.forEach(d.vi,g=>l.persistence.referenceDelegate.removeReference(h,d.targetId,g)))))}catch(h){if(!tt(h))throw h;w("LocalStore","Failed to update sequence numbers: "+h)}for(const h of c){const d=h.targetId;if(!h.fromCache){const g=l.$i.get(d),x=g.withLastLimboFreeSnapshotVersion(g.snapshotVersion);l.$i=l.$i.insert(d,x)}}}),function(u,c){return a.apply(this,arguments)})(r.localStore,i))}),fa.apply(this,arguments)}function kp(n,e){return ma.apply(this,arguments)}function ma(){return ma=(0,p.Z)(function*(n,e){const t=_(n);if(!t.currentUser.isEqual(e)){w("SyncEngine","User change. New user:",e.toKey());const r=yield ch(t.localStore,e);t.currentUser=e,(s=t).uc.forEach(o=>{o.forEach(a=>{a.reject(new v(m.CANCELLED,"'waitForPendingWrites' promise is rejected due to a user change."))})}),s.uc.clear(),t.sharedClientState.handleUserChange(e,r.removedBatchIds,r.addedBatchIds),yield Ze(t,r.Ki)}var s}),ma.apply(this,arguments)}function Rp(n,e){const t=_(n),r=t.ic.get(e);if(r&&r.Xu)return N().add(r.key);{let s=N();const i=t.ec.get(e);if(!i)return s;for(const o of i){const a=t.tc.get(o);s=s.unionWith(a.view.qu)}return s}}function Mp(n,e){return ga.apply(this,arguments)}function ga(){return ga=(0,p.Z)(function*(n,e){const t=_(n),r=yield Ns(t.localStore,e.query,!0),s=e.view.Ju(r);return t.isPrimaryClient&&ha(t,e.targetId,s.zu),s}),ga.apply(this,arguments)}function Fp(n,e){return pa.apply(this,arguments)}function pa(){return pa=(0,p.Z)(function*(n,e){const t=_(n);return fh(t.localStore,e).then(r=>Ze(t,r))}),pa.apply(this,arguments)}function Lp(n,e,t,r){return ya.apply(this,arguments)}function ya(){return ya=(0,p.Z)(function*(n,e,t,r){const s=_(n),i=yield function(o,a){const u=_(o),c=_(u.mutationQueue);return u.persistence.runTransaction("Lookup mutation documents","readonly",l=>c.yn(l,a).next(h=>h?u.localDocuments.getDocuments(l,h):f.resolve(null)))}(s.localStore,e);var a;null!==i?("pending"===t?yield yn(s.remoteStore):"acknowledged"===t||"rejected"===t?(la(s,e,r||null),ca(s,e),a=e,_(_(s.localStore).mutationQueue).In(a)):T(),yield Ze(s,i)):w("SyncEngine","Cannot apply mutation batch with id: "+e)}),ya.apply(this,arguments)}function va(){return va=(0,p.Z)(function*(n,e){const t=_(n);if(xa(t),Ea(t),!0===e&&!0!==t.ac){const r=t.sharedClientState.getAllActiveQueryTargets(),s=yield Oh(t,r.toArray());t.ac=!0,yield jo(t.remoteStore,!0);for(const i of s)Fs(t.remoteStore,i)}else if(!1===e&&!1!==t.ac){const r=[];let s=Promise.resolve();t.ec.forEach((i,o)=>{t.sharedClientState.isLocalQueryTarget(o)?r.push(o):s=s.then(()=>(xn(t,o),gn(t.localStore,o,!0))),xr(t.remoteStore,o)}),yield s,yield Oh(t,r),function(i){const o=_(i);o.ic.forEach((a,u)=>{xr(o.remoteStore,u)}),o.rc.cs(),o.ic=new Map,o.sc=new H(I.comparator)}(t),t.ac=!1,yield jo(t.remoteStore,!1)}}),va.apply(this,arguments)}function Oh(n,e,t){return wa.apply(this,arguments)}function wa(){return wa=(0,p.Z)(function*(n,e,t){const r=_(n),s=[],i=[];for(const o of e){let a;const u=r.ec.get(o);if(u&&0!==u.length){a=yield mn(r.localStore,Me(u[0]));for(const c of u){const l=r.tc.get(c),h=yield Mp(r,l);h.snapshot&&i.push(h.snapshot)}}else{const c=yield dh(r.localStore,o);a=yield mn(r.localStore,c),yield ea(r,Vh(c),o,!1)}s.push(a)}return r.Zu.Go(i),s}),wa.apply(this,arguments)}function Vh(n){return $c(n.path,n.collectionGroup,n.orderBy,n.filters,n.limit,"F",n.startAt,n.endAt)}function Vp(n){const e=_(n);return _(_(e.localStore).persistence).Ri()}function Pp(n,e,t,r){return Ia.apply(this,arguments)}function Ia(){return Ia=(0,p.Z)(function*(n,e,t,r){const s=_(n);if(s.ac)return void w("SyncEngine","Ignoring unexpected query state notification.");const i=s.ec.get(e);if(i&&i.length>0)switch(t){case"current":case"not-current":{const o=yield fh(s.localStore,Zc(i[0])),a=or.createSynthesizedRemoteEventForCurrentChange(e,"current"===t);yield Ze(s,o,a);break}case"rejected":yield gn(s.localStore,e,!0),xn(s,e,r);break;default:T()}}),Ia.apply(this,arguments)}function Up(n,e,t){return _a.apply(this,arguments)}function _a(){return _a=(0,p.Z)(function*(n,e,t){const r=xa(n);if(r.ac){for(const s of e){if(r.ec.has(s)){w("SyncEngine","Adding an already active target "+s);continue}const i=yield dh(r.localStore,s),o=yield mn(r.localStore,i);yield ea(r,Vh(i),o.targetId,!1),Fs(r.remoteStore,o)}for(const s of t)r.ec.has(s)&&(yield gn(r.localStore,s,!1).then(()=>{xr(r.remoteStore,s),xn(r,s)}).catch(et))}}),_a.apply(this,arguments)}function xa(n){const e=_(n);return e.remoteStore.remoteSyncer.applyRemoteEvent=Mh.bind(null,e),e.remoteStore.remoteSyncer.getRemoteKeysForTarget=Rp.bind(null,e),e.remoteStore.remoteSyncer.rejectListen=bp.bind(null,e),e.Zu.Go=pp.bind(null,e.eventManager),e.Zu.lc=yp.bind(null,e.eventManager),e}function Ea(n){const e=_(n);return e.remoteStore.remoteSyncer.applySuccessfulWrite=Dp.bind(null,e),e.remoteStore.remoteSyncer.rejectFailedWrite=Ap.bind(null,e),e}class Ph{constructor(){this.synchronizeTabs=!1}initialize(e){var t=this;return(0,p.Z)(function*(){t.wt=Ir(e.databaseInfo.databaseId),t.sharedClientState=t.dc(e),t.persistence=t._c(e),yield t.persistence.start(),t.localStore=t.wc(e),t.gcScheduler=t.mc(e,t.localStore),t.indexBackfillerScheduler=t.gc(e,t.localStore)})()}mc(e,t){return null}gc(e,t){return null}wc(e){return uh(this.persistence,new ah,e.initialUser,this.wt)}_c(e){return new ih(As.Ms,this.wt)}dc(e){return new yh}terminate(){var e=this;return(0,p.Z)(function*(){e.gcScheduler&&e.gcScheduler.stop(),yield e.sharedClientState.shutdown(),yield e.persistence.shutdown()})()}}class Uh extends Ph{constructor(e,t,r){super(),this.yc=e,this.cacheSizeBytes=t,this.forceOwnership=r,this.synchronizeTabs=!1}initialize(e){var t=()=>super.initialize,r=this;return(0,p.Z)(function*(){yield t().call(r,e),yield r.yc.initialize(r,e),yield Ea(r.yc.syncEngine),yield yn(r.yc.remoteStore),yield r.persistence.ci(()=>(r.gcScheduler&&!r.gcScheduler.started&&r.gcScheduler.start(),r.indexBackfillerScheduler&&!r.indexBackfillerScheduler.started&&r.indexBackfillerScheduler.start(),Promise.resolve()))})()}wc(e){return uh(this.persistence,new ah,e.initialUser,this.wt)}mc(e,t){return new Ng(this.persistence.referenceDelegate.garbageCollector,e.asyncQueue,t)}gc(e,t){const r=new dm(t,this.persistence);return new hm(e.asyncQueue,r)}_c(e){const t=vo(e.databaseInfo.databaseId,e.databaseInfo.persistenceKey),r=void 0!==this.cacheSizeBytes?De.withCacheSize(this.cacheSizeBytes):De.DEFAULT;return new yo(this.synchronizeTabs,t,e.clientId,r,e.asyncQueue,wh(),Ms(),this.wt,this.sharedClientState,!!this.forceOwnership)}dc(e){return new yh}}class qp extends Uh{constructor(e,t){super(e,t,!1),this.yc=e,this.cacheSizeBytes=t,this.synchronizeTabs=!0}initialize(e){var t=()=>super.initialize,r=this;return(0,p.Z)(function*(){yield t().call(r,e);const s=r.yc.syncEngine;r.sharedClientState instanceof Do&&(r.sharedClientState.syncEngine={kr:Lp.bind(null,s),Or:Pp.bind(null,s),Mr:Up.bind(null,s),Ri:Vp.bind(null,s),Nr:Fp.bind(null,s)},yield r.sharedClientState.start()),yield r.persistence.ci(function(){var i=(0,p.Z)(function*(o){yield function Op(n,e){return va.apply(this,arguments)}(r.yc.syncEngine,o),r.gcScheduler&&(o&&!r.gcScheduler.started?r.gcScheduler.start():o||r.gcScheduler.stop()),r.indexBackfillerScheduler&&(o&&!r.indexBackfillerScheduler.started?r.indexBackfillerScheduler.start():o||r.indexBackfillerScheduler.stop())});return function(o){return i.apply(this,arguments)}}())})()}dc(e){const t=wh();if(!Do.V(t))throw new v(m.UNIMPLEMENTED,"IndexedDB persistence is only available on platforms that support LocalStorage.");const r=vo(e.databaseInfo.databaseId,e.databaseInfo.persistenceKey);return new Do(t,e.asyncQueue,r,e.clientId,e.initialUser)}}class Ta{initialize(e,t){var r=this;return(0,p.Z)(function*(){r.localStore||(r.localStore=e.localStore,r.sharedClientState=e.sharedClientState,r.datastore=r.createDatastore(t),r.remoteStore=r.createRemoteStore(t),r.eventManager=r.createEventManager(t),r.syncEngine=r.createSyncEngine(t,!e.synchronizeTabs),r.sharedClientState.onlineStateHandler=s=>Fh(r.syncEngine,s,1),r.remoteStore.remoteSyncer.handleCredentialChange=kp.bind(null,r.syncEngine),yield jo(r.remoteStore,r.syncEngine.isPrimaryClient))})()}createEventManager(e){return new gp}createDatastore(e){const t=Ir(e.databaseInfo.databaseId),r=new Jg(e.databaseInfo);return new np(e.authCredentials,e.appCheckCredentials,r,t)}createRemoteStore(e){return t=this.localStore,r=this.datastore,s=e.asyncQueue,i=a=>Fh(this.syncEngine,a,0),o=vh.V()?new vh:new Wg,new sp(t,r,s,i,o);var t,r,s,i,o}createSyncEngine(e,t){return function(r,s,i,o,a,u,c){const l=new xp(r,s,i,o,a,u);return c&&(l.ac=!0),l}(this.localStore,this.remoteStore,this.eventManager,this.sharedClientState,e.initialUser,e.maxConcurrentLimboResolutions,t)}terminate(){return(e=(0,p.Z)(function*(t){const r=_(t);w("RemoteStore","RemoteStore shutting down."),r.lu.add(5),yield pn(r),r.du.shutdown(),r._u.set("Unknown")}),function(t){return e.apply(this,arguments)})(this.remoteStore);var e}}function Bh(n,e=10240){let t=0;return{read:()=>(0,p.Z)(function*(){if(t<n.byteLength){const r={value:n.slice(t,t+e),done:!1};return t+=e,r}return{done:!0}})(),cancel:()=>(0,p.Z)(function*(){})(),releaseLock(){},closed:Promise.reject("unimplemented")}}class Os{constructor(e){this.observer=e,this.muted=!1}next(e){this.observer.next&&this.Ic(this.observer.next,e)}error(e){this.observer.error?this.Ic(this.observer.error,e):console.error("Uncaught Error in snapshot listener:",e)}Tc(){this.muted=!0}Ic(e,t){this.muted||setTimeout(()=>{this.muted||e(t)},0)}}class Gp{constructor(e,t){this.Ec=e,this.wt=t,this.metadata=new oe,this.buffer=new Uint8Array,this.Ac=new TextDecoder("utf-8"),this.Rc().then(r=>{r&&r.Cu()?this.metadata.resolve(r.payload.metadata):this.metadata.reject(new Error(`The first element of the bundle is not a metadata, it is\n             ${JSON.stringify(r?.payload)}`))},r=>this.metadata.reject(r))}close(){return this.Ec.cancel()}getMetadata(){var e=this;return(0,p.Z)(function*(){return e.metadata.promise})()}fc(){var e=this;return(0,p.Z)(function*(){return yield e.getMetadata(),e.Rc()})()}Rc(){var e=this;return(0,p.Z)(function*(){const t=yield e.bc();if(null===t)return null;const r=e.Ac.decode(t),s=Number(r);isNaN(s)&&e.Pc(`length string (${r}) is not valid number`);const i=yield e.vc(s);return new vp(JSON.parse(i),t.length+s)})()}Vc(){return this.buffer.findIndex(e=>e==="{".charCodeAt(0))}bc(){var e=this;return(0,p.Z)(function*(){for(;e.Vc()<0&&!(yield e.Sc()););if(0===e.buffer.length)return null;const t=e.Vc();t<0&&e.Pc("Reached the end of bundle when a length string is expected.");const r=e.buffer.slice(0,t);return e.buffer=e.buffer.slice(t),r})()}vc(e){var t=this;return(0,p.Z)(function*(){for(;t.buffer.length<e;)(yield t.Sc())&&t.Pc("Reached the end of bundle when more is expected.");const r=t.Ac.decode(t.buffer.slice(0,e));return t.buffer=t.buffer.slice(e),r})()}Pc(e){throw this.Ec.cancel(),new Error(`Invalid bundle format: ${e}`)}Sc(){var e=this;return(0,p.Z)(function*(){const t=yield e.Ec.read();if(!t.done){const r=new Uint8Array(e.buffer.length+t.value.length);r.set(e.buffer),r.set(t.value,e.buffer.length),e.buffer=r}return t.done})()}}class Kp{constructor(e){this.datastore=e,this.readVersions=new Map,this.mutations=[],this.committed=!1,this.lastWriteError=null,this.writtenDocs=new Set}lookup(e){var t=this;return(0,p.Z)(function*(){if(t.ensureCommitNotCalled(),t.mutations.length>0)throw new v(m.INVALID_ARGUMENT,"Firestore transactions require all reads to be executed before all writes.");const r=yield(s=(0,p.Z)(function*(i,o){const a=_(i),u=lr(a.wt)+"/documents",c={documents:o.map(g=>cr(a.wt,g))},l=yield a.ao("BatchGetDocuments",u,c,o.length),h=new Map;l.forEach(g=>{const y=function zm(n,e){return"found"in e?function(t,r){D(!!r.found);const s=Pe(t,r.found.name),i=ae(r.found.updateTime),o=new me({mapValue:{fields:r.found.fields}});return B.newFoundDocument(s,i,o)}(n,e):"missing"in e?function(t,r){D(!!r.missing),D(!!r.readTime);const s=Pe(t,r.missing),i=ae(r.readTime);return B.newNoDocument(s,i)}(n,e):T()}(a.wt,g);h.set(y.key.toString(),y)});const d=[];return o.forEach(g=>{const y=h.get(g.toString());D(!!y),d.push(y)}),d}),function(i,o){return s.apply(this,arguments)})(t.datastore,e);var s;return r.forEach(s=>t.recordVersion(s)),r})()}set(e,t){this.write(t.toMutation(e,this.precondition(e))),this.writtenDocs.add(e.toString())}update(e,t){try{this.write(t.toMutation(e,this.preconditionForUpdate(e)))}catch(r){this.lastWriteError=r}this.writtenDocs.add(e.toString())}delete(e){this.write(new cn(e,this.precondition(e))),this.writtenDocs.add(e.toString())}commit(){var e=this;return(0,p.Z)(function*(){if(e.ensureCommitNotCalled(),e.lastWriteError)throw e.lastWriteError;const t=e.readVersions;var r;e.mutations.forEach(r=>{t.delete(r.key.toString())}),t.forEach((r,s)=>{const i=I.fromPath(s);e.mutations.push(new ro(i,e.precondition(i)))}),yield(r=(0,p.Z)(function*(s,i){const o=_(s),a=lr(o.wt)+"/documents",u={writes:i.map(c=>hr(o.wt,c))};yield o.ro("Commit",a,u)}),function(s,i){return r.apply(this,arguments)})(e.datastore,e.mutations),e.committed=!0})()}recordVersion(e){let t;if(e.isFoundDocument())t=e.version;else{if(!e.isNoDocument())throw T();t=b.min()}const r=this.readVersions.get(e.key.toString());if(r){if(!t.isEqual(r))throw new v(m.ABORTED,"Document version changed between two reads.")}else this.readVersions.set(e.key.toString(),t)}precondition(e){const t=this.readVersions.get(e.toString());return!this.writtenDocs.has(e.toString())&&t?Q.updateTime(t):Q.none()}preconditionForUpdate(e){const t=this.readVersions.get(e.toString());if(!this.writtenDocs.has(e.toString())&&t){if(t.isEqual(b.min()))throw new v(m.INVALID_ARGUMENT,"Can't update a document that doesn't exist.");return Q.updateTime(t)}return Q.exists(!0)}write(e){this.ensureCommitNotCalled(),this.mutations.push(e)}ensureCommitNotCalled(){}}class jp{constructor(e,t,r,s,i){this.asyncQueue=e,this.datastore=t,this.options=r,this.updateFunction=s,this.deferred=i,this.Dc=r.maxAttempts,this.So=new Ao(this.asyncQueue,"transaction_retry")}run(){this.Dc-=1,this.Cc()}Cc(){var e=this;this.So.Io((0,p.Z)(function*(){const t=new Kp(e.datastore),r=e.xc(t);r&&r.then(s=>{e.asyncQueue.enqueueAndForget(()=>t.commit().then(()=>{e.deferred.resolve(s)}).catch(i=>{e.Nc(i)}))}).catch(s=>{e.Nc(s)})}))}xc(e){try{const t=this.updateFunction(e);return!Hn(t)&&t.catch&&t.then?t:(this.deferred.reject(Error("Transaction callback must return a Promise")),null)}catch(t){return this.deferred.reject(t),null}}Nc(e){this.Dc>0&&this.kc(e)?(this.Dc-=1,this.asyncQueue.enqueueAndForget(()=>(this.Cc(),Promise.resolve()))):this.deferred.reject(e)}kc(e){if("FirebaseError"===e.name){const t=e.code;return"aborted"===t||"failed-precondition"===t||!cl(t)}return!1}}class $p{constructor(e,t,r,s){var i=this;this.authCredentials=e,this.appCheckCredentials=t,this.asyncQueue=r,this.databaseInfo=s,this.user=ie.UNAUTHENTICATED,this.clientId=Ic.I(),this.authCredentialListener=()=>Promise.resolve(),this.appCheckCredentialListener=()=>Promise.resolve(),this.authCredentials.start(r,function(){var o=(0,p.Z)(function*(a){w("FirestoreClient","Received user=",a.uid),yield i.authCredentialListener(a),i.user=a});return function(a){return o.apply(this,arguments)}}()),this.appCheckCredentials.start(r,o=>(w("FirestoreClient","Received new app check token=",o),this.appCheckCredentialListener(o,this.user)))}getConfiguration(){var e=this;return(0,p.Z)(function*(){return{asyncQueue:e.asyncQueue,databaseInfo:e.databaseInfo,clientId:e.clientId,authCredentials:e.authCredentials,appCheckCredentials:e.appCheckCredentials,initialUser:e.user,maxConcurrentLimboResolutions:100}})()}setCredentialChangeListener(e){this.authCredentialListener=e}setAppCheckTokenChangeListener(e){this.appCheckCredentialListener=e}verifyNotTerminated(){if(this.asyncQueue.isShuttingDown)throw new v(m.FAILED_PRECONDITION,"The client has already been terminated.")}terminate(){var e=this;this.asyncQueue.enterRestrictedMode();const t=new oe;return this.asyncQueue.enqueueAndForgetEvenWhileRestricted((0,p.Z)(function*(){try{e.onlineComponents&&(yield e.onlineComponents.terminate()),e.offlineComponents&&(yield e.offlineComponents.terminate()),e.authCredentials.shutdown(),e.appCheckCredentials.shutdown(),t.resolve()}catch(r){const s=wn(r,"Failed to shutdown persistence");t.reject(s)}})),t.promise}}function qh(n,e){return Sa.apply(this,arguments)}function Sa(){return Sa=(0,p.Z)(function*(n,e){n.asyncQueue.verifyOperationInProgress(),w("FirestoreClient","Initializing OfflineComponentProvider");const t=yield n.getConfiguration();yield e.initialize(t);let r=t.initialUser;n.setCredentialChangeListener(function(){var s=(0,p.Z)(function*(i){r.isEqual(i)||(yield ch(e.localStore,i),r=i)});return function(i){return s.apply(this,arguments)}}()),e.persistence.setDatabaseDeletedListener(()=>n.terminate()),n.offlineComponents=e}),Sa.apply(this,arguments)}function Gh(n,e){return ba.apply(this,arguments)}function ba(){return ba=(0,p.Z)(function*(n,e){n.asyncQueue.verifyOperationInProgress();const t=yield Da(n);w("FirestoreClient","Initializing OnlineComponentProvider");const r=yield n.getConfiguration();yield e.initialize(t,r),n.setCredentialChangeListener(s=>bh(e.remoteStore,s)),n.setAppCheckTokenChangeListener((s,i)=>bh(e.remoteStore,i)),n.onlineComponents=e}),ba.apply(this,arguments)}function Da(n){return Aa.apply(this,arguments)}function Aa(){return Aa=(0,p.Z)(function*(n){return n.offlineComponents||(w("FirestoreClient","Using default OfflineComponentProvider"),yield qh(n,new Ph)),n.offlineComponents}),Aa.apply(this,arguments)}function Vs(n){return Ca.apply(this,arguments)}function Ca(){return Ca=(0,p.Z)(function*(n){return n.onlineComponents||(w("FirestoreClient","Using default OnlineComponentProvider"),yield Gh(n,new Ta)),n.onlineComponents}),Ca.apply(this,arguments)}function Kh(n){return Da(n).then(e=>e.persistence)}function Na(n){return Da(n).then(e=>e.localStore)}function jh(n){return Vs(n).then(e=>e.remoteStore)}function ka(n){return Vs(n).then(e=>e.syncEngine)}function En(n){return Ra.apply(this,arguments)}function Ra(){return Ra=(0,p.Z)(function*(n){const e=yield Vs(n),t=e.eventManager;return t.onListen=Ep.bind(null,e.syncEngine),t.onUnlisten=Tp.bind(null,e.syncEngine),t}),Ra.apply(this,arguments)}function $h(n,e,t={}){const r=new oe;return n.asyncQueue.enqueueAndForget((0,p.Z)(function*(){return function(s,i,o,a,u){const c=new Os({next:h=>{i.enqueueAndForget(()=>Ho(s,l));const d=h.docs.has(o);!d&&h.fromCache?u.reject(new v(m.UNAVAILABLE,"Failed to get document because the client is offline.")):d&&h.fromCache&&a&&"server"===a.source?u.reject(new v(m.UNAVAILABLE,'Failed to get document from server. (However, this document does exist in the local cache. Run again without setting source to "server" to retrieve the cached document.)')):u.resolve(h)},error:h=>u.reject(h)}),l=new Yo(rn(o.path),c,{includeMetadataChanges:!0,Du:!0});return Qo(s,l)}(yield En(n),n.asyncQueue,e,t,r)})),r.promise}function zh(n,e,t={}){const r=new oe;return n.asyncQueue.enqueueAndForget((0,p.Z)(function*(){return function(s,i,o,a,u){const c=new Os({next:h=>{i.enqueueAndForget(()=>Ho(s,l)),h.fromCache&&"server"===a.source?u.reject(new v(m.UNAVAILABLE,'Failed to get documents from server. (However, these documents may exist in the local cache. Run again without setting source to "server" to retrieve the cached documents.)')):u.resolve(h)},error:h=>u.reject(h)}),l=new Yo(o,c,{includeMetadataChanges:!0,Du:!0});return Qo(s,l)}(yield En(n),n.asyncQueue,e,t,r)})),r.promise}const Qh=new Map;function Ma(n,e,t){if(!t)throw new v(m.INVALID_ARGUMENT,`Function ${n}() cannot be called with an empty ${e}.`)}function Zh(n,e,t,r){if(!0===e&&!0===r)throw new v(m.INVALID_ARGUMENT,`${n} and ${t} cannot be used together.`)}function Hh(n){if(!I.isDocumentKey(n))throw new v(m.INVALID_ARGUMENT,`Invalid document reference. Document references must have an even number of segments, but ${n} has ${n.length}.`)}function Wh(n){if(I.isDocumentKey(n))throw new v(m.INVALID_ARGUMENT,`Invalid collection reference. Collection references must have an odd number of segments, but ${n} has ${n.length}.`)}function Ps(n){if(void 0===n)return"undefined";if(null===n)return"null";if("string"==typeof n)return n.length>20&&(n=`${n.substring(0,20)}...`),JSON.stringify(n);if("number"==typeof n||"boolean"==typeof n)return""+n;if("object"==typeof n){if(n instanceof Array)return"an array";{const e=(t=n).constructor?t.constructor.name:null;return e?`a custom ${e} object`:"an object"}}var t;return"function"==typeof n?"a function":T()}function R(n,e){if("_delegate"in n&&(n=n._delegate),!(n instanceof e)){if(e.name===n.constructor.name)throw new v(m.INVALID_ARGUMENT,"Type does not match the expected instance. Did you pass a reference from a different Firestore SDK?");{const t=Ps(n);throw new v(m.INVALID_ARGUMENT,`Expected type '${e.name}', but it was: ${t}`)}}return n}function Xh(n,e){if(e<=0)throw new v(m.INVALID_ARGUMENT,`Function ${n}() requires a positive number, but it was: ${e}.`)}class Yh{constructor(e){var t;if(void 0===e.host){if(void 0!==e.ssl)throw new v(m.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host="firestore.googleapis.com",this.ssl=!0}else this.host=e.host,this.ssl=null===(t=e.ssl)||void 0===t||t;if(this.credentials=e.credentials,this.ignoreUndefinedProperties=!!e.ignoreUndefinedProperties,void 0===e.cacheSizeBytes)this.cacheSizeBytes=41943040;else{if(-1!==e.cacheSizeBytes&&e.cacheSizeBytes<1048576)throw new v(m.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");this.cacheSizeBytes=e.cacheSizeBytes}this.experimentalForceLongPolling=!!e.experimentalForceLongPolling,this.experimentalAutoDetectLongPolling=!!e.experimentalAutoDetectLongPolling,this.useFetchStreams=!!e.useFetchStreams,Zh("experimentalForceLongPolling",e.experimentalForceLongPolling,"experimentalAutoDetectLongPolling",e.experimentalAutoDetectLongPolling)}isEqual(e){return this.host===e.host&&this.ssl===e.ssl&&this.credentials===e.credentials&&this.cacheSizeBytes===e.cacheSizeBytes&&this.experimentalForceLongPolling===e.experimentalForceLongPolling&&this.experimentalAutoDetectLongPolling===e.experimentalAutoDetectLongPolling&&this.ignoreUndefinedProperties===e.ignoreUndefinedProperties&&this.useFetchStreams===e.useFetchStreams}}class Er{constructor(e,t,r){this._authCredentials=t,this._appCheckCredentials=r,this.type="firestore-lite",this._persistenceKey="(lite)",this._settings=new Yh({}),this._settingsFrozen=!1,e instanceof $e?this._databaseId=e:(this._app=e,this._databaseId=function(s){if(!Object.prototype.hasOwnProperty.apply(s.options,["projectId"]))throw new v(m.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');return new $e(s.options.projectId)}(e))}get app(){if(!this._app)throw new v(m.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._app}get _initialized(){return this._settingsFrozen}get _terminated(){return void 0!==this._terminateTask}_setSettings(e){if(this._settingsFrozen)throw new v(m.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only modify settings before calling any other methods on a Firestore object.");this._settings=new Yh(e),void 0!==e.credentials&&(this._authCredentials=function(t){if(!t)return new tm;switch(t.type){case"gapi":const r=t.client;return D(!("object"!=typeof r||null===r||!r.auth||!r.auth.getAuthHeaderValueForFirstParty)),new im(r,t.sessionIndex||"0",t.iamToken||null);case"provider":return t.client;default:throw new v(m.INVALID_ARGUMENT,"makeAuthCredentialsProvider failed due to invalid credential type")}}(e.credentials))}_getSettings(){return this._settings}_freezeSettings(){return this._settingsFrozen=!0,this._settings}_delete(){return this._terminateTask||(this._terminateTask=this._terminate()),this._terminateTask}toJSON(){return{app:this._app,databaseId:this._databaseId,settings:this._settings}}_terminate(){return function(e){const t=Qh.get(e);t&&(w("ComponentProvider","Removing Datastore"),Qh.delete(e),t.terminate())}(this),Promise.resolve()}}class q{constructor(e,t,r){this.converter=t,this._key=r,this.type="document",this.firestore=e}get _path(){return this._key.path}get id(){return this._key.path.lastSegment()}get path(){return this._key.path.canonicalString()}get parent(){return new Be(this.firestore,this.converter,this._key.path.popLast())}withConverter(e){return new q(this.firestore,e,this._key)}}class ye{constructor(e,t,r){this.converter=t,this._query=r,this.type="query",this.firestore=e}withConverter(e){return new ye(this.firestore,e,this._query)}}class Be extends ye{constructor(e,t,r){super(e,t,rn(r)),this._path=r,this.type="collection"}get id(){return this._query.path.lastSegment()}get path(){return this._query.path.canonicalString()}get parent(){const e=this._path.popLast();return e.isEmpty()?null:new q(this.firestore,null,new I(e))}withConverter(e){return new Be(this.firestore,e,this._path)}}function Jh(n,e,...t){if(n=(0,L.m9)(n),Ma("collection","path",e),n instanceof Er){const r=M.fromString(e,...t);return Wh(r),new Be(n,null,r)}{if(!(n instanceof q||n instanceof Be))throw new v(m.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const r=n._path.child(M.fromString(e,...t));return Wh(r),new Be(n.firestore,null,r)}}function Us(n,e,...t){if(n=(0,L.m9)(n),1===arguments.length&&(e=Ic.I()),Ma("doc","path",e),n instanceof Er){const r=M.fromString(e,...t);return Hh(r),new q(n,null,new I(r))}{if(!(n instanceof q||n instanceof Be))throw new v(m.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const r=n._path.child(M.fromString(e,...t));return Hh(r),new q(n.firestore,n instanceof Be?n.converter:null,new I(r))}}function ed(n,e){return n=(0,L.m9)(n),e=(0,L.m9)(e),(n instanceof q||n instanceof Be)&&(e instanceof q||e instanceof Be)&&n.firestore===e.firestore&&n.path===e.path&&n.converter===e.converter}function td(n,e){return n=(0,L.m9)(n),e=(0,L.m9)(e),n instanceof ye&&e instanceof ye&&n.firestore===e.firestore&&tr(n._query,e._query)&&n.converter===e.converter}class ny{constructor(){this.Oc=Promise.resolve(),this.Mc=[],this.Fc=!1,this.$c=[],this.Bc=null,this.Lc=!1,this.Uc=!1,this.qc=[],this.So=new Ao(this,"async_queue_retry"),this.Kc=()=>{const t=Ms();t&&w("AsyncQueue","Visibility state changed to "+t.visibilityState),this.So.Eo()};const e=Ms();e&&"function"==typeof e.addEventListener&&e.addEventListener("visibilitychange",this.Kc)}get isShuttingDown(){return this.Fc}enqueueAndForget(e){this.enqueue(e)}enqueueAndForgetEvenWhileRestricted(e){this.Gc(),this.Qc(e)}enterRestrictedMode(e){if(!this.Fc){this.Fc=!0,this.Uc=e||!1;const t=Ms();t&&"function"==typeof t.removeEventListener&&t.removeEventListener("visibilitychange",this.Kc)}}enqueue(e){if(this.Gc(),this.Fc)return new Promise(()=>{});const t=new oe;return this.Qc(()=>this.Fc&&this.Uc?Promise.resolve():(e().then(t.resolve,t.reject),t.promise)).then(()=>t.promise)}enqueueRetryable(e){this.enqueueAndForget(()=>(this.Mc.push(e),this.jc()))}jc(){var e=this;return(0,p.Z)(function*(){if(0!==e.Mc.length){try{yield e.Mc[0](),e.Mc.shift(),e.So.reset()}catch(t){if(!tt(t))throw t;w("AsyncQueue","Operation failed with retryable error: "+t)}e.Mc.length>0&&e.So.Io(()=>e.jc())}})()}Qc(e){const t=this.Oc.then(()=>(this.Lc=!0,e().catch(r=>{throw this.Bc=r,this.Lc=!1,J("INTERNAL UNHANDLED ERROR: ",function(i){let o=i.message||"";return i.stack&&(o=i.stack.includes(i.message)?i.stack:i.message+"\n"+i.stack),o}(r)),r}).then(r=>(this.Lc=!1,r))));return this.Oc=t,t}enqueueAfterDelay(e,t,r){this.Gc(),this.qc.indexOf(e)>-1&&(t=0);const s=zo.createAndSchedule(this,e,t,r,i=>this.Wc(i));return this.$c.push(s),s}Gc(){this.Bc&&T()}verifyOperationInProgress(){}zc(){var e=this;return(0,p.Z)(function*(){let t;do{t=e.Oc,yield t}while(t!==e.Oc)})()}Hc(e){for(const t of this.$c)if(t.timerId===e)return!0;return!1}Jc(e){return this.zc().then(()=>{this.$c.sort((t,r)=>t.targetTimeMs-r.targetTimeMs);for(const t of this.$c)if(t.skipDelay(),"all"!==e&&t.timerId===e)break;return this.zc()})}Yc(e){this.qc.push(e)}Wc(e){const t=this.$c.indexOf(e);this.$c.splice(t,1)}}function Fa(n){return function(e,t){if("object"!=typeof e||null===e)return!1;const r=e;for(const s of["next","error","complete"])if(s in r&&"function"==typeof r[s])return!0;return!1}(n)}class ry{constructor(){this._progressObserver={},this._taskCompletionResolver=new oe,this._lastProgress={taskState:"Running",totalBytes:0,totalDocuments:0,bytesLoaded:0,documentsLoaded:0}}onProgress(e,t,r){this._progressObserver={next:e,error:t,complete:r}}catch(e){return this._taskCompletionResolver.promise.catch(e)}then(e,t){return this._taskCompletionResolver.promise.then(e,t)}_completeWith(e){this._updateProgress(e),this._progressObserver.complete&&this._progressObserver.complete(),this._taskCompletionResolver.resolve(e)}_failWith(e){this._lastProgress.taskState="Error",this._progressObserver.next&&this._progressObserver.next(this._lastProgress),this._progressObserver.error&&this._progressObserver.error(e),this._taskCompletionResolver.reject(e)}_updateProgress(e){this._lastProgress=e,this._progressObserver.next&&this._progressObserver.next(e)}}class z extends Er{constructor(e,t,r){super(e,t,r),this.type="firestore",this._queue=new ny,this._persistenceKey="name"in e?e.name:"[DEFAULT]"}_terminate(){return this._firestoreClient||nd(this),this._firestoreClient.terminate()}}function te(n){return n._firestoreClient||nd(n),n._firestoreClient.verifyNotTerminated(),n._firestoreClient}function nd(n){var e;const t=n._freezeSettings(),r=(i=(null===(e=n._app)||void 0===e?void 0:e.options.appId)||"",new gm(n._databaseId,i,n._persistenceKey,(a=t).host,a.ssl,a.experimentalForceLongPolling,a.experimentalAutoDetectLongPolling,a.useFetchStreams));var i,a;n._firestoreClient=new $p(n._authCredentials,n._appCheckCredentials,n._queue,r)}function rd(n,e,t){const r=new oe;return n.asyncQueue.enqueue((0,p.Z)(function*(){try{yield qh(n,t),yield Gh(n,e),r.resolve()}catch(s){const i=s;if(!("FirebaseError"===(o=i).name?o.code===m.FAILED_PRECONDITION||o.code===m.UNIMPLEMENTED:!(typeof DOMException<"u"&&o instanceof DOMException)||22===o.code||20===o.code||11===o.code))throw i;console.warn("Error enabling offline persistence. Falling back to persistence disabled: "+i),r.reject(i)}var o})).then(()=>r.promise)}function sd(n){if(n._initialized||n._terminated)throw new v(m.FAILED_PRECONDITION,"Firestore has already been started and persistence can no longer be enabled. You can only enable persistence before calling any other methods on a Firestore object.")}class He{constructor(...e){for(let t=0;t<e.length;++t)if(0===e[t].length)throw new v(m.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this._internalPath=new X(e)}isEqual(e){return this._internalPath.isEqual(e._internalPath)}}class qe{constructor(e){this._byteString=e}static fromBase64String(e){try{return new qe(re.fromBase64String(e))}catch(t){throw new v(m.INVALID_ARGUMENT,"Failed to construct data from Base64 string: "+t)}}static fromUint8Array(e){return new qe(re.fromUint8Array(e))}toBase64(){return this._byteString.toBase64()}toUint8Array(){return this._byteString.toUint8Array()}toString(){return"Bytes(base64: "+this.toBase64()+")"}isEqual(e){return this._byteString.isEqual(e._byteString)}}class Ut{constructor(e){this._methodName=e}}class Bs{constructor(e,t){if(!isFinite(e)||e<-90||e>90)throw new v(m.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+e);if(!isFinite(t)||t<-180||t>180)throw new v(m.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+t);this._lat=e,this._long=t}get latitude(){return this._lat}get longitude(){return this._long}isEqual(e){return this._lat===e._lat&&this._long===e._long}toJSON(){return{latitude:this._lat,longitude:this._long}}_compareTo(e){return C(this._lat,e._lat)||C(this._long,e._long)}}const fy=/^__.*__$/;class my{constructor(e,t,r){this.data=e,this.fieldMask=t,this.fieldTransforms=r}toMutation(e,t){return null!==this.fieldMask?new Qe(e,this.data,this.fieldMask,t,this.fieldTransforms):new un(e,this.data,t,this.fieldTransforms)}}class id{constructor(e,t,r){this.data=e,this.fieldMask=t,this.fieldTransforms=r}toMutation(e,t){return new Qe(e,this.data,this.fieldMask,t,this.fieldTransforms)}}function od(n){switch(n){case 0:case 2:case 1:return!0;case 3:case 4:return!1;default:throw T()}}class qs{constructor(e,t,r,s,i,o){this.settings=e,this.databaseId=t,this.wt=r,this.ignoreUndefinedProperties=s,void 0===i&&this.Xc(),this.fieldTransforms=i||[],this.fieldMask=o||[]}get path(){return this.settings.path}get Zc(){return this.settings.Zc}ta(e){return new qs(Object.assign(Object.assign({},this.settings),e),this.databaseId,this.wt,this.ignoreUndefinedProperties,this.fieldTransforms,this.fieldMask)}ea(e){var t;const r=null===(t=this.path)||void 0===t?void 0:t.child(e),s=this.ta({path:r,na:!1});return s.sa(e),s}ia(e){var t;const r=null===(t=this.path)||void 0===t?void 0:t.child(e),s=this.ta({path:r,na:!1});return s.Xc(),s}ra(e){return this.ta({path:void 0,na:!0})}oa(e){return js(e,this.settings.methodName,this.settings.ua||!1,this.path,this.settings.ca)}contains(e){return void 0!==this.fieldMask.find(t=>e.isPrefixOf(t))||void 0!==this.fieldTransforms.find(t=>e.isPrefixOf(t.field))}Xc(){if(this.path)for(let e=0;e<this.path.length;e++)this.sa(this.path.get(e))}sa(e){if(0===e.length)throw this.oa("Document fields must not be empty");if(od(this.Zc)&&fy.test(e))throw this.oa('Document fields cannot begin and end with "__"')}}class gy{constructor(e,t,r){this.databaseId=e,this.ignoreUndefinedProperties=t,this.wt=r||Ir(e)}aa(e,t,r,s=!1){return new qs({Zc:e,methodName:t,ca:r,path:X.emptyPath(),na:!1,ua:s},this.databaseId,this.wt,this.ignoreUndefinedProperties)}}function Bt(n){const e=n._freezeSettings(),t=Ir(n._databaseId);return new gy(n._databaseId,!!e.ignoreUndefinedProperties,t)}function Gs(n,e,t,r,s,i={}){const o=n.aa(i.merge||i.mergeFields?2:0,e,t,s);Pa("Data must be an object, but it was:",o,r);const a=cd(r,o);let u,c;if(i.merge)u=new Ne(o.fieldMask),c=o.fieldTransforms;else if(i.mergeFields){const l=[];for(const h of i.mergeFields){const d=Ua(e,h,t);if(!o.contains(d))throw new v(m.INVALID_ARGUMENT,`Field '${d}' is specified in your field mask but missing from your input data.`);hd(l,d)||l.push(d)}u=new Ne(l),c=o.fieldTransforms.filter(h=>u.covers(h.field))}else u=null,c=o.fieldTransforms;return new my(new me(a),u,c)}class Tr extends Ut{_toFieldTransform(e){if(2!==e.Zc)throw e.oa(1===e.Zc?`${this._methodName}() can only appear at the top level of your update data`:`${this._methodName}() cannot be used with set() unless you pass {merge:true}`);return e.fieldMask.push(e.path),null}isEqual(e){return e instanceof Tr}}function ad(n,e,t){return new qs({Zc:3,ca:e.settings.ca,methodName:n._methodName,na:t},e.databaseId,e.wt,e.ignoreUndefinedProperties)}class La extends Ut{_toFieldTransform(e){return new nr(e.path,new on)}isEqual(e){return e instanceof La}}class py extends Ut{constructor(e,t){super(e),this.ha=t}_toFieldTransform(e){const t=ad(this,e,!0),r=this.ha.map(i=>qt(i,t)),s=new Ct(r);return new nr(e.path,s)}isEqual(e){return this===e}}class yy extends Ut{constructor(e,t){super(e),this.ha=t}_toFieldTransform(e){const t=ad(this,e,!0),r=this.ha.map(i=>qt(i,t)),s=new Nt(r);return new nr(e.path,s)}isEqual(e){return this===e}}class vy extends Ut{constructor(e,t){super(e),this.la=t}_toFieldTransform(e){const t=new an(e.wt,Yc(e.wt,this.la));return new nr(e.path,t)}isEqual(e){return this===e}}function Oa(n,e,t,r){const s=n.aa(1,e,t);Pa("Data must be an object, but it was:",s,r);const i=[],o=me.empty();Tt(r,(u,c)=>{const l=Ks(e,u,t);c=(0,L.m9)(c);const h=s.ia(l);if(c instanceof Tr)i.push(l);else{const d=qt(c,h);null!=d&&(i.push(l),o.set(l,d))}});const a=new Ne(i);return new id(o,a,s.fieldTransforms)}function Va(n,e,t,r,s,i){const o=n.aa(1,e,t),a=[Ua(e,r,t)],u=[s];if(i.length%2!=0)throw new v(m.INVALID_ARGUMENT,`Function ${e}() needs to be called with an even number of arguments that alternate between field names and values.`);for(let d=0;d<i.length;d+=2)a.push(Ua(e,i[d])),u.push(i[d+1]);const c=[],l=me.empty();for(let d=a.length-1;d>=0;--d)if(!hd(c,a[d])){const g=a[d];let y=u[d];y=(0,L.m9)(y);const x=o.ia(g);if(y instanceof Tr)c.push(g);else{const S=qt(y,x);null!=S&&(c.push(g),l.set(g,S))}}const h=new Ne(c);return new id(l,h,o.fieldTransforms)}function ud(n,e,t,r=!1){return qt(t,n.aa(r?4:3,e))}function qt(n,e){if(ld(n=(0,L.m9)(n)))return Pa("Unsupported field value:",e,n),cd(n,e);if(n instanceof Ut)return function(t,r){if(!od(r.Zc))throw r.oa(`${t._methodName}() can only be used with update() and set()`);if(!r.path)throw r.oa(`${t._methodName}() is not currently supported inside arrays`);const s=t._toFieldTransform(r);s&&r.fieldTransforms.push(s)}(n,e),null;if(void 0===n&&e.ignoreUndefinedProperties)return null;if(e.path&&e.fieldMask.push(e.path),n instanceof Array){if(e.settings.na&&4!==e.Zc)throw e.oa("Nested arrays are not supported");return function(t,r){const s=[];let i=0;for(const o of t){let a=qt(o,r.ra(i));null==a&&(a={nullValue:"NULL_VALUE"}),s.push(a),i++}return{arrayValue:{values:s}}}(n,e)}return function(t,r){if(null===(t=(0,L.m9)(t)))return{nullValue:"NULL_VALUE"};if("number"==typeof t)return Yc(r.wt,t);if("boolean"==typeof t)return{booleanValue:t};if("string"==typeof t)return{stringValue:t};if(t instanceof Date){const s=$.fromDate(t);return{timestampValue:ur(r.wt,s)}}if(t instanceof $){const s=new $(t.seconds,1e3*Math.floor(t.nanoseconds/1e3));return{timestampValue:ur(r.wt,s)}}if(t instanceof Bs)return{geoPointValue:{latitude:t.latitude,longitude:t.longitude}};if(t instanceof qe)return{bytesValue:wl(r.wt,t._byteString)};if(t instanceof q){const s=r.databaseId,i=t.firestore._databaseId;if(!i.isEqual(s))throw r.oa(`Document reference is for database ${i.projectId}/${i.database} but should be for database ${s.projectId}/${s.database}`);return{referenceValue:so(t.firestore._databaseId||r.databaseId,t._key.path)}}throw r.oa(`Unsupported field value: ${Ps(t)}`)}(n,e)}function cd(n,e){const t={};return Ac(n)?e.path&&e.path.length>0&&e.fieldMask.push(e.path):Tt(n,(r,s)=>{const i=qt(s,e.ea(r));null!=i&&(t[r]=i)}),{mapValue:{fields:t}}}function ld(n){return!("object"!=typeof n||null===n||n instanceof Array||n instanceof Date||n instanceof $||n instanceof Bs||n instanceof qe||n instanceof q||n instanceof Ut)}function Pa(n,e,t){if(!ld(t)||"object"!=typeof(r=t)||null===r||Object.getPrototypeOf(r)!==Object.prototype&&null!==Object.getPrototypeOf(r)){const r=Ps(t);throw e.oa("an object"===r?n+" a custom object":n+" "+r)}var r}function Ua(n,e,t){if((e=(0,L.m9)(e))instanceof He)return e._internalPath;if("string"==typeof e)return Ks(n,e);throw js("Field path arguments must be of type string or ",n,!1,void 0,t)}const wy=new RegExp("[~\\*/\\[\\]]");function Ks(n,e,t){if(e.search(wy)>=0)throw js(`Invalid field path (${e}). Paths must not contain '~', '*', '/', '[', or ']'`,n,!1,void 0,t);try{return new He(...e.split("."))._internalPath}catch{throw js(`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`,n,!1,void 0,t)}}function js(n,e,t,r,s){const i=r&&!r.isEmpty(),o=void 0!==s;let a=`Function ${e}() called with invalid data`;t&&(a+=" (via `toFirestore()`)"),a+=". ";let u="";return(i||o)&&(u+=" (found",i&&(u+=` in field ${r}`),o&&(u+=` in document ${s}`),u+=")"),new v(m.INVALID_ARGUMENT,a+n+u)}function hd(n,e){return n.some(t=>t.isEqual(e))}class Sr{constructor(e,t,r,s,i){this._firestore=e,this._userDataWriter=t,this._key=r,this._document=s,this._converter=i}get id(){return this._key.path.lastSegment()}get ref(){return new q(this._firestore,this._converter,this._key)}exists(){return null!==this._document}data(){if(this._document){if(this._converter){const e=new Iy(this._firestore,this._userDataWriter,this._key,this._document,null);return this._converter.fromFirestore(e)}return this._userDataWriter.convertValue(this._document.data.value)}}get(e){if(this._document){const t=this._document.data.field($s("DocumentSnapshot.get",e));if(null!==t)return this._userDataWriter.convertValue(t)}}}class Iy extends Sr{data(){return super.data()}}function $s(n,e){return"string"==typeof e?Ks(n,e):e instanceof He?e._internalPath:e._delegate._internalPath}class Gt{constructor(e,t){this.hasPendingWrites=e,this.fromCache=t}isEqual(e){return this.hasPendingWrites===e.hasPendingWrites&&this.fromCache===e.fromCache}}class We extends Sr{constructor(e,t,r,s,i,o){super(e,t,r,s,o),this._firestore=e,this._firestoreImpl=e,this.metadata=i}exists(){return super.exists()}data(e={}){if(this._document){if(this._converter){const t=new br(this._firestore,this._userDataWriter,this._key,this._document,this.metadata,null);return this._converter.fromFirestore(t,e)}return this._userDataWriter.convertValue(this._document.data.value,e.serverTimestamps)}}get(e,t={}){if(this._document){const r=this._document.data.field($s("DocumentSnapshot.get",e));if(null!==r)return this._userDataWriter.convertValue(r,t.serverTimestamps)}}}class br extends We{data(e={}){return super.data(e)}}class dt{constructor(e,t,r,s){this._firestore=e,this._userDataWriter=t,this._snapshot=s,this.metadata=new Gt(s.hasPendingWrites,s.fromCache),this.query=r}get docs(){const e=[];return this.forEach(t=>e.push(t)),e}get size(){return this._snapshot.docs.size}get empty(){return 0===this.size}forEach(e,t){this._snapshot.docs.forEach(r=>{e.call(t,new br(this._firestore,this._userDataWriter,r.key,r,new Gt(this._snapshot.mutatedKeys.has(r.key),this._snapshot.fromCache),this.query.converter))})}docChanges(e={}){const t=!!e.includeMetadataChanges;if(t&&this._snapshot.excludesMetadataChanges)throw new v(m.INVALID_ARGUMENT,"To include metadata changes with your document changes, you must also pass { includeMetadataChanges:true } to onSnapshot().");return this._cachedChanges&&this._cachedChangesIncludeMetadataChanges===t||(this._cachedChanges=function(r,s){if(r._snapshot.oldDocs.isEmpty()){let i=0;return r._snapshot.docChanges.map(o=>({type:"added",doc:new br(r._firestore,r._userDataWriter,o.doc.key,o.doc,new Gt(r._snapshot.mutatedKeys.has(o.doc.key),r._snapshot.fromCache),r.query.converter),oldIndex:-1,newIndex:i++}))}{let i=r._snapshot.oldDocs;return r._snapshot.docChanges.filter(o=>s||3!==o.type).map(o=>{const a=new br(r._firestore,r._userDataWriter,o.doc.key,o.doc,new Gt(r._snapshot.mutatedKeys.has(o.doc.key),r._snapshot.fromCache),r.query.converter);let u=-1,c=-1;return 0!==o.type&&(u=i.indexOf(o.doc.key),i=i.delete(o.doc.key)),1!==o.type&&(i=i.add(o.doc),c=i.indexOf(o.doc.key)),{type:_y(o.type),doc:a,oldIndex:u,newIndex:c}})}}(this,t),this._cachedChangesIncludeMetadataChanges=t),this._cachedChanges}}function _y(n){switch(n){case 0:return"added";case 2:case 3:return"modified";case 1:return"removed";default:return T()}}function dd(n,e){return n instanceof We&&e instanceof We?n._firestore===e._firestore&&n._key.isEqual(e._key)&&(null===n._document?null===e._document:n._document.isEqual(e._document))&&n._converter===e._converter:n instanceof dt&&e instanceof dt&&n._firestore===e._firestore&&td(n.query,e.query)&&n.metadata.isEqual(e.metadata)&&n._snapshot.isEqual(e._snapshot)}function fd(n){if("L"===n.limitType&&0===n.explicitOrderBy.length)throw new v(m.UNIMPLEMENTED,"limitToLast() queries require specifying at least one orderBy() clause")}class Dr{}function ft(n,...e){for(const t of e)n=t._apply(n);return n}class xy extends Dr{constructor(e,t,r){super(),this.fa=e,this.da=t,this._a=r,this.type="where"}_apply(e){const t=Bt(e.firestore),r=function(s,i,o,a,u,c,l){let h;if(u.isKeyField()){if("array-contains"===c||"array-contains-any"===c)throw new v(m.INVALID_ARGUMENT,`Invalid Query. You can't perform '${c}' queries on documentId().`);if("in"===c||"not-in"===c){wd(l,c);const g=[];for(const y of l)g.push(vd(a,s,y));h={arrayValue:{values:g}}}else h=vd(a,s,l)}else"in"!==c&&"not-in"!==c&&"array-contains-any"!==c||wd(l,c),h=ud(o,"where",l,"in"===c||"not-in"===c);const d=ge.create(u,c,h);return function(g,y){if(y.ht()){const S=Ji(g);if(null!==S&&!S.isEqual(y.field))throw new v(m.INVALID_ARGUMENT,`Invalid query. All where filters with an inequality (<, <=, !=, not-in, >, or >=) must be on the same field. But you have inequality filters on '${S.toString()}' and '${y.field.toString()}'`);const V=Yi(g);null!==V&&Id(0,y.field,V)}const x=function(S,V){for(const G of S.filters)if(V.indexOf(G.op)>=0)return G.op;return null}(g,function(S){switch(S){case"!=":return["!=","not-in"];case"array-contains":return["array-contains","array-contains-any","not-in"];case"in":return["array-contains-any","in","not-in"];case"array-contains-any":return["array-contains","array-contains-any","in","not-in"];case"not-in":return["array-contains","array-contains-any","in","not-in","!="];default:return[]}}(y.op));if(null!==x)throw new v(m.INVALID_ARGUMENT,x===y.op?`Invalid query. You cannot use more than one '${y.op.toString()}' filter.`:`Invalid query. You cannot use '${y.op.toString()}' filters with '${x.toString()}' filters.`)}(s,d),d}(e._query,0,t,e.firestore._databaseId,this.fa,this.da,this._a);return new ye(e.firestore,e.converter,function(s,i){const o=s.filters.concat([i]);return new ze(s.path,s.collectionGroup,s.explicitOrderBy.slice(),o,s.limit,s.limitType,s.startAt,s.endAt)}(e._query,r))}}class Ty extends Dr{constructor(e,t){super(),this.fa=e,this.wa=t,this.type="orderBy"}_apply(e){const t=function(r,s,i){if(null!==r.startAt)throw new v(m.INVALID_ARGUMENT,"Invalid query. You must not call startAt() or startAfter() before calling orderBy().");if(null!==r.endAt)throw new v(m.INVALID_ARGUMENT,"Invalid query. You must not call endAt() or endBefore() before calling orderBy().");const o=new nn(s,i);return function(a,u){if(null===Yi(a)){const c=Ji(a);null!==c&&Id(0,c,u.field)}}(r,o),o}(e._query,this.fa,this.wa);return new ye(e.firestore,e.converter,function(r,s){const i=r.explicitOrderBy.concat([s]);return new ze(r.path,r.collectionGroup,i,r.filters.slice(),r.limit,r.limitType,r.startAt,r.endAt)}(e._query,t))}}class md extends Dr{constructor(e,t,r){super(),this.type=e,this.ma=t,this.ga=r}_apply(e){return new ye(e.firestore,e.converter,zc(e._query,this.ma,this.ga))}}class gd extends Dr{constructor(e,t,r){super(),this.type=e,this.ya=t,this.pa=r}_apply(e){const t=yd(e,this.type,this.ya,this.pa);return new ye(e.firestore,e.converter,(s=t,new ze((r=e._query).path,r.collectionGroup,r.explicitOrderBy.slice(),r.filters.slice(),r.limit,r.limitType,s,r.endAt)));var r,s}}class pd extends Dr{constructor(e,t,r){super(),this.type=e,this.ya=t,this.pa=r}_apply(e){const t=yd(e,this.type,this.ya,this.pa);return new ye(e.firestore,e.converter,(s=t,new ze((r=e._query).path,r.collectionGroup,r.explicitOrderBy.slice(),r.filters.slice(),r.limit,r.limitType,r.startAt,s)));var r,s}}function yd(n,e,t,r){if(t[0]=(0,L.m9)(t[0]),t[0]instanceof Sr)return function(s,i,o,a,u){if(!a)throw new v(m.NOT_FOUND,`Can't use a DocumentSnapshot that doesn't exist for ${o}().`);const c=[];for(const l of sn(s))if(l.field.isKeyField())c.push(Dt(i,a.key));else{const h=a.data.field(l.field);if(Hi(h))throw new v(m.INVALID_ARGUMENT,'Invalid query. You are trying to start or end a query using a document for which the field "'+l.field+'" is an uncommitted server timestamp. (Since the value of this field is unknown, you cannot start/end a query with it.)');if(null===h){const d=l.field.canonicalString();throw new v(m.INVALID_ARGUMENT,`Invalid query. You are trying to start or end a query using a document for which the field '${d}' (used as the orderBy) does not exist.`)}c.push(h)}return new it(c,u)}(n._query,n.firestore._databaseId,e,t[0]._document,r);{const s=Bt(n.firestore);return function(i,o,a,u,c,l){const h=i.explicitOrderBy;if(c.length>h.length)throw new v(m.INVALID_ARGUMENT,`Too many arguments provided to ${u}(). The number of arguments must be less than or equal to the number of orderBy() clauses`);const d=[];for(let g=0;g<c.length;g++){const y=c[g];if(h[g].field.isKeyField()){if("string"!=typeof y)throw new v(m.INVALID_ARGUMENT,`Invalid query. Expected a string for document ID in ${u}(), but got a ${typeof y}`);if(!eo(i)&&-1!==y.indexOf("/"))throw new v(m.INVALID_ARGUMENT,`Invalid query. When querying a collection and ordering by documentId(), the value passed to ${u}() must be a plain document ID, but '${y}' contains a slash.`);const x=i.path.child(M.fromString(y));if(!I.isDocumentKey(x))throw new v(m.INVALID_ARGUMENT,`Invalid query. When querying a collection group and ordering by documentId(), the value passed to ${u}() must result in a valid document path, but '${x}' is not because it contains an odd number of segments.`);const S=new I(x);d.push(Dt(o,S))}else{const x=ud(a,u,y);d.push(x)}}return new it(d,l)}(n._query,n.firestore._databaseId,s,e,t,r)}}function vd(n,e,t){if("string"==typeof(t=(0,L.m9)(t))){if(""===t)throw new v(m.INVALID_ARGUMENT,"Invalid query. When querying with documentId(), you must provide a valid document ID, but it was an empty string.");if(!eo(e)&&-1!==t.indexOf("/"))throw new v(m.INVALID_ARGUMENT,`Invalid query. When querying a collection by documentId(), you must provide a plain document ID, but '${t}' contains a '/' character.`);const r=e.path.child(M.fromString(t));if(!I.isDocumentKey(r))throw new v(m.INVALID_ARGUMENT,`Invalid query. When querying a collection group by documentId(), the value provided must result in a valid document path, but '${r}' is not because it has an odd number of segments (${r.length}).`);return Dt(n,new I(r))}if(t instanceof q)return Dt(n,t._key);throw new v(m.INVALID_ARGUMENT,`Invalid query. When querying with documentId(), you must provide a valid string or a DocumentReference, but it was: ${Ps(t)}.`)}function wd(n,e){if(!Array.isArray(n)||0===n.length)throw new v(m.INVALID_ARGUMENT,`Invalid Query. A non-empty array is required for '${e.toString()}' filters.`);if(n.length>10)throw new v(m.INVALID_ARGUMENT,`Invalid Query. '${e.toString()}' filters support a maximum of 10 elements in the value array.`)}function Id(n,e,t){if(!t.isEqual(e))throw new v(m.INVALID_ARGUMENT,`Invalid query. You have a where filter with an inequality (<, <=, !=, not-in, >, or >=) on field '${e.toString()}' and so you must also use '${e.toString()}' as your first argument to orderBy(), but your first orderBy() is on field '${t.toString()}' instead.`)}const Ry={maxAttempts:5};class Ba{convertValue(e,t="none"){switch(bt(e)){case 0:return null;case 1:return e.booleanValue;case 2:return W(e.integerValue||e.doubleValue);case 3:return this.convertTimestamp(e.timestampValue);case 4:return this.convertServerTimestamp(e,t);case 5:return e.stringValue;case 6:return this.convertBytes(St(e.bytesValue));case 7:return this.convertReference(e.referenceValue);case 8:return this.convertGeoPoint(e.geoPointValue);case 9:return this.convertArray(e.arrayValue,t);case 10:return this.convertObject(e.mapValue,t);default:throw T()}}convertObject(e,t){const r={};return Tt(e.fields,(s,i)=>{r[s]=this.convertValue(i,t)}),r}convertGeoPoint(e){return new Bs(W(e.latitude),W(e.longitude))}convertArray(e,t){return(e.values||[]).map(r=>this.convertValue(r,t))}convertServerTimestamp(e,t){switch(t){case"previous":const r=Nc(e);return null==r?null:this.convertValue(r,t);case"estimate":return this.convertTimestamp(Zn(e));default:return null}}convertTimestamp(e){const t=nt(e);return new $(t.seconds,t.nanos)}convertDocumentKey(e,t){const r=M.fromString(e);D(Cl(r));const s=new $e(r.get(1),r.get(3)),i=new I(r.popFirst(5));return s.isEqual(t)||J(`Document ${i} contains a document reference within a different database (${s.projectId}/${s.database}) which is not supported. It will be treated as a reference in the current database (${t.projectId}/${t.database}) instead.`),i}}function zs(n,e,t){let r;return r=n?t&&(t.merge||t.mergeFields)?n.toFirestore(e,t):n.toFirestore(e):e,r}class My extends Ba{constructor(e){super(),this.firestore=e}convertBytes(e){return new qe(e)}convertReference(e){const t=this.convertDocumentKey(e,this.firestore._databaseId);return new q(this.firestore,null,t)}}class _d{constructor(e,t){this._firestore=e,this._commitHandler=t,this._mutations=[],this._committed=!1,this._dataReader=Bt(e)}set(e,t,r){this._verifyNotCommitted();const s=mt(e,this._firestore),i=zs(s.converter,t,r),o=Gs(this._dataReader,"WriteBatch.set",s._key,i,null!==s.converter,r);return this._mutations.push(o.toMutation(s._key,Q.none())),this}update(e,t,r,...s){this._verifyNotCommitted();const i=mt(e,this._firestore);let o;return o="string"==typeof(t=(0,L.m9)(t))||t instanceof He?Va(this._dataReader,"WriteBatch.update",i._key,t,r,s):Oa(this._dataReader,"WriteBatch.update",i._key,t),this._mutations.push(o.toMutation(i._key,Q.exists(!0))),this}delete(e){this._verifyNotCommitted();const t=mt(e,this._firestore);return this._mutations=this._mutations.concat(new cn(t._key,Q.none())),this}commit(){return this._verifyNotCommitted(),this._committed=!0,this._mutations.length>0?this._commitHandler(this._mutations):Promise.resolve()}_verifyNotCommitted(){if(this._committed)throw new v(m.FAILED_PRECONDITION,"A write batch can no longer be used after commit() has been called.")}}function mt(n,e){if((n=(0,L.m9)(n)).firestore!==e)throw new v(m.INVALID_ARGUMENT,"Provided document reference is from a different Firestore instance.");return n}class Kt extends Ba{constructor(e){super(),this.firestore=e}convertBytes(e){return new qe(e)}convertReference(e){const t=this.convertDocumentKey(e,this.firestore._databaseId);return new q(this.firestore,null,t)}}function xd(n,e,t){n=R(n,q);const r=R(n.firestore,z),s=zs(n.converter,e,t);return Tn(r,[Gs(Bt(r),"setDoc",n._key,s,null!==n.converter,t).toMutation(n._key,Q.none())])}function Ed(n,e,t,...r){n=R(n,q);const s=R(n.firestore,z),i=Bt(s);let o;return o="string"==typeof(e=(0,L.m9)(e))||e instanceof He?Va(i,"updateDoc",n._key,e,t,r):Oa(i,"updateDoc",n._key,e),Tn(s,[o.toMutation(n._key,Q.exists(!0))])}function Td(n,...e){var t,r,s;n=(0,L.m9)(n);let i={includeMetadataChanges:!1},o=0;"object"!=typeof e[o]||Fa(e[o])||(i=e[o],o++);const a={includeMetadataChanges:i.includeMetadataChanges};if(Fa(e[o])){const h=e[o];e[o]=null===(t=h.next)||void 0===t?void 0:t.bind(h),e[o+1]=null===(r=h.error)||void 0===r?void 0:r.bind(h),e[o+2]=null===(s=h.complete)||void 0===s?void 0:s.bind(h)}let u,c,l;if(n instanceof q)c=R(n.firestore,z),l=rn(n._key.path),u={next:h=>{e[o]&&e[o](qa(c,n,h))},error:e[o+1],complete:e[o+2]};else{const h=R(n,ye);c=R(h.firestore,z),l=h._query;const d=new Kt(c);u={next:g=>{e[o]&&e[o](new dt(c,d,h,g))},error:e[o+1],complete:e[o+2]},fd(n._query)}return function(h,d,g,y){const x=new Os(y),S=new Yo(d,x,g);return h.asyncQueue.enqueueAndForget((0,p.Z)(function*(){return Qo(yield En(h),S)})),()=>{x.Tc(),h.asyncQueue.enqueueAndForget((0,p.Z)(function*(){return Ho(yield En(h),S)}))}}(te(c),l,a,u)}function Tn(n,e){return function(t,r){const s=new oe;return t.asyncQueue.enqueueAndForget((0,p.Z)(function*(){return function Sp(n,e,t){return ra.apply(this,arguments)}(yield ka(t),r,s)})),s.promise}(te(n),e)}function qa(n,e,t){const r=t.docs.get(e._key),s=new Kt(n);return new We(n,s,e._key,r,new Gt(t.hasPendingWrites,t.fromCache),e.converter)}class Ky extends class{constructor(e,t){this._firestore=e,this._transaction=t,this._dataReader=Bt(e)}get(e){const t=mt(e,this._firestore),r=new My(this._firestore);return this._transaction.lookup([t._key]).then(s=>{if(!s||1!==s.length)return T();const i=s[0];if(i.isFoundDocument())return new Sr(this._firestore,r,i.key,i,t.converter);if(i.isNoDocument())return new Sr(this._firestore,r,t._key,null,t.converter);throw T()})}set(e,t,r){const s=mt(e,this._firestore),i=zs(s.converter,t,r),o=Gs(this._dataReader,"Transaction.set",s._key,i,null!==s.converter,r);return this._transaction.set(s._key,o),this}update(e,t,r,...s){const i=mt(e,this._firestore);let o;return o="string"==typeof(t=(0,L.m9)(t))||t instanceof He?Va(this._dataReader,"Transaction.update",i._key,t,r,s):Oa(this._dataReader,"Transaction.update",i._key,t),this._transaction.update(i._key,o),this}delete(e){const t=mt(e,this._firestore);return this._transaction.delete(t._key),this}}{constructor(e,t){super(e,t),this._firestore=e}get(e){const t=mt(e,this._firestore),r=new Kt(this._firestore);return super.get(e).then(s=>new We(this._firestore,r,t._key,s._document,new Gt(!1,!1),t.converter))}}function Ga(n,e){if(void 0===e)return{merge:!1};if(void 0!==e.mergeFields&&void 0!==e.merge)throw new v("invalid-argument",`Invalid options passed to function ${n}(): You cannot specify both "merge" and "mergeFields".`);return e}function bd(){if(typeof Uint8Array>"u")throw new v("unimplemented","Uint8Arrays are not available in this environment.")}function Dd(){if(!function fm(){return typeof atob<"u"}())throw new v("unimplemented","Blobs are unavailable in Firestore in this environment.")}!function(n,e=!0){Yt=Fr.SDK_VERSION,(0,Fr._registerComponent)(new tu.wA("firestore",(t,{options:r})=>{const s=t.getProvider("app").getImmediate(),i=new z(s,new rm(t.getProvider("auth-internal")),new om(t.getProvider("app-check-internal")));return r=Object.assign({useFetchStreams:e},r),i._setSettings(r),i},"PUBLIC")),(0,Fr.registerVersion)(yc,"3.4.13",n),(0,Fr.registerVersion)(yc,"3.4.13","esm2017")}();class Ar{constructor(e){this._delegate=e}static fromBase64String(e){return Dd(),new Ar(qe.fromBase64String(e))}static fromUint8Array(e){return bd(),new Ar(qe.fromUint8Array(e))}toBase64(){return Dd(),this._delegate.toBase64()}toUint8Array(){return bd(),this._delegate.toUint8Array()}isEqual(e){return this._delegate.isEqual(e._delegate)}toString(){return"Blob(base64: "+this.toBase64()+")"}}function Ka(n){return function Yy(n,e){if("object"!=typeof n||null===n)return!1;const t=n;for(const r of e)if(r in t&&"function"==typeof t[r])return!0;return!1}(n,["next","error","complete"])}class Jy{enableIndexedDbPersistence(e,t){return function iy(n,e){sd(n=R(n,z));const t=te(n),r=n._freezeSettings(),s=new Ta;return rd(t,s,new Uh(s,r.cacheSizeBytes,e?.forceOwnership))}(e._delegate,{forceOwnership:t})}enableMultiTabIndexedDbPersistence(e){return function oy(n){sd(n=R(n,z));const e=te(n),t=n._freezeSettings(),r=new Ta;return rd(e,r,new qp(r,t.cacheSizeBytes))}(e._delegate)}clearIndexedDbPersistence(e){return function ay(n){if(n._initialized&&!n._terminated)throw new v(m.FAILED_PRECONDITION,"Persistence can only be cleared before a Firestore instance is initialized or after it is terminated.");const e=new oe;return n._queue.enqueueAndForgetEvenWhileRestricted((0,p.Z)(function*(){try{yield(t=(0,p.Z)(function*(r){if(!Le.V())return Promise.resolve();const s=r+"main";yield Le.delete(s)}),function(r){return t.apply(this,arguments)})(vo(n._databaseId,n._persistenceKey)),e.resolve()}catch(t){e.reject(t)}var t})),e.promise}(e._delegate)}}class Ad{constructor(e,t,r){this._delegate=t,this._persistenceProvider=r,this.INTERNAL={delete:()=>this.terminate()},e instanceof $e||(this._appCompat=e)}get _databaseId(){return this._delegate._databaseId}settings(e){const t=this._delegate._getSettings();!e.merge&&t.host!==e.host&&jn("You are overriding the original host. If you did not intend to override your settings, use {merge: true}."),e.merge&&delete(e=Object.assign(Object.assign({},t),e)).merge,this._delegate._setSettings(e)}useEmulator(e,t,r={}){!function ey(n,e,t,r={}){var s;const i=(n=R(n,Er))._getSettings();if("firestore.googleapis.com"!==i.host&&i.host!==e&&jn("Host has been set in both settings() and useEmulator(), emulator host will be used"),n._setSettings(Object.assign(Object.assign({},i),{host:`${e}:${t}`,ssl:!1})),r.mockUserToken){let o,a;if("string"==typeof r.mockUserToken)o=r.mockUserToken,a=ie.MOCK_USER;else{o=(0,L.Sg)(r.mockUserToken,null===(s=n._app)||void 0===s?void 0:s.options.projectId);const u=r.mockUserToken.sub||r.mockUserToken.user_id;if(!u)throw new v(m.INVALID_ARGUMENT,"mockUserToken must contain 'sub' or 'user_id' field!");a=new ie(u)}n._authCredentials=new nm(new vc(o,a))}}(this._delegate,e,t,r)}enableNetwork(){return function cy(n){return function zp(n){return n.asyncQueue.enqueue((0,p.Z)(function*(){const e=yield Kh(n),t=yield jh(n);return e.setNetworkEnabled(!0),function(r){const s=_(r);return s.lu.delete(0),_r(s)}(t)}))}(te(n=R(n,z)))}(this._delegate)}disableNetwork(){return function ly(n){return function Qp(n){return n.asyncQueue.enqueue((0,p.Z)(function*(){const e=yield Kh(n),t=yield jh(n);return e.setNetworkEnabled(!1),(r=(0,p.Z)(function*(s){const i=_(s);i.lu.add(0),yield pn(i),i._u.set("Offline")}),function(s){return r.apply(this,arguments)})(t);var r}))}(te(n=R(n,z)))}(this._delegate)}enablePersistence(e){let t=!1,r=!1;return e&&(t=!!e.synchronizeTabs,r=!!e.experimentalForceOwningTab,Zh("synchronizeTabs",t,"experimentalForceOwningTab",r)),t?this._persistenceProvider.enableMultiTabIndexedDbPersistence(this):this._persistenceProvider.enableIndexedDbPersistence(this,r)}clearPersistence(){return this._persistenceProvider.clearIndexedDbPersistence(this)}terminate(){return this._appCompat&&(this._appCompat._removeServiceInstance("firestore-compat"),this._appCompat._removeServiceInstance("firestore")),this._delegate._delete()}waitForPendingWrites(){return function uy(n){return function(e){const t=new oe;return e.asyncQueue.enqueueAndForget((0,p.Z)(function*(){return function Cp(n,e){return ua.apply(this,arguments)}(yield ka(e),t)})),t.promise}(te(n=R(n,z)))}(this._delegate)}onSnapshotsInSync(e){return function Gy(n,e){return function Wp(n,e){const t=new Os(e);return n.asyncQueue.enqueueAndForget((0,p.Z)(function*(){return r=yield En(n),s=t,_(r).Tu.add(s),void s.next();var r,s})),()=>{t.Tc(),n.asyncQueue.enqueueAndForget((0,p.Z)(function*(){return r=yield En(n),s=t,void _(r).Tu.delete(s);var r,s}))}}(te(n=R(n,z)),Fa(e)?e:{next:e})}(this._delegate,e)}get app(){if(!this._appCompat)throw new v("failed-precondition","Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._appCompat}collection(e){try{return new Sn(this,Jh(this._delegate,e))}catch(t){throw Ee(t,"collection()","Firestore.collection()")}}doc(e){try{return new Fe(this,Us(this._delegate,e))}catch(t){throw Ee(t,"doc()","Firestore.doc()")}}collectionGroup(e){try{return new Te(this,function ty(n,e){if(n=R(n,Er),Ma("collectionGroup","collection id",e),e.indexOf("/")>=0)throw new v(m.INVALID_ARGUMENT,`Invalid collection ID '${e}' passed to function collectionGroup(). Collection IDs must not contain '/'.`);return new ye(n,null,(t=e,new ze(M.emptyPath(),t)));var t}(this._delegate,e))}catch(t){throw Ee(t,"collectionGroup()","Firestore.collectionGroup()")}}runTransaction(e){return function jy(n,e,t){n=R(n,z);const r=Object.assign(Object.assign({},Ry),t);return function(s){if(s.maxAttempts<1)throw new v(m.INVALID_ARGUMENT,"Max attempts must be at least 1")}(r),function Xp(n,e,t){const r=new oe;return n.asyncQueue.enqueueAndForget((0,p.Z)(function*(){const s=yield(i=n,Vs(i).then(o=>o.datastore));var i;new jp(n.asyncQueue,s,t,e,r).run()})),r.promise}(te(n),s=>e(new Ky(n,s)),r)}(this._delegate,t=>e(new Cd(this,t)))}batch(){return te(this._delegate),new Nd(new _d(this._delegate,e=>Tn(this._delegate,e)))}loadBundle(e){return function hy(n,e){const t=te(n=R(n,z)),r=new ry;return function Yp(n,e,t,r){const s=function(i,o){let a;return a="string"==typeof i?(new TextEncoder).encode(i):i,u=function(u,c){if(u instanceof Uint8Array)return Bh(u,c);if(u instanceof ArrayBuffer)return Bh(new Uint8Array(u),c);if(u instanceof ReadableStream)return u.getReader();throw new Error("Source of `toByteStreamReader` has to be a ArrayBuffer or ReadableStream")}(a),new Gp(u,o);var u}(t,Ir(e));n.asyncQueue.enqueueAndForget((0,p.Z)(function*(){!function Bp(n,e,t){const r=_(n);var s;(s=(0,p.Z)(function*(i,o,a){try{const u=yield o.getMetadata();if(yield function(d,g){const y=_(d),x=ae(g.createTime);return y.persistence.runTransaction("hasNewerBundle","readonly",S=>y.Ds.getBundleMetadata(S,g.id)).then(S=>!!S&&S.createTime.compareTo(x)>=0)}(i.localStore,u))return yield o.close(),a._completeWith({taskState:"Success",documentsLoaded:(d=u).totalDocuments,bytesLoaded:d.totalBytes,totalDocuments:d.totalDocuments,totalBytes:d.totalBytes}),Promise.resolve(new Set);a._updateProgress(Ch(u));const c=new wp(u,i.localStore,o.wt);let l=yield o.fc();for(;l;){const d=yield c.Nu(l);d&&a._updateProgress(d),l=yield o.fc()}const h=yield c.complete();return yield Ze(i,h.Mu,void 0),yield function(d,g){const y=_(d);return y.persistence.runTransaction("Save bundle","readwrite",x=>y.Ds.saveBundleMetadata(x,g))}(i.localStore,u),a._completeWith(h.progress),Promise.resolve(h.Ou)}catch(u){return jn("SyncEngine",`Loading bundle failed with ${u}`),a._failWith(u),Promise.resolve(new Set)}var d}),function(i,o,a){return s.apply(this,arguments)})(r,e,t).then(s=>{r.sharedClientState.notifyBundleLoaded(s)})}(yield ka(n),s,r)}))}(t,n._databaseId,e,r),r}(this._delegate,e)}namedQuery(e){return function dy(n,e){return function Jp(n,e){return n.asyncQueue.enqueue((0,p.Z)(function*(){return function(t,r){const s=_(t);return s.persistence.runTransaction("Get named query","readonly",i=>s.Ds.getNamedQuery(i,r))}(yield Na(n),e)}))}(te(n=R(n,z)),e).then(t=>t?new ye(n,null,t.query):null)}(this._delegate,e).then(t=>t?new Te(this,t):null)}}class Qs extends Ba{constructor(e){super(),this.firestore=e}convertBytes(e){return new Ar(new qe(e))}convertReference(e){const t=this.convertDocumentKey(e,this.firestore._databaseId);return Fe.forKey(t,this.firestore,null)}}class Cd{constructor(e,t){this._firestore=e,this._delegate=t,this._userDataWriter=new Qs(e)}get(e){const t=$t(e);return this._delegate.get(t).then(r=>new Cr(this._firestore,new We(this._firestore._delegate,this._userDataWriter,r._key,r._document,r.metadata,t.converter)))}set(e,t,r){const s=$t(e);return r?(Ga("Transaction.set",r),this._delegate.set(s,t,r)):this._delegate.set(s,t),this}update(e,t,r,...s){const i=$t(e);return 2===arguments.length?this._delegate.update(i,t):this._delegate.update(i,t,r,...s),this}delete(e){const t=$t(e);return this._delegate.delete(t),this}}class Nd{constructor(e){this._delegate=e}set(e,t,r){const s=$t(e);return r?(Ga("WriteBatch.set",r),this._delegate.set(s,t,r)):this._delegate.set(s,t),this}update(e,t,r,...s){const i=$t(e);return 2===arguments.length?this._delegate.update(i,t):this._delegate.update(i,t,r,...s),this}delete(e){const t=$t(e);return this._delegate.delete(t),this}commit(){return this._delegate.commit()}}class jt{constructor(e,t,r){this._firestore=e,this._userDataWriter=t,this._delegate=r}fromFirestore(e,t){const r=new br(this._firestore._delegate,this._userDataWriter,e._key,e._document,e.metadata,null);return this._delegate.fromFirestore(new Nr(this._firestore,r),t??{})}toFirestore(e,t){return t?this._delegate.toFirestore(e,t):this._delegate.toFirestore(e)}static getInstance(e,t){const r=jt.INSTANCES;let s=r.get(e);s||(s=new WeakMap,r.set(e,s));let i=s.get(t);return i||(i=new jt(e,new Qs(e),t),s.set(t,i)),i}}jt.INSTANCES=new WeakMap;class Fe{constructor(e,t){this.firestore=e,this._delegate=t,this._userDataWriter=new Qs(e)}static forPath(e,t,r){if(e.length%2!=0)throw new v("invalid-argument",`Invalid document reference. Document references must have an even number of segments, but ${e.canonicalString()} has ${e.length}`);return new Fe(t,new q(t._delegate,r,new I(e)))}static forKey(e,t,r){return new Fe(t,new q(t._delegate,r,e))}get id(){return this._delegate.id}get parent(){return new Sn(this.firestore,this._delegate.parent)}get path(){return this._delegate.path}collection(e){try{return new Sn(this.firestore,Jh(this._delegate,e))}catch(t){throw Ee(t,"collection()","DocumentReference.collection()")}}isEqual(e){return(e=(0,L.m9)(e))instanceof q&&ed(this._delegate,e)}set(e,t){t=Ga("DocumentReference.set",t);try{return t?xd(this._delegate,e,t):xd(this._delegate,e)}catch(r){throw Ee(r,"setDoc()","DocumentReference.set()")}}update(e,t,...r){try{return 1===arguments.length?Ed(this._delegate,e):Ed(this._delegate,e,t,...r)}catch(s){throw Ee(s,"updateDoc()","DocumentReference.update()")}}delete(){return function By(n){return Tn(R(n.firestore,z),[new cn(n._key,Q.none())])}(this._delegate)}onSnapshot(...e){const t=kd(e),r=Rd(e,s=>new Cr(this.firestore,new We(this.firestore._delegate,this._userDataWriter,s._key,s._document,s.metadata,this._delegate.converter)));return Td(this._delegate,t,r)}get(e){let t;return t="cache"===e?.source?function Ly(n){n=R(n,q);const e=R(n.firestore,z),t=te(e),r=new Kt(e);return function Zp(n,e){const t=new oe;return n.asyncQueue.enqueueAndForget((0,p.Z)(function*(){return(r=(0,p.Z)(function*(s,i,o){try{const a=yield function(u,c){const l=_(u);return l.persistence.runTransaction("read document","readonly",h=>l.localDocuments.getDocument(h,c))}(s,i);a.isFoundDocument()?o.resolve(a):a.isNoDocument()?o.resolve(null):o.reject(new v(m.UNAVAILABLE,"Failed to get document from cache. (However, this document may exist on the server. Run again without setting 'source' in the GetOptions to attempt to retrieve the document from the server.)"))}catch(a){const u=wn(a,`Failed to get document '${i} from cache`);o.reject(u)}}),function(s,i,o){return r.apply(this,arguments)})(yield Na(n),e,t);var r})),t.promise}(t,n._key).then(s=>new We(e,r,n._key,s,new Gt(null!==s&&s.hasLocalMutations,!0),n.converter))}(this._delegate):"server"===e?.source?function Oy(n){n=R(n,q);const e=R(n.firestore,z);return $h(te(e),n._key,{source:"server"}).then(t=>qa(e,n,t))}(this._delegate):function Fy(n){n=R(n,q);const e=R(n.firestore,z);return $h(te(e),n._key).then(t=>qa(e,n,t))}(this._delegate),t.then(r=>new Cr(this.firestore,new We(this.firestore._delegate,this._userDataWriter,r._key,r._document,r.metadata,this._delegate.converter)))}withConverter(e){return new Fe(this.firestore,this._delegate.withConverter(e?jt.getInstance(this.firestore,e):null))}}function Ee(n,e,t){return n.message=n.message.replace(e,t),n}function kd(n){for(const e of n)if("object"==typeof e&&!Ka(e))return e;return{}}function Rd(n,e){var t,r;let s;return s=Ka(n[0])?n[0]:Ka(n[1])?n[1]:"function"==typeof n[0]?{next:n[0],error:n[1],complete:n[2]}:{next:n[1],error:n[2],complete:n[3]},{next:i=>{s.next&&s.next(e(i))},error:null===(t=s.error)||void 0===t?void 0:t.bind(s),complete:null===(r=s.complete)||void 0===r?void 0:r.bind(s)}}class Cr{constructor(e,t){this._firestore=e,this._delegate=t}get ref(){return new Fe(this._firestore,this._delegate.ref)}get id(){return this._delegate.id}get metadata(){return this._delegate.metadata}get exists(){return this._delegate.exists()}data(e){return this._delegate.data(e)}get(e,t){return this._delegate.get(e,t)}isEqual(e){return dd(this._delegate,e._delegate)}}class Nr extends Cr{data(e){const t=this._delegate.data(e);return function em(n,e){n||T()}(void 0!==t),t}}class Te{constructor(e,t){this.firestore=e,this._delegate=t,this._userDataWriter=new Qs(e)}where(e,t,r){try{return new Te(this.firestore,ft(this._delegate,function Ey(n,e,t){const r=e,s=$s("where",n);return new xy(s,r,t)}(e,t,r)))}catch(s){throw Ee(s,/(orderBy|where)\(\)/,"Query.$1()")}}orderBy(e,t){try{return new Te(this.firestore,ft(this._delegate,function Sy(n,e="asc"){const t=e,r=$s("orderBy",n);return new Ty(r,t)}(e,t)))}catch(r){throw Ee(r,/(orderBy|where)\(\)/,"Query.$1()")}}limit(e){try{return new Te(this.firestore,ft(this._delegate,function by(n){return Xh("limit",n),new md("limit",n,"F")}(e)))}catch(t){throw Ee(t,"limit()","Query.limit()")}}limitToLast(e){try{return new Te(this.firestore,ft(this._delegate,function Dy(n){return Xh("limitToLast",n),new md("limitToLast",n,"L")}(e)))}catch(t){throw Ee(t,"limitToLast()","Query.limitToLast()")}}startAt(...e){try{return new Te(this.firestore,ft(this._delegate,function Ay(...n){return new gd("startAt",n,!0)}(...e)))}catch(t){throw Ee(t,"startAt()","Query.startAt()")}}startAfter(...e){try{return new Te(this.firestore,ft(this._delegate,function Cy(...n){return new gd("startAfter",n,!1)}(...e)))}catch(t){throw Ee(t,"startAfter()","Query.startAfter()")}}endBefore(...e){try{return new Te(this.firestore,ft(this._delegate,function Ny(...n){return new pd("endBefore",n,!1)}(...e)))}catch(t){throw Ee(t,"endBefore()","Query.endBefore()")}}endAt(...e){try{return new Te(this.firestore,ft(this._delegate,function ky(...n){return new pd("endAt",n,!0)}(...e)))}catch(t){throw Ee(t,"endAt()","Query.endAt()")}}isEqual(e){return td(this._delegate,e._delegate)}get(e){let t;return t="cache"===e?.source?function Py(n){n=R(n,ye);const e=R(n.firestore,z),t=te(e),r=new Kt(e);return function Hp(n,e){const t=new oe;return n.asyncQueue.enqueueAndForget((0,p.Z)(function*(){return(r=(0,p.Z)(function*(s,i,o){try{const a=yield Ns(s,i,!0),u=new Rh(i,a.ji),c=u.Ku(a.documents),l=u.applyChanges(c,!1);o.resolve(l.snapshot)}catch(a){const u=wn(a,`Failed to execute query '${i} against cache`);o.reject(u)}}),function(s,i,o){return r.apply(this,arguments)})(yield Na(n),e,t);var r})),t.promise}(t,n._query).then(s=>new dt(e,r,n,s))}(this._delegate):"server"===e?.source?function Uy(n){n=R(n,ye);const e=R(n.firestore,z),t=te(e),r=new Kt(e);return zh(t,n._query,{source:"server"}).then(s=>new dt(e,r,n,s))}(this._delegate):function Vy(n){n=R(n,ye);const e=R(n.firestore,z),t=te(e),r=new Kt(e);return fd(n._query),zh(t,n._query).then(s=>new dt(e,r,n,s))}(this._delegate),t.then(r=>new ja(this.firestore,new dt(this.firestore._delegate,this._userDataWriter,this._delegate,r._snapshot)))}onSnapshot(...e){const t=kd(e),r=Rd(e,s=>new ja(this.firestore,new dt(this.firestore._delegate,this._userDataWriter,this._delegate,s._snapshot)));return Td(this._delegate,t,r)}withConverter(e){return new Te(this.firestore,this._delegate.withConverter(e?jt.getInstance(this.firestore,e):null))}}class tv{constructor(e,t){this._firestore=e,this._delegate=t}get type(){return this._delegate.type}get doc(){return new Nr(this._firestore,this._delegate.doc)}get oldIndex(){return this._delegate.oldIndex}get newIndex(){return this._delegate.newIndex}}class ja{constructor(e,t){this._firestore=e,this._delegate=t}get query(){return new Te(this._firestore,this._delegate.query)}get metadata(){return this._delegate.metadata}get size(){return this._delegate.size}get empty(){return this._delegate.empty}get docs(){return this._delegate.docs.map(e=>new Nr(this._firestore,e))}docChanges(e){return this._delegate.docChanges(e).map(t=>new tv(this._firestore,t))}forEach(e,t){this._delegate.forEach(r=>{e.call(t,new Nr(this._firestore,r))})}isEqual(e){return dd(this._delegate,e._delegate)}}class Sn extends Te{constructor(e,t){super(e,t),this.firestore=e,this._delegate=t}get id(){return this._delegate.id}get path(){return this._delegate.path}get parent(){const e=this._delegate.parent;return e?new Fe(this.firestore,e):null}doc(e){try{return new Fe(this.firestore,void 0===e?Us(this._delegate):Us(this._delegate,e))}catch(t){throw Ee(t,"doc()","CollectionReference.doc()")}}add(e){return function qy(n,e){const t=R(n.firestore,z),r=Us(n),s=zs(n.converter,e);return Tn(t,[Gs(Bt(n.firestore),"addDoc",r._key,s,null!==n.converter,{}).toMutation(r._key,Q.exists(!1))]).then(()=>r)}(this._delegate,e).then(t=>new Fe(this.firestore,t))}isEqual(e){return ed(this._delegate,e._delegate)}withConverter(e){return new Sn(this.firestore,this._delegate.withConverter(e?jt.getInstance(this.firestore,e):null))}}function $t(n){return R(n,q)}class $a{constructor(...e){this._delegate=new He(...e)}static documentId(){return new $a(X.keyField().canonicalString())}isEqual(e){return(e=(0,L.m9)(e))instanceof He&&this._delegate._internalPath.isEqual(e._internalPath)}}class zt{constructor(e){this._delegate=e}static serverTimestamp(){const e=function zy(){return new La("serverTimestamp")}();return e._methodName="FieldValue.serverTimestamp",new zt(e)}static delete(){const e=function $y(){return new Tr("deleteField")}();return e._methodName="FieldValue.delete",new zt(e)}static arrayUnion(...e){const t=function Qy(...n){return new py("arrayUnion",n)}(...e);return t._methodName="FieldValue.arrayUnion",new zt(t)}static arrayRemove(...e){const t=function Zy(...n){return new yy("arrayRemove",n)}(...e);return t._methodName="FieldValue.arrayRemove",new zt(t)}static increment(e){const t=function Hy(n){return new vy("increment",n)}(e);return t._methodName="FieldValue.increment",new zt(t)}isEqual(e){return this._delegate.isEqual(e._delegate)}}const nv={Firestore:Ad,GeoPoint:Bs,Timestamp:$,Blob:Ar,Transaction:Cd,WriteBatch:Nd,DocumentReference:Fe,DocumentSnapshot:Cr,Query:Te,QueryDocumentSnapshot:Nr,QuerySnapshot:ja,CollectionReference:Sn,FieldPath:$a,FieldValue:zt,setLogLevel:function ev(n){!function Jf(n){Je.setLogLevel(n)}(n)},CACHE_SIZE_UNLIMITED:-1};!function sv(n){(function rv(n,e){n.INTERNAL.registerComponent(new tu.wA("firestore-compat",t=>{const r=t.getProvider("app-compat").getImmediate(),s=t.getProvider("firestore").getImmediate();return e(r,s)},"PUBLIC").setServiceProps(Object.assign({},nv)))})(n,(e,t)=>new Ad(e,t,new Jy)),n.registerVersion("@firebase/firestore-compat","0.1.22")}(jd.Z);var gt=O(1205),iv=O(440);function Md(n,e){return function ov(n,e=Ud.z){return new Bd.y(t=>{let r;return null!=e?e.schedule(()=>{r=n.onSnapshot({includeMetadataChanges:!0},t)}):r=n.onSnapshot({includeMetadataChanges:!0},t),()=>{r?.()}})}(n,e)}function za(n,e){return Md(n,e).pipe((0,ke.U)(t=>({payload:t,type:"query"})))}function Zs(n,e){return za(n,e).pipe((0,Hs.O)(void 0),Ws(),(0,ke.U)(([t,r])=>{const s=r.payload.docChanges(),i=s.map(o=>({type:o.type,payload:o}));return t&&JSON.stringify(t.payload.metadata)!==JSON.stringify(r.payload.metadata)&&r.payload.docs.forEach((o,a)=>{const u=s.find(l=>l.doc.ref.isEqual(o.ref)),c=t?.payload.docs.find(l=>l.ref.isEqual(o.ref));u&&JSON.stringify(u.doc.metadata)===JSON.stringify(o.metadata)||!u&&c&&JSON.stringify(c.metadata)===JSON.stringify(o.metadata)||i.push({type:"modified",payload:{oldIndex:a,newIndex:a,type:"modified",doc:o}})}),i}))}function Fd(n,e,t){return Zs(n,t).pipe((0,Xs.R)((r,s)=>function uv(n,e,t){return e.forEach(r=>{t.indexOf(r.type)>-1&&(n=function cv(n,e){switch(e.type){case"added":if(!n[e.newIndex]||!n[e.newIndex].doc.ref.isEqual(e.doc.ref))return Qa(n,e.newIndex,0,e);break;case"modified":if(null==n[e.oldIndex]||n[e.oldIndex].doc.ref.isEqual(e.doc.ref)){if(e.oldIndex!==e.newIndex){const t=n.slice();return t.splice(e.oldIndex,1),t.splice(e.newIndex,0,e),t}return Qa(n,e.newIndex,1,e)}break;case"removed":if(n[e.oldIndex]&&n[e.oldIndex].doc.ref.isEqual(e.doc.ref))return Qa(n,e.oldIndex,1)}return n}(n,r))}),n}(r,s.map(i=>i.payload),e),[]),(0,Kd.x)(),(0,ke.U)(r=>r.map(s=>({type:s.type,payload:s}))))}function Qa(n,e,t,...r){const s=n.slice();return s.splice(e,t,...r),s}function Ld(n){return(!n||0===n.length)&&(n=["added","removed","modified"]),n}O(127);class Od{constructor(e,t,r){this.ref=e,this.query=t,this.afs=r}stateChanges(e){let t=Zs(this.query,this.afs.schedulers.outsideAngular);return e&&e.length>0&&(t=t.pipe((0,ke.U)(r=>r.filter(s=>e.indexOf(s.type)>-1)))),t.pipe((0,Hs.O)(void 0),Ws(),(0,eu.h)(([r,s])=>s.length>0||!r),(0,ke.U)(([r,s])=>s),Re.iC)}auditTrail(e){return this.stateChanges(e).pipe((0,Xs.R)((t,r)=>[...t,...r],[]))}snapshotChanges(e){const t=Ld(e);return Fd(this.query,t,this.afs.schedulers.outsideAngular).pipe(Re.iC)}valueChanges(e={}){return za(this.query,this.afs.schedulers.outsideAngular).pipe((0,ke.U)(t=>t.payload.docs.map(r=>e.idField?Object.assign(Object.assign({},r.data()),{[e.idField]:r.id}):r.data())),Re.iC)}get(e){return(0,Rr.D)(this.query.get(e)).pipe(Re.iC)}add(e){return this.ref.add(e)}doc(e){return new Vd(this.ref.doc(e),this.afs)}}class Vd{constructor(e,t){this.ref=e,this.afs=t}set(e,t){return this.ref.set(e,t)}update(e){return this.ref.update(e)}delete(){return this.ref.delete()}collection(e,t){const r=this.ref.collection(e),{ref:s,query:i}=Pd(r,t);return new Od(s,i,this.afs)}snapshotChanges(){return function av(n,e){return Md(n,e).pipe((0,Hs.O)(void 0),Ws(),(0,ke.U)(([t,r])=>r.exists?t?.exists?{payload:r,type:"modified"}:{payload:r,type:"added"}:{payload:r,type:"removed"}))}(this.ref,this.afs.schedulers.outsideAngular).pipe(Re.iC)}valueChanges(e={}){return this.snapshotChanges().pipe((0,ke.U)(({payload:t})=>e.idField?Object.assign(Object.assign({},t.data()),{[e.idField]:t.id}):t.data()))}get(e){return(0,Rr.D)(this.ref.get(e)).pipe(Re.iC)}}class lv{constructor(e,t){this.query=e,this.afs=t}stateChanges(e){return e&&0!==e.length?Zs(this.query,this.afs.schedulers.outsideAngular).pipe((0,ke.U)(t=>t.filter(r=>e.indexOf(r.type)>-1)),(0,eu.h)(t=>t.length>0),Re.iC):Zs(this.query,this.afs.schedulers.outsideAngular).pipe(Re.iC)}auditTrail(e){return this.stateChanges(e).pipe((0,Xs.R)((t,r)=>[...t,...r],[]))}snapshotChanges(e){const t=Ld(e);return Fd(this.query,t,this.afs.schedulers.outsideAngular).pipe(Re.iC)}valueChanges(e={}){return za(this.query,this.afs.schedulers.outsideAngular).pipe((0,ke.U)(r=>r.payload.docs.map(s=>e.idField?Object.assign({[e.idField]:s.id},s.data()):s.data())),Re.iC)}get(e){return(0,Rr.D)(this.query.get(e)).pipe(Re.iC)}}const hv=new k.OlP("angularfire2.enableFirestorePersistence"),dv=new k.OlP("angularfire2.firestore.persistenceSettings"),fv=new k.OlP("angularfire2.firestore.settings"),mv=new k.OlP("angularfire2.firestore.use-emulator");function Pd(n,e=(t=>t)){return{query:e(n),ref:n}}let gv=(()=>{class n{constructor(t,r,s,i,o,a,u,c,l,h,d,g,y,x,S,V,G){this.schedulers=u;const U=(0,Mr.on)(t,a,r),ne=l;h&&(0,gt.nw)(U,a,d,y,x,S,g,V),[this.firestore,this.persistenceEnabled$]=(0,Mr.cc)(`${U.name}.firestore`,"AngularFirestore",U.name,()=>{const K=a.runOutsideAngular(()=>U.firestore());if(i&&K.settings(i),ne&&K.useEmulator(...ne),s&&!(0,Ha.PM)(o)){const Z=()=>{try{return(0,Rr.D)(K.enablePersistence(c||void 0).then(()=>!0,()=>!1))}catch(ve){return typeof console<"u"&&console.warn(ve),(0,Ja.of)(!1)}};return[K,a.runOutsideAngular(Z)]}return[K,(0,Ja.of)(!1)]},[i,ne,s])}collection(t,r){let s;s="string"==typeof t?this.firestore.collection(t):t;const{ref:i,query:o}=Pd(s,r),a=this.schedulers.ngZone.run(()=>i);return new Od(a,o,this)}collectionGroup(t,r){const s=r||(o=>o),i=this.firestore.collectionGroup(t);return new lv(s(i),this)}doc(t){let r;r="string"==typeof t?this.firestore.doc(t):t;const s=this.schedulers.ngZone.run(()=>r);return new Vd(s,this)}createId(){return this.firestore.collection("_").doc().id}}return n.\u0275fac=function(t){return new(t||n)(k.LFG(Mr.Dh),k.LFG(Mr.xv,8),k.LFG(hv,8),k.LFG(fv,8),k.LFG(k.Lbi),k.LFG(k.R0b),k.LFG(Re.HU),k.LFG(dv,8),k.LFG(mv,8),k.LFG(gt.zQ,8),k.LFG(gt.Qv,8),k.LFG(gt.L6,8),k.LFG(gt._Q,8),k.LFG(gt.rT,8),k.LFG(gt.lh,8),k.LFG(gt.f7,8),k.LFG(iv.nm,8))},n.\u0275prov=k.Yz7({token:n,factory:n.\u0275fac,providedIn:"any"}),n})();var pv=O(3511);let yv=(()=>{class n{constructor(t,r){this.$store=t,this.$overlay=r}request(t,r=!0){const s=r?this.$overlay.startLoading():"",i=document.activeElement;return i.blur(),{create:(o,a)=>a?this.getDoc(t,a).set(o).then(()=>this.$overlay.endLoading(s,i)):this.getCollection(t).add(o).then(()=>this.$overlay.endLoading(s,i)),read:o=>o?this.readDocument(t,o,s,i):this.readCollection(t,s,i),read$:o=>o?this.getDoc(t,o).get().pipe((0,Xa.x)(()=>this.$overlay.endLoading(s,i)),(0,ke.U)(a=>a.data())):this.$store.collection(t).get().pipe((0,Xa.x)(()=>this.$overlay.endLoading(s,i)),(0,ke.U)(a=>a.docs.map(u=>({key:u.id,value:u.data()})))),update:(o,a)=>this.getDoc(t,a).update(o).then(()=>this.$overlay.endLoading(s,i)),delete:o=>this.getDoc(t,o).delete().then(()=>this.$overlay.endLoading(s,i))}}watch(t){const r=this.$overlay.startLoading();return{onChanges$:()=>this.$store.collection(t).valueChanges().pipe((0,Ya.b)(()=>this.$overlay.endLoading(r))),doc:s=>({onChanges$:()=>this.$store.collection(t).doc(s).valueChanges().pipe((0,Ya.b)(()=>this.$overlay.endLoading(r)))})}}getDoc(t,r){return this.$store.collection(t).doc(r)}getCollection(t){return this.$store.collection(t)}readDocument(t,r,s,i){return new Promise(o=>{this.getDoc(t,r).get().subscribe(a=>{this.$overlay.endLoading(s,i),o(a.data())})})}readCollection(t,r,s){return new Promise(i=>{this.$store.collection(t).get().subscribe(o=>{this.$overlay.endLoading(r,s),i(o.docs.map(a=>({key:a.id,value:a.data()})))})})}}return n.\u0275fac=function(t){return new(t||n)(k.LFG(gv),k.LFG(pv.F))},n.\u0275prov=k.Yz7({token:n,factory:n.\u0275fac,providedIn:"root"}),n})();const vv=[{path:"",component:(()=>{class n{constructor(t){this.$fb=t}ngOnInit(){}}return n.\u0275fac=function(t){return new(t||n)(k.Y36(yv))},n.\u0275cmp=k.Xpm({type:n,selectors:[["app-todo-list-page"]],decls:5,vars:0,consts:[["page-title",""],["page-container",""]],template:function(t,r){1&t&&(k.TgZ(0,"header",0),k._uU(1,"\u4ee3\u8fa6\u4e8b\u9805"),k.qZA(),k.TgZ(2,"section",1)(3,"p"),k._uU(4,"todo-list-page works!"),k.qZA()())}}),n})()}];let wv=(()=>{class n{}return n.\u0275fac=function(t){return new(t||n)},n.\u0275mod=k.oAB({type:n}),n.\u0275inj=k.cJS({imports:[Wa.Bz.forChild(vv),Wa.Bz]}),n})(),Iv=(()=>{class n{}return n.\u0275fac=function(t){return new(t||n)},n.\u0275mod=k.oAB({type:n}),n.\u0275inj=k.cJS({imports:[Ha.ez,wv]}),n})()}}]);